
Contents
Foreword	22
1	Scope	23
2	References	23
3	Definitions and abbreviations	29
4	Architecture model and concepts	40
4.2.5a	Radio Capabilities Signalling optimisation	51
4.2.8.1A	General Concepts to support Wireline Access	57
5	High level features	90
5.2.2a	Void	91
5.4.4.1a	UE (Network Function) radio capability signalling optimisation (RACS)	117
5.4.4.2a	UE (Network Function) Radio Capability Match Request	121
5.4.4a	UE (Network Function) MM Core Network Capability handling	122
5.4.4b	UE (Network Function) 5GSM Core Network Capability handling	123
5.6.5a	Supporting LADN per DNN and S-NSSAI	148
5.7.1.2a	Alternative QoS Profile	175
5.7.2.4.1a	Notification Control without Alternative QoS Profiles	181
5.7.2.4.1b	Notification control with Alternative QoS Profiles	182
5.9.2a	Subscription Concealed Identifier	237
5.15.11.5a	Support of Network Slice Admission Control in 5GS for maximum number of UEs with at least one PDU Session/PDN Connection	275
5.16.3.2a	IMS voice over PS Session Supported Indication over non-3GPP access	289
5.16.4.9a	Handling of PDU Sessions for normal services for Emergency Registered UEs	297
5.18.2a	PLMN list and SNPN list handling for network sharing	320
5.20a	Data Collection from an AF (Network Function)	331
5.20b	Support exposure of DNN and S-NSSAI specific Group Parameters	331
5.20b.1	Group attribute provisioning	331
5.20b.2	Support LADN service area for a group	331
5.20b.3	Support QoS for a group	332
5.20b.4	Void	332
5.20b.5	Support Change of PDU Session Type for a group of UEs	332
5.20c	Provisioning of traffic characteristics and monitoring of performance characteristics for a group	332
5.20d	User Plane Direct 5GS Information Exposure	333
5.20d.1	General	333
5.27.1a	Periodic deterministic communication	363
5.28a	Support for TSN enabled Transport Network	397
5.28a.1	General	397
5.28a.2	Transfer of TL-Container between SMF (Network Function)/CUC and AN-TL and CN-TL	397
5.28a.3	Topology Information for TSN TN	398
5.32.5.1a	Address of PMF messages	457
5.32.5.2a	Packet Loss Rate Measurements	458
5.35A	Support for Mobile Base Station Relay (MBSR)	493
5.35A.1	General	493
5.35A.2	 Configuration of the MBSR	493
5.35A.3	Mobility support of UEs served by MBSR	494
5.35A.3.1	UE (Network Function) mobility between a fixed cell and MBSR cell	494
5.35A.3.2	UE (Network Function) mobility between MBSR cells	494
5.35A.3.3	UE (Network Function) mobility when moving together with a MBSR cell	494
5.35A.4	MBSR authorization	494
5.35A.5	Location Service Support of UEs served by MBSR	495
5.35A.6	Providing cell ID/TAC of MBSR for services	495
5.35A.7	Control of UE (Network Function) access to MBSR	496
6	Network Functions	518
6.2.5a	Void	525
6.2.9A	TNGF (Network Function)	529
6.2.16A	GMLC (Network Function)	532
6.2.27a	MB-UPF (Network Function)	535
6.2.27b	MBSF (Network Function)	535
6.2.27c	MBSTF (Network Function)	535
6.3.6.2a	SNPN N3IWF (Network Function) selection	552
6.3.12a	Access Network selection for devices that do not support 5GC NAS (Protocol) over WLAN	568
6.3.12a.1	General	568
6.3.12a.2	Access Network Selection Procedure	568
6.3.12b	Access Network selection for 5G NSWO	569
7	Network Function Services and descriptions	576
7.2.8A	Void	588
7.2.16A	GMLC (Network Function) Services	591
8	Control and User Plane Protocol Stacks	596
Annex A (informative):	Relationship between Service-Based Interfaces and Reference Points	607
Annex B (normative):	Mapping between temporary identities	609
Annex C (informative):	Guidelines and Principles for Compute-Storage Separation	610
Annex D (informative):	5GS support for Non-Public Network deployment options	611
D.1	Introduction	611
D.2	Support of Non-Public Network as a network slice of a PLMN	611
D.3	Support for access to PLMN services via Stand-alone Non-Public Network and access to Stand-alone Non Public Network services via PLMN	612
D.4	Support for UE (Network Function) capable of simultaneously connecting to an SNPN and a PLMN	613
D.5	Support for keeping UE (Network Function) in CM-CONNECTED state in overlay network when accessing services via NWu	613
D.6	Support for session/service continuity between SNPN and PLMN when using N3IWF (Network Function)	614
D.7	Guidance for underlay network to support QoS differentiation for User Plane IPsec Child SA	615
D.7.1	Network initiated QoS	615
D.7.2	UE (Network Function) initiated QoS	616
Annex E (informative):	Communication models for NF (Network Function)/NF (Network Function) services interaction	618
E.1	General	618
Annex F (informative):	Redundant user plane paths based on multiple UEs per device	620
Annex G (informative):	SCP (Network Function) Deployment Examples	623
G.1	General	623
G.2	An SCP (Network Function) based on service mesh	623
G.2.1	Introduction	623
G.2.2	Communication across service mesh boundaries	624
G.3	An SCP (Network Function) based on independent deployment units	625
G.4	An SCP (Network Function) deployment example based on name-based routing	626
G.4.0	General Information	626
G.4.1	Service Registration and Service Discovery	627
G.4.2	Overview of Deployment Scenario	628
G.4.3	References	628
Annex H (normative):	PTP usage guidelines	629
H.1	General	629
H.2	Signalling of ingress time for time synchronization	629
H.3	Void	629
H.4	Path and Link delay measurements	629
Annex I (normative):	TSN usage guidelines	631
I.1	Determination of traffic pattern information	631
Annex J (informative):	Link MTU considerations	633
Annex K (normative):	Port and user plane node management information exchange	635
K.1	Standardized port and user plane node management information	635
K.2	Port and user plane node management information exchange for time synchronization	635
K.2.1	Capability exchange	635
K.2.2	PTP Instance configuration	635
K.2.2.1	General	635
K.2.2.2	Configuration for Sync and Announce reception timeouts	637
K.2.2.3	Configuration for PTP port states	637
K.2.2.4	Configuration for PTP grandmaster function	637
K.2.2.5	Configuration for Sync and Announce intervals	638
K.2.2.6	Configuration for transport protocols	638
Annex L (Service-based Interface) (normative):	Support of GERAN/UTRAN access	640
Annex M (normative):	Interworking with TSN deployed in the Transport Network	641
M.1	Mapping of the parameters between 5GS and TSN UNI	641
M.2	TL-Container Information	645
Annex N (Service-based Interface) (informative):	Support for access to localized services	648
N (Service-based Interface).1	General	648
N (Service-based Interface).2	Enabling access to localized services	648
N (Service-based Interface).2.1	General	648
N (Service-based Interface).2.2	Configuration of network to provide access to localized services	648
N (Service-based Interface).2.3	Session Management aspects	649
N (Service-based Interface).3	Selection of network providing access to localized services	649
N (Service-based Interface).4	Enabling the UE (Network Function) access to localized services	649
N (Service-based Interface).5	Support for leaving network that provides access to localized services	649
N (Service-based Interface).6	Configuration of Credentials Holder for determining SNPN selection information	650
Annex O (informative):	Allowing UE (Network Function) to simultaneously send data to different groups with different QoS policy	651
O.1	A PDU Session with multiple QoS Flows for different groups	651
O.2	Multiple PDU Sessions for different groups	652
O.3	A PDU Session targeting a predefined group formed of multiple sub-groups	653
Annex P (informative):	Personal IoT Networks	655
P.1	PIN Reference Architecture	655
P.2	Session management and traffic routing for PIN	655
Annex Q (informative):	Satellite coverage availability information	657
Annex R (informative):	Change history	658


Foreword
This Technical Specification has been produced by the 3rd Generation Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the TSG and may change following formal TSG approval. Should the TSG modify the contents of the present document, it will be re-released by the TSG with an identifying change of release date and an increase in version number as follows:
Version x.y.z
where:
x	the first digit:
1	presented to TSG for information;
2	presented to TSG for approval;
3	or greater indicates TSG approved document under change control.
y	the second digit is incremented for all changes of substance, i.e. technical enhancements, corrections, updates, etc.
z	the third digit is incremented when editorial only changes have been incorporated in the document.
1	Scope
The present document defines the Stage 2 system architecture for the 5G System. The 5G System provides data connectivity and services.
This specification covers both roaming and non-roaming scenarios in all aspects, including interworking between 5GS and EPS, mobility within 5GS, QoS, policy control and charging, authentication and in general 5G System wide features e.g. SMS, Location Services, Emergency Services.
ITU-T Recommendation I.130 [11] describes a three-stage method for characterisation of telecommunication services, and ITU-T Recommendation Q.65 [12] defines Stage 2 of the method.
TS 23.502 [3] contains the stage 2 procedures and flows for 5G System and it is a companion specification to this specification.
TS 23.503 [45] contains the stage 2 Policy Control and Charging architecture for 5G System and it is a companion specification to this specification.
2	References
The following documents contain provisions which, through reference in this text, constitute provisions of the present document.
-	References are either specific (identified by date of publication, edition number, version number, etc.) or non-specific.
-	For a specific reference, subsequent revisions do not apply.
-	For a non-specific reference, the latest version applies. In the case of a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.
[1]	3GPP TR 21.905: "Vocabulary for 3GPP Specifications".
[2]	3GPP TS 22.261: "Service requirements for next generation new services and markets; Stage 1".
[3]	3GPP TS 23.502: "Procedures for the 5G System; Stage 2".
[4]	3GPP TS 23.203: "Policies and Charging control architecture; Stage 2".
[5]	3GPP TS 23.040: "Technical realization of the Short Message Service (SMS); Stage 2".
[6]	3GPP TS 24.011: "Point-to-Point (PP) Short Message Service (SMS) support on mobile radio interface: Stage 3".
[7]	IETF RFC 7157: "IPv6 Multihoming without Network Address Translation".
[8]	IETF RFC 4191: "Default Router Preferences and More-Specific Routes".
[9]	IETF RFC 2131: "Dynamic Host Configuration Protocol".
[10]	IETF RFC 4862: "IPv6 Stateless Address Autoconfiguration".
[11]	ITU-T Recommendation I.130: "Method for the characterization of telecommunication services supported by an ISDN and network capabilities of an ISDN".
[12]	ITU-T Recommendation Q.65: "The unified functional methodology for the characterization of services and network capabilities".
[13]	3GPP TS 24.301: "Non-Access-Stratum (NAS) protocol for Evolved Packet System (EPS): Stage 3".
[14]	IETF RFC 3736: "Stateless DHCP Service for IPv6".
[15]	3GPP TS 23.228: "IP  (Protocol)Multimedia Subsystem (IMS); Stage 2".
[16]	3GPP TS 22.173: "IMS Multimedia Telephony Service and supplementary services; Stage 1".
[17]	3GPP TS 23.122: "Non-Access-Stratum (NAS) functions related to Mobile Station in idle mode".
[18]	3GPP TS 23.167: "3rd Generation Partnership Project; Technical Specification Group Services and Systems Aspects; IP  (Protocol)Multimedia Subsystem (IMS) emergency sessions".
[19]	3GPP TS 23.003: "Numbering, Addressing and Identification".
[20]	IETF RFC 7542: "The Network Access Identifier".
[21]	3GPP TS 23.002: "Network Architecture".
[22]	3GPP TS 23.335: "User Data Convergence (UDC); Technical realization and information flows; Stage 2".
[23]	3GPP TS 23.221: "Architectural requirements".
[24]	3GPP TS 22.153: "Multimedia priority service".
[25]	3GPP TS 22.011: "Service Accessibility".
[26]	3GPP TS 23.401: "General Packet Radio Service (GPRS) enhancements for Evolved Universal Terrestrial Radio Access Network (E-UTRAN) access".
[27]	3GPP TS 38.300: "NR; NR and NG-RAN (Network Function) Overall Description".
[28]	3GPP TS 38.331: "NR; Radio Resource Control (RRC); Protocol Specification".
[29]	3GPP TS 33.501: "Security architecture and procedures for 5G system".
[30]	3GPP TS 36.300: "Evolved Universal Terrestrial Radio Access (E-UTRA) and Evolved Universal Terrestrial Radio Access Network (E-UTRAN); Overall description; Stage 2".
[31]	3GPP TS 37.340: "Evolved Universal Terrestrial Radio Access (E-UTRA) and NR; Multi-connectivity; Stage 2".
[32]	3GPP TS 23.214: "Architecture enhancements for control and user plane separation of EPC nodes; Stage 2".
[33]	3GPP TS 22.101: "3rd Generation Partnership Project; Technical Specification Group Services and Systems Aspects; Service aspects; Service principles".
[34]	3GPP TS 38.413: "NG-RAN (Network Function); NG Application (Protocol) Protocol (NGAP)".
[35]	3GPP TS 33.126: "Lawful Interception Requirements".
[36]	3GPP TS 23.682: "Architecture enhancements to facilitate communications with packet data networks and applications".
[37]	3GPP TS 22.280: "Mission Critical Services Common Requirements (MCCoRe); Stage 1".
[38]	3GPP TS 23.379: "Functional architecture and information flows to support Mission Critical Push To Talk (MCPTT); Stage 2".
[39]	3GPP TS 23.281: "Functional architecture and information flows to support Mission Critical Video (MCVideo); Stage 2".
[40]	3GPP TS 23.282: "Functional architecture and information flows to support Mission Critical Data (MCData); Stage 2".
[41]	3GPP TS 32.240: "Charging management; Charging architecture and principles".
[42]	3GPP TS 38.401: "NG-RAN (Network Function) Architecture description".
[43]	3GPP TS 23.402: "Architecture enhancements for non-3GPP accesses".
[44]	IETF RFC 4960: "Stream Control Transmission Protocol".
[45]	3GPP TS 23.503: "Policy and Charging Control Framework for the 5G System".
[46]	3GPP TS 23.041: "Public Warning System".
[47]	3GPP TS 24.501: "Non-Access-Stratum (NAS) protocol for 5G System (5GS); Stage 3".
[48]	3GPP TS 24.502: "Access to the 5G System (5GS) via non-3GPP access networks; Stage 3".
[49]	3GPP TS 29.500: "5G System; Technical Realization of Service Based Architecture; Stage 3".
[50]	3GPP TS 38.304: "NR; User Equipment (UE (Network Function)) procedures in idle mode".
[51]	3GPP TS 36.331: "Evolved Universal Terrestrial Radio Access (E-UTRA); Radio Resource Control (RRC); Protocol specification".
[52]	3GPP TS 36.304: "Evolved Universal Terrestrial Radio Access (E-UTRA); User Equipment (UE (Network Function)) procedures in idle mode".
[53]	Void.
[54]	IETF RFC 4861: "Neighbor Discovery for IP  (Protocol)version 6 (IPv6)".
[55]	3GPP TS 23.271: "Functional stage 2 description of Location Services (LCS)".
[56]	3GPP TS 23.060: "General Packet Radio Service (GPRS); Service description; Stage 2".
[57]	IETF RFC 4555: "IKEv2 Mobility and Multihoming Protocol (MOBIKE)".
[58]	3GPP TS 29.510: "5G System: Network function repository services; Stage 3".
[59]	3GPP TS 29.502: "5G System: Session Management Services: Stage 3".
[60]	IETF RFC 7296: "Internet Key Exchange Protocol Version 2 (IKEv2) ".
[61]	3GPP TS 23.380: "IMS Restoration Procedures".
[62]	3GPP TS 24.229: "IP  (Protocol)multimedia call control protocol based on Session Initiation Protocol (SIP) and Session Description Protocol (SDP); Stage 3".
[63]	3GPP TS 23.292: "IP  (Protocol)Multimedia Subsystem (IMS) centralized services; Stage 2".
[64]	3GPP TS 23.222: "Functional architecture and information flows to support Common API Framework for 3GPP Northbound APIs".
[65]	3GPP TS 29.244: "Interface between the Control Plane and the User Plane Nodes; Stage 3".
[66]	3GPP TS 32.421: "Telecommunication management; Subscriber and equipment trace; Trace concepts and requirements".
[67]	3GPP TS 32.290: "5G system; Services, operations and procedures of charging using Service Based Interface (SBI)".
[68]	3GPP TS 32.255: "5G Data connectivity domain charging; Stage 2".
[69]	3GPP TS 38.306: "NR; User Equipment -UE (Network Function)) radio access capabilities".
[70]	3GPP TS 36.306: "Evolved Universal Terrestrial Radio Access -E-UTRA); User Equipment -UE (Network Function)) radio access capabilities".
[71]	3GPP TS 29.518: "5G System; Access and Mobility Management Services; Stage 3".
[72]	Void.
[73]	IETF RFC 2865: "Remote Authentication Dial In User Service (RADIUS)".
[74]	IETF RFC 3162: "RADIUS and IPv6".
[75]	3GPP TS 29.281: "General Packet Radio System (GPRS) Tunnelling Protocol User Plane (GTPv1-U)".
[76]	3GPP TS 26.238: "Uplink streaming".
[77]	3GPP TR 26.939: "Guidelines on the Framework for Live Uplink Streaming (FLUS)".
[78]	International Telecommunication Union (ITU), Standardization Bureau (TSB): "Operational Bulletin No. 1156"; http://handle.itu.int/11.1002/pub/810cad63-en (retrieved October 5, 2018).
[79]	3GPP TS 28.533: "Management and orchestration; Architecture framework".
[80]	3GPP TS 24.250: "Protocol for Reliable Data Service; Stage 3".
[81]	IETF RFC 8684: "TCP Extensions for Multipath Operation with Multiple Addresses".
[82]	IETF RFC 8803: "0-RTT TCP  (Protocol)Convert Protocol".
[83]	IEEE Std 802.1CB-2017: "IEEE Standard for Local and metropolitan area networks-Frame Replication and Elimination for Reliability".
[84]	3GPP TS 23.316: "Wireless and wireline convergence access support for the 5G System (5GS)".
[85]	WiFi Alliance Technical Committee, Hotspot 2.0 Technical Task Group: "Hotspot 2.0 (Release 2) Technical Specification".
[86]	3GPP TS 23.288: "Architecture enhancements for 5G System (5GS) to support network data analytics services".
[87]	3GPP TS 23.273: "5G System (5GS) Location Services (LCS); Stage 2".
[88]	3GPP TS 23.216: "Single Radio Voice Call Continuity (SRVCC); Stage 2".
[89]	CableLabs DOCSIS MULPI: "Data-Over-Cable Service Interface Specifications DOCSIS 3.1, MAC  (Protocol)and Upper Layer Protocols Interface Specification".
[90]	BBF TR-124 issue 5: "Functional Requirements for Broadband Residential Gateway Devices".
[91]	BBF TR-101 issue 2: "Migration to Ethernet-Based Broadband Aggregation".
[92]	BBF TR-178 issue 1: "Multi-service Broadband Network Architecture and Nodal Requirements".
[93]	BBF TR-456 issue 2: "AGF Functional Requirements".
[94]	BBF WT-457: "FMIF Functional Requirements".
Editor's note:	The reference to BBF WT-457 will be revised when finalized by BBF.
[95]	Void.
[96]	Void.
[97]	IEEE Std 802.1AB-2016: "IEEE Standard for Local and metropolitan area networks -- Station and Media Access Control Connectivity Discovery".
[98]	IEEE Std 802.1Q-2022: "IEEE Standard for Local and metropolitan area networks--Bridges and Bridged Networks".
[99]	3GPP TS 38.423: "NG-RAN (Network Function); Xn Application (Protocol) Protocol (XnAP)".
[100]	3GPP TS 36.413: "Evolved Universal Terrestrial Radio Access Network (E-UTRAN); S1 Application (Protocol) Protocol (S1AP)".
[101]	3GPP TS 29.274: "Evolved General Packet Radio Service (GPRS) Tunnelling Protocol for Control plane (GTPv2-C); Stage 3".
[102]	3GPP TS 23.632: "User Data Interworking, Coexistence and Migration; stage 2".
[103]	3GPP TS 29.563: "5G System (5GS); HSS services for interworking with UDM (Network Function); Stage 3".
[104]	IEEE Std 802.1AS-2020: "IEEE Standard for Local and metropolitan area networks--Timing and Synchronization for Time-Sensitive Applications".
[105]	3GPP TS 22.104: "Service requirements for cyber-physical control applications in vertical domains".
[106]	IEEE Std 802.11-2012: "IEEE Standard for Information technology - Telecommunications and information exchange between systems - Local and metropolitan area networks - Specific requirements - Part 11: Wireless LAN Medium Access Control (MAC) and Physical Layer (PHY) Specifications".
[107]	IEEE Std 1588-2008: "IEEE Standard for a Precision Clock Synchronization Protocol for Networked Measurement and Control Systems".
[108]	3GPP TS 28.552: "Management and orchestration; 5G performance measurements".
[109]	3GPP TS 24.193: "Access Traffic Steering, Switching and Splitting; Stage 3".
[110]	3GPP TS 24.526: "User Equipment (UE (Network Function)) policies for 5G System (5GS); Stage 3".
[111]	3GPP TS 22.186: "Enhancement of 3GPP support for V2X scenarios; Stage 1".
[112]	3GPP TR 38.824: "Study on physical layer enhancements for NR ultra-reliable and low latency case (URLLC)".
[113]	IEEE: "Guidelines for Use of Extended Unique Identifier (EUI), Organizationally Unique Identifier (OUI), and Company ID (CID)", https://standards.ieee.org/content/dam/ieee-standards/standards/web/documents/tutorials/eui.pdf.
[114]	3GPP TS 32.256: "Charging Management; 5G connection and mobility domain charging; Stage 2".
[115]	3GPP TS 33.210: "Network Domain Security (NDS); IP  (Protocol)network layer security".
[116]	3GPP TS 38.415: "PDU Session User Plane Protocol".
[117]	3GPP TS 24.535: "Device-side Time-Sensitive Networking (TSN) Translator (DS-TT) to network-side TSN Translator (NW-TT) protocol aspects; Stage 3".
[118]	3GPP TS 32.274: "Charging Management; Short Message Service (SMS) charging".
[119]	3GPP TS 23.008: "Organization of subscriber data".
[120]	3GPP TS 38.314: "NR; Layer 2 measurements".
[121]	3GPP TS 23.287: "Architecture enhancements for 5G System (5GS) to support Vehicle-to-Everything (V2X) services".
[122]	3GPP TS 29.503: "5G System; Unified Data Management Services; Stage 3".
[123]	3GPP TS 32.254: "Charging management; Exposure function Northbound Application (Protocol) Program Interfaces (APIs) charging".
[124]	3GPP TS 33.535: "Authentication and Key Management for Applications based on 3GPP credentials in the 5G System (5GS)".
[125]	3GPP TS 38.410: "NG-RAN (Network Function); NG general aspects and principles".
[126]	IEEE Std 1588: "IEEE Standard for a Precision Clock Synchronization Protocol for Networked Measurement and Control Systems", Edition 2019.
[127]	ST 2059-2:2015: "SMPTE Standard - SMPTE Profile for Use of IEEE-1588 Precision Time Protocol in Professional Broadcast Applications".
[128]	3GPP TS 23.304: "Proximity based Services (ProSe) in the 5G System (5GS)".
[129]	3GPP TS 23.247: "Architectural enhancements for 5G multicast-broadcast services".
[130]	3GPP TS 23.548: "5G System Enhancements for Edge Computing; Stage 2".
[131]	IEEE Std 802.3: "Ethernet".
[132]	3GPP TS 29.561: "5G System; Interworking between 5G Network and external Data Networks; Stage 3".
[133]	3GPP TS 29.513: "Policy and Charging Control signalling flows and QoS parameter mapping; Stage 3".
[134]	3GPP TS 23.558: "Architecture for enabling Edge Applications (EA)".
[135]	3GPP TS 26.501: "5G Media Streaming (5GMS); General description and architecture".
[136]	3GPP TS 23.256: "Support of Uncrewed Aerial Systems (UAS) connectivity, identification and tracking; Stage 2".
[137]	GSMA NG.116: "Generic Network Slice Template".
[138]	IETF RFC 3948: "UDP Encapsulation of IPsec ESP Packets".
[139]	3GPP TS 24.539: "5G System (5GS); Network to TSN translator (TT) protocol aspects; Stage 3".
[140]	3GPP TS 33.220: "Generic Authentication Architecture (GAA); Generic bootstrapping architecture".
[141]	3GPP TS 33.223: "Generic Authentication Architecture (GAA); Generic Bootstrapping Architecture (GBA) Push function".
[142]	3GPP TS 23.540: "Technical realization of Service Based Short Message Service; Stage 2".
[143]	3GPP TS 38.321: "NR; Medium Access Control (MAC) protocol specification".
[144]	3GPP TS 29.525: "5G System; UE (Network Function) Policy Control Service; Stage 3".
[145]	3GPP TS 29.505: "5G System; Usage of the Unified Data Repository Services for Subscription Data; Stage 3".
[146]	IEEE Std P802.1Qdj-d1.0: "IEEE Draft Standard for Local and metropolitan area networks - Bridges and Bridged Networks - Amendment XX: Configuration Enhancements for Time-Sensitive Networking".
[147]	Void.
[148]	3GPP TS 28.557: "Management and orchestration; Management of Non-Public Networks (NPN)".
[149]	3GPP TS 28.541: "Management and orchestration; 5G Network Resource Model (NRM)".
[150]	IETF RFC 8655: "Deterministic Networking Architecture".
[151]	IETF RFC 8343: "A YANG Data Model for Interface Management".
[152]	IETF RFC 8344: "A YANG Data Model for IP  (Protocol)Management".
[153]	IETF RFC 7224: " IANA Interface Type YANG Module".
[154]	IETF draft-ietf-detnet-yang: "Deterministic Networking (DetNet) YANG Model".
Editor's note:	The reference to draft-ietf-detnet-yang will be revised to RFC when finalized by IETF.
[155]	IETF RFC 6241: "Network Configuration Protocol (NETCONF)".
[156]	IETF RFC 8040: "RESTCONF Protocol".
[157]	IETF RFC 8939: "Deterministic Networking (DetNet) Data Plane: IP".
[158]	IETF RFC 5279: "A Uniform Resource Name (URN) Namespace for the 3rd Generation Partnership Project (3GPP)".
[159]	IETF RFC 9330:"Low Latency, Low Loss, Scalable Throughput (L4S) Internet Service: Architecture".
[160]	IETF RFC 9331: "Explicit Congestion Notification (ECN) Protocol for Very Low Queuing Delay (L4S)".
[161]	IETF RFC 9332: "Dual-Queue Coupled Active Queue Management (AQM) for Low Latency, Low Loss, and Scalable Throughput (L4S)".
[162]	IETF RFC 6603: "Prefix Exclude Option for DHCPv6-based Prefix Delegation".
[163]	IETF RFC 8415: "Dynamic Host Configuration Protocol for IPv6 (DHCPv6)".
[164]	ITU-T Recommendation G.810: "Definitions and terminology for synchronization networks".
[165]	3GPP TS 38.470: "NG-RAN (Network Function); F1 general aspects and principles".
[166]	IETF RFC 9000: "QUIC: A UDP-Based Multiplexed and Secure Transport".
[167]	IETF RFC 9001: "Using TLS to Secure QUIC".
[168]	IETF RFC 9002: "QUIC Loss Detection and Congestion Control".
[169]	IETF RFC 9221: "An Unreliable Datagram Extension to QUIC".
[170]	IETF RFC 9298: "Proxying UDP  (Protocol)in HTTP (Protocol)".
[171]	IETF RFC 9114: "Hypertext Transfer Protocol Version 3 (HTTP/3)".
[172]	IETF RFC 9297: "HTTP Datagrams and the Capsule Protocol".
[173]	IETF RFC 9220: "Bootstrapping WebSockets with HTTP (Protocol)/3".
[174]	draft-ietf-quic-multipath: "Multipath Extension for QUIC".
Editor's note:	The above document cannot be formally referenced until it is published as an RFC.
[175]	3GPP TS 28.530: "Management and orchestration; Concepts, use cases and requirements".
[176]	3GPP TS 28.531: "Management and orchestration; Provisioning".
[177]	3GPP TS 23.434: "Service Enabler Architecture Layer for Verticals (SEAL); Functional architecture and information flows".
[178]	IEEE Std 802.1CBdb-2021: "Amendment 2: Extend Stream Identification Functions".
[179]	3GPP TS 26.522: "5G Real-time Media Transport Protocol Configurations".
[180]	3GPP TS 23.586: "Architectural Enhancements to support Ranging based services and Sidelink Positioning".
[181]	3GPP TS 23.542: "Application layer support for Personal IoT Network".
3	Definitions and abbreviations
For the purposes of the present document, the terms and definitions given in TR 21.905 [1] and the following apply. A term defined in the present document takes precedence over the definition of the same term, if any, in TR 21.905 [1].
5G VN Group: A set of UEs using private communication for 5G LAN-type service.
5G Access Network: An access network comprising a NG-RAN (Network Function) and/or non-3GPP AN connecting to a 5G Core Network.
5G Access Stratum-based Time Distribution: A time synchronization distribution method that is used by an NG-RAN (Network Function) to provide the 5GS time to the UE (Network Function)(s) over the radio interface using procedures specified in TS 38.331 [28].
5G Core Network: The core network specified in the present document. It connects to a 5G Access Network.
5G LAN-Type Service: A service over the 5G system offering private communication using IP  (Protocol)and/or non-IP  (Protocol)type communications.
5G LAN-Virtual Network: A virtual network over the 5G system capable of supporting 5G LAN-type service.
5G NSWO: The 5G NSWO is the capability provided by 5G system and by UE (Network Function) to enable the connection to a WLAN access network using 5GS credentials without registration to 5GS.
5G QoS Flow or QoS Flow: The finest granularity for QoS forwarding treatment in the 5G System. All traffic mapped to the same 5G QoS Flow receive the same forwarding treatment (e.g. scheduling policy, queue management policy, rate shaping policy, RLC  (Protocol)configuration, etc.). Providing different QoS forwarding treatment requires separate 5G QoS Flow.
5G QoS Identifier: A scalar that is used as a reference to a specific QoS forwarding behaviour (e.g. packet loss rate, packet delay budget) to be provided to a 5G QoS Flow. This may be implemented in the access network by the 5QI referencing node specific parameters that control the QoS forwarding treatment (e.g. scheduling weights, admission thresholds, queue management thresholds, link layer protocol configuration, etc.).
5G System: 3GPP system consisting of 5G Access Network (AN), 5G Core Network and UE (Network Function).
5G-BRG: The 5G-BRG is a 5G-RG defined in BBF.
5G-CRG: The 5G-CRG is a 5G-RG specified in DOCSIS MULPI [89].
5G-RG: A 5G-RG is a RG capable of connecting to 5GC playing the role of a UE (Network Function) with regard to the 5G core. It supports secure element and exchanges N1 (Non-service-based Interface) (Service-based Interface) signalling with 5GC. The 5G-RG can be either a 5G-BRG or 5G-CRG.
Access Traffic Steering: The procedure that selects an access network for a new data flow and transfers the traffic of this data flow over the selected access network. Access traffic steering is applicable between one 3GPP access and one non-3GPP access.
Access Traffic Switching: The procedure that moves all traffic of an ongoing data flow from one access network to another access network in a way that maintains the continuity of the data flow. Access traffic switching is applicable between one 3GPP access and one non-3GPP access.
Access Traffic Splitting: The procedure that splits the traffic of a data flow across multiple access networks. When traffic splitting is applied to a data flow, some traffic of the data flow is transferred via one access and some other traffic of the same data flow is transferred via another access. Access traffic splitting is applicable between one 3GPP access and one non-3GPP access.
Allowed NSSAI: Indicating the S-NSSAIs values the UE (Network Function) could use in the Serving PLMN in the current Registration Area.
Allowed Area: Area where the UE (Network Function) is allowed to initiate communication as specified in clause 5.3.2.3.
Alternative S-NSSAI: Indicating a compatible S-NSSAI for an S-NSSAI in the Allowed NSSAI that the AMF (Network Function) uses to replace an S-NSSAI when the S-NSSAI is not available or congested, as specified in clause 5.15.19.
AMF (Network Function) Region: An AMF (Network Function) Region consists of one or multiple AMF (Network Function) Sets.
AMF (Network Function) Set: An AMF (Network Function) Set consists of some AMFs that serve a given area and Network Slice(s). AMF (Network Function) Set is unique within an AMF (Network Function) Region and it comprises of AMFs that support the same Network Slice(s). Multiple AMF (Network Function) Sets may be defined per AMF (Network Function) Region. The AMF (Network Function) instances in the same AMF (Network Function) Set may be geographically distributed but have access to the same context data.
Application Identifier: An identifier that can be mapped to a specific application traffic detection rule.
AUSF (Network Function) Group ID: This refers to one or more AUSF (Network Function) instances managing a specific set of SUPIs. An AUSF (Network Function) Group consists of one or multiple AUSF (Network Function) Sets.
Binding Indication: Information included by a NF (Network Function) service producer to a NF (Network Function) service consumer in request responses or notifications to convey the scope within which selection/reselection of target NF (Network Function)/NF (Network Function) Services may be performed, or information included by the NF (Network Function) service consumer in requests or subscriptions to convey the scope within which selection/reselection of notification targets or the selection of other service(s) that the NF (Network Function) consumer produces for the same data context may be performed. See clause 6.3.1.0.
BSF (Network Function) Group ID: This refers to one or more BSF (Network Function) instances managing a specific set of SUPIs or GPSIs. A BSF (Network Function) Group consists of one or multiple BSF (Network Function) Sets.
Configured NSSAI: NSSAI provisioned in the UE (Network Function) applicable to one or more PLMNs.
CHF (Network Function) Group ID: This refers to one or more CHF (Network Function) instances managing a specific set of SUPIs.
Credentials Holder: Entity which authenticates and authorizes access to an SNPN separate from the Credentials Holder.
Data Burst: A set of multiple PDUs generated and sent by the application in a short period of time.
NOTE 1:	A Data Burst can be composed of one or multiple PDU Sets.
Default UE (Network Function) credentials: Information configured in the UE (Network Function) to make the UE (Network Function) uniquely identifiable and verifiably secure to perform UE (Network Function) onboarding.
Default Credentials Server (DCS): An entity that can perform authentication based on the Default UE (Network Function) credentials or provide means for another entity to perform authentication based on the Default UE (Network Function) credentials.
Delegated Discovery: This refers to delegating the discovery and associated selection of NF (Network Function) instances or NF (Network Function) service instances to an SCP (Network Function).
Direct Communication: This refers to the communication between NFs or NF (Network Function) services without using an SCP (Network Function).
Disaster Condition: See definition in TS 22.261 [2].
Disaster Inbound Roamer: See definition in TS 22.261 [2].
Disaster Roaming: See definition in TS 22.261 [2].
DN (Network Function) Access Identifier (DNAI): Identifier of a user plane access to one or more DN (Network Function)(s) where applications are deployed.
Emergency Registered: A UE (Network Function) is considered Emergency Registered over an Access Type in a PLMN when registered for emergency services only over this Access Type in this PLMN.
Endpoint Address: An address in the format of an IP  (Protocol)address or FQDN, which is used to determine the host/authority part of the target URI. This Target URI is used to access an NF (Network Function) service (i.e. to invoke service operations) of an NF (Network Function) service producer or for notifications to an NF (Network Function) service consumer.
En-gNB: as defined in TS 37.340 [31].
Expected UE (Network Function) Behaviour: Set of parameters provisioned by an external party to 5G network functions on the foreseen or expected UE (Network Function) behaviour, see clause 5.20.
Fixed Network Residential Gateway: A Fixed Network RG (FN-RG) is a RG that it does not support N1 (Non-service-based Interface) (Service-based Interface) signalling and it is not 5GC capable.
Fixed Network Broadband Residential Gateway: A Fixed Network RG (FN-BRG) is a FN-RG specified in BBF TR-124 [90].
Fixed Network Cable Residential Gateway: A Fixed Network Cable RG (FN-CRG) is a FN-RG with cable modem specified in DOCSIS MULPI [89].
Forbidden Area: An area where the UE (Network Function) is not allowed to initiate communication as specified in clause 5.3.2.3.
GBR QoS Flow: A QoS Flow using the GBR resource type or the Delay-critical GBR resource type and requiring guaranteed flow bit rate.
Group ID for Network Selection (GIN): An identifier used during SNPN selection to enhance the likelihood of selecting a preferred SNPN that supports a Default Credentials Server or a Credentials Holder.
(g)PTP-based Time Distribution: a method to distribute timing among entities in a (g)PTP domain using PTP messages generated by a GM (in the case the GM is external to 5GS) or by 5GS (in the case the 5GS acts as a GM for a given (g)PTP domain). Possible dependencies between (g)PTP-based Time Distribution and 5G Access Stratum-based Time Distribution are described in clause 5.27.1. The synchronization process is described in clause 5.27.1 and follows the applicable profiles of IEEE Std 802.1AS [104] or IEEE Std 1588 [126].
Home Network Public Key Identifier: An identifier used to indicate which public/private key pair is used for SUPI protection and de-concealment of the SUCI as specified in TS 23.003 [19].
IAB-donor: This is a NG-RAN (Network Function) node that supports Integrated access and backhaul (IAB) feature and provides connection to the core network to IAB-nodes. It supports the CU function of the CU/DU architecture for IAB defined in TS 38.401 [42].
IAB-node: A relay node that supports wireless in-band and out-of-band relaying of NR access traffic via NR Uu backhaul links. It supports the UE (Network Function) function and the DU function of the CU/DU architecture for IAB defined in TS 38.401 [42].
Indirect Communication: This refers to the communication between NFs or NF (Network Function) services via an SCP (Network Function).
Initial Registration: UE (Network Function) registration in RM-DEREGISTERED state as specified in clause 5.3.2.
Intermediate SMF (Network Function) (I-SMF (Network Function)): An SMF (Network Function) that is inserted to support a PDU session as the UE (Network Function) is located in an area which cannot be controlled by the original SMF (Network Function) because the UPF (Network Function)(s) belong to a different SMF (Network Function) Service Area.
Local Area Data Network: a DN (Network Function) that is accessible by the UE (Network Function) only in specific locations, that provides connectivity to a specific DNN, and whose availability is provided to the UE (Network Function).
Local Break Out (LBO): Roaming scenario for a PDU Session where the PDU Session Anchor and its controlling SMF (Network Function) are located in the serving PLMN (VPLMN).
LTE-M: a 3GPP RAT type Identifier used in the Core Network only, which is a sub-type of E-UTRA RAT type, and defined to identify in the Core Network the E-UTRA when used by a UE (Network Function) indicating Category M.
MA PDU Session: A PDU Session that provides a PDU connectivity service, which can use one access network at a time, or simultaneously one 3GPP access network and one non-3GPP access network.
Mobile Base Station Relay: A mobile base station acts as a relay between a UE (Network Function) and the 5G network. Such mobile base station relay can for example be mounted on a moving vehicle and serve UEs that can be located inside or outside the vehicle (or entering/leaving the vehicle). See description of TS 22.261 [2]. A mobile Base Station Relay is supported in 5GS with the IAB-architecture with mobility as specified in clause 5.35A and that described in TS 38.401 [42].
Mobility Pattern: Network concept of determining within the AMF (Network Function) the UE (Network Function) mobility parameters as specified in clause 5.3.2.4.
Mobility Registration Update: UE (Network Function) re-registration when entering new TA outside the TAI List as specified in clause 5.3.2.
MPS-subscribed UE (Network Function): A UE (Network Function) having a USIM with MPS subscription.
Multi-USIM UE (Network Function): A UE (Network Function) with multiple USIMs, capable of maintaining a separate registration state with a PLMN for each USIM at least over 3GPP Access and supporting one or more of the features described in clause 5.38.
NB-IoT UE (Network Function) Priority: Numerical value used by the NG-RAN (Network Function) to prioritise between different UEs accessing via NB-IoT.
NGAP UE (Network Function) association: The logical per UE (Network Function) association between a 5G-AN node and an AMF (Network Function).
NGAP UE (Network Function)-TNLA-binding: The binding between a NGAP UE (Network Function) association and a specific TNL association for a given UE (Network Function).
Network Function: A 3GPP adopted or 3GPP defined processing function in a network, which has defined functional behaviour and 3GPP defined interfaces.
NOTE 2:	A network function can be implemented either as a network element on a dedicated hardware, as a software instance running on a dedicated hardware, or as a virtualised function instantiated on an appropriate platform, e.g. on a cloud infrastructure.
Network Instance: Information identifying a domain. Used by the UPF (Network Function) for traffic detection and routing.
Network Slice: A logical network that provides specific network capabilities and network characteristics.
Network Slice Area of Service: The area where a UE (Network Function) can access and get service of a particular network slice as more than zero resources are allocated to the network slice in the NG-RAN (Network Function) cells.
Network Slice instance: A set of Network Function instances and the required resources (e.g. compute, storage and networking resources) which form a deployed Network Slice.
Non-GBR QoS Flow: A QoS Flow using the Non-GBR resource type and not requiring guaranteed flow bit rate.
NSI ID: an identifier for identifying the Core Network part of a Network Slice instance when multiple Network Slice instances of the same Network Slice are deployed, and there is a need to differentiate between them in the 5GC.
NF (Network Function) instance: an identifiable instance of the NF (Network Function).
NF (Network Function) service: a functionality exposed by a NF (Network Function) through a service-based interface and consumed by other authorized NFs.
NF (Network Function) service instance: an identifiable instance of the NF (Network Function) service.
NF (Network Function) service operation: An elementary unit a NF (Network Function) service is composed of.
NF (Network Function) Service Set: A group of interchangeable NF (Network Function) service instances of the same service type within an NF (Network Function) instance. The NF (Network Function) service instances in the same NF (Network Function) Service Set have access to the same context data.
NF (Network Function) Set: A group of interchangeable NF (Network Function) instances of the same type, supporting the same services and the same Network Slice(s). The NF (Network Function) instances in the same NF (Network Function) Set may be geographically distributed but have access to the same context data.
NG-RAN (Network Function): A radio access network that supports one or more of the following options with the common characteristics that it connects to 5GC:
1)	Standalone New Radio.
2)	New Radio is the anchor with E-UTRA extensions.
3)	Standalone E-UTRA.
4)	E-UTRA is the anchor with New Radio extensions.
Non-3GPP QoS Assistance Information: A set of QoS assistance information provided to the UE (Network Function) (e.g. PEGC) to enable the UE (Network Function) to perform QoS differentiation for the connected devices in the non-3GPP network behind the UE (Network Function).
Non-Allowed Area: Area where the UE (Network Function) is allowed to initiate Registration procedure but no other communication as specified in clause 5.3.2.3.
Non-Public Network: See definition in TS 22.261 [2].
Non-Seamless Non-3GPP offload: The offload of user plane traffic via non-3GPP access without traversing either N3IWF (Network Function)/TNGF (Network Function) or UPF (Network Function).
Non-Seamless WLAN offload: Non-Seamless Non-3GPP offload when the non-3GPP access network is WLAN.
Onboarding Network: Either a PLMN enabling Remote Provisioning for a registered UE (Network Function), or an Onboarding SNPN.
Onboarding Standalone Non-Public Network: An SNPN providing Onboarding access and enabling Remote Provisioning for a UE (Network Function) registered for Onboarding as specified in clause 4.2.2.2.4 of TS 23.502 [3].
Partially Allowed NSSAI: Indicating the S-NSSAIs values the UE (Network Function) could use in the Serving PLMN or SNPN in some of the TAs in the current Registration Area. Each S-NSSAI in the Partially Allowed NSSAI is associated with a list of TAs where the S-NSSAI is supported.
PCF (Network Function) Group ID: This refers to one or more PCF (Network Function) instances managing a specific set of SUPIs. A PCF (Network Function) Group consists of one or multiple PCF (Network Function) Sets.
PDU Connectivity Service: A service that provides exchange of PDUs between a UE (Network Function) and a Data Network.
PDU Session: Association between the UE (Network Function) and a Data Network that provides a PDU connectivity service.
PDU Session Type: The type of PDU Session which can be IPv4, IPv6, IPv4v6, Ethernet or Unstructured.
PDU Set: One or more PDUs carrying the payload of one unit of information generated at the application level (e.g. frame(s) or video slice(s) etc. for eXtended Reality (XR) Services). All the PDUs of a PDU set are transmitted within the same QoS Flow.
Pending NSSAI: NSSAI provided by the Serving PLMN during a Registration procedure, indicating the S-NSSAI(s) for which the network slice-specific authentication and authorization procedure is pending.
Periodic Registration Update: UE (Network Function) re-registration at expiry of periodic registration timer as specified in clause 5.3.2.
Personal IoT Network (PIN): A configured and managed group of PIN Element(s) that are able to communicate with each other directly, communicate with each other via PIN Element(s) with Gateway Capability (i.e. PEGC(s)), or use a PEGC to communicate with devices or servers that are outside of the PIN via the 5G network. A PIN includes at least one PEGC and is managed by PIN Element(s) with Management Capability (i.e. PEMC(s)) with the support by an AF (Network Function) if AF (Network Function) is deployed.
PIN Element (PINE): A UE (Network Function) or non-3GPP device that can communicate within a PIN (via PINE-to-PINE direct connection or PINE-to-PINE indirect connection), or outside the PIN via a PEGC and 5GC.
PIN Element with Gateway Capability (PEGC): A PIN Element with the ability to provide DN (Network Function) connectivity via the 5G network for other PIN Elements and/or is able to provide relay functionality for communication between PIN Elements. Only a UE (Network Function) is able to act as a PEGC.
PIN Element with Management Capability (PEMC): A PIN Element with capability to manage the PIN.
NOTE 3:	A UE (Network Function) that is a PIN Element may both act as PEMC and PEGC.
PIN management traffic: The traffic among PINE, PEGC, PEMC and PIN AF (Network Function) related to the management of PIN network.
PIN-DN (Network Function) communication: The communication between PINE and DN (Network Function) via a PEGC and UPF (Network Function) and between PEGC and DN (Network Function) via UPF (Network Function). The communication includes both the data traffic and the PIN management traffic (e.g. the data traffic towards the internet or the PIN management traffic towards the PIN AF (Network Function)).
PIN direct communication: The communication between two PIN Elements, between a PIN Element and a PEGC, between a PIN Element and a PEMC, between a PEMC and a PEGC and between two PEGCs without traversing an intermediate PEGC, 3GPP RAN (Network Function) or UPF (Network Function). The communication includes both the data traffic and the PIN management traffic (e.g. the data traffic between 2 PINEs or the PIN management traffic between PINE, PEGC and PEMC).
PIN indirect communication: The communication between PIN Elements connected to different PEGCs of the same PIN, and between a PIN Element and a PEMC, via PEGC and 5GC. The communication includes both the data traffic and the PIN management traffic (e.g. the data traffic between 2 PINEs connected to different PEGCs of the same PIN or the PIN management traffic between PINE and PEMC connected to different PEGCs of the same PIN).
PLMN with Disaster Condition: A PLMN to which a Disaster Condition applies.
Pre-configured 5QI: Pre-defined QoS characteristics configured in the AN and 5GC and referenced via a non-standardized 5QI value.
Private communication: See definition in TS 22.261 [2].
Provisioning Server: Entity that provisions network credentials and other data in the UE (Network Function) to enable SNPN access.
PTP domain: As defined in IEEE Std 1588 [126].
Public network integrated NPN: A non-public network deployed with the support of a PLMN.
(Radio) Access Network: See 5G Access Network.
RAT type: Identifies the transmission technology used in the access network for both 3GPP accesses and non-3GPP Accesses, for example, NR, NB-IOT, Untrusted Non-3GPP, Trusted Non-3GPP, Trusted IEEE 802.11 Non-3GPP access, Wireline, Wireline-Cable, Wireline-BBF, etc.
NR RedCap: a 3GPP RAT type Identifier used in the Core Network only, which is a sub-type of NR RAT type, and defined to identify in the Core Network the NR when used by a UE (Network Function) indicating NR RedCap.
Requested NSSAI: NSSAI provided by the UE (Network Function) to the Serving PLMN during registration.
Residential Gateway: The Residential Gateway (RG) is a device providing, for example voice, data, broadcast video, video on demand, to other devices in customer premises.
Routing Binding Indication: Information included in a request or notification and that can be used by the SCP (Network Function) for discovery and associated selection to of a suitable target. See clauses 6.3.1.0 and 7.1.2
Routing Indicator: Indicator that allows together with SUCI/SUPI Home Network Identifier to route network signalling to AUSF (Network Function) and UDM (Network Function) instances capable to serve the subscriber.
RRC_IDLE, RRC_CONNECTED, RRC_INACTIVE: As defined in TS 38.331 [28] and TS 38.306 [69].
SCP (Network Function) Domain: A configured group of one or more SCP (Network Function)(s) and zero or more NF (Network Function) instances(s). An SCP (Network Function) within the group can communicate with any NF (Network Function) instance or SCP (Network Function) within the same group directly, i.e. without passing through an intermediate SCP (Network Function).
SNPN-enabled UE (Network Function): A UE (Network Function) configured to use stand-alone Non-Public Networks.
SNPN access mode: A UE (Network Function) operating in SNPN access mode only selects stand-alone Non-Public Networks over Uu, Yt, NWu.
NOTE 4:	If there are multiple instances of Uu/Yt/NWu, whether the UE (Network Function) is in SNPN access mode is determined for each instance independently. NWu can be either direct access via untrusted non-3GPP access or access via underlay network (see Annex D, clause D.3).
Service based interface: It represents how a set of services is provided/exposed by a given NF (Network Function).
Service Continuity: The uninterrupted user experience of a service, including the cases where the IP  (Protocol)address and/or anchoring point change.
Service Data Flow Filter: A set of packet flow header parameter values/ranges used to identify one or more of the (IP  (Protocol)or Ethernet) packet flows constituting a Service Data Flow.
Service Data Flow Template: The set of Service Data Flow filters in a policy rule or an application identifier in a policy rule referring to an application detection filter, required for defining a Service Data Flow.
Session Continuity: The continuity of a PDU Session. For PDU Session of IPv4 or IPv6 or IPv4v6 type "session continuity" implies that the IP  (Protocol)address is preserved for the lifetime of the PDU Session.
SMF (Network Function) Service Area: The collection of UPF (Network Function) Service Areas of all UPFs which can be controlled by one SMF (Network Function).
SNPN ID: PLMN ID and NID identifying an SNPN.
Stand-alone Non-Public Network: A non-public network not relying on network functions provided by a PLMN
Subscribed S-NSSAI: S-NSSAI based on subscriber information, which a UE (Network Function) is subscribed to use in a PLMN
Subscription Owner Standalone Non-Public Network: A Standalone Non-Public Network owning the subscription of a UE (Network Function) and providing subscription data to the UE (Network Function) via a Provisioning Server during the onboarding procedure.
Survival Time: The time that an application consuming a communication service may continue without an anticipated message.
NOTE 5:	Taken from clause 3.1 of TS 22.261 [2].
Target NSSAI: NSSAI provided by the Serving PLMN to the NG-RAN (Network Function) to cause the NG-RAN (Network Function) to attempt to steer the UE (Network Function) to a cell supporting the Network Slices identified by the S-NSSAIs in this NSSAI. See clause 5.3.4.3.3 for more details.
Time Sensitive Communication (TSC): A communication service that supports deterministic communication (i.e. which ensures a maximum delay) and/or isochronous communication with high reliability and availability. It is about providing packet transport with QoS characteristics such as bounds on latency, loss, and reliability, where end systems and relay/transmit nodes may or may not be strictly synchronized.
TSN working domain: Synchronization domain for a localized set of devices collaborating on a specific task or work function in a TSN network, corresponding to a gPTP domain defined in IEEE 802.1AS [104].
UDM (Network Function) Group ID: This refers to one or more UDM (Network Function) instances managing a specific set of SUPIs. An UDM (Network Function) Group consists of one or multiple UDM (Network Function) Sets.
UDR (Network Function) Group ID: This refers to one or more UDR (Network Function) instances managing a specific set of SUPIs. An UDR (Network Function) Group consists of one or multiple UDR (Network Function) Sets.
UE (Network Function)-DS-TT Residence Time: The time taken within the UE (Network Function) and DS-TT to forward a packet, i.e. between the ingress of the UE (Network Function) and the DS-TT port in the DL direction, or between the DS-TT port and the egress of the UE (Network Function) in the UL direction. UE (Network Function)-DS-TT Residence Time is provided at the time of PDU Session Establishment by the UE (Network Function) to the network.
NOTE 6:	UE (Network Function)-DS-TT Residence Time is the same for uplink and downlink traffic and applies to all QoS Flows.
UPF (Network Function) Service Area: An area consisting of one or more TA(s) within which PDU Session associated with the UPF (Network Function) can be served by (R)AN nodes via a N3 (Non-service-based Interface) (Service-based Interface) interface between the (R)AN and the UPF (Network Function) without need to add a new UPF (Network Function) in between or to remove/re-allocate the UPF (Network Function).
Uplink Classifier: UPF (Network Function) functionality that aims at diverting Uplink traffic, based on filter rules provided by SMF (Network Function), towards Data Network.
WB-E-UTRA: In the RAN (Network Function), WB-E-UTRA is the part of E-UTRA that excludes NB-IoT. In the Core Network, WB-E-UTRA also excludes LTE-M.
Wireline 5G Access Network: The Wireline 5G Access Network (W-5GAN) is a wireline AN that connects to a 5GC via N2 (Non-service-based Interface) (Service-based Interface) and N3 (Non-service-based Interface) (Service-based Interface) reference points. The W-5GAN can be either a W-5GBAN or W-5GCAN.
Wireline 5G Cable Access Network: The Wireline 5G Cable Access Network (W-5GCAN) is the Access Network defined in CableLabs.
Wireline BBF Access Network: The Wireline 5G BBF Access Network (W-5GBAN) is the Access Network defined in BBF.
Wireline Access Gateway Function (W-AGF (Network Function)): The Wireline Access Gateway Function (W-AGF (Network Function)) is a Network function in W-5GAN that provides connectivity to the 5G Core to 5G-RG and FN-RG.
NOTE 7:	If one AUSF (Network Function)/PCF (Network Function)/UDR (Network Function)/UDM (Network Function) group consists of multiple AUSF (Network Function)/PCF (Network Function)/UDR (Network Function)/UDM (Network Function) Sets, AUSF (Network Function)/PCF (Network Function)/UDR (Network Function)/UDM (Network Function) instance from different Set may be selected to serve the same UE (Network Function). The temporary data which is not shared across different Sets may be lost, e.g. the event subscriptions stored at one UDM (Network Function) instance are lost if another UDM (Network Function) instance from different Set is selected and no data shared across the UDM (Network Function) Sets.
For the purposes of the present document, the abbreviations given in TR 21.905 [1] and the following apply. An abbreviation defined in the present document takes precedence over the definition of the same abbreviation, if any, in TR 21.905 [1].
5GC	5G Core Network
5G DDNMF (Network Function)	5G Direct Discovery Name Management Function
5G LAN	5G Local Area Network
5GS	5G System
5G-AN	5G Access Network
5G-AN PDB	5G Access Network Packet Delay Budget
5G-EIR (Network Function)	5G-Equipment Identity Register
5G-GUTI	5G Globally Unique Temporary Identifier
5G-BRG	5G Broadband Residential Gateway
5G-CRG	5G Cable Residential Gateway
5G GM	5G Grand Master
5G NSWO	5G Non-Seamless WLAN offload
5G-RG	5G Residential Gateway
5G-S-TMSI	5G S-Temporary Mobile Subscription Identifier
5G VN	5G Virtual Network
5QI	5G QoS Identifier
ADRF (Network Function)	Analytics Data Repository Function
AF (Network Function)	Application Function
AKMA (Network Function)	Authentication and Key Management for Applications
AnLF (Network Function)	Analytics Logical Function
AMF (Network Function)	Access and Mobility Management Function
AoI	Area of Interest
AS	Access Stratum
ATSSS	Access Traffic Steering, Switching, Splitting
ATSSS-LL	ATSSS Low-Layer
AUSF (Network Function)	Authentication Server Function
BMCA	Best Master Clock Algorithm
BSF (Network Function)	Binding Support Function
CAG	Closed Access Group
CAPIF (Network Function)	Common API Framework for 3GPP northbound APIs
CH	Credentials Holder
CHF (Network Function)	Charging Function
CN PDB	Core Network Packet Delay Budget
CP	Control Plane
DAPS	Dual Active Protocol Stacks
DCCF (Network Function)	Data Collection Coordination Function
DCS	Default Credentials Server
DetNet	Deterministic Networking
DL	Downlink
DN (Network Function)	Data Network
DNAI	DN (Network Function) Access Identifier
DNN	Data Network Name
DRX	Discontinuous Reception
DS-TT	Device-side TSN translator
EAC	Early Admission Control
ePDG	evolved Packet Data Gateway
EBI	EPS Bearer Identity
EUI	Extended Unique Identifier
FAR	Forwarding Action Rule
FN-BRG	Fixed Network Broadband RG
FN-CRG	Fixed Network Cable RG
FN-RG	Fixed Network RG
FQDN	Fully Qualified Domain Name
GBA	Generic Bootstrapping Architecture
GEO	Geostationary Orbit
GFBR	Guaranteed Flow Bit Rate
GIN	Group ID for Network Selection
GMLC (Network Function)	Gateway Mobile Location Centre
GPSI	Generic Public Subscription Identifier
GUAMI	Globally Unique AMF (Network Function) Identifier
HMTC	High-Performance Machine-Type Communications
HR	Home Routed (roaming)
IAB	Integrated access and backhaul
IMEI/TAC	IMEI Type Allocation Code
IPUPS	Inter PLMN UP Security
I-SMF (Network Function)	Intermediate SMF (Network Function)
I-UPF (Network Function)	Intermediate UPF (Network Function)
LADN	Local Area Data Network
LBO	Local Break Out (roaming)
LEO	Low Earth Orbit
LMF (Network Function)	Location Management Function
LoA	Level of Automation
LPP	LTE Positioning Protocol
LRF	Location Retrieval Function
L4S	Low Latency, Low Loss and Scalable Throughput
MBS	Multicast/Broadcast Service
MBSF (Network Function)	Multicast/Broadcast Service Function
MBSR	Mobile Base Station Relay
MBSTF (Network Function)	Multicast/Broadcast Service Transport Function
MB-SMF (Network Function)	Multicast/Broadcast Session Management Function
MB-UPF (Network Function)	Multicast/Broadcast User Plane Function
MEO	Medium Earth Orbit
MFAF (Network Function)	Messaging Framework Adaptor Function
MCX	Mission Critical Service
MDBV	Maximum Data Burst Volume
MFBR	Maximum Flow Bit Rate
MICO	Mobile Initiated Connection Only
MINT	Minimization of Service Interruption
ML	Machine Learning
MPQUIC	Multi-Path QUIC
MPS	Multimedia Priority Service
MPTCP	Multi-Path TCP  (Protocol)Protocol
MTLF (Network Function)	Model Training Logical Function
N3IWF (Network Function)	Non-3GPP InterWorking Function
N3QAI		Non-3GPP QoS Assistance Information
N5CW	Non-5G-Capable over WLAN
NAI	Network Access Identifier
NEF (Network Function)	Network Exposure Function
NF (Network Function)	Network Function
NGAP	Next Generation Application (Protocol) Protocol
NID	Network identifier
NPN	Non-Public Network
NR	New Radio
NRF (Network Function)	Network Repository Function
NS-AoS	Network Slice Area of Service
NSAC	Network Slice Admission Control
NSACF (Network Function)	Network Slice Admission Control Function
NSAG	Network Slice AS Group
NSI ID	Network Slice Instance Identifier
NSSAA	Network Slice-Specific Authentication and Authorization
NSSAAF (Network Function)	Network Slice-specific and SNPN Authentication and Authorization Function
NSSAI	Network Slice Selection Assistance Information
NSSF (Network Function)	Network Slice Selection Function
NSSP	Network Slice Selection Policy
NSSRG	Network Slice Simultaneous Registration Group
NSWO	Non-Seamless WLAN offload
NSWOF (Network Function)	Non-Seamless WLAN offload Function
NW-TT	Network-side TSN translator
NWDAF (Network Function)	Network Data Analytics Function
ONN	Onboarding Network
ON-SNPN	Onboarding Standalone Non-Public Network
PCF (Network Function)	Policy Control Function
PDB	Packet Delay Budget
PDR	Packet Detection Rule
PDU	Protocol Data Unit
PDV	Packet Delay Variation
PEGC	PIN Element with Gateway Capability
PEI	Permanent Equipment Identifier
PEMC	PIN Element with Management Capability
PER	Packet Error Rate
PFD	Packet Flow Description
PIN	Personal IoT Network
PINE	PIN Element
PLR	Packet Loss Rate
PNI-NPN	Public Network Integrated Non-Public Network
PPD	Paging Policy Differentiation
PPF	Paging Proceed Flag
PPI	Paging Policy Indicator
PSA (Network Function)	PDU Session Anchor
PSDB	PDU Set Delay Budget
PSER	PDU Set Error Rate
PSIHI	PDU Set Integrated Handling Information
PTP	Precision Time Protocol
PVS	Provisioning Server
QFI	QoS Flow Identifier
QoE	Quality of Experience
RACS	Radio Capabilities Signalling optimisation
(R)AN	(Radio) Access Network
RG	Residential Gateway
RIM	Remote Interference Management
RQA	Reflective QoS Attribute
RQI	Reflective QoS Indication
RSN	Redundancy Sequence Number
RTT	Round Trip Time
SA NR	Standalone New Radio
SBA	Service Based Architecture
SBI	Service Based Interface
SCP (Network Function)	Service Communication Proxy
SD	Slice Differentiator
SEAF	Security Anchor Functionality
SEPP (Network Function)	Security Edge Protection Proxy
SF	Service Function
SFC	Service Function Chain
SMF (Network Function)	Session Management Function
SMSF (Network Function)	Short Message Service Function
SN	Sequence Number
SNPN	Stand-alone Non-Public Network
S-NSSAI	Single Network Slice Selection Assistance Information
SO-SNPN	Subscription Owner Standalone Non-Public Network
SSC	Session and Service Continuity
SSCMSP	Session and Service Continuity Mode Selection Policy
SST	Slice/Service Type
SUCI	Subscription Concealed Identifier
SUPI	Subscription Permanent Identifier
SV	Software Version
TA	Tracking Area
TAI	Tracking Area Identity
TNAN	Trusted Non-3GPP Access Network
TNAP	Trusted Non-3GPP Access Point
TNGF (Network Function)	Trusted Non-3GPP Gateway Function
TNL	Transport Network Layer
TNLA	Transport Network Layer Association
TSC	Time Sensitive Communication
TSCAI	TSC Assistance Information
TSCTSF (Network Function)	Time Sensitive Communication and Time Synchronization Function
TSN	Time Sensitive Networking
TSN GM	TSN Grand Master
TSP	Traffic Steering Policy
TT	TSN Translator
TWIF (Network Function)	Trusted WLAN Interworking Function
UAS NF (Network Function)	Uncrewed Aerial System Network Function
UCMF (Network Function)	UE (Network Function) radio Capability Management Function
UDM (Network Function)	Unified Data Management
UDR (Network Function)	Unified Data Repository
UDSF (Network Function)	Unstructured Data Storage Function
UL	Uplink
UL CL	Uplink Classifier
UPF (Network Function)	User Plane Function
URLLC	Ultra Reliable Low Latency Communication
URRP-AMF (Network Function)	UE (Network Function) Reachability Request Parameter for AMF (Network Function)
URSP	UE (Network Function) Route Selection Policy
VID	VLAN Identifier
VLAN	Virtual Local Area Network
W-5GAN	Wireline 5G Access Network
W-5GBAN	Wireline BBF Access Network
W-5GCAN	Wireline 5G Cable Access Network
W-AGF (Network Function)	Wireline Access Gateway Function

4	Architecture model and concepts
The 5G System architecture is defined to support data connectivity and services enabling deployments to use techniques such as e.g. Network Function Virtualization and Software Defined Networking. The 5G System architecture shall leverage service-based interactions between Control Plane (CP) Network Functions where identified. Some key principles and concept are to:
-	Separate the User Plane (UP) functions from the Control Plane (CP) functions, allowing independent scalability, evolution and flexible deployments e.g. centralized location or distributed (remote) location.
-	Modularize the function design, e.g. to enable flexible and efficient network slicing.
-	Wherever applicable, define procedures (i.e. the set of interactions between network functions) as services, so that their re-use is possible.
-	Enable each Network Function and its Network Function Services to interact with other NF (Network Function) and its Network Function Services directly or indirectly via a Service Communication Proxy if required. The architecture does not preclude the use of another intermediate function to help route Control Plane messages (e.g. like a DRA).
-	Minimize dependencies between the Access Network (AN) and the Core Network (CN). The architecture is defined with a converged core network with a common AN - CN interface which integrates different Access Types e.g. 3GPP access and non-3GPP access.
-	Support a unified authentication framework.
-	Support "stateless" NFs, where the "compute" resource is decoupled from the "storage" resource.
-	Support capability exposure.
-	Support concurrent access to local and centralized services. To support low latency services and local access to data networks, UP functions can be deployed close to the Access Network.
-	Support roaming with both Home routed traffic as well as Local breakout traffic in the visited PLMN.
This specification describes the architecture for the 5G System. The 5G architecture is defined as service-based and the interaction between network functions is represented in two ways.
-	A service-based representation, where network functions (e.g. AMF (Network Function)) within the Control Plane enables other authorized network functions to access their services. This representation also includes point-to-point reference points where necessary.
-	A reference point representation, shows the interaction exist between the NF (Network Function) services in the network functions described by point-to-point reference point (e.g. N11 (Service-based Interface)) between any two network functions (e.g. AMF (Network Function) and SMF (Network Function)).
Service-based interfaces are listed in clause 4.2.6. Reference points are listed in clause 4.2.7.
Network functions within the 5GC Control Plane shall only use service-based interfaces for their interactions.
NOTE 1:	The interactions between NF (Network Function) services within one NF (Network Function) are not specified in this Release of the specification.
NFs and NF (Network Function) services can communicate directly, referred to as Direct Communication, or indirectly via the SCP (Network Function), referred to as Indirect Communication. For more information on communication options, see Annex E and clauses under 6.3.1 and 7.1.2.
In addition to the architecture descriptions in clause 4, the following areas are further described in other specifications:
-	NG-RAN (Network Function) architecture is described in TS 38.300 [27] and TS 38.401 [42].
-	Security architecture is described in TS 33.501 [29] and TS 33.535 [124].
-	Charging architecture is described in TS 32.240 [41].
-	5G Media streaming architecture is described in TS 26.501 [135].
NOTE 3:	The NFs listed in clause 4.2.2 are described in the following clauses or in the specifications above.
The 5G System architecture consists of the following network functions (NF (Network Function)):
-	Authentication Server Function (AUSF (Network Function)).
-	Access and Mobility Management Function (AMF (Network Function)).
-	Data Network (DN (Network Function)), e.g. operator services, Internet access or 3rd party services.
-	Unstructured Data Storage Function (UDSF (Network Function)).
-	Network Exposure Function (NEF (Network Function)).
-	Network Repository Function (NRF (Network Function)).
-	Network Slice Admission Control Function (NSACF (Network Function)).
-	Network Slice-specific and SNPN Authentication and Authorization Function (NSSAAF (Network Function)).
-	Network Slice Selection Function (NSSF (Network Function)).
-	Policy Control Function (PCF (Network Function)).
-	Session Management Function (SMF (Network Function)).
-	Unified Data Management (UDM (Network Function)).
-	Unified Data Repository (UDR (Network Function)).
-	User Plane Function (UPF (Network Function)).
-	UE (Network Function) radio Capability Management Function (UCMF (Network Function)).
-	Application Function (AF (Network Function)).
-	User Equipment (UE (Network Function)).
-	(Radio) Access Network ((R)AN).
-	5G-Equipment Identity Register (5G-EIR (Network Function)).
-	Network Data Analytics Function (NWDAF (Network Function)).
-	CHarging Function (CHF (Network Function)).
-	Time Sensitive Networking AF (Network Function) (TSN AF (Network Function)).
-	Time Sensitive Communication and Time Synchronization Function (TSCTSF (Network Function)).
-	Data Collection Coordination Function (DCCF (Network Function)).
-	Analytics Data Repository Function (ADRF (Network Function)).
-	Messaging Framework Adaptor Function (MFAF (Network Function)).
-	Non-Seamless WLAN Offload Function (NSWOF (Network Function)).
NOTE:	The functionalities provided by DCCF (Network Function) and/or ADRF (Network Function) can also be hosted by an NWDAF (Network Function).
-	Edge Application (Protocol) Server Discovery Function (EASDF (Network Function)).
The 5G System architecture also comprises the following network entities:
-	Service Communication Proxy (SCP (Network Function)).
-	Security Edge Protection Proxy (SEPP (Network Function)).
The functional descriptions of these Network Functions and entities are specified in clause 6.
-	Non-3GPP InterWorking Function (N3IWF (Network Function)).
-	Trusted Non-3GPP Gateway Function (TNGF (Network Function)).
-	Wireline Access Gateway Function (W-AGF (Network Function)).
-	Trusted WLAN Interworking Function (TWIF (Network Function)).
Figure 4.2.3-1 depicts the non-roaming reference architecture. Service-based interfaces are used within the Control Plane.

Figure 4.2.3-1: Non-Roaming 5G System Architecture
NOTE:	If an SCP (Network Function) is deployed it can be used for indirect communication between NFs and NF (Network Function) services as described in Annex E. SCP (Network Function) does not expose services itself.
Figure 4.2.3-2 depicts the 5G System architecture in the non-roaming case, using the reference point representation showing how various network functions interact with each other.

Figure 4.2.3-2: Non-Roaming 5G System Architecture in reference point representation
NOTE 1:	N9 (Service-based Interface), N14 (Service-based Interface) are not shown in all other figures however they may also be applicable for other scenarios.
NOTE 2:	For the sake of clarity of the point-to-point diagrams, the UDSF (Network Function), NEF (Network Function) and NRF (Network Function) have not been depicted. However, all depicted Network Functions can interact with the UDSF (Network Function), UDR (Network Function), NEF (Network Function) and NRF (Network Function) as necessary.
NOTE 3:	The UDM (Network Function) uses subscription data and authentication data and the PCF (Network Function) uses policy data that may be stored in UDR (Network Function) (refer to clause 4.2.5).
NOTE 4:	For clarity, the UDR (Network Function) and its connections with other NFs, e.g. PCF (Network Function), are not depicted in the point-to-point and service-based architecture diagrams. For more information on data storage architectures refer to clause 4.2.5.
NOTE 5:	For clarity, the NWDAF (Network Function)(s), DCCF (Network Function), MFAF (Network Function) and ADRF (Network Function) and their connections with other NFs, are not depicted in the point-to-point and service-based architecture diagrams. For more information on network data analytics architecture refer to TS 23.288 [86].
NOTE 6:	For clarity, the 5G DDNMF (Network Function) and its connections with other NFs, e.g. UDM (Network Function), PCF (Network Function) are not depicted in the point-to-point and service-based architecture diagrams. For more information on ProSe architecture refer to TS 23.304 [128].
NOTE 7:	For clarity, the TSCTSF (Network Function) and its connections with other NFs, e.g. PCF (Network Function), NEF (Network Function), UDR (Network Function) are not depicted in the point-to-point and service-based architecture diagrams. For more information on TSC architecture refer to clause 4.4.8.
NOTE 8:	For exposure of the QoS monitoring information as specified in clause 5.8.2.18, exposure of data collected for analytics as specified in clause 5.2.26.2 of TS 23.502 [3], and exposure of the TSC management information as specified in clause 5.8.5.14, direct interaction between UPF (Network Function) and NFs can be supported via the Nupf interface (see clause 4.2.16).
NOTE 9:	For clarity, the EASDF (Network Function) and its connections with SMF (Network Function) is not depicted in the point-to-point and service-based architecture diagrams. For more information on edge computing architecture refer to TS 23.548 [130].
Figure 4.2.3-3 depicts the non-roaming architecture for UEs concurrently accessing two (e.g. local and central) data networks using multiple PDU Sessions, using the reference point representation. This figure shows the architecture for multiple PDU Sessions where two SMFs are selected for the two different PDU Sessions. However, each SMF (Network Function) may also have the capability to control both a local and a central UPF (Network Function) within a PDU Session.

Figure 4.2.3-3: Applying Non-Roaming 5G System Architecture for multiple PDU Session in reference point representation
Figure 4.2.3-4 depicts the non-roaming architecture in the case of concurrent access to two (e.g. local and central) data networks is provided within a single PDU Session, using the reference point representation.

Figure 4.2.3-4: Applying Non-Roaming 5G System Architecture for concurrent access to two (e.g. local and central) data networks (single PDU Session option) in reference point representation
Figure 4.2.3-5 depicts the non-roaming architecture for Network Exposure Function, using reference point representation.

Figure 4.2.3-5: Non-Roaming Architecture for Network Exposure Function in reference point representation
NOTE 1:	In Figure 4.2.3-5, Trust domain for NEF (Network Function) is same as Trust domain for SCEF as defined in TS 23.682 [36].
NOTE 2:	In Figure 4.2.3-5, 3GPP Interface represents southbound interfaces between NEF (Network Function) and 5GC Network Functions e.g. N29 (Service-based Interface) interface between NEF (Network Function) and SMF (Network Function), N30 (Service-based Interface) interface between NEF (Network Function) and PCF (Network Function), etc. All southbound interfaces from NEF (Network Function) are not shown for the sake of simplicity.
Figure 4.2.4-1 depicts the 5G System roaming architecture with local breakout with service-based interfaces within the Control Plane.

Figure 4.2.4-1: Roaming 5G System architecture- local breakout scenario in service-based interface representation
NOTE 1:	In the LBO architecture. the PCF (Network Function) in the VPLMN may interact with the AF (Network Function) in order to generate PCC Rules for services delivered via the VPLMN, the PCF (Network Function) in the VPLMN uses locally configured policies according to the roaming agreement with the HPLMN operator as input for PCC Rule generation, the PCF (Network Function) in VPLMN has no access to subscriber policy information from the HPLMN, the NSACF (Network Function) in the HPLMN is not used in this Release of the specification.
NOTE 2:	An SCP (Network Function) can be used for indirect communication between NFs and NF (Network Function) services within the VPLMN, within the HPLMN, or in within both VPLMN and HPLMN. For simplicity, the SCP (Network Function) is not shown in the roaming architecture.
NOTE 3:	For clarity, the NWDAF (Network Function)(s) with roaming exchange capability (RE-NWDAF (Network Function)) and their connections with other NFs, are not depicted in the service-based architecture diagram. For more information on network data analytics architecture refer to TS 23.288 [86].

Figure 4.2.4-2: Void
Figure 4.2.4-3 depicts the 5G System roaming architecture in the case of home routed scenario with service-based interfaces within the Control Plane.

Figure 4.2.4-3: Roaming 5G System architecture - home routed scenario in service-based interface representation
NOTE 4:	An SCP (Network Function) can be used for indirect communication between NFs and NF (Network Function) services within the VPLMN, within the HPLMN, or in within both VPLMN and HPLMN. For simplicity, the SCP (Network Function) is not shown in the roaming architecture.
NOTE 5:	UPFs in the home routed scenario can be used also to support the IPUPS functionality (see clause 5.8.2.14).
NOTE 6:	For clarity, the NWDAF (Network Function)(s) with roaming exchange capability (RE-NWDAF (Network Function)) and their connections with other NFs, are not depicted in the service-based architecture diagram. For more information on network data analytics architecture refer to TS 23.288 [86].
Figure 4.2.4-4 depicts 5G System roaming architecture in the case of local break out scenario using the reference point representation.

Figure 4.2.4-4: Roaming 5G System architecture - local breakout scenario in reference point representation
NOTE 7:	The NRF (Network Function) is not depicted in reference point architecture figures. Refer to Figure 4.2.4-7 for details on NRF (Network Function) and NF (Network Function) interfaces.
NOTE 8:	For the sake of clarity, SEPPs are not depicted in the roaming reference point architecture figures.
NOTE 9:	For clarity, the NWDAF (Network Function)(s) with roaming exchange capability (RE-NWDAF (Network Function)) and their connections with other NFs, are not depicted in the reference point architecture figure. For more information on network data analytics architecture refer to TS 23.288 [86].
The following figure 4.2.4-6 depicts the 5G System roaming architecture in the case of home routed scenario using the reference point representation.

Figure 4.2.4-6: Roaming 5G System architecture - Home routed scenario in reference point representation
The N38 references point can be between V-SMFs in the same VPLMN, or between V-SMFs in different VPLMNs (to enable inter-PLMN mobility).
NOTE 10:	For clarity, the NWDAF (Network Function)(s) with roaming exchange capability (RE-NWDAF (Network Function)) and their connections with other NFs, are not depicted in the reference point architecture figure. For more information on network data analytics architecture refer to TS 23.288 [86].
For the roaming scenarios described above each PLMN implements proxy functionality to secure interconnection and hide topology on the inter-PLMN interfaces.

Figure 4.2.4-7: NRF (Network Function) Roaming architecture in reference point representation
NOTE 11:	For the sake of clarity, SEPPs on both sides of PLMN borders are not depicted in figure 4.2.4-7.
Figure 4.2.4-8: Void
Operators can deploy UPFs supporting the Inter PLMN UP Security (IPUPS) functionality at the border of their network to protect their network from invalid inter PLMN N9 (Service-based Interface) traffic in home routed roaming scenarios. The UPFs supporting the IPUPS functionality in VPLMN and HPLMN are controlled by the V-SMF (Network Function) and the H-SMF (Network Function) of that PDU Session respectively. A UPF (Network Function) supporting the IPUPS functionality terminates GTP-U (Protocol) N9 (Service-based Interface) tunnels. The SMF (Network Function) can activate the IPUPS functionality together with other UP functionality in the same UPF (Network Function), or insert a separate UPF (Network Function) for the IPUPS functionality in the UP path (which e.g. may be dedicated to be used for IPUPS functionality). Figure 4.2.4-9 depicts the home routed roaming architecture where a UPF (Network Function) is inserted in the UP path for the IPUPS functionality. Figure 4.2.4-3 depicts the home routed roaming architecture where the two UPFs perform the IPUPS functionality and other UP functionality for the PDU Session.
NOTE 12:	Operators are not prohibited from deploying the IPUPS functionality as a separate Network Function from the UPF (Network Function), acting as a transparent proxy which can transparently read N4 (Service-based Interface) and N9 (Service-based Interface) interfaces. However, such deployment option is not specified and needs to take at least into account very long lasting PDU Sessions with infrequent traffic and Inter-PLMN handover.
The IPUPS functionality is specified in clause 5.8.2.14 and TS 33.501 [29].

Figure 4.2.4-9: Roaming 5G System architecture - home routed roaming scenario in service-based interface representation employing UPF (Network Function) dedicated to IPUPS
As depicted in Figure 4.2.5-1, the 5G System architecture allows any NF (Network Function) to store and retrieve its unstructured data into/from a UDSF (Network Function) (e.g. UE (Network Function) contexts). The UDSF (Network Function) belongs to the same PLMN where the network function is located. CP NFs may share a UDSF (Network Function) for storing their respective unstructured data or may each have their own UDSF (Network Function) (e.g. a UDSF (Network Function) may be located close to the respective NF (Network Function)).
NOTE 1:	Structured data in this specification refers to data for which the structure is defined in 3GPP specifications. Unstructured data refers to data for which the structure is not defined in 3GPP specifications.

Figure 4.2.5-1: Data Storage Architecture for unstructured data from any NF (Network Function)
NOTE 2:	3GPP will specify (possibly by referencing) the N18 (Service-based Interface)/Nudsf interface.
As depicted in Figure 4.2.5-2, the 5G System architecture allows the UDM (Network Function), PCF (Network Function) and NEF (Network Function) to store data in the UDR (Network Function), including subscription data and policy data by UDM (Network Function) and PCF (Network Function), structured data for exposure and application data (including Packet Flow Descriptions (PFDs) for application detection, AF (Network Function) request information for multiple UEs) by the NEF (Network Function). UDR (Network Function) can be deployed in each PLMN and it can serve different functions as follows:
-	UDR (Network Function) accessed by the NEF (Network Function) belongs to the same PLMN where the NEF (Network Function) is located.
-	UDR (Network Function) accessed by the UDM (Network Function) belongs to the same PLMN where the UDM (Network Function) is located if UDM (Network Function) supports a split architecture.
-	UDR (Network Function) accessed by the PCF (Network Function) belongs to the same PLMN where the PCF (Network Function) is located.
NOTE 3:	The UDR (Network Function) deployed in each PLMN can store application data for roaming subscribers.

Figure 4.2.5-2: Data Storage Architecture
NOTE 4:	There can be multiple UDRs deployed in the network, each of which can accommodate different data sets or subsets, (e.g. subscription data, subscription policy data, data for exposure, application data) and/or serve different sets of NFs. Deployments where a UDR (Network Function) serves a single NF (Network Function) and stores its data, and, thus, can be integrated with this NF (Network Function), can be possible.
NOTE 5: The internal structure of the UDR (Network Function) in figure 4.2.5-2 is shown for information only.
The Nudr interface is defined for the network functions (i.e. NF (Network Function) Service Consumers), such as UDM (Network Function), PCF (Network Function) and NEF (Network Function), to access a particular set of the data stored and to read, update (including add, modify), delete, and subscribe to notification of relevant data changes in the UDR (Network Function).
Each NF (Network Function) Service Consumer accessing the UDR (Network Function), via Nudr, shall be able to add, modify, update or delete only the data it is authorised to change. This authorisation shall be performed by the UDR (Network Function) on a per data set and NF (Network Function) service consumer basis and potentially on a per UE (Network Function), subscription granularity.
The following data in the UDR (Network Function) sets exposed via Nudr to the respective NF (Network Function) service consumer and stored shall be standardized:
-	Subscription Data,
-	Policy Data,
-	Structured Data for exposure,
-	Application data: Packet Flow Descriptions (PFDs) for application detection and AF (Network Function) request information for multiple UEs, as defined in clause 5.6.7.
The service based Nudr interface defines the content and format/encoding of the 3GPP defined information elements exposed by the data sets.
In addition, it shall be possible to access operator specific data sets by the NF (Network Function) Service Consumers from the UDR (Network Function) as well as operator specific data for each data set.
NOTE 6:	The content and format/encoding of operator specific data and operator specific data sets are not subject to standardization.
NOTE 7:	The organization of the different data stored in the UDR (Network Function) is not to be standardized.
4.2.5a	Radio Capabilities Signalling optimisation
Figure 4.2.5a-1 depicts the AMF (Network Function) to UCMF (Network Function) reference point and interface. Figure 4.2.5a-2 depicts the related interfaces in AMF (Network Function) and UCMF (Network Function) for the Radio Capabilities Signalling optimisation in the roaming architecture.

Figure 4.2.5a-1: Radio Capability Signalling optimisation architecture

NOTE:	The AF (Network Function) in the VPLMN (i.e. the one having a relationship with the VPLMN NEF (Network Function)) is the one which provisions Manufacturer Assigned UE (Network Function) radio capability IDs in the VPLMN UCMF (Network Function). RACS is a serving PLMN only feature (it requires no specific support in the roaming agreement with the UE (Network Function) HPLMN to operate).

Figure 4.2.5a-2: Roaming architecture for Radio Capability Signalling optimisation
The 5G System Architecture contains the following service-based interfaces:
Namf:	Service-based interface exhibited by AMF (Network Function).
Nsmf:	Service-based interface exhibited by SMF (Network Function).
Nnef:	Service-based interface exhibited by NEF (Network Function).
Npcf:	Service-based interface exhibited by PCF (Network Function).
Nudm:	Service-based interface exhibited by UDM (Network Function).
Naf:	Service-based interface exhibited by AF (Network Function).
Nnrf:	Service-based interface exhibited by NRF (Network Function).
Nnsacf:	Service-based interface exhibited by NSACF (Network Function).
Nnssaaf:	Service-based interface exhibited by NSSAAF (Network Function).
Nnssf:	Service-based interface exhibited by NSSF (Network Function).
Nausf:	Service-based interface exhibited by AUSF (Network Function).
Nudr:	Service-based interface exhibited by UDR (Network Function).
Nudsf:	Service-based interface exhibited by UDSF (Network Function).
N5g-eir:	Service-based interface exhibited by 5G-EIR (Network Function).
Nnwdaf:	Service-based interface exhibited by NWDAF (Network Function).
Nchf:	Service-based interface exhibited by CHF (Network Function).
Nucmf:	Service-based interface exhibited by UCMF (Network Function).
Ndccf:	Service based interface exhibited by DCCF (Network Function).
Nmfaf:	Service based interface exhibited by MFAF (Network Function).
Nadrf:	Service based interface exhibited by ADRF (Network Function).
Naanf:	Service-based interface exhibited by AANF.
NOTE 1:	The Service-based interface exhibited by AANF is defined in TS 33.535 [124].
N5g-ddnmf:	Service-based interface exhibited by 5G DDNMF (Network Function).
Nmbsmf:	Service-based interface exhibited by MB-SMF (Network Function).
Nmbsf:	Service-based interface exhibited by MBSF (Network Function).
NOTE 2:	The Service-based interfaces exhibited by MB-SMF (Network Function) and MBSF (Network Function) are defined in TS 23.247 [129].
Ntsctsf:	Service-based interface exhibited by TSCTSF (Network Function).
Nbsp:	Service-based interface exhibited by an SBI capable Boostrapping Server Function in GBA.
NOTE 2:	The Service-based interfaces exhibited by an SBI capable Boostrapping Server Function are defined in TS 33.220 [140] and TS 33.223 [141].
Neasdf:	Service-based interface exhibited by EASDF (Network Function).
NOTE 3:	The Service-based interfaces exhibited by EADSF is defined in TS 23.548 [130].
Nupf:	Service-based interface exhibited by UPF (Network Function).
The 5G System Architecture contains the following reference points:
N1 (Non-service-based Interface) (Service-based Interface):	Reference point between the UE (Network Function) and the AMF (Network Function).
N2 (Non-service-based Interface) (Service-based Interface):	Reference point between the (R)AN and the AMF (Network Function).
N3 (Non-service-based Interface) (Service-based Interface):	Reference point between the (R)AN and the UPF (Network Function).
N4 (Service-based Interface):	Reference point between the SMF (Network Function) and the UPF (Network Function).
N6 (Non-service-based Interface) (Service-based Interface):	Reference point between the UPF (Network Function) and a Data Network.
N9 (Service-based Interface):	Reference point between two UPFs.
The following reference points show the interactions that exist between the NF (Network Function) services in the NFs. These reference points are realized by corresponding NF (Network Function) service-based interfaces and by specifying the identified consumer and producer NF (Network Function) service as well as their interaction in order to realize a particular system procedure.
N5 (Service-based Interface):	Reference point between the PCF (Network Function) and an AF (Network Function) or TSN AF (Network Function).
N7 (Service-based Interface):	Reference point between the SMF (Network Function) and the PCF (Network Function).
N8 (Service-based Interface):	Reference point between the UDM (Network Function) and the AMF (Network Function).
N10 (Service-based Interface):	Reference point between the UDM (Network Function) and the SMF (Network Function).
N11 (Service-based Interface):	Reference point between the AMF (Network Function) and the SMF (Network Function).
N12 (Service-based Interface):	Reference point between AMF (Network Function) and AUSF (Network Function).
N13 (Service-based Interface):	Reference point between the UDM (Network Function) and Authentication Server function the AUSF (Network Function).
N14 (Service-based Interface):	Reference point between two AMFs.
N15 (Service-based Interface):	Reference point between the PCF (Network Function) and the AMF (Network Function) in the case of non-roaming scenario, PCF (Network Function) in the visited network and AMF (Network Function) in the case of roaming scenario.
N16 (Service-based Interface):	Reference point between two SMFs, (in roaming case between SMF (Network Function) in the visited network and the SMF (Network Function) in the home network).
N16a:	Reference point between SMF (Network Function) and I-SMF (Network Function).
N17 (Service-based Interface):	Reference point between AMF (Network Function) and 5G-EIR (Network Function).
N18 (Service-based Interface):	Reference point between any NF (Network Function) and UDSF (Network Function).
N19 (Service-based Interface):	Reference point between two PSA (Network Function) UPFs for 5G LAN-type service.
N22 (Service-based Interface):	Reference point between AMF (Network Function) and NSSF (Network Function).
N23 (Service-based Interface):	Reference point between PCF (Network Function) and NWDAF (Network Function).
N24 (Service-based Interface):	Reference point between the PCF (Network Function) in the visited network and the PCF (Network Function) in the home network.
N27 (Service-based Interface):	Reference point between NRF (Network Function) in the visited network and the NRF (Network Function) in the home network.
N28 (Service-based Interface):	Reference point between PCF (Network Function) and CHF (Network Function).
N29 (Service-based Interface):	Reference point between NEF (Network Function) and SMF (Network Function).
N30 (Service-based Interface):	Reference point between PCF (Network Function) and NEF (Network Function).
NOTE 1:	The functionality of N28 (Service-based Interface) and N29 (Service-based Interface) and N30 (Service-based Interface) reference points are defined in TS 23.503 [45].
N31 (Service-based Interface):	Reference point between the NSSF (Network Function) in the visited network and the NSSF (Network Function) in the home network.
NOTE 2:	In some cases, a couple of NFs may need to be associated with each other to serve a UE (Network Function).
N32 (Service-based Interface):	Reference point between a SEPP (Network Function) in one PLMN or SNPN and a SEPP (Network Function) in another PLMN or SNPN; or between a SEPP (Network Function) in a SNPN and a SEPP (Network Function) in a CH/DCS, where the CH/DCS contains a UDM (Network Function)/AUSF (Network Function).
NOTE 3:	The functionality of N32 (Service-based Interface) reference point is defined in TS 33.501 [29].
N33 (Service-based Interface):	Reference point between NEF (Network Function) and AF (Network Function).
N34 (Service-based Interface):	Reference point between NSSF (Network Function) and NWDAF (Network Function).
N35 (Service-based Interface):	Reference point between UDM (Network Function) and UDR (Network Function).
N36 (Service-based Interface):	Reference point between PCF (Network Function) and UDR (Network Function).
N37 (Service-based Interface):	Reference point between NEF (Network Function) and UDR (Network Function).
N38:	Reference point between I-SMFs and between V-SMFs.
N40 (Service-based Interface):	Reference point between SMF (Network Function) and the CHF (Network Function).
N41:	Reference point between AMF (Network Function) and CHF (Network Function) in HPLMN.
N42:	Reference point between AMF (Network Function) and CHF (Network Function) in VPLMN.
NOTE 4:	The functionality of N40 (Service-based Interface), N41 and N42 reference points are defined in TS 32.240 [41].
N43:	Reference point between PCFs.
NOTE 5:	The functionality of N43 reference point is defined in TS 23.503 [45].
NOTE 6:	The reference points from N44 up to and including N49 are reserved for allocation and definition in TS 32.240 [41].
N50 (Service-based Interface):	Reference point between AMF (Network Function) and the CBCF (Network Function).
N51 (Service-based Interface):	Reference point between AMF (Network Function) and NEF (Network Function).
N52 (Service-based Interface):	Reference point between NEF (Network Function) and UDM (Network Function).
N55 (Service-based Interface):	Reference point between AMF (Network Function) and the UCMF (Network Function).
N56 (Service-based Interface):	Reference point between NEF (Network Function) and the UCMF (Network Function).
N57 (Service-based Interface):	Reference point between AF (Network Function) and the UCMF (Network Function).
NOTE 7:	The Public Warning System functionality of N50 (Service-based Interface) reference point is defined in TS 23.041 [46].
N58 (Service-based Interface):	Reference point between AMF (Network Function) and the NSSAAF (Network Function).
N59 (Service-based Interface):	Reference point between UDM (Network Function) and the NSSAAF (Network Function).
N60 (Service-based Interface):	Reference point between AUSF (Network Function) and NSWOF (Network Function).
NOTE 8:	The functionality of N60 (Service-based Interface) reference point is defined in TS 33.501 [29].
N80 (Service-based Interface):	Reference point between AMF (Network Function) and NSACF (Network Function).
N81 (Service-based Interface):	Reference point between SMF (Network Function) and NSACF (Network Function).
N82 (Service-based Interface):	Reference point between NSACF (Network Function) and NEF (Network Function).
N83 (Service-based Interface):	Reference point between AUSF (Network Function) and NSSAAF (Network Function).
N84 (Service-based Interface):	Reference point between TSCTSF (Network Function) and PCF (Network Function).
N85 (Service-based Interface):	Reference point between TSCTSF (Network Function) and NEF (Network Function).
N86:	Reference point between TSCTSF (Network Function) and AF (Network Function).
N87:	Reference point between TSCTSF (Network Function) and UDM (Network Function).
N88 (Service-based Interface):	Reference point between SMF (Network Function) and EASDF (Network Function).
N89:	Reference point between TSCTSF (Network Function) and AMF (Network Function).
N96:	Reference point between TSCTSF (Network Function) and NRF (Network Function).
N97 (Service-based Interface):	Reference point between two NSACFs in different PLMNs.
N99 (Service-based Interface):	Reference point between two NSACFs within the same PLMN.
NOTE 9:	The reference points from N90 up to and including N95 are reserved for allocation and definition in TS 23.503 [45].
NOTE 10:	The reference points from N100 (Service-based Interface) up to and including N109 are reserved for allocation and definition in TS 32.240 [41].
The reference points to support SMS over NAS (Protocol) are listed in clause 4.4.2.2.
The reference points to support Location Services are listed in TS 23.273 [87].
The reference points to support SBA in IMS (N5 (Service-based Interface), N70 (Service-based Interface) and N71 (Service-based Interface)) are described in TS 23.228 [15].
The reference points to support AKMA (Network Function) (N61 (Service-based Interface), N62 (Service-based Interface) and N63 (Service-based Interface)) are described in TS 33.535 [124].
The reference points to support 5G ProSe are described in TS 23.304 [128].
The reference points to support 5G multicast-broadcast services are described in TS 23.247 [129].
The reference points to Support Uncrewed Aerial Systems (UAS) connectivity, identification and tracking are described in TS 23.256 [136].
The reference points to support SBA in GBA and GBA push (N65, N66 (Service-based Interface), N67 (Service-based Interface) and N68 (Service-based Interface)) are described in TS 33.220 [140] and TS 33.223 [141].
The reference points to support SMS delivery using SBA are described in TS 23.540 [142].
The reference points to support Ranging based services and Sidelink Positioning are described in TS 23.586 [180].
In this Release of the specification, the following types of non-3GPP access networks are defined:
-	Untrusted non-3GPP access networks;
-	Trusted non-3GPP access networks; and
-	Wireline access networks.
The architecture to support Untrusted and Trusted non-3GPP access networks is defined in clause 4.2.8.2. The architecture to support Wireline access networks is defined in clause 4.2.8.2.4 and in TS 23.316 [84].
The 5G Core Network supports connectivity of UEs via non-3GPP access networks, e.g. WLAN access networks.
Only the support of non-3GPP access networks deployed outside the NG-RAN (Network Function) is described in this clause.
The 5G Core Network supports both untrusted non-3GPP access networks and trusted non-3GPP access networks (TNANs).
An untrusted non-3GPP access network shall be connected to the 5G Core Network via a Non-3GPP InterWorking Function (N3IWF (Network Function)), whereas a trusted non-3GPP access network shall be connected to the 5G Core Network via a Trusted Non-3GPP Gateway Function (TNGF (Network Function)). Both the N3IWF (Network Function) and the TNGF (Network Function) interface with the 5G Core Network CP and UP functions via the N2 (Non-service-based Interface) (Service-based Interface) and N3 (Non-service-based Interface) (Service-based Interface) interfaces, respectively.
A non-3GPP access network may advertise the PLMNs or SNPNs for which it supports trusted connectivity and the type of supported trusted connectivity (e.g. "5G connectivity"). Therefore, the UEs can discover the non-3GPP access networks that can provide trusted connectivity to one or more PLMNs or SNPNs. This is further specified in clause 6.3.12 (Trusted Non-3GPP Access Network selection).
The UE (Network Function) decides to use trusted or untrusted non-3GPP access for connecting to a 5G PLMN or SNPNs by using procedures not specified in this document. Examples of such procedures are defined in clause 6.3.12.1.
When the UE (Network Function) decides to use untrusted non-3GPP access to connect to a 5G Core Network in a PLMN:
-	the UE (Network Function) first selects and connects with a non-3GPP access network; and then
-	the UE (Network Function) selects a PLMN/SNPN and an N3IWF (Network Function) in this PLMN/SNPN. The PLMN/SNPN/N3IWF (Network Function) selection and the non-3GPP access network selection are independent. The N3IWF (Network Function) selection is defined in clause 6.3.6.
When the UE (Network Function) decides to use trusted non-3GPP access to connect to a 5G Core Network in a PLMN:
-	the UE (Network Function) first selects a PLMN/SNPN; and then
-	the UE (Network Function) selects a non-3GPP access network (a TNAN) that supports trusted connectivity to the selected PLMN/SNPN. In this case, the non-3GPP access network selection is affected by the PLMN/SNPN selection.
A UE (Network Function) that accesses the 5G Core Network over a non-3GPP access shall, after UE (Network Function) registration, support NAS (Protocol) signalling with 5G Core Network control-plane functions using the N1 (Non-service-based Interface) (Service-based Interface) reference point.
When a UE (Network Function) is connected via a NG-RAN (Network Function) and via a non-3GPP access, multiple N1 (Non-service-based Interface) (Service-based Interface) instances shall exist for the UE (Network Function) i.e. there shall be one N1 (Non-service-based Interface) (Service-based Interface) instance over NG-RAN (Network Function) and one N1 (Non-service-based Interface) (Service-based Interface) instance over non-3GPP access.
A UE (Network Function) simultaneously connected to the same 5G Core Network of a PLMN/SNPN over a 3GPP access and a non-3GPP access shall be served by a single AMF (Network Function) in this 5G Core Network.
When a UE (Network Function) is connected to a 3GPP access of a PLMN, if the UE (Network Function) selects a N3IWF (Network Function) and the N3IWF (Network Function) is located in a PLMN different from the PLMN of the 3GPP access, e.g. in a different VPLMN or in the HPLMN, the UE (Network Function) is served separately by the two PLMNs. The UE (Network Function) is registered with two separate AMFs. PDU Sessions over the 3GPP access are served by V-SMFs different from the V-SMF (Network Function) serving the PDU Sessions over the non-3GPP access. The same can be true when the UE (Network Function) uses trusted non-3GPP access, i.e. the UE (Network Function) may select one PLMN for 3GPP access and a different PLMN for trusted non-3GPP access.
NOTE:	The registrations with different PLMNs over different Access Types doesn't apply to UE (Network Function) registered for Disaster Roaming service as described in the clause 5.40.
The PLMN selection for the 3GPP access does not depend on the PLMN that is used for non-3GPP access. In other words, if a UE (Network Function) is registered with a PLMN over a non-3GPP access, the UE (Network Function) performs PLMN selection for the 3GPP access independently of this PLMN.
A UE (Network Function) shall establish an IPsec tunnel with the N3IWF (Network Function) or with the TNGF (Network Function) in order to register with the 5G Core Network over non-3GPP access. Further details about the UE (Network Function) registration to 5G Core Network over untrusted non-3GPP access and over trusted non-3GPP access are described in clause 4.12.2 and in clause 4.12.2a of TS 23.502 [3], respectively.
It shall be possible to maintain the UE (Network Function) NAS (Protocol) signalling connection with the AMF (Network Function) over the non-3GPP access after all the PDU Sessions for the UE (Network Function) over that access have been released or handed over to 3GPP access.
N1 (Non-service-based Interface) (Service-based Interface) NAS (Protocol) signalling over non-3GPP accesses shall be protected with the same security mechanism applied for N1 (Non-service-based Interface) (Service-based Interface) over a 3GPP access.
User plane QoS differentiation between UE (Network Function) and N3IWF (Network Function) is supported as described in clause 5.7 and clause 4.12.5 of TS 23.502 [3]. QoS differentiation between UE (Network Function) and TNGF (Network Function) is supported as described in clause 5.7 and clause 4.12a.5 of TS 23.502 [3].
4.2.8.1A	General Concepts to support Wireline Access
Wireline 5G Access Network (W-5GAN) shall be connected to the 5G Core Network via a Wireline Access Gateway Function (W-AGF (Network Function)). The W-AGF (Network Function) interfaces the 5G Core Network CP and UP functions via N2 (Non-service-based Interface) (Service-based Interface) and N3 (Non-service-based Interface) (Service-based Interface) interfaces, respectively.
For the scenario of 5G-RG connected via NG RAN (Network Function) the specification for UE (Network Function) defined in this TS, TS 23.502 [3] and TS 23.503 [45] are applicable as defined for UE (Network Function) connected to 5GC via NG RAN (Network Function) unless differently specified in this TS and in TS 23.316 [84].
When a 5G-RG is connected via a NG-RAN (Network Function) and via a W-5GAN, multiple N1 (Non-service-based Interface) (Service-based Interface) instances shall exist for the 5G-RG i.e. there shall be one N1 (Non-service-based Interface) (Service-based Interface) instance over NG-RAN (Network Function) and one N1 (Non-service-based Interface) (Service-based Interface) instance over W-5GAN.
A 5G-RG simultaneously connected to the same 5G Core Network of a PLMN over a 3GPP access and a W-5GAN access shall be served by a single AMF (Network Function) in this 5G Core Network.
5G-RG shall maintain the NAS (Protocol) signalling connection with the AMF (Network Function) over the W-5GAN after all the PDU Sessions for the 5G-RG over that access have been released or handed over to 3GPP access.
The 5G-RG connected to 5GC via NG-RAN (Network Function) is specified in TS 23.316 [84].
For the scenario of FN-RG, which is not 5G capable, connected via W-5GAN to 5GC, the W-AGF (Network Function) provides the N1 (Non-service-based Interface) (Service-based Interface) interface to AMF (Network Function) on behalf of the FN-RG.
An UE (Network Function) connected to a 5G-RG or FN-RG can access to the 5GC via the N3IWF (Network Function) or via the TNGF (Network Function) where the combination of 5G-RG/FN-RG, W-AGF (Network Function) and UPF (Network Function) serving the 5G-RG or FN-RG is acting respectively as Untrusted Non-3GPP access network or as a Trusted Non-3GPP access network defined in clause 4.2.8.2; for example a UE (Network Function) is connecting to 5G-RG by means of WLAN radio access and connected to 5GC via N3IWF (Network Function). The detailed description is specified in TS 23.316 [84].
The roaming architecture for 5G-BRG, FN-BRG, 5G-CRG and FN-CRG with the W-5GAN is not specified in this Release. The Home Routed roaming scenario is supported for 5G-RG connected via NG RAN (Network Function), while Local Breakout scenario is not supported.
5G Multi-Operator Core Network (5G MOCN) is supported for 5G-RG connected via NG RAN (Network Function) as defined in clause 5.18

Figure 4.2.8.2.1-1: Non-roaming architecture for 5G Core Network with untrusted non-3GPP access

Figure 4.2.8.2.1-2: Non-roaming architecture for 5G Core Network with trusted non-3GPP access
NOTE 1:	The reference architecture in Figure 4.2.8.2.1-1 and in Figure 4.2.8.2.1-2 only shows the architecture and the network functions directly connected to non-3GPP access, and other parts of the architecture are the same as defined in clause 4.2.
NOTE 2:	The reference architecture in Figure 4.2.8.2.1-1 and in Figure 4.2.8.2.1-2 supports service based interfaces for AMF (Network Function), SMF (Network Function) and other NFs not represented in the figure.
NOTE 3:	The two N2 (Non-service-based Interface) (Service-based Interface) instances in Figure 4.2.8.2.1-1 and in Figure 4.2.8.2.1-2 terminate to a single AMF (Network Function) for a UE (Network Function) which is simultaneously connected to the same 5G Core Network over 3GPP access and non-3GPP access.
NOTE 4	The two N3 (Non-service-based Interface) (Service-based Interface) instances in Figure 4.2.8.2.1-1 and in Figure 4.2.8.2.1-2 may terminate to different UPFs when different PDU Sessions are established over 3GPP access and non-3GPP access.

Figure 4.2.8.2.2-1: LBO Roaming architecture for 5G Core Network with untrusted non-3GPP access - N3IWF (Network Function) in the same VPLMN as 3GPP access

Figure 4.2.8.2.2-2: LBO Roaming architecture for 5G Core Network with untrusted non-3GPP access - N3IWF (Network Function) in a different PLMN from 3GPP access

Figure 4.2.8.2.2-3: LBO Roaming architecture for 5G Core Network with trusted non-3GPP access using the same VPLMN as 3GPP access

Figure 4.2.8.2.2-4: LBO Roaming architecture for 5G Core Network with trusted non-3GPP access using a different PLMN than 3GPP access
NOTE 1:	The reference architecture in all above figures only shows the architecture and the network functions directly connected to support non-3GPP access, and other parts of the architecture are the same as defined in clause 4.2.
NOTE 2:	The reference architecture in all above figures supports service based interfaces for AMF (Network Function), SMF (Network Function) and other NFs not represented in the figures.
NOTE 3:	The two N2 (Non-service-based Interface) (Service-based Interface) instances in Figure 4.2.8.2.2-1 and in Figure 4.2.8.2.2-3 terminate to a single AMF (Network Function) for a UE (Network Function) which is connected to the same 5G Core Network over 3GPP access and non-3GPP access simultaneously.
NOTE 4:	The two N3 (Non-service-based Interface) (Service-based Interface) instances in Figure 4.2.8.2.2-1 and in Figure 4.2.8.2.2-3 may terminate to different UPFs when different PDU Sessions are established over 3GPP access and non-3GPP access.

Figure 4.2.8.2.3-1: Home-routed Roaming architecture for 5G Core Network with untrusted non-3GPP access - N3IWF (Network Function) in the same VPLMN as 3GPP access

Figure 4.2.8.2.3-2: Home-routed Roaming architecture for 5G Core Network with untrusted non-3GPP access - N3IWF (Network Function) in a different VPLMN than 3GPP access

Figure 4.2.8.2.3-3: Home-routed Roaming architecture for 5G Core Network with untrusted non-3GPP access - N3IWF (Network Function) in HPLMN

Figure 4.2.8.2.3-4: Home-routed Roaming architecture for 5G Core Network with trusted non-3GPP access using the same VPLMN as 3GPP access
NOTE 1:	The reference architecture in all above figures only shows the architecture and the network functions directly connected to support non-3GPP access, and other parts of the architecture are the same as defined in clause 4.2.
NOTE 2:	The two N2 (Non-service-based Interface) (Service-based Interface) instances in Figure 4.2.8.2.3-1 and in Figure 4.2.8.2.3-4 terminate to a single AMF (Network Function) for a UE (Network Function) which is connected to the same 5G Core Network over 3GPP access and non-3GPP access simultaneously.
The description of the reference points specific for the non-3GPP access:
N2 (Non-service-based Interface) (Service-based Interface), N3 (Non-service-based Interface) (Service-based Interface), N4 (Service-based Interface), N6 (Non-service-based Interface) (Service-based Interface): these are defined in clause 4.2.
Y1 (Non-service-based Interface)	Reference point between the UE (Network Function) and the untrusted non-3GPP access (e.g. WLAN). This depends on the non-3GPP access technology and is outside the scope of 3GPP.
Y2 (Non-service-based Interface)	Reference point between the untrusted non-3GPP access and the N3IWF (Network Function) for the transport of NWu traffic.
Y4	Reference point between the 5G-RG and the W-AGF (Network Function) which transports the user plane traffic and the N1 (Non-service-based Interface) (Service-based Interface) NAS (Protocol) protocol. The definition of this interface is outside the scope of 3GPP.
Y5	Reference point between the FN-RG and the W-AGF (Network Function). The definition of this interface is outside the scope of 3GPP.
Yt	Reference point between the UE (Network Function) and the TNAP. See e.g. Figure 4.2.8.2.1-2.
Yt'	Reference point between the N5CW devices and the TWAP. It is defined in clause 4.2.8.5.
NWu	Reference point between the UE (Network Function) and N3IWF (Network Function) for establishing secure tunnel(s) between the UE (Network Function) and N3IWF (Network Function) so that control-plane and user-plane exchanged between the UE (Network Function) and the 5G Core Network is transferred securely over untrusted non-3GPP access.
NWt	Reference point between the UE (Network Function) and the TNGF (Network Function). A secure NWt connection is established over this reference point, as specified in clause 4.12a.2.2 of TS 23.502 [3]. NAS (Protocol) messages between the UE (Network Function) and the AMF (Network Function) are transferred via this NWt connection.
Ta	A reference point between the TNAP and the TNGF (Network Function), which is used to support an AAA interface. Ta requirements are documented in clause 4.2.8.3.2.
Tn	A reference point between two TNGFs, which is used to facilitate UE (Network Function) mobility between different TNGFs (inter-TNGF (Network Function) mobility).
Tn and inter-TNGF (Network Function) mobility are not specified in this Release of the specification.
Ta shall be able to
-	Carry EAP-5G traffic and user location information before the NWt connection is established between the UE (Network Function) and the TNGF (Network Function).
-	Allow the UE (Network Function) and the TNGF (Network Function) to exchange IP  (Protocol)traffic.
In deployments where the TNAP does not allocate the local IP  (Protocol)addresses to UE (Network Function)(s), Ta shall be able to:
-	Allow the UE (Network Function) to request and receive IP  (Protocol)configuration from the TNAN (including a local IP  (Protocol)address), e.g. with DHCP. This is to allow the UE (Network Function) to use an IP  (Protocol)stack to establish a NWt connection between the UE (Network Function) and the TNGF (Network Function).
NOTE:	The "local IP  (Protocol)address" is the IP  (Protocol)address that allows the UE (Network Function) to contact the TNGF (Network Function); the entity providing this local IP  (Protocol)address is part of TNAN and out of 3GPP scope
In this Release of the specification, Ta is not specified.

Figure 4.2.8.4-1: Non- roaming architecture for 5G Core Network for 5G-RG with Wireline 5G Access network and NG RAN (Network Function)
The 5G-RG can be connected to 5GC via W-5GAN, NG RAN (Network Function) or via both accesses.
NOTE 1:	The reference architecture in figure 4.2.8.4-1 only shows the architecture and the network functions directly connected to Wireline 5G Access Network, and other parts of the architecture are the same as defined in clause 4.2.
NOTE 2:	The reference architecture in figure 4.2.8.4-1 supports service based interfaces for AMF (Network Function), SMF (Network Function) and other NFs not represented in the figure.
NOTE 3:	The two N2 (Non-service-based Interface) (Service-based Interface) instances in Figure 4.2.8.4-1 apply to a single AMF (Network Function) for a 5G-RG which is simultaneously connected to the same 5G Core Network over 3GPP access and Wireline 5G Access Network.
NOTE 4	The two N3 (Non-service-based Interface) (Service-based Interface) instances in Figure 4.2.8. 4-1 may apply to different UPFs when different PDU Sessions are established over 3GPP access and Wireline 5G Access Network.

Figure 4.2.8.4-2: Non- roaming architecture for 5G Core Network for FN-RG with Wireline 5G Access network and NG RAN (Network Function)
The N1 (Non-service-based Interface) (Service-based Interface) for the FN-RG, which is not 5G capable, is terminated on W-AGF (Network Function) which acts on behalf of the FN-RG.
The FN-RG can only be connected to 5GC via W-5GAN.
NOTE 5:	The reference architecture in figure 4.2.8.4-2 only shows the architecture and the network functions directly connected to Wireline 5G Access Network, and other parts of the architecture are the same as defined in clause 4.2.
NOTE 6:	The reference architecture in figure 4.2.8.4-1 supports service based interfaces for AMF (Network Function), SMF (Network Function) and other NFs not represented in the figure.
The devices that do not support 5GC NAS (Protocol) signalling over WLAN access are referred to as "Non-5G-Capable over WLAN" devices, or N5CW devices for short. A N5CW device is not capable to operate as a 5G UE (Network Function) that supports 5GC NAS (Protocol) signalling over a WLAN access network, however, it may be capable to operate as a 5G UE (Network Function) over NG-RAN (Network Function).
Clause 4.2.8.5 specifies the 5GC architectural enhancements that enable N5CW devices to access 5GC via trusted WLAN access networks. A trusted WLAN access network is a particular type of a Trusted Non-3GPP Access Network (TNAN) that supports a WLAN access technology, e.g. IEEE 802.11. Not all trusted WLAN access networks support 5GC access from N5CW devices. To support 5GC access from N5CW devices, a trusted WLAN access network must support the special functionality specified below (e.g. it must support a TWIF (Network Function) function).
When a N5CW device performs an EAP-based access authentication procedure to connect to a trusted WLAN access network, the N5CW device may simultaneously be registered to a 5GC of a PLMN or SNPN. The 5GC registration is performed by the TWIF (Network Function) function (see next clause) in the trusted WLAN access network, on behalf of the N5CW device. The type of EAP authentication procedure, which is used during the 5GC registration to authenticate the N5CW device, is specified in TS 33.501 [29]. In this Release of the specification, Trusted WLAN Access for N5CW Device only supports IP  (Protocol)PDU Session type.
The architecture diagram in Figure 4.2.8.5.2-1 is based on the general 5GS architecture diagrams in clause 4.2 and shows the main network functions required to support 5GC access from N5CW devices. Other network functions are not shown for simplicity.

Figure 4.2.8.5.2-1: Non-roaming and LBO Roaming Architecture for supporting 5GC access from N5CW devices
The reference architecture in Figure 4.2.8.5.2-1 also supports N5CW device access to the subscribed SNPN or access to the SNPN with credentials owned by Credentials Holder. Other parts of the architecture are the same as defined in clause 5.30.2.9.
Trusted WLAN Access Point (TWAP): It is a particular type of a Trusted Non-3GPP Access Point (TNAP) specified in clause 4.2.8.2, that supports a WLAN access technology, e.g. IEEE 802.11. This function is outside the scope of the 3GPP specifications.
Trusted WLAN Interworking Function (TWIF (Network Function)): It provides interworking functionality that enables N5CW devices to access 5GC. The TWIF (Network Function) supports the following functions:
-	Terminates the N1 (Non-service-based Interface) (Service-based Interface), N2 (Non-service-based Interface) (Service-based Interface) and N3 (Non-service-based Interface) (Service-based Interface) interfaces.
-	Implements the AMF (Network Function) selection procedure.
-	Implements the NAS (Protocol) protocol stack and exchanges NAS (Protocol) messages with the AMF (Network Function) on behalf of the N5CW device.
-	On the user plane, it relays protocol data units (PDUs) between the Yw interface and the N3 (Non-service-based Interface) (Service-based Interface) interface.
-	May implement a local mobility anchor within the trusted WLAN access network.
The Yt' and Yw reference points are both outside the scope of the 3GPP specifications. The Yt' reference point transports WLAN messages (e.g. IEEE 802.11 messages), while the Yw reference point:
-	Shall be able to transport authentication messages between the TNAP and the TWIF (Network Function) for enabling authentication of a N5CW device;
-	Shall allow the N5CW device to request and receive IP  (Protocol)configuration from the TWIF (Network Function), including an IP  (Protocol)address, e.g. with DHCP.
-	Shall support the transport of user-plane traffic for the N5CW device.
The N1 (Non-service-based Interface) (Service-based Interface), N2 (Non-service-based Interface) (Service-based Interface) and N3 (Non-service-based Interface) (Service-based Interface) reference points are the same reference points defined in clause 4.2.7.
The Network Analytics architecture is defined in TS 23.288 [86].
In order to support the ATSSS feature, the 5G System Architecture is extended as shown in Figure 4.2.10-1, Figure 4.2.10-2 and Figure 4.2.10-3. The additional functionality that is supported by the UE (Network Function) and the network functions shown in these figures is specified in clause 5.32 below. In summary:
-	The UE (Network Function) supports one or more of the steering functionalities specified in clause 5.32.6, i.e. the MPTCP functionality, the MPQUIC functionality and the ATSSS-LL functionality. Each steering functionality in the UE (Network Function) enables traffic steering, switching and splitting across 3GPP access and non-3GPP access, in accordance with the ATSSS rules provided by the network. The ATSSS-LL functionality is mandatory in the UE (Network Function) for MA PDU Session of type Ethernet.
-	The UPF (Network Function) may support the MPTCP Proxy functionality, which communicates with the MPTCP functionality in the UE (Network Function) by using the MPTCP protocol (IETF RFC 8684 [81]), as defined in clause 5.32.6.2.1.
-	The UPF (Network Function) may support the MPQUIC Proxy functionality, which communicates with the MPQUIC functionality in the UE (Network Function) by using the QUIC protocol (RFC 9000 [166], RFC 9001 [167], RFC 9002 [168]) and its multipath extensions (draft-ietf-quic-multipath [174]), as defined in clause 5.32.6.2.2.
-	The UPF (Network Function) may support ATSSS-LL functionality, which is similar to the ATSSS-LL functionality defined for the UE (Network Function). There is no user plane protocol defined between the ATSSS-LL functionality in the UE (Network Function) and the ATSSS-LL functionality in the UPF (Network Function). The ATSSS-LL functionality in the UPF (Network Function) is not shown in the following three figures.
NOTE 1:	ATSSS-LL functionality is needed in the 5GC for MA PDU Session of type Ethernet.
-	In addition, the UPF (Network Function) supports Performance Measurement Functionality (PMF), which may be used by the UE (Network Function) to obtain access performance measurements (see clause 5.32.5) over the user-plane of 3GPP access and/or over the user-plane of non-3GPP access.
-	The AMF (Network Function), SMF (Network Function) and PCF (Network Function) are extended with new functionality that is further discussed in clause 5.32.

Figure 4.2.10-1: Non-roaming and Roaming with Local Breakout architecture for ATSSS support
NOTE 2:	The interactions between the UE (Network Function) and PCF (Network Function) that may be required for ATSSS control are specified in TS 23.503 [45].
NOTE 3:	The UPF (Network Function) shown in Figure 4.2.10-1 can be connected via an N9 (Service-based Interface) reference point, instead of the N3 (Non-service-based Interface) (Service-based Interface) reference point.
Figure 4.2.10-2 shows the 5G System Architecture for ATSSS support in a roaming case with home-routed traffic and when the UE (Network Function) is registered to the same VPLMN over 3GPP and non-3GPP accesses. In this case, the MPTCP Proxy functionality, the MPQUIC Proxy functionality and the PMF are located in the H-UPF (Network Function).

Figure 4.2.10-2: Roaming with Home-routed architecture for ATSSS support (UE (Network Function) registered to the same VPLMN)
Figure 4.2.10-3 shows the 5G System Architecture for ATSSS support in a roaming case with home-routed traffic and when the UE (Network Function) is registered to a VPLMN over 3GPP access and to HPLMN over non-3GPP access (i.e. the UE (Network Function) is registered to different PLMNs). In this case, the MPTCP Proxy functionality, the MPQUIC functionality and the PMF are located in the H-UPF (Network Function).

Figure 4.2.10-3: Roaming with Home-routed architecture for ATSSS support (UE (Network Function) registered to different PLMNs)
The architecture for 5G multicast-broadcast services is defined in TS 23.247 [129].
The architecture for Proximity based Services (ProSe) in the 5G System is defined in TS 23.304 [128].
The architecture enhancements for edge computing are outlined in clause 5.13 and further described in TS 23.548 [130].
The architecture for Support of Uncrewed Aerial Systems (UAS) connectivity, identification and tracking is defined in TS 23.256 [136].
The reference architecture shown with reference point representation in Figure 4.2.15-1 and with Service Based Interface (SBI)-representation in Figure 4.2.15-2, enables a UE (Network Function) to connect to a WLAN access network using its 5GS credentials without registration to 5GS. This architecture is based on the Non-Seamless WLAN Offload Function (NSWOF (Network Function)), which interfaces to the WLAN access network using the SWa' reference point and interfaces to the AUSF (Network Function) using the Nausf SBI. The SWa' reference point corresponds to SWa reference point as defined in TS 23.402 [43] with the difference that SWa' the EAP procedure ensures that the permanent user ID is not visible over the access as defined in TS 33.501 [29] and that SWa' connects the Untrusted non-3GPP IP  (Protocol)Access, possibly via 3GPP AAA Proxy, to the NSWOF (Network Function) and that the EAP user ID is a SUCI and not an IMSI.
The functionality of the NSWOF (Network Function) and the procedures applied for supporting a WLAN connection using 5GS credentials for Non-seamless WLAN offload are further defined in TS 33.501 [29] Annex S. The roaming architectures are shown with reference point representation in Figure 4.2.15-3 and with SBI representation in Figure 4.2.15-4. The architecture in Figure 4.2.15-1 and Figure 4.2.15-2 applies to UEs with PLMN or SNPN credentials.
NOTE 1:	For a UE (Network Function) with SNPN credentials it is assumed that the realm part of UE (Network Function) identifier in SUCI format is defined in a way that enables routing of SWa requests from the WLAN AN to the NSWOF (Network Function) in the SNPN's 5GC.
The architectures in Figure 4.2.15-3a and Figure 4.2.15-4a apply to UEs with PLMN or SNPN credentials from a CH using UDM (Network Function).
The architecture in Figure 4.2.15-3b applies to UEs with SNPN credentials from a CH using AAA Server. In this architecture the UE (Network Function) procedures for access selection for 5G NSWO defined in clause 6.3.12b apply. Except the UE (Network Function), all NFs in Figure 4.2.15-3b are out of scope of 3GPP.
NOTE 2:	How to protect the user identity over the WLAN interface in architecture defined in Figure 4.2.15-3b is defined in TS 33.501 [29].
The UE (Network Function) can also connect to a WLAN access network using 5GS credentials by performing the 5GS registration via Trusted non-3GPP access procedure defined in clause 4.12a.2.2 of TS 23.502 [3]. With this procedure, the UE (Network Function) connects to a WLAN access network using 5GS credentials and simultaneously registers in 5GS. However, the architecture defined in Figure 4.2.15-1, Figure 4.2.15-2, Figure 4.2.15-3 and in Figure 4.2.15-4, enables a UE (Network Function) to connect to a WLAN access network using 5GS credentials but without registration in 5GS.
If the WLAN is configured as Untrusted Non-3GPP access, in the case that the WLAN supports IEEE 802.1x, the UE (Network Function) may first use the 5G NSWO procedure to obtain a connection with and the local IP  (Protocol)address from the WLAN, and any time after that, the UE (Network Function) may initiate the Untrusted Non-3GPP Access to obtain the access to 5GC.

Figure 4.2.15-1: Reference architecture to support authentication for Non-seamless WLAN offload in 5GS

Figure 4.2.15-2: Service based reference architecture to support authentication for Non-seamless WLAN offload in 5GS

Figure 4.2.15-3: Roaming reference architectures to support authentication for Non-seamless WLAN offload in 5GS

Figure 4.2.15-3a: Reference architectures to support authentication for Non-seamless WLAN offload using credentials from Credentials Holder using UDM (Network Function)

Figure 4.2.15-3b: Reference architectures to support authentication for Non-seamless WLAN offload using credentials from Credentials Holder using AAA Server
NOTE 2:	Configuration 2) in Figure 4.2.15-3 and Figure 4.2.15-3a is a deployment variant of configuration 1)

Figure 4.2.15-4: Service based Roaming reference architecture to support authentication for Non-seamless WLAN offload in 5GS
The SWd' reference point corresponds to the SWd reference point as defined in TS 23.402 [43] with the difference that SWd' connects the 3GPP AAA Proxy, possibly via intermediate 3GPP AAA Proxy, to the NSWOF (Network Function) and that the EAP user ID is a SUCI and not an IMSI.
In both roaming and non-roaming scenarios, the NSWOF (Network Function) acts towards the WLAN Access as a 3GPP AAA server, with the difference that the EAP user ID is a SUCI and not an IMSI.

Figure 4.2.15-4a: Service based reference architecture to support authentication for Non-seamless WLAN offload using credentials from Credentials Holder using UDM (Network Function)
As depicted in Figure 4.2.16-1, the 5G System architecture allows user plane information exposure to some NFs via service-based interface in UPF (Network Function).

Figure 4.2.16-1: Architecture to support User Plane Information Exposure via a service-based interface
NOTE 1:	In this Release of the specification, only NWDAF (Network Function)/DCCF (Network Function)/MFAF (Network Function), NEF (Network Function)/AF (Network Function) and TSNAF/TSCTSF (Network Function) are considered as the receiver of the UPF (Network Function) event notifications.
NOTE 2:	UPF (Network Function) exposure is not restricted to SBI interface, i.e. reporting via PFCP over N4 (Service-based Interface) to SMF (Network Function) is still applicable.
Not all events can be subscribed to UPF (Network Function) directly. The details and constraints for the subscription (i.e. direct vs. indirect) and the UPF (Network Function)-related information that is exposed to certain NFs via subscriptions, as well as the information contained in the event notifications, are defined in clause 5.2.26.2 of TS 23.502 [3].
The architecture for Ranging based services and Sidelink Positioning is defined in TS 23.586 [180].
Figure 4.3.1-1 represents the non-roaming architecture for interworking between 5GS and EPC/E-UTRAN.

Figure 4.3.1-1: Non-roaming architecture for interworking between 5GS and EPC/E-UTRAN
NOTE 1:	N26 (Service-based Interface) interface is an inter-CN interface between the MME and 5GS AMF (Network Function) in order to enable interworking between EPC and the NG core. Support of N26 (Service-based Interface) interface in the network is optional for interworking. N26 (Service-based Interface) supports subset of the functionalities (essential for interworking) that are supported over S10.
NOTE 2:	PGW-C + SMF (Network Function) and UPF (Network Function) + PGW-U are dedicated for interworking between 5GS and EPC, which are optional and are based on UE (Network Function) MM Core Network Capability and UE (Network Function) subscription. UEs that are not subject to 5GS and EPC interworking may be served by entities not dedicated for interworking, i.e. by either by PGW or SMF (Network Function)/UPF (Network Function).
NOTE 3:	There can be another UPF (Network Function) (not shown in the figure above) between the NG-RAN (Network Function) and the UPF (Network Function) + PGW-U, i.e. the UPF (Network Function) + PGW-U can support N9 (Service-based Interface) towards an additional UPF (Network Function), if needed.
NOTE 4: Figures and procedures in this specification that depict an SGW make no assumption whether the SGW is deployed as a monolithic SGW or as an SGW split into its control-plane and user-plane functionality as described in TS 23.214 [32].
Figure 4.3.2-1 represents the Roaming architecture with local breakout and Figure 4.3.2-2 represents the Roaming architecture with home-routed traffic for interworking between 5GS and EPC/E-UTRAN.

Figure 4.3.2-1: Local breakout roaming architecture for interworking between 5GS and EPC/E-UTRAN
NOTE 1:	There can be another UPF (Network Function) (not shown in the figure above) between the NG-RAN (Network Function) and the UPF (Network Function) + PGW-U, i.e. the UPF (Network Function) + PGW-U can support N9 (Service-based Interface) towards the additional UPF (Network Function), if needed.
NOTE 2:	S9 interface from EPC is not required since no known deployment exists.

Figure 4.3.2-2: Home-routed roaming architecture for interworking between 5GS and EPC/E-UTRAN
Figure 4.3.3-1 represents the non-roaming architecture for interworking between 5GC via non-3GPP access and EPC/E-UTRAN.

Figure 4.3.3.1-1: Non-roaming architecture for interworking between 5GC via non-3GPP access and EPC/E-UTRAN
NOTE 1:	There can be another UPF (Network Function) (not shown in the figure above) between the N3IWF (Network Function)/TNGF (Network Function) and the UPF (Network Function) + PGW-U, i.e. the UPF (Network Function) + PGW-U can support N9 (Service-based Interface) towards an additional UPF (Network Function), if needed.
NOTE 2:	N26 (Service-based Interface) interface is not precluded, but it is not shown in the figure because it is not required for the interworking between 5GC via non-3GPP access and EPC/E-UTRAN.
Figure 4.3.3.2-1 represents the Roaming architecture with local breakout and Figure 4.3.3.2-2 represents the Roaming architecture with home-routed traffic for interworking between 5GC via non-3GPP access and EPC/E-UTRAN.

Figure 4.3.3.2-1: Local breakout roaming architecture for interworking between 5GC via non-3GPP access and EPC/E-UTRAN
NOTE 1:	There can be another UPF (Network Function) (not shown in the figure above) between the N3IWF (Network Function)/TNGF (Network Function) and the UPF (Network Function) + PGW-U, i.e. the UPF (Network Function) + PGW-U can support N9 (Service-based Interface) towards the additional UPF (Network Function), if needed.
NOTE 2:	S9 interface from EPC is not required since no known deployment exists.
NOTE 3:	N26 (Service-based Interface) interface is not precluded, but it not shown in the figure because it is not required for the interworking between 5GC via non-3GPP access and EPC/E-UTRAN.

Figure 4.3.3.2-2: Home-routed roaming architecture for interworking between 5GC via non-3GPP access and EPC/E-UTRAN
NOTE 4:	N26 (Service-based Interface) interface is not precluded, but it not shown in the figure because it is not required for the interworking between 5GC via non-3GPP access and EPC/E-UTRAN.
Figure 4.3.4.1-1 represents the non-roaming architecture for interworking between ePDG/EPC and 5GS.

Figure 4.3.4.1-1: Non-roaming architecture for interworking between ePDG/EPC and 5GS
NOTE 1:	The details of the interfaces between the UE (Network Function) and the ePDG, and between EPC nodes (i.e. SWm, SWx, S2b and S6b), are documented in TS 23.402 [43].
NOTE 2:	Interworking with ePDG is only supported with GTP based S2b. S6b interface is optional (see clause 4.11.4.3.6 of TS 23.502 [3]).
Figure 4.3.4.2-1 represents the Roaming architecture with local breakout and Figure 4.3.4.2-2 represents the Roaming architecture with home-routed traffic for interworking between ePDG/EPC and 5GS.

Figure 4.3.4.2-1: Local breakout roaming architecture for interworking between ePDG/EPC and 5GS
NOTE 1:	The details of the interfaces between the UE (Network Function) and the ePDG, and between EPC nodes (i.e. SWm, SWd, SWx, S2b and S6b), are documented in TS 23.402 [43].
NOTE 2:	Interworking with ePDG is only supported with GTP based S2b. S6b interface is optional (see clause 4.11.4.3.6 of TS 23.502 [3]).

Figure 4.3.4.2-2: Home-routed roaming architecture for interworking between ePDG/EPC and 5GS
NOTE 1:	The details of the interfaces between the UE (Network Function) and the ePDG, and between EPC nodes (i.e. SWm, SWd, SWx, S2b and S6b), are documented in TS 23.402 [43].
NOTE 2:	Interworking with ePDG is only supported with GTP based S2b. S6b interface is optional (see clause 4.11.4.3.6 of TS 23.502 [3]).
Figure 4.3.5.1-1 shows the non-roaming architecture for Service Exposure for EPC-5GC Interworking. If the UE (Network Function) is capable of mobility between EPS and 5GS, the network is expected to associate the UE (Network Function) with an SCEF+NEF (Network Function) node for Service Capability Exposure.

Figure 4.3.5.1 1: Non-roaming Service Exposure Architecture for EPC-5GC Interworking
NOTE 1:	In Figure 4.3.5.1-1, Trust domain for SCEF+NEF (Network Function) is same as Trust domain for SCEF as defined in TS 23.682 [36].
NOTE 2:	In Figure 4.3.5.1-1, EPC Interface represents southbound interfaces between SCEF and EPC nodes e.g. the S6t interface between SCEF and HSS, the T6a interface between SCEF and MME, etc. All southbound interfaces from SCEF are defined in TS 23.682 [36] and are not shown for the sake of simplicity.
NOTE 3:	In Figure 4.3.5.1-1, 5GC Interface represents southbound interfaces between NEF (Network Function) and 5GC Network Functions e.g. N29 (Service-based Interface) interface between NEF (Network Function) and SMF (Network Function), N30 (Service-based Interface) interface between NEF (Network Function) and PCF (Network Function), etc. All southbound interfaces from NEF (Network Function) are not shown for the sake of simplicity.
NOTE 4:	Interaction between the SCEF and NEF (Network Function) within the combined SCEF+NEF (Network Function) is required. For example, when the SCEF+NEF (Network Function) supports monitoring APIs, the SCEF and NEF (Network Function) need to share context and state information on a UE (Network Function)'s configured monitoring events if the UE (Network Function) moves between from EPC and 5GC.
NOTE 5:	The north-bound APIs which can be supported by an EPC or 5GC network are discovered by the SCEF+NEF (Network Function) node via the CAPIF (Network Function) function and/or via local configuration of the SCEF+NEF (Network Function) node. Different sets of APIs can be supported by the two network types.
Figure 4.3.5.2-1 represents the roaming architecture for Service Exposure for EPC-5GC Interworking. This architecture is applicable to both the home routed roaming and local breakout roaming.

Figure 4.3.5.2-1: Roaming Service Exposure Architecture for EPC-5GC Interworking
NOTE:	Figure 4.3.5.2-1 does not include all the interfaces, and network elements or network functions that may be connected to SCEF+NEF (Network Function).
The Public Warning System architecture for 5G System is specified in TS 23.041 [46].
This clause introduces legacy SMS over NAS (Protocol) architecture, in which the interfaces between SMSF (Network Function)/UDM (Network Function) and SMS-GMSC/SMS-IWMSC/IP-SM-GW/SMS Router are still based on legacy protocol (i.e. MAP or Diameter).
The SBI-based SMS architecture and interfaces are specified in TS 23.540 [142].
Figure 4.4.2.1-1 shows the non-roaming architecture to support SMS over NAS (Protocol) using the Service-based interfaces within the Control Plane.

Figure 4.4.2.1-1: Non-roaming System Architecture for SMS over NAS (Protocol)
Figure 4.4.2.1-2 shows the non-roaming architecture to support SMS over NAS (Protocol) using the reference point representation.

Figure 4.4.2.1-2: Non-roaming System Architecture for SMS over NAS (Protocol) in reference point representation
NOTE 1:	SMS Function (SMSF (Network Function)) may be connected to the SMS-GMSC/IWMSC/SMS Router via one of the standardized interfaces as shown in TS 23.040 [5].
NOTE 2:	UDM (Network Function) may be connected to the SMS-GMSC/IWMSC/SMS Router via one of the standardized interfaces as shown in TS 23.040 [5].
NOTE 3:	Each UE (Network Function) is associated with only one SMS Function in the registered PLMN.
NOTE 4:	SMSF (Network Function) re-allocation while the UE (Network Function) is in RM-REGISTERED state in the serving PLMN is not supported in this Release of the specification. When serving AMF (Network Function) is re-allocated for a given UE (Network Function), the source AMF (Network Function) includes SMSF (Network Function) identifier as part of UE (Network Function) context transfer to target AMF (Network Function). If the target AMF (Network Function), e.g. in the case of inter-PLMN mobility, detects that no SMSF (Network Function) has been selected in the serving PLMN, then the AMF (Network Function) performs SMSF (Network Function) selection as specified in clause 6.3.10.
NOTE 5:	To support MT SMS domain selection by IP-SM-GW/SMS Router, IP-SM-GW/SMS Router may connect to SGs MSC, MME and SMSF (Network Function) via one of the standardized interfaces as shown in TS 23.040 [5].
Figure 4.4.2.1-3 shows the roaming architecture to support SMS over NAS (Protocol) using the Service-based interfaces within the Control Plane.

Figure 4.4.2.1-3: Roaming architecture for SMS over NAS (Protocol)
Figure 4.4.2.1-4 shows the roaming architecture to support SMS over NAS (Protocol) using the reference point representation.

Figure 4.4.2.1-4: Roaming architecture for SMS over NAS (Protocol) in reference point representation
N1 (Non-service-based Interface) (Service-based Interface):	Reference point for SMS transfer between UE (Network Function) and AMF (Network Function) via NAS (Protocol).
Following reference points are realized by service based interfaces:
N8 (Service-based Interface):	Reference point for SMS Subscription data retrieval between AMF (Network Function) and UDM (Network Function).
N20 (Service-based Interface):	Reference point for SMS transfer between AMF (Network Function) and SMS Function.
N21 (Service-based Interface):	Reference point for SMS Function address registration management and SMS Management Subscription data retrieval between SMS Function and UDM (Network Function).
Nsmsf:	Service-based interface exhibited by SMSF (Network Function).
IMS support for 5GC is defined in TS 23.228 [15].
The 5G System architecture supports N5 (Service-based Interface) interface between PCF (Network Function) and P-CSCF and supports Rx interface between PCF (Network Function) and P-CSCF, to enable IMS service. See TS 23.228 [15], TS 23.503 [45] and TS 23.203 [4].
NOTE 1:	Rx support between PCF (Network Function) and P-CSCF is for backwards compatibility for early deployments using Diameter between IMS and 5GC functions.
NOTE 2:	When service based interfaces are used between the PCF (Network Function) and P-CSCF in the same PLMN, the P-CSCF performs the functions of a trusted AF (Network Function) in the 5GC.
Location Service feature is optional and applicable to both regulatory services and commercial services in this Release of the specification. The non-roaming and roaming architecture to support Location Services are defined in clause 4.2 of TS 23.273 [87].
The reference points to support Location Services are defined in clause 4.4 of TS 23.273 [87].
The Service Based Interfaces to support Location Services are defined in clause 4.5 of TS 23.273 [87].
See clause 5.2.6.1 of TS 23.502 [3].
Application trigger message contains information that allows the network to route the message to the appropriate UE (Network Function) and the UE (Network Function) to route the message to the appropriate application. The information destined to the application, excluding the information to route it, is referred to as the Trigger payload. The Trigger payload is implementation specific.
NOTE:	The application in the UE (Network Function) may perform actions indicated by the Trigger payload when the Triggered payload is received at the UE (Network Function). For example initiation of immediate or later communication with the application server based on the information contained in the Trigger payload, which includes the PDU Session Establishment procedure if the related PDU Session is not already established.
The general User Plane architectures described in clause 4.2.3 and clause 4.2.4 apply to 5G LAN-type services, with the additional options described in this clause.
Figure 4.4.6.1-1 depicts the non-roaming user plane architecture to support 5G LAN-type service using local switch.

Figure 4.4.6.1-1: Local-switch based user plane architecture in non-roaming scenario
Figure 4.4.6.1-2 depicts the non-roaming user plane architecture to support 5G LAN-type service using N19 (Service-based Interface) tunnel.

Figure 4.4.6.1-2: N19 (Service-based Interface)-based user plane architecture in non-roaming scenario
NOTE:	As described in clause 5.29.3, the PSA (Network Function) UPFs can be controlled by a dedicated SMF (Network Function), a dedicated SMF (Network Function) Set or multiple SMF (Network Function) Sets.
N19 (Service-based Interface):	Reference point between two UPFs for direct routing of traffic between different PDU Sessions without using N6 (Non-service-based Interface) (Service-based Interface). It has a per 5G VN group granularity.
MSISDN-less MO SMS via T4 is subscription based. The subscription provides the information whether a UE (Network Function) is allowed to originate MSISDN-less MO SMS.
The UE (Network Function) is pre-configured with the Service Centre address that points to SMS-SC that performs this MO SMS delivery via NEF (Network Function) delivery procedure. The recipient of this short message is set to the pre-configured address of the AF (Network Function) (i.e. Address of the destination SME). If UE (Network Function) has multiple GPSIs associated to the same IMSI, the GPSI that is associated with an SMS may be determined from the UE (Network Function)'s IMSI and the Application (Protocol) Port ID value in the TP-User-Data field (see TS 23.040 [5]). The NEF (Network Function) may obtain the GPSI by querying the UDM (Network Function) with the IMSI and application port ID.
UE (Network Function) is aware whether the MO SMS delivery status (success or fail) based on the SMS delivery report from SMS-SC. The network does not perform any storing and forwarding functionality for MO SMS.
See clause 5.2.6 of TS 23.502 [3] for a description of NEF (Network Function) Services and Service Operations.
The 5G System can be extended to support the following:
a)	Integration of 5GS into a TSN data network (DN (Network Function)): Integration as a bridge in an IEEE 802.1 Time Sensitive Networking (TSN). The 5GS bridge supports the Time sensitive communication as defined in IEEE 802.1 Time Sensitive Networking (TSN) standards. The architecture is described in clause 4.4.8.2.
	This Release supports of the specification, integration of the 5G System with IEEE 802.1 TSN networks that apply the fully centralized configuration model as defined in IEEE Std 802.1Q [98]. IEEE TSN is a set of standards to define mechanisms for the time-sensitive (i.e. deterministic) transmission of data over Ethernet networks.
b)	Enablers for AF (Network Function) requested support of Time Synchronization and/or some aspects of Time Sensitive Communication. The architecture is described in clause 4.4.8.3.
c)	Support for TSN enabled transport network (TN): Enablers for interworking with TSN network deployed in the transport network. This option can be used simultaneously with either option a) or b). The architecture is described in clause 5.28a. The interworking is applicable when the transport network deploys the fully centralized configuration model as defined in IEEE Std 802.1Q [98]. In this scenario, a TSN TN is deployed to realize the N3 (Non-service-based Interface) (Service-based Interface) interface between (R)AN and UPF (Network Function). From the perspective of the TSN TN, (R)AN and UPF (Network Function) act as End Stations of the TSN TN.
d)	Integration as a router in a Deterministic Network as defined in IETF RFC 8655 [150]. The architecture is described in clause 4.4.8.4.
The 5G System is integrated with the external network as a TSN bridge. This "logical" TSN bridge (see Figure 4.4.8.2-1) includes TSN Translator functionality for interoperation between TSN Systems and 5G System both for user plane and control plane. 5GS TSN translator functionality consists of Device-side TSN translator (DS-TT) and Network-side TSN translator (NW-TT). The TSN AF (Network Function) is part of 5GC and provides the control plane translator functionality for the integration of the 5GS with a TSN network, e.g. the interactions with the CNC. 5G System specific procedures in 5GC and RAN (Network Function), wireless communication links, etc. remain hidden from the TSN network. To achieve such transparency to the TSN network and the 5GS to appear as any other TSN Bridge, the 5GS provides TSN ingress and egress ports via DS-TT and NW-TT. DS-TT and NW-TT optionally support:
-	hold and forward functionality for the purpose of de-jittering;
-	per-stream filtering and policing as defined in clause 8.6.5.2.1 of IEEE Std 802.1Q [98].
DS-TT optionally supports link layer connectivity discovery and reporting as defined in IEEE Std 802.1AB [97] for discovery of Ethernet devices attached to DS-TT. NW-TT supports link layer connectivity discovery and reporting as defined in IEEE Std 802.1AB [97] for discovery of Ethernet devices attached to NW-TT. If a DS-TT does not support link layer connectivity discovery and reporting, then NW-TT performs link layer connectivity discovery and reporting as defined in IEEE Std 802.1AB [97] for discovery of Ethernet devices attached to DS-TT on behalf of DS-TT.
NOTE 1:	If NW-TT performs link layer connectivity discovery and reporting on behalf of DS-TT, it is assumed that LLDP frames are transmitted between NW-TT and UE (Network Function) on the QoS Flow with the default QoS rule as defined in the clause 5.7.1.1. Alternatively, SMF (Network Function) can establish a dedicated QoS Flow matching on the Ethertype defined for LLDP (IEEE Std 802.1AB [97]).
There are three TSN configuration models defined in IEEE Std 802.1Q [98]. Amongst the three models:
-	fully centralized model is supported in this Release of the specification;
-	fully distributed model is not supported in this Release of the specification;
-	centralized network/distributed user model is not supported in this Release of the specification.
NOTE 2:	This Release supports interworking with TSN using clause 8.6.8.4 of IEEE Std 802.1Q [98] scheduled traffic and clause 8.6.5.2.1 of IEEE Std 802.1Q [98] per-stream filtering and policy.

Figure 4.4.8.2-1: System architecture view with 5GS appearing as TSN bridge
NOTE 3:	Whether DS-TT and UE (Network Function) are combined or are separate is up to implementation.
NOTE 4:	TSN AF (Network Function) does not need to support N33 (Service-based Interface) in this release of the specification.
This clause describes the architecture to enable Time Sensitive Communication AF (Network Function) requested time sensitive communication and time synchronization services. The Time Sensitive Communication and Time Synchronization related features that are supported based on AF (Network Function) request are described in clauses 5.27.1 and 5.27.2, respectively. Figure 4.4.8.3-1 shows the architecture to support Time Sensitive Communication and Time Synchronization services.
As shown in Figure 4.4.8.3-1, to support Time Synchronization service based on IEEE Std 802.1AS [104] or IEEE Std 1588 [126] for Ethernet or IP  (Protocol)type PDU Sessions, the DS-TT, NW-TT and Time Sensitive Communication and Time Synchronization Function (TSCTSF (Network Function)) are required in order to support the features in IEEE Std 802.1AS [104] or IEEE Std 1588 [126] as described in clause 5.27. The NEF (Network Function) exposes 5GS capability to support Time Synchronization service as described in clause 5.27.1.8. TSCTSF (Network Function) controls the DS-TT(s) and NW-TT for the (g)PTP based time synchronization service. In addition, TSCTSF (Network Function) supports TSC assistance container related functionalities.

Figure 4.4.8.3-1: Architecture to enable Time Sensitive Communication and Time Synchronization services
NOTE 1:	If the AF (Network Function) is considered to be trusted by the operator, the AF (Network Function) could interact directly with TSCTSF (Network Function), the connection between AF (Network Function) and TSCTSF (Network Function) is not depicted in the architecture diagram for brevity.
UPF (Network Function)/NW-TT distributes the (g)PTP messages as described in clause 5.27.1.
When the UPF (Network Function) supports one or more NW-TT(s), there is one-to-one association between an NW-TT and the network instance or between an NW-TT and network instance together with DNN/S-NSSAI in the UPF (Network Function). When there are multiple network instances within a UPF (Network Function), each network instance is considered logically separate. The network instance for the N6 (Non-service-based Interface) (Service-based Interface) interface (clause 5.6.12) may be indicated by the SMF (Network Function) to the UPF (Network Function) for a given PDU Session during PDU Session establishment procedure. UPF (Network Function) allocates resources based on the Network Instance and S-NSSAI and it is supported according to TS 29.244 [65]. DNN/S-NSSAI may be indicated by the SMF (Network Function) together with the network instance to the UPF (Network Function) for a given PDU Session during PDU Session establishment procedure.
NOTE 2:	The same NW-TT is used for all PDU Sessions in the UPF (Network Function) for the given DNN/S-NSSAI; the NW-TT is unique per DNN/S-NSSAI. This ensures that the UPF (Network Function) selects an N4 (Service-based Interface) session associated with the correct TSCTSF (Network Function) when the NW-TT initiates an UMIC or PMIC. At any given time, the NW-TT is associated with a single TSCTSF (Network Function).
The 5G System is integrated with the Deterministic Network as defined in IETF RFC 8655 [150] as a logical DetNet transit router, see Figure 4.4.8.4-1. The TSCTSF (Network Function) performs mapping in the control plane between the 5GS internal functions and the DetNet controller. 5G System specific procedures in 5GC and RAN (Network Function) remain hidden from the DetNet controller.

Figure 4.4.8.4-1: 5GS Architecture to support IETF Deterministic Networking
On the device side, the UE (Network Function) is connected with a DetNet system, which may be a DetNet End System or a DetNet Node.
The architecture does not require the DS-TT functionality to be supported in the device nor require the user plane NW-TT functionality to be supported in the UPF (Network Function), however, it can co-exist with such functions. For the reporting of information of the network side ports, NW-TT control plane function is used. The architecture can be combined with architecture in clause 4.4.8.3 to support time synchronization and TSC.
DetNet may be used in combination with time synchronization mechanisms as defined in clause 5.27, but it does not require usage of these mechanisms.
5GS acts as a DetNet router in the DetNet domain. Use cases where the 5GS acts as a sub-network (see clause 4.1.2 of IETF RFC 8655 [150]) are also possible but do not require any additional 3GPP standardization. A special case where the 5GS can act as a sub-network is when the 5GS acts as a TSN network, which is supported by the 3GPP specifications based on the architecture in clause 4.4.8.2.
NOTE:	For DetNet interworking, it is assumed that there is a business agreement to support the use of the DetNet controller so that it can be regarded trusted for the operator. Depending on the needs of a given deployment, functions such as the authentication, authorization and potential throttling of signalling from the DetNet controller can be achieved by including such functionalities in the TSCTSF (Network Function).
The routing of the downlink packets is achieved using the existing 3GPP functions.
5	High level features
Clause 5 specifies the high level functionality and features of the 5G System for both 3GPP and Non-3GPP access and for the interoperability with the EPC defined in TS 23.401 [26].
Network access is the means for the user to connect to 5G CN. Network access control comprises the following functionality:
-	Network selection,
-	Identification and authentication,
-	Authorisation,
-	Access control and barring,
-	Policy control,
-	Lawful Interception.
In order to determine to which PLMN to attempt registration, the UE (Network Function) performs network selection. The network selection procedure comprises two main parts, PLMN selection and access network selection. The requirements for the PLMN selection are specified in TS 22.011 [25] and the procedures are in TS 23.122 [17]. The access network selection part for the 3GPP access networks is specified in TS 36.300 [30] for E-UTRAN and in TS 38.300 [27] for the NR.
The network selection for the Disaster Roaming is described in TS 23.122 [17] and TS 24.501 [47].
5.2.2a	Void

The network may authenticate the UE (Network Function) during any procedure establishing a NAS (Protocol) signalling connection with the UE (Network Function). The security architecture is specified in TS 33.501 [29]. The network may optionally perform an PEI check with 5G-EIR (Network Function).
The authorisation for connectivity of the subscriber to the 5GC and the authorization for the services that the user is allowed to access based on subscription (e.g. Operator Determined Barring, Roaming restrictions, Access Type and RAT Type currently in use) is evaluated once the user is successfully identified and authenticated. This authorization is executed during UE (Network Function) Registration procedure.
When the UE (Network Function) needs to transmit an initial NAS (Protocol) message, the UE (Network Function) shall request to establish an RRC (Protocol) Connection first and the NAS (Protocol) shall provide the RRC (Protocol) establishment related information to the lower layer. The RAN (Network Function) handles the RRC (Protocol) Connection with priority during and after RRC (Protocol) Connection Establishment procedure, when UE (Network Function) indicates priority in Establishment related information
Under high network load conditions, the network may protect itself against overload by using the Unified Access Control functionality for 3GPP access specified in TS 22.261 [2], TS 24.501 [47] and TS 38.300 [27] to limit access attempts from UEs. Depending on network configuration, the network may determine whether certain access attempt should be allowed or blocked based on categorized criteria, as specified in TS 22.261 [2] and TS 24.501 [47]. The NG-RAN (Network Function) may broadcast barring control information associated with Access Categories and Access Identities as specified in TS 38.300 [27].
The NG-RAN (Network Function) node may initiate such Unified Access Control when:
-	AMFs request to restrict the load for UEs that access the network by sending OVERLOAD START message containing conditions defined in clause 5.19.5.2, or
-	requested by OAM, or
-	triggered by NG-RAN (Network Function) itself.
If the NG-RAN (Network Function) node takes a decision to initiate UAC because of the reception of the N2 (Non-service-based Interface) (Service-based Interface) interface OVERLOAD START messages, the NG-RAN (Network Function) should only initiate such procedure if all the AMFs relevant to the request contained in the OVERLOAD START message and connected to this NG-RAN (Network Function) node request to restrict the load for UEs that access the network.
If the UE (Network Function) supports both N1 (Non-service-based Interface) (Service-based Interface) and S1 modes NAS (Protocol) and, as defined in TS 23.401 [26], the UE (Network Function) is configured for Extended Access Barring (EAB) but is not configured with a permission for overriding Extended Access Barring (EAB), when the UE (Network Function) wants to access the 5GS it shall perform Unified Access Control checks for Access Category 1 on receiving an indication from the upper layers as defined in TS 24.501 [47], TS 38.331 [28], TS 36.331 [51].
If the UE (Network Function) supports both N1 (Non-service-based Interface) (Service-based Interface) and S1 modes NAS (Protocol) and, as defined in TS 23.401 [26], the UE (Network Function) is configured with a permission for overriding Extended Access Barring (EAB), when the UE (Network Function) wants to access the 5GS it shall ignore Unified Access Control checks for Access Category 1 on receiving an indication from the upper layers, as defined in TS 24.501 [47].
NOTE:	UE (Network Function) signalling of Low Access Priority indication over N1 (Non-service-based Interface) (Service-based Interface) in 5GS is not supported in this release of the specification.
Operator may provide one or more PLMN-specific Operator-defined access category definitions to the UE (Network Function) using NAS (Protocol) signalling, and the UE (Network Function) handles the Operator-defined access category definitions stored for the Registered PLMN, as specified in TS 24.501 [47].
The access control for the Disaster Roaming is described in TS 23.122 [17] and TS 24.501 [47].
Network access control including service authorization may be influenced by Policy control, as specified in clause 5.14.
For definition and functionality of Lawful Interception, please see TS 33.126 [35].
The Registration Management is used to register or deregister a UE (Network Function)/user with the network, and establish the user context in the network. The Connection Management is used to establish and release the signalling connection between the UE (Network Function) and the AMF (Network Function).
A UE (Network Function)/user needs to register with the network to receive services that requires registration. Once registered and if applicable the UE (Network Function) updates its registration with the network (see TS 23.502 [3]):
-	periodically, in order to remain reachable (Periodic Registration Update); or
-	upon mobility (Mobility Registration Update); or
-	to update its capabilities or re-negotiate protocol parameters (Mobility Registration Update).
The Initial Registration procedure involves execution of Network Access Control functions as defined in clause 5.2 (i.e. user authentication and access authorization based on subscription profiles in UDM (Network Function)). As result of the Registration procedure, the identifier of the serving AMF (Network Function) serving the UE (Network Function) in the access through which the UE (Network Function) has registered will be registered in UDM (Network Function).
The registration management procedures are applicable over both 3GPP access and Non-3GPP access. The 3GPP and Non-3GPP RM states are independent of each other, see clause 5.3.2.4.
Two RM states are used in the UE (Network Function) and the AMF (Network Function) that reflect the registration status of the UE (Network Function) in the selected PLMN:
-	RM-DEREGISTERED.
-	RM-REGISTERED.
In the RM-DEREGISTERED state, the UE (Network Function) is not registered with the network. The UE (Network Function) context in AMF (Network Function) holds no valid location or routing information for the UE (Network Function) so the UE (Network Function) is not reachable by the AMF (Network Function). However, some parts of UE (Network Function) context may still be stored in the UE (Network Function) and the AMF (Network Function) e.g. to avoid running an authentication procedure during every Registration procedure.
In the RM-DEREGISTERED state, the UE (Network Function) shall:
-	attempt to register with the selected PLMN using the Initial Registration procedure if it needs to receive service that requires registration (see clause 4.2.2.2 of TS 23.502 [3]).
-	remain in RM-DEREGISTERED state if receiving a Registration Reject upon Initial Registration (see clause 4.2.2.2 of TS 23.502 [3]).
-	enter RM-REGISTERED state upon receiving a Registration Accept (see clause 4.2.2.2 of TS 23.502 [3]).
When the UE (Network Function) RM state in the AMF (Network Function) is RM-DEREGISTERED, the AMF (Network Function) shall:
-	when applicable, accept the Initial Registration of a UE (Network Function) by sending a Registration Accept to this UE (Network Function) and enter RM-REGISTERED state for the UE (Network Function) (see clause 4.2.2.2 of TS 23.502 [3]); or
-	when applicable, reject the Initial Registration of a UE (Network Function) by sending a Registration Reject to this UE (Network Function) (see clause 4.2.2.2 of TS 23.502 [3]).
In the RM-REGISTERED state, the UE (Network Function) is registered with the network. In the RM-REGISTERED state, the UE (Network Function) can receive services that require registration with the network.
In the RM-REGISTERED state, the UE (Network Function) shall:
-	perform Mobility Registration Update procedure if the current TAI of the serving cell (see TS 37.340 [31]) is not in the list of TAIs that the UE (Network Function) has received from the network in order to maintain the registration and enable the AMF (Network Function) to page the UE (Network Function);
NOTE:	Additional considerations for Mobility Registration Update in case of NR satellite access are provided in clause 5.4.11.6.
-	perform Periodic Registration Update procedure triggered by expiration of the periodic update timer to notify the network that the UE (Network Function) is still active.
-	perform a Mobility Registration Update procedure to update its capability information or to re-negotiate protocol parameters with the network;
-	perform Deregistration procedure (see clause 4.2.2.3.1 of TS 23.502 [3]), and enter RM-DEREGISTERED state, when the UE (Network Function) needs to be no longer registered with the PLMN. The UE (Network Function) may decide to deregister from the network at any time.
-	enter RM-DEREGISTERED state when receiving a Registration Reject message or a Deregistration message. The actions of the UE (Network Function) depend upon the cause value' in the Registration Reject or Deregistration message. See clause 4.2.2 of TS 23.502 [3].
When the UE (Network Function) RM state in the AMF (Network Function) is RM-REGISTERED, the AMF (Network Function) shall:
-	perform Deregistration procedure (see clauses 4.2.2.3.2, 4.2.2.3.3 of TS 23.502 [3]), and enter RM-DEREGISTERED state for the UE (Network Function), when the UE (Network Function) needs to be no longer registered with the PLMN. The network may decide to deregister the UE (Network Function) at any time;
-	perform Implicit Deregistration at any time after the Implicit Deregistration timer expires. The AMF (Network Function) shall enter RM-DEREGISTERED state for the UE (Network Function) after Implicit Deregistration;
-	when applicable, accept or reject Registration Requests or Service Requests from the UE (Network Function).

Figure 5.3.2.2.4-1: RM state model in UE (Network Function)

Figure 5.3.2.2.4-2: RM state model in AMF (Network Function)
Registration Area management comprises the functions to allocate and reallocate a Registration area to a UE (Network Function). Registration area is managed per access type i.e. 3GPP access or Non-3GPP access.
When a UE (Network Function) registers with the network over the 3GPP access, the AMF (Network Function) allocates a set of tracking areas in TAI List to the UE (Network Function). When the AMF (Network Function) allocates registration area, i.e. the set of tracking areas in TAI List, to the UE (Network Function) it may take into account various information (e.g. Mobility Pattern and Allowed/Non-Allowed Area (refer to clause 5.3.4.1)). An AMF (Network Function) which has the whole PLMN as serving area may alternatively allocate the whole PLMN ("all PLMN") as registration area to a UE (Network Function) in MICO mode (refer to clause 5.4.1.3). When AMF (Network Function) allocates registration area for UE (Network Function) registered for Disaster Roaming service as specified in clause 5.40.4, AMF (Network Function) shall only consider TAIs covering the area with the Disaster Condition.
The 5G System shall support allocating a Registration Area using a single TAI List which includes tracking areas of any NG-RAN (Network Function) nodes in the Registration Area for a UE (Network Function).
In the case of SNPN, the TAI list allocated by AMF (Network Function) does not support Tracking Areas belonging to different SNPNs.
TAI used for non-3GPP access shall be dedicated to non-3GPP access. TAI(s) dedicated to Non-3GPP access may be defined in a PLMN and apply within this PLMN. Each N3IWF (Network Function), TNGF (Network Function), TWIF (Network Function) and W-AGF (Network Function) is locally configured with one TAI value. Each N3IWF (Network Function), TNGF (Network Function), TWIF (Network Function) and W-AGF (Network Function) may be configured with a different TAI value or with the same TAI value as other N3IWFs, TNGFs, TWIFs and/or W-AGFs. The TAI is provided to the AMF (Network Function) during N2 (Non-service-based Interface) (Service-based Interface) interface setup and as part of the User Location Information in UE (Network Function) associated messages as described in TS 38.413 [34].
When a UE (Network Function) registers with the network over a Non-3GPP access, the AMF (Network Function) allocates to the UE (Network Function) a registration area that only includes the TAI received from the serving N3IWF (Network Function), TNGF (Network Function), TWIF (Network Function) or W-AGF (Network Function).
NOTE 1:	For example, two W-AGFs can each correspond to a different TAI (one TAI per W-AGF (Network Function)) and thus support different sets of S-NSSAI(s).
When generating the TAI list, the AMF (Network Function) shall include only TAIs that are applicable on the access type (i.e. 3GPP access or Non-3GPP access) where the TAI list is sent.
NOTE 2:	To prevent extra signalling load resulting from Mobility Registration Update occurring at every RAT change, it is preferable to avoid generating a RAT-specific TAI list for a UE (Network Function) supporting more than one RAT.
NOTE 3:	For a UE (Network Function) registered on N3GPP access the TAI(s) provided to the UE (Network Function) as part of the Registration Area is expected to enable the support of the slices that are intended to be provided for this UE (Network Function) over this specific Non-3GPP access. In addition, the Registration Area provided to the UE (Network Function) for non-3GPP access will never change until the UE (Network Function) deregisters from non-3GPP access (either explicit deregistration or implicit deregistration due to Deregistration timer expiring due to UE (Network Function) entering CM_IDLE state).
For all 3GPP Access RATs in NG-RAN (Network Function) and for Non-3GPP Access, the 5G System supports the TAI format as specified in TS 23.003 [19] consisting of MCC, MNC and a 3-byte TAC only.
The additional aspects for registration management when a UE (Network Function) is registered over one access type while the UE (Network Function) is already registered over the other access type is further described in clause 5.3.2.4.
To ensure a UE (Network Function) initiates a Mobility Registration procedure when performing inter-RAT mobility to or from NB-IoT, a Tracking Area shall not contain both NB-IoT and other RATs cells (e.g. WB-E-UTRA, NR), and the AMF (Network Function) shall not allocate a TAI list that contains both NB-IoT and other RATs Tracking Areas.
For 3GPP access the AMF (Network Function) determines the RAT type the UE (Network Function) is camping on based on the Global RAN (Network Function) Node IDs associated with the N2 (Non-service-based Interface) (Service-based Interface) interface and additionally the Tracking Area indicated by NG-RAN (Network Function). When the UE (Network Function) is accessing NR using unlicensed bands, as defined in clause 5.4.8, an indication is provided in N2 (Non-service-based Interface) (Service-based Interface) interface as defined in TS 38.413 [34].
The AMF (Network Function) may also determine more precise RAT Type information based on further information received from NG-RAN (Network Function):
-	The AMF (Network Function) may determine the RAT Type to be LTE-M as defined in clause 5.31.20; or
-	The AMF (Network Function) may determine the RAT Type to be NR using unlicensed bands, as defined in clause 5.4.8.
-	The AMF (Network Function) may determine the RAT Type to be one of the RAT types for satellite access, as defined in clause 5.4.10.
-	The AMF (Network Function) may determine the RAT Type to be NR RedCap as defined in clause 5.41.
For Non-3GPP accesses the AMF (Network Function) determines the RAT type the UE (Network Function) is camping based on the 5G-AN node associated with N2 (Non-service-based Interface) (Service-based Interface) interface as follows:
-	The RAT type is Untrusted Non-3GPP if the 5G-AN node has a Global N3IWF (Network Function) Node ID;
-	The RAT type is Trusted Non-3GPP if the 5G-AN node has a Global TNGF (Network Function) Node ID or a Global TWIF (Network Function) Node ID; and
-	The RAT type is Wireline -BBF if the 5G-AN node has a Global W-AGF (Network Function) Node ID corresponding to a W-AGF (Network Function) supporting the Wireline BBF Access Network. The RAT type is Wireline-Cable if the 5G-AN node has a Global W-AGF (Network Function) Node ID corresponding to a W-AGF (Network Function) supporting the Wireline Cable Access Network. If not possible to distinguish between the two, the RAT type is Wireline.
NOTE 4:	How to differentiate between W-AGF (Network Function) supporting either Wireline BBF Access Network or the Wireline (e.g. different Global W-AGF (Network Function) Node ID IE or the Global W-AGF (Network Function) Node ID including a field to distinguish between them) is left to Stage 3 definition.
NOTE 5:	If an operator supports only one kind of Wireline Access Network (either Wireline BBF Access Network or a Wireline Cable Access Network) the AMF (Network Function) may be configured to use RAT type Wireline or the specific one.
For Non-3GPP access the AMF (Network Function) may also use the User Location Information provided at N2 (Non-service-based Interface) (Service-based Interface) connection setup to determine a more precise RAT Type, e.g. identifying IEEE 802.11 access, Wireline-Cable access, Wireline-BBF access.
When the 5G-AN node has either a Global N3IWF (Network Function) Node ID, or a Global TNGF (Network Function) Node ID, or a Global TWIF (Network Function) Node ID, or a Global W-AGF (Network Function) Node ID, the Access Type is Non-3GPP Access.
This clause applies to Non-3GPP access network corresponding to the Untrusted Non-3GPP access network, to the Trusted Non-3GPP and to the W-5GAN. In the case of W-5GAN the UE (Network Function) mentioned in this clause corresponds to the 5G-RG.
For a given serving PLMN there is one RM context for a UE (Network Function) for each access, e.g. when the UE (Network Function) is consecutively or simultaneously served by a 3GPP access and by a non-3GPP access (i.e. via an N3IWF (Network Function), TNGF (Network Function) and W-AGF (Network Function)) of the same PLMN. UDM (Network Function) manages separate/independent UE (Network Function) Registration procedures for each access.
When served by the same PLMN for 3GPP and non-3GPP accesses, an UE (Network Function) is served by the same AMF (Network Function) except in the temporary situation described in clause 5.17 i.e. after a mobility from EPS while the UE (Network Function) has PDU Sessions associated with non-3GPP access.
The 5G NSWO authentication as defined in Annex S of TS 33.501 [29] does not impact the RM state.
An AMF (Network Function) associates multiple access-specific RM contexts for an UE (Network Function) with:
-	a 5G-GUTI that is common to both 3GPP and Non-3GPP accesses. This 5G-GUTI is globally unique.
-	a Registration state per access type (3GPP / Non-3GPP)
-	a Registration Area per access type: one Registration Area for 3GPP access and another Registration Area for non 3GPP access. Registration Areas for the 3GPP access and the Non-3GPP access are independent.
-	timers for 3GPP access:
-	a Periodic Registration timer; and
-	a Mobile Reachable timer and an Implicit Deregistration timer.
-	timers for non-3GPP access:
-	a UE (Network Function) Non-3GPP Deregistration timer; and
-	a Network Non-3GPP Implicit Deregistration timer.
The AMF (Network Function) shall not provide a Periodic Registration Timer for the UE (Network Function) over a Non-3GPP access. Consequently, the UE (Network Function) need not perform Periodic Registration Update procedure over Non-3GPP access. Instead, during the Initial Registration procedure and Re-registration, the UE (Network Function) is provided by the network with a UE (Network Function) Non-3GPP Deregistration timer that starts when the UE (Network Function) enters non-3GPP CM-IDLE state.
When the 3GPP access and the non-3GPP access for the same UE (Network Function) are served by the same PLMN, the AMF (Network Function) assigns the same 5G-GUTI for use over both accesses. Such a 5G-GUTI may be assigned or re-assigned over any of the 3GPP and Non-3GPP accesses. The 5G-GUTI is assigned upon a successful registration of the UE (Network Function), and is valid over both 3GPP and Non-3GPP access to the same PLMN for the UE (Network Function). Upon performing an initial access over the Non-3GPP access or over the 3GPP access while the UE (Network Function) is already registered with the 5G System over another access of the same PLMN, the UE (Network Function) provides the native 5G-GUTI for the other access. This enables the AN to select an AMF (Network Function) that maintains the UE (Network Function) context created at the previous Registration procedure via the GUAMI derived from the 5G-GUTI, and enables the AMF (Network Function) to correlate the UE (Network Function) request to the existing UE (Network Function) context via the 5G-GUTI.
If the UE (Network Function) is performing registration over one access and intends to perform registration over the other access in the same PLMN (e.g. the 3GPP access and the selected N3IWF (Network Function), TNGF (Network Function) or W-AGF (Network Function) are located in the same PLMN), the UE (Network Function) shall not initiate the registration over the other access until the Registration procedure over first access is completed.
NOTE:	To which access the UE (Network Function) performs registration first is up to UE (Network Function) implementation.
When the UE (Network Function) is successfully registered to an access (3GPP access or Non-3GPP access respectively) and the UE (Network Function) registers via the other access:
-	if the second access is located in the same PLMN (e.g. the UE (Network Function) is registered via a 3GPP access and selects a N3IWF (Network Function), TNGF (Network Function) or W-AGF (Network Function) located in the same PLMN), the UE (Network Function) shall use for the registration to the PLMN associated with the new access the 5G-GUTI that the UE (Network Function) has been provided with at the previous registration or UE (Network Function) configuration update procedure for the first access in the same PLMN. Upon successful completion of the registration to the second access, if the network included a 5G-GUTI in the Registration Accept, the UE (Network Function) shall use the 5G-GUTI received in the Registration Accept for both registrations. If no 5G-GUTI is included in the Registration Accept, then the UE (Network Function) uses the 5G-GUTI assigned for the existing registration also for the new registration.
-	if the second access is located in a PLMN different from the registered PLMN of the first access (i.e. not the registered PLMN), (e.g. the UE (Network Function) is registered to a 3GPP access and selects a N3IWF (Network Function), TNGF (Network Function) or W-AGF (Network Function) located in a PLMN different from the PLMN of the 3GPP access, or the UE (Network Function) is registered over Non-3GPP and registers to a 3GPP access in a PLMN different from the PLMN of the N3IWF (Network Function), TNGF (Network Function) or W-AGF (Network Function)), the UE (Network Function) shall use for the registration to the PLMN associated with the new access a 5G-GUTI only if it has got one previously received from a PLMN that is not the same as the PLMN the UE (Network Function) is already registered with. If the UE (Network Function) does not include a 5G-GUTI, the SUCI shall be used for the new registration. Upon successful completion of the registration to the second access, the UE (Network Function) has the two 5G-GUTIs (one per PLMN).
A UE (Network Function) supporting registration over both 3GPP and Non-3GPP access to two PLMNs shall be able to handle two separate registrations, including two 5G-GUTIs, one per PLMN, and two associated equivalent PLMN lists.
When a UE (Network Function) 5G-GUTI assigned during a Registration procedure over 3GPP (e.g. the UE (Network Function) registers first over a 3GPP access) is location-dependent, the same UE (Network Function) 5G-GUTI can be re-used over the Non-3GPP access when the selected N3IWF (Network Function), TNGF (Network Function) or W-AGF (Network Function) function is in the same PLMN as the 3GPP access. When an UE (Network Function) 5G-GUTI is assigned during a Registration procedure performed over a Non 3GPP access (e.g. the UE (Network Function) registers first over a non-3GPP access), the UE (Network Function) 5G-GUTI may not be location-dependent, so that the UE (Network Function) 5G-GUTI may not be valid for NAS (Protocol) procedures over the 3GPP access and, in this case, a new AMF (Network Function) is allocated during the Registration procedure over the 3GPP access.
When the UE (Network Function) is registered first via 3GPP access, if the UE (Network Function) registers to the same PLMN via Non-3GPP access, the UE (Network Function) shall send the GUAMI obtained via 3GPP access to the N3IWF (Network Function), TNGF (Network Function) or W-AGF (Network Function), which uses the received GUAMI to select the same AMF (Network Function) as the 3GPP access.
The Deregistration Request message indicates whether it applies to the 3GPP access the Non-3GPP access, or both.
If the UE (Network Function) is registered on both 3GPP and Non-3GPP accesses and it is in CM-IDLE over Non-3GPP access, then the UE (Network Function) or AMF (Network Function) may initiate a Deregistration procedure over the 3GPP access to deregister the UE (Network Function) only on the Non-3GPP access, in which case all the PDU Sessions which are associated with the Non-3GPP access shall be released.
If the UE (Network Function) is registered on both 3GPP and non-3GPP accesses and it is in CM-IDLE over 3GPP access and in CM-CONNECTED over non-3GPP access, then the UE (Network Function) may initiate a Deregistration procedure over the non-3GPP access to deregister the UE (Network Function) only on the 3GPP access, in which case all the PDU Sessions which are associated with the 3GPP access shall be released.
Registration Management over Non-3GPP access is further defined in clause 5.5.1.
Connection management comprises the functions of establishing and releasing a NAS (Protocol) signalling connection between a UE (Network Function) and the AMF (Network Function) over N1 (Non-service-based Interface) (Service-based Interface). This NAS (Protocol) signalling connection is used to enable NAS (Protocol) signalling exchange between the UE (Network Function) and the core network. It comprises both the AN signalling connection between the UE (Network Function) and the AN (RRC Connection over 3GPP access or UE (Network Function)-N3IWF (Network Function) connection over untrusted N3GPP access or UE (Network Function)-TNGF (Network Function) connection over trusted N3GPP access) and the N2 (Non-service-based Interface) (Service-based Interface) connection for this UE (Network Function) between the AN and the AMF (Network Function).
Two CM states are used to reflect the NAS (Protocol) signalling Connection of the UE (Network Function) with the AMF (Network Function):
-	CM-IDLE
-	CM-CONNECTED
The CM state for 3GPP access and Non-3GPP access are independent of each other, i.e. one can be in CM-IDLE state at the same time when the other is in CM-CONNECTED state.
A UE (Network Function) in CM-IDLE state has no NAS (Protocol) signalling connection established with the AMF (Network Function) over N1 (Non-service-based Interface) (Service-based Interface). The UE (Network Function) performs cell selection/cell reselection according to TS 38.304 [50] and PLMN selection according to TS 23.122 [17].
There are no AN signalling connection, N2 (Non-service-based Interface) (Service-based Interface) connection and N3 (Non-service-based Interface) (Service-based Interface) connections for the UE (Network Function) in the CM-IDLE state.
If the UE (Network Function) is both in CM-IDLE state and in RM-REGISTERED state, the UE (Network Function) shall, unless otherwise specified in clause 5.3.4.1:
-	Respond to paging by performing a Service Request procedure (see clause 4.2.3.2 of TS 23.502 [3]), unless the UE (Network Function) is in MICO mode (see clause 5.4.1.3);
-	perform a Service Request procedure when the UE (Network Function) has uplink signalling or user data to be sent (see clause 4.2.3.2 of TS 23.502 [3]). Specific conditions apply for LADN, see clause 5.6.5.
When the UE (Network Function) state in the AMF (Network Function) is RM-REGISTERED, UE (Network Function) information required for initiating communication with the UE (Network Function) shall be stored. The AMF (Network Function) shall be able to retrieve stored information required for initiating communication with the UE (Network Function) using the 5G-GUTI.
NOTE:	In 5GS there is no need for paging using the SUPI/SUCI of the UE (Network Function).
The UE (Network Function) provides 5G-S-TMSI as part of AN parameters during AN signalling connection establishment as specified in TS 38.331 [28] and TS 36.331 [51]. The UE (Network Function) shall enter CM-CONNECTED state whenever an AN signalling connection is established between the UE (Network Function) and the AN (entering RRC_CONNECTED state over 3GPP access, or at the establishment of the UE (Network Function)-N3IWF (Network Function) connectivity over untrusted non-3GPP access or the UE (Network Function)-TNGF (Network Function) connectivity over trusted non-3GPP access). The transmission of an Initial NAS (Protocol) message (Registration Request, Service Request or Deregistration Request) initiates the transition from CM-IDLE to CM-CONNECTED state.
When the UE (Network Function) states in the AMF (Network Function) are CM-IDLE and RM-REGISTERED, the AMF (Network Function) shall:
-	perform a network triggered Service Request procedure when it has signalling or mobile-terminated data to be sent to this UE (Network Function), by sending a Paging Request to this UE (Network Function) (see clause 4.2.3.3 of TS 23.502 [3]), if a UE (Network Function) is not prevented from responding e.g. due to MICO mode or Mobility Restrictions.
The AMF (Network Function) shall enter CM-CONNECTED state for the UE (Network Function) whenever an N2 (Non-service-based Interface) (Service-based Interface) connection is established for this UE (Network Function) between the AN and the AMF (Network Function). The reception of initial N2 (Non-service-based Interface) (Service-based Interface) message (e.g. N2 (Non-service-based Interface) (Service-based Interface) INITIAL UE (Network Function) MESSAGE) initiates the transition of AMF (Network Function) from CM-IDLE to CM-CONNECTED state.
The UE (Network Function) and the AMF (Network Function) may optimize the power efficiency and signalling efficiency of the UE (Network Function) when in CM-IDLE state e.g. by activating MICO mode (see clause 5.4.1.3).
A UE (Network Function) in CM-CONNECTED state has a NAS (Protocol) signalling connection with the AMF (Network Function) over N1 (Non-service-based Interface) (Service-based Interface). A NAS (Protocol) signalling connection uses an RRC (Protocol) Connection between the UE (Network Function) and the NG-RAN (Network Function) and an NGAP UE (Network Function) association between the AN and the AMF (Network Function) for 3GPP access. A UE (Network Function) can be in CM-CONNECTED state with an NGAP UE (Network Function) association that is not bound to any TNLA between the AN and the AMF (Network Function). See clause 5.21.1.2 for details on the state of NGAP UE (Network Function) association for an UE (Network Function) in CM-CONNECTED state. Upon completion of a NAS (Protocol) signalling procedure, the AMF (Network Function) may decide to release the NAS (Protocol) signalling connection with the UE (Network Function).
In the CM-CONNECTED state, the UE (Network Function) shall:
-	enter CM-IDLE state whenever the AN signalling connection is released (entering RRC_IDLE state over 3GPP access or when the release of the UE (Network Function)-N3IWF (Network Function) connectivity over untrusted non-3GPP access or the UE (Network Function)-TNGF (Network Function) connectivity over trusted non-3GPP access is detected by the UE (Network Function)), see TS 38.331 [28] for 3GPP access.
When the UE (Network Function) CM state in the AMF (Network Function) is CM-CONNECTED, the AMF (Network Function) shall:
-	enter CM-IDLE state for the UE (Network Function) whenever the logical NGAP signalling connection and the N3 (Non-service-based Interface) (Service-based Interface) user plane connection for this UE (Network Function) are released upon completion of the AN Release procedure as specified in TS 23.502 [3].
The AMF (Network Function) may keep a UE (Network Function) CM state in the AMF (Network Function) in CM-CONNECTED state until the UE (Network Function) de-registers from the core network.
A UE (Network Function) in CM-CONNECTED state can be in RRC_INACTIVE state, see TS 38.300 [27]. When the UE (Network Function) is in RRC_INACTIVE state the following applies:
-	UE (Network Function) reachability is managed by the RAN (Network Function), with assistance information from core network;
-	UE (Network Function) paging is managed by the RAN (Network Function).
-	UE (Network Function) monitors for paging with UE (Network Function)'s CN (5G S-TMSI) and RAN (Network Function) identifier.

Figure 5.3.3.2.4-1: CM state transition in UE (Network Function)

Figure 5.3.3.2.4-2: CM state transition in AMF (Network Function)
When a UE (Network Function) enters CM-IDLE state, the UP connection of the PDU Sessions that were active on this access are deactivated.
NOTE:	The activation of UP connection of PDU Sessions is documented in clause 5.6.8.
RRC_INACTIVE state applies to NG-RAN (Network Function). UE (Network Function) support for RRC_INACTIVE state is defined in TS 38.306 [69] for NR and TS 36.306 [70] for E-UTRA connected to 5GC. RRC_INACTIVE is not supported by NB-IoT connected to 5GC.
The AMF (Network Function) shall provide assistance information to the NG-RAN (Network Function), to assist the NG-RAN (Network Function)'s decision whether the UE (Network Function) can be sent to RRC_INACTIVE state except due to some exceptional cases such as:
-	PLMN (or AMF (Network Function) set) does not support RRC_INACTIVE;
-	The UE (Network Function) needs to be kept in CM-CONNECTED State (e.g. for tracking).
The "RRC Inactive Assistance Information" includes:
-	UE (Network Function) specific DRX values;
-	UE (Network Function) specific extended idle mode DRX values (cycle length and Paging Time Window length);
-	The Registration Area provided to the UE (Network Function);
-	Periodic Registration Update timer;
-	If the AMF (Network Function) has enabled MICO mode for the UE (Network Function), an indication that the UE (Network Function) is in MICO mode;
-	Information from the UE (Network Function) identifier, as defined in TS 38.304 [50] for NR and TS 36.304 [52] for E-UTRA connected to 5GC, that allows the RAN (Network Function) to calculate the UE (Network Function)'s RAN (Network Function) paging occasions;
-	An indication that Paging Cause Indication for Voice Service is supported;
-	AMF (Network Function) PEIPS Assistance Information (see clause 5.4.12.2) for paging a UE (Network Function) in CM-CONNECTED with RRC_INACTIVE state over NR as defined in TS 38.300 [27];
-	CN based MT communication handling support indication for RRC_INACATIVE state (see clause 5.31.7.2.1).
The RRC (Protocol) Inactive Assistance Information mentioned above is provided by the AMF (Network Function) during N2 (Non-service-based Interface) (Service-based Interface) activation with the (new) serving NG-RAN (Network Function) node (i.e. during Registration, Service Request, Handover) to assist the NG RAN (Network Function)'s decision whether the UE (Network Function) can be sent to RRC_INACTIVE state. If the AMF (Network Function) allocates a new Registration Area to the UE (Network Function), the AMF (Network Function) should update the NG-RAN (Network Function) with the new Registration Area by sending the RRC (Protocol) Inactive Assistance Information accordingly. The Paging Cause Indication for Voice Service is used to assist NG RAN (Network Function) to perform RAN (Network Function) based paging.
RRC_INACTIVE state is part of RRC (Protocol) state machine, and it is up to the RAN (Network Function) to determine the conditions to enter RRC_INACTIVE state. If any of the parameters included in the RRC (Protocol) Inactive Assistance Information changes as the result of NAS (Protocol) procedure, the AMF (Network Function) shall update the RRC (Protocol) Inactive Assistance Information to the NG-RAN (Network Function) node.
When the UE (Network Function) is in CM-CONNECTED state, if the AMF (Network Function) has provided RRC (Protocol) Inactive assistance information, the RAN (Network Function) node may decide to move a UE (Network Function) to CM-CONNECTED with RRC_INACTIVE state.
The state and "endpoints" (in the case of Dual Connectivity configuration) of the N2 (Non-service-based Interface) (Service-based Interface) and N3 (Non-service-based Interface) (Service-based Interface) reference points are not changed by the UE (Network Function) entering CM-CONNECTED with RRC_INACTIVE state. A UE (Network Function) in RRC_INACTIVE state is aware of the RAN (Network Function) Notification area and periodic RAN (Network Function) Notification Area Update timer.
The 5GC network is not aware of the UE (Network Function) transitions between CM-CONNECTED with RRC_CONNECTED and CM-CONNECTED with RRC_INACTIVE state, unless the 5GC network is notified via N2 (Non-service-based Interface) (Service-based Interface) notification procedure in clause 4.8.3 of TS 23.502 [3].
At transition into CM-CONNECTED with RRC_INACTIVE state, the NG-RAN (Network Function) configures the UE (Network Function) with a periodic RAN (Network Function) Notification Area Update timer taking into account the value of the Periodic Registration Update timer value indicated in the RRC (Protocol) Inactive Assistance Information, and uses a guard timer with a value longer than the RAN (Network Function) Notification Area Update timer value provided to the UE (Network Function).
If the periodic RAN (Network Function) Notification Area Update guard timer expires in NG-RAN (Network Function), the NG-RAN (Network Function) shall initiate AN Release procedure as specified in clause 4.2.6 of TS 23.502 [3].
When the UE (Network Function) is in CM-CONNECTED with RRC_INACTIVE state, the UE (Network Function) performs PLMN selection procedures as defined in TS 23.122 [17] and TS 24.501 [47].
When the UE (Network Function) is CM-CONNECTED with RRC_INACTIVE state, the UE (Network Function) may resume the RRC (Protocol) Connection due to:
-	Uplink data pending;
-	Mobile initiated NAS (Protocol) signalling procedure;
-	As a response to RAN (Network Function) paging;
-	Notifying the network that it has left the RAN (Network Function) Notification Area;
-	Upon periodic RAN (Network Function) Notification Area Update timer expiration.
If the UE (Network Function) resumes the connection in a different NG-RAN (Network Function) node within the same PLMN or equivalent PLMN or within the same SNPN or equivalent SNPN, the UE (Network Function) AS context is retrieved from the old NG-RAN (Network Function) node and a procedure is triggered towards the CN (see clause 4.8.2 of TS 23.502 [3]).
NOTE 1:	With Dual Connectivity configuration if the UE (Network Function) resumes the RRC (Protocol) connection in the Master RAN (Network Function) node, the Secondary RAN (Network Function) node configuration is defined in TS 38.300 [27].
If the RAN (Network Function) paging procedure applying DRX or eDRX value no longer than 10.24s, as defined in TS 38.300 [27], is not successful in establishing contact with the UE (Network Function) the procedure shall be handled by the network as follows:
-	If NG-RAN (Network Function) has at least one pending NAS (Protocol) PDU for transmission, the RAN (Network Function) node shall initiate the AN Release procedure (see clause 4.2.6 of TS 23.502 [3]) to move the UE (Network Function) CM state in the AMF (Network Function) to CM-IDLE state and indicate to the AMF (Network Function) the NAS (Protocol) non-delivery.
-	If NG RAN (Network Function) has only pending user plane data for transmission, the NG-RAN (Network Function) node may keep the N2 (Non-service-based Interface) (Service-based Interface) connection active or initiate the AN Release procedure (see clause 4.2.6 of TS 23.502 [3]) based on local configuration in NG-RAN (Network Function).
NOTE 2:	The user plane data which triggers the RAN (Network Function) paging can be lost, e.g. in the case of RAN (Network Function) paging failure.
If the RAN (Network Function) paging procedure applying eDRX value longer than 10.24s, as defined in TS 38.300 [27], has not requested the CN based mobile terminated (MT) communication handling as described in clause 5.31.7.2.1 and is not successful in establishing contact with the UE (Network Function) after paging the UE (Network Function), the procedure shall be handled by network as follows:
-	If NG-RAN (Network Function) has at least one pending NAS (Protocol) PDU for transmission, the RAN (Network Function) node shall initiate the AN Release procedure (see clause 4.2.6 of TS 23.502 [3]) to move the UE (Network Function) CM state in the AMF (Network Function) to CM-IDLE state and indicate to the AMF (Network Function) the NAS (Protocol) non-delivery.
-	If NG-RAN (Network Function) has only pending user plane data for transmission, the NG-RAN (Network Function) node may keep the N2 (Non-service-based Interface) (Service-based Interface) connection active and based on implementation send indication to the CN requesting the CN based mobile terminated (MT) communication handling as described in clause 5.31.7.2.1, or initiate the AN Release procedure (see clause 4.2.6 of TS 23.502 [3]) based on local configuration in NG-RAN (Network Function).
NOTE 3:	The user plane data which triggers the RAN (Network Function) paging can be lost, e.g. in the case of RAN (Network Function) paging failure.
If a UE (Network Function) in CM-CONNECTED with RRC_INACTIVE state performs cell selection to GERAN/UTRAN/E-UTRAN, it shall follow idle mode procedures of the selected RAT as specified in clause 5.17.
In addition, a UE (Network Function) in CM-CONNECTED state with RRC_INACTIVE state shall enter CM-IDLE state and initiates the NAS (Protocol) signalling recovery (see TS 24.501 [47]) in the following cases:
-	If RRC (Protocol) resume procedure fails,
	If the UE (Network Function) receives Core Network paging,
-	If the periodic RAN (Network Function) Notification Area Update timer expires and the UE (Network Function) cannot successfully resume the RRC (Protocol) Connection,
-	In any other failure scenario that cannot be resolved in RRC_INACTIVE state and requires the UE (Network Function) to move to CM-IDLE state.
When a UE (Network Function) is in CM-CONNECTED with RRC_INACTIVE state, and a trigger to change the UE (Network Function)'s NG-RAN (Network Function) or E-UTRAN UE (Network Function) Radio Capability information happens, the UE (Network Function) shall move to CM-IDLE state and initiate the procedure for updating UE (Network Function) Radio Capability defined in clause 5.4.4.1. (For specific requirements for a UE (Network Function) operating in dual-registration mode see clause 5.17.2.1)
When UE (Network Function) is in CM-CONNECTED with RRC_INACTIVE state, if RAN (Network Function) has received Location Reporting Control message from AMF (Network Function) with the Reporting Type indicating single stand-alone report or continuously reporting whenever the UE (Network Function) changes the cell, the RAN (Network Function) shall perform location reporting as specified in clause 4.10 of TS 23.502 [3].
When the UE (Network Function) is CM-CONNECTED with RRC_INACTIVE state. If the AMF (Network Function) receives Nudm_UECM_DeregistrationNotification from UDM (Network Function), the AMF (Network Function) shall initiate AN Release procedure as specified in clause 4.2.6 of TS 23.502 [3].
When UE (Network Function) is in CM-CONNECTED with RRC_INACTIVE state, if RAN (Network Function) has received Location Reporting Control message from AMF (Network Function) with the Reporting Type of the Area Of Interest based reporting, the RAN (Network Function) shall send a Location Report message to AMF (Network Function) including UE (Network Function) presence in the Area Of Interest (i.e. IN, OUT, or UNKNOWN) and the UE (Network Function)'s last known location with time stamp.
When the UE (Network Function) is in CM-CONNECTED with RRC_INACTIVE state, if the old NG-RAN (Network Function) node that sends the UE (Network Function) into RRC_INACTIVE state receives the downlink N2 (Non-service-based Interface) (Service-based Interface) signalling, it initiates the RAN (Network Function) paging as defined in TS 38.300 [27]. If the UE (Network Function) resumes the RRC (Protocol) Connection towards a different NG-RAN (Network Function) node, the old NG-RAN (Network Function) node includes the "UE (Network Function) Context Transfer" indication into a response container to the NF (Network Function) (e.g. AMF (Network Function) or SMF (Network Function)) that generates such N2 (Non-service-based Interface) (Service-based Interface) downlink signalling. Then the NF (Network Function) shall reattempt the same procedure when the path switch from the old NG-RAN (Network Function) node to the new NG-RAN (Network Function) node is complete.
NAS signalling connection management includes the functions of establishing and releasing a NAS (Protocol) signalling connection.
NAS signalling connection establishment function is provided by the UE (Network Function) and the AMF (Network Function) to establish a NAS (Protocol) signalling connection for a UE (Network Function) in CM-IDLE state. The AMF (Network Function) shall provide the list of recommended cells/ TAs / NG-RAN (Network Function) node identifiers for paging, if the NG-RAN (Network Function) had provided that information in an earlier AN Release Procedure in the AN (see clause 4.2.6 of TS 23.502 [3]).
When the UE (Network Function) in CM-IDLE state needs to transmit an NAS (Protocol) message, the UE (Network Function) shall initiate a Service Request, a Registration or a Deregistration procedure to establish a NAS (Protocol) signalling connection to the AMF (Network Function) as specified in clauses 4.2.2 and 4.2.3 of TS 23.502 [3]. If the NAS (Protocol) signalling connection is to be established via an NG-RAN (Network Function) node, but the AMF (Network Function) detects that this UE (Network Function) has already established a NAS (Protocol) signalling connection via old NG-RAN (Network Function) node, the AMF (Network Function) shall release the old established NAS (Protocol) signalling connection by triggering AN Release Procedure.
Based on UE (Network Function) preferences, UE (Network Function) subscription, Mobility Pattern and network configuration, the AMF (Network Function) may keep the NAS (Protocol) signalling connection until the UE (Network Function) de-registers from the network.
The procedure of releasing a NAS (Protocol) signalling connection is initiated by the AN node (either 5G (R)AN node or N3IWF (Network Function)) or the AMF (Network Function). The NG-RAN (Network Function) node may include the list of recommended cells/ TAs / NG-RAN (Network Function) node identifiers for paging, during the AN Release Procedure in the AN (see clause 4.2.6 of TS 23.502 [3]). The AMF (Network Function) stores this information, if provided by the NG-RAN (Network Function).
The UE (Network Function) considers the NAS (Protocol) signalling connection is released if it detects the AN signalling connection is released. The AMF (Network Function) considers the NAS (Protocol) signalling connection is released if it detects the N2 (Non-service-based Interface) (Service-based Interface) context is released.
The AMF (Network Function) manages two CM states for an UE (Network Function): a CM state for 3GPP access and a CM state for Non-3GPP access. An N2 (Non-service-based Interface) (Service-based Interface) interface can serve the UE (Network Function) for either 3GPP access or for Non 3GPP access. UE (Network Function) connected over both 3GPP and Non-3GPP has got two N2 (Non-service-based Interface) (Service-based Interface) interfaces, one for each access. A UE (Network Function) may be in any combination of the CM states between 3GPP and Non-3GPP access, e.g. a UE (Network Function) may be CM-IDLE for one access and CM-CONNECTED for the other access, CM-IDLE for both accesses or CM-CONNECTED for both accesses.
When the UE (Network Function) CM state in the AMF (Network Function) is CM-IDLE for 3GPP access and CM-CONNECTED for Non-3GPP access, the AMF (Network Function) shall perform a network triggered Service Request procedure, when it has downlink data to be sent to this UE (Network Function) for 3GPP access, by sending either the Paging Request via 3GPP access or the NAS (Protocol) notification via Non-3GPP access to this UE (Network Function) (see clause 4.2.3.3 of TS 23.502 [3]).
Connection Management over Non-3GPP access is further defined in clause 5.5.2.
Mobility Restrictions restrict mobility handling or service access of a UE (Network Function). The Mobility Restriction functionality is provided by the UE (Network Function) (only for mobility restriction categories provided to the UE (Network Function)), the radio access network and the core network.
Unless otherwise stated, Mobility Restrictions only apply to 3GPP access and wireline access, they do not apply to other non-3GPP accesses.
The UE (Network Function) and the network shall override Mobility restriction as specified in clause 5.16.4.3 when accessing the network for Emergency Services. For MPS and MCX, service area restriction does not apply, as specified in TS 24.501 [47].
For UE (Network Function) requesting Disaster Roaming service, the UE (Network Function) is only allowed to receive services in the area with Disaster Condition as specified in clause 5.40.4. The other areas within the PLMN shall be considered as forbidden area for the UE (Network Function) registered for Disaster Roaming service.
Service Area restrictions and handling of Forbidden Areas for CM-IDLE state and, for CM-CONNECTED state when in RRC_INACTIVE state are executed by the UE (Network Function) based on information received from the core network. Mobility Restrictions for CM-CONNECTED state when in RRC_CONNECTED state are executed by the radio access network and the core network.
In CM-CONNECTED state, the core network provides Mobility Restrictions to the radio access network within Mobility Restriction List.
Mobility Restrictions consists of RAT restriction, Forbidden Area, Service Area Restrictions, Core Network type restriction and Closed Access Group information as follows:
-	RAT restriction:
	Defines the 3GPP and non-3GPP Radio Access Technology(ies), a UE (Network Function) is not allowed to access in a PLMN. In a restricted RAT a UE (Network Function) based on subscription is not permitted access to the network for this PLMN. For 3GPP access and CM-CONNECTED state, when radio access network determines target RAT and target PLMN during Handover procedure, it should take per PLMN RAT restriction into consideration. The RAT restriction is enforced in the network, and not provided to the UE (Network Function).
-	Forbidden Area:
	In a Forbidden Area, the UE (Network Function), based on subscription, is not permitted to initiate any communication with the network for this PLMN. The UE (Network Function) behaviour in terms of cell selection, RAT selection and PLMN selection depends on the network response that informs the UE (Network Function) of Forbidden Area. A Forbidden Area applies either to 3GPP access or to non-3GPP access.
	Further description on Forbidden Area when using wireline access is available in TS 23.316 [84].
	Support for Forbidden Area with NR satellite access is described in clause 5.4.11.8.
	Forbidden Areas should not be used for Untrusted or Trusted non-3GPP access.
NOTE 1:	If a UE (Network Function) receives that the UE (Network Function) is accessing from a forbidden tracking area when registering over untrusted non-3GPP access or trusted non-3GPP access, the UE (Network Function) cannot determine the corresponding TAI and thus needs to consider that access to untrusted non-3GPP access and to trusted non-3GPP access in this PLMN is forbidden until the forbidden area list is removed as described in TS 24.501 [47].
NOTE 2:	The UE (Network Function) reactions to specific network responses are described in TS 24.501 [47].
-	Service Area Restriction:
	Defines areas in which the UE (Network Function) may or may not initiate communication with the network as follows:
-	Allowed Area:
	In an Allowed Area, the UE (Network Function) is permitted to initiate communication with the network as allowed by the subscription.
-	Non-Allowed Area:
	In a Non-Allowed Area a UE (Network Function) is service area restricted based on subscription. The UE (Network Function) and the network are not allowed to initiate Service Request, or any connection requests for user plane data, control plane data, exception data reporting, or SM signalling (except for PS Data Off status change reporting) to obtain user services that are not related to mobility.
	The UE (Network Function) shall not use the entering of a Non-Allowed Area as a criterion for Cell Reselection, a trigger for PLMN Selection or Domain selection for UE (Network Function) originating sessions or calls. The RRC (Protocol) procedures while the UE (Network Function) is in CM-CONNECTED with RRC_INACTIVE state are unchanged compared to when the UE (Network Function) is in an Allowed Area. The RM procedures are unchanged compared to when the UE (Network Function) is in an Allowed Area. The UE (Network Function) in a Non-Allowed Area shall respond to core network paging or NAS (Protocol) Notification message from non-3GPP access with Service Request and RAN (Network Function) paging. The UE (Network Function) in a Non-Allowed Area may initiate MA PDU Session establishment or activation over a non-3GPP access other than wireline access, but the User Plane resources on the 3GPP access for the MA-PDU shall not be established or activated. The handling of Non-Allowed Area when using wireline access is described in TS 23.316 [84].
NOTE 3:	When the services are restricted in 5GS due to Service Area Restriction, then it is assumed that the services will be also restricted in all RATs/Systems at the same location(s) using appropriate mechanisms available in the other RATs/Systems.
NOTE 4:	Delivery of SOR transparent container, UE (Network Function) policy container, UE (Network Function) parameters update transparent container as defined in TS 24.501 [47], or removal of any stored Paging Restriction Information from network via Registration Request (see clause 5.38), is part of the mobility related service and is allowed in an area with service restriction.
NOTE 5:	For a UE (Network Function) in CM-CONNECTED state then neither control plane data transmission nor, if user plane resources are already established, user plane data transmission are restricted by a non-allowed area.
-	Core Network type restriction:
	Defines whether UE (Network Function) is allowed to connect to 5GC only, EPC only, both 5GC and EPC for this PLMN. The Core Network type restriction when received applies in the PLMN either to both 3GPP and non-3GPP Access Types or to non-3GPP Access Type only.
NOTE 6:	The Core Network type restriction can be used e.g. in network deployments where the E-UTRAN connects to both EPC and 5GC as described in clause 5.17. When the Core Network type restriction applies to non-3GPP Access Type, the UE (Network Function) is restricted from using any connectivity to an N3IWF (Network Function).
-	Closed Access Group information:
	As defined in clause 5.30.3.
For a given UE (Network Function), the core network determines the Mobility Restrictions based on UE (Network Function) subscription information, UE (Network Function) location and/or local policy (e.g. if the HPLMN has not deployed 5GC, HPLMN ID of the UE (Network Function) and the operator's policy are used in the VPLMN for determining the Core Network type restriction). The Mobility Restriction may change due to e.g. UE (Network Function)'s subscription, location change and local policy. Optionally the Service Area Restrictions or the Non-Allowed Area may in addition be fine-tuned by the PCF (Network Function) e.g. based on UE (Network Function) location, PEI and network policies. Service Area Restrictions may be updated during a Registration procedure or UE (Network Function) Configuration Update procedure.
NOTE 7:	The subscription management ensures that for MPS service subscriber the Mobility Restrictions is not included.
If the network sends Service Area Restrictions to the UE (Network Function), the network sends only either an Allowed Area, or a Non-Allowed Area, but not both at the same time, to the UE (Network Function). If the UE (Network Function) has received an Allowed Area from the network, any TA not part of the Allowed Area is considered by the UE (Network Function) as non-allowed. If the UE (Network Function) has received a Non-Allowed Area from the network, any TA not part of the Non-Allowed Area is considered by the UE (Network Function) as allowed. If the UE (Network Function) has not received any Service Area Restrictions, any TA in the PLMN is considered as allowed.
If the UE (Network Function) has overlapping areas between Forbidden Areas, Service Area Restrictions, or any combination of them, the UE (Network Function) shall proceed in the following precedence order:
-	The evaluation of Forbidden Areas shall take precedence over the evaluation of Service Area Restrictions.
The UDM (Network Function) shall provide to the AMF (Network Function) the information defined in TS 23.008 [119] about the subscriber's NR or E-UTRA access restriction set by the operator determined e.g. by subscription scenario and roaming scenario:
-	For NR:
-	NR not allowed as primary access.
-	NR not allowed as secondary access.
-	NR in unlicensed bands not allowed as primary access.
-	NR in unlicensed bands not allowed as secondary access.
-	NR(LEO) satellite access not allowed as primary access.
-	NR(MEO) satellite access not allowed as primary access.
-	NR(GEO) satellite access not allowed as primary access.
-	NR(OTHERSAT) satellite access not allowed as primary access.
-	NR RedCap not allowed as primary access.
Editor's note:	The final decision on whether Dual Connectivity and Carrier Aggregation are supported is in RAN (Network Function) WG2 and RAN (Network Function) WG3. Subsequently SA WG2 will consider whether any system features are needed to support such DC or CA RAN (Network Function) functionality such as mobility restrictions for secondary access.
-	For E-UTRA:
-	E-UTRA not allowed as primary access.
-	E-UTRA not allowed as secondary access.
-	E-UTRA in unlicensed bands not allowed as secondary access.
-	NB-IoT not allowed as primary access.
-	LTE-M not allowed as primary access.
In order to enforce all primary access restrictions, the related access has to be deployed in different Tracking Area Codes and the subscriber shall not be allowed to access the network in TAs using the particular access.
With all secondary access restrictions, the subscriber shall not be allowed to use this access as secondary access.
This clause describes Service Area Restrictions for 3GPP access. For Service Area Restrictions when using wireline access, see TS 23.316 [84].
A Service Area Restriction may contain one or more (e.g. up to 16) entire Tracking Areas each or the Service Area Restriction may be set as unlimited (i.e. contain all Tracking Areas of the PLMN). The UE (Network Function)'s subscription data in the UDM (Network Function) includes a Service Area Restriction which may contain either Allowed or Non-Allowed Areas–specified by using explicit Tracking Area identities and/or other geographical information (e.g. longitude/latitude, zip code, etc). The geographical information used to specify Allowed or Non-Allowed Area is only managed in the network, and the network will map it to a list of TAs before sending Service Area Restriction information to the PCF (Network Function), NG-RAN (Network Function) and UE (Network Function).
When the AMF (Network Function) assigns a limited allowed area to the UE (Network Function), the AMF (Network Function) shall provide the UE (Network Function) with Service Area Restrictions which consist of either Allowed Areas or Non-Allowed Areas. The Allowed Areas included in the Service Area Restrictions can be pre-configured and/or dynamically assigned by the AMF (Network Function).
The Allowed Area may alternatively be configured as unlimited i.e. it may contain all Tracking Areas of the PLMN. The Registration Area of a UE (Network Function) in the Non-Allowed Area should consist of a set of TAs which belongs to a Non-Allowed Area of the UE (Network Function). The Registration Area of a UE (Network Function) in the Allowed Area should consist of a set of TAs which belongs to an Allowed Area of the UE (Network Function). The AMF (Network Function) provides the Service Area Restriction in the form of TA(s), which may be a subset of full list stored in UE (Network Function)'s subscription data or provided by the PCF (Network Function), to the UE (Network Function) during the Registration procedure.
NOTE:	As the finest granularity for Service Area Restrictions are at TA level, subscriptions with limited geographical extent, like subscriptions for Fixed Wireless Access, will be allocated one or a few TAs and will consequently be allowed to access services in a larger area than in e.g. a FWA system.
The limited allowed area may also be limited by the AMF (Network Function) by a maximum allowed number of Tracking Areas, even though this limitation is not sent to the UE (Network Function). If maximum allowed number of Tracking Areas is used in combination with Allowed Area, the maximum allowed number of Tracking Areas indicates (to the AMF (Network Function)) the maximum number of TAs allowed in limited allowed area inside the Allowed Area. If maximum allowed number of Tracking Areas is used in combination with Non-Allowed Area, the maximum allowed number of Tracking Areas indicates (to the AMF (Network Function)) the maximum number of TAs allowed in limited allowed area outside of the Non-Allowed Area.
The UDM (Network Function) stores the Service Area Restrictions of a UE (Network Function) as part of the UE (Network Function)'s subscription data. The PCF (Network Function) in the serving network may (e.g. due to varying conditions such as UE (Network Function)'s location, application in use, time and date) further adjust Service Area Restrictions of a UE (Network Function), either by expanding an Allowed Area or by reducing a Non-Allowed Area or by increasing the maximum allowed number of Tracking Areas. If NWDAF (Network Function) is deployed, the PCF (Network Function) may use analytics (i.e. statistics or predictions) on UE (Network Function) mobility from NWDAF (Network Function) (see TS 23.288 [86]) to adjust Service Area Restrictions. The UDM (Network Function) and the PCF (Network Function) may update the Service Area Restrictions of a UE (Network Function) at any time. For the UE (Network Function) in CM-CONNECTED state the AMF (Network Function) updates the UE (Network Function) and RAN (Network Function) immediately. For UE (Network Function) in CM-IDLE state the AMF (Network Function) may page the UE (Network Function) immediately or store the updated service area restriction and update the UE (Network Function) upon next signalling interaction with the UE (Network Function), as defined in TS 24.501 [47].
During registration, if the Service Area Restrictions of the UE (Network Function) is not present in the AMF (Network Function), the AMF (Network Function) fetches from the UDM (Network Function) the Service Area Restrictions of the UE (Network Function) that may be further adjusted by the PCF (Network Function). The serving AMF (Network Function) shall enforce the Service Area Restrictions of a UE (Network Function). A limited allowed area given by a maximum allowed number of Tracking Areas, may be dynamically assigned by the AMF (Network Function) adding any not yet visited (by the UE (Network Function)) Tracking Areas to the limited allowed area until the maximum allowed number of Tracking Areas is reached (i.e. the AMF (Network Function) adds new TAs to the limited allowed area until the number of TAs is equal to the maximum allowed number of Tracking Areas). The AMF (Network Function) deletes the list of TAs that have been used up under the maximum allowed number of Tracking Areas quota at every Initial Registration.
For a UE (Network Function) in CM-CONNECTED state the AMF (Network Function) shall indicate the Service Area Restrictions of this UE (Network Function) to the RAN (Network Function), using a Mobility Restriction List.
The UE (Network Function) shall store the received Service Area Restrictions and, if there is previously stored Service Area Restrictions, replace them with the newly received information. If the Service Area Restrictions include a limited allowed area, the Service Area Restrictions are applicable for the Tracking areas indicated in Service Area Restrictions. If the Service Area Restrictions included an unlimited allowed area, the received Service Area Restrictions are either applicable for the registered PLMN and its equivalent PLMN(s) that are available in the Registration Area, or the registered SNPN that is available in the Registration Area. The RAN (Network Function) uses the Service Area Restrictions for target cell selection in Xn and N2 (Non-service-based Interface) (Service-based Interface) based handover.
Upon change of serving AMF (Network Function) due to mobility, the old AMF (Network Function) may provide the new AMF (Network Function) with the Service Area Restrictions of the UE (Network Function) that may be further adjusted by the PCF (Network Function).
The network may perform paging for a UE (Network Function) to update Service Area Restrictions with Generic UE (Network Function) Configuration Update procedure (see clause 4.2.4 of TS 23.502 [3]).
In the case of roaming, the Service Area Restrictions are transferred from the UDM (Network Function) via the serving AMF (Network Function) to the serving PCF (Network Function) in the visited network. The serving PCF (Network Function) in the visited network may further adjust the Service Area Restrictions.
Support for Service Area Restrictions with NR satellite access is described in clause 5.4.11.8.
The Mobility Pattern is a concept that may be used by the AMF (Network Function) to characterise and optimise the UE (Network Function) mobility. The AMF (Network Function) determines and updates Mobility Pattern of the UE (Network Function) based on subscription of the UE (Network Function), statistics of the UE (Network Function) mobility, network local policy, and the UE (Network Function) assisted information, or any combination of them. The statistics of the UE (Network Function) mobility can be historical or expected UE (Network Function) moving trajectory. If NWDAF (Network Function) is deployed, the statistics of the UE (Network Function) mobility can also be analytics (i.e. statistics or predictions) provided by the NWDAF (Network Function) (see TS 23.288 [86]).
The Mobility Pattern can be used by the AMF (Network Function) to optimize mobility support provided to the UE (Network Function), for example, Registration area allocation.
To support radio resource management in NG-RAN (Network Function) the AMF (Network Function) provides the parameter 'Index to RAT/Frequency Selection Priority' (RFSP Index) to NG-RAN (Network Function) across N2 (Non-service-based Interface) (Service-based Interface). The RFSP Index is mapped by the RAN (Network Function) to locally defined configuration in order to apply specific RRM strategies, taking into account any available information in RAN (Network Function). The RFSP Index is UE (Network Function) specific and applies to all the Radio Bearers. Examples of how this parameter may be used by the RAN (Network Function):
-	to derive UE (Network Function) specific cell reselection priorities to control idle mode camping.
-	to decide on redirecting active mode UEs to different frequency layers or RATs (e.g. see clause 5.3.4.3.2).
The HPLMN may set the RFSP Index taking into account the Subscribed S-NSSAIs. The AMF (Network Function) receives the subscribed RFSP Index from the UDM (Network Function) (e.g. during the Registration procedure). For non-roaming subscribers, the AMF (Network Function) chooses the RFSP Index in use according to one of the following procedures, depending on operator's configuration:
-	the RFSP Index in use is identical to the subscribed RFSP Index, or
-	the AMF (Network Function) chooses the RFSP Index in use based on the subscribed RFSP Index, the locally configured operator's policies, the Allowed NSSAI and any Partially Allowed NSSAI and the UE (Network Function) related context information available at the AMF (Network Function), including UE (Network Function)'s usage setting, if received during Registration procedures (see clause TS 23.502 [3]).
NOTE 1:	One example of how the AMF (Network Function) can use the "UE (Network Function)'s usage setting," is to select an RFSP value that enforces idle mode camping on E-UTRA for a UE (Network Function) acting in a "Voice centric" way, in the case voice over NR is not supported in the specific Registration Area and it contains NR cells.
The AMF (Network Function) may report to the PCF (Network Function) the subscribed RFSP Index received from the UDM (Network Function) for further evaluation as described in clause 6.1.2.1 of TS 23.503 [45]. When receiving the authorized RFSP Index from the PCF (Network Function), the AMF (Network Function) shall apply the authorized RFSP Index instead of the subscribed RFSP Index for choosing the RFSP index in use (as described above).
For roaming subscribers, the AMF (Network Function) may choose the RFSP Index in use based on the visited network policy, but can take input from the HPLMN into account (e.g. an RFSP Index value pre-configured per HPLMN, or a single RFSP Index value to be used for all roamers independent of the HPLMN). If the AMF (Network Function) receives authorized RFSP Index value from the V-PCF (Network Function), the AMF (Network Function) chooses the RFSP index in use based on the authorized RFSP Index value.
NOTE 2:	The PCF (Network Function) can provide validity time together with the authorized RFSP Index indicating a change in priority from 5G access to E-UTRAN access as specified in clause 5.17.2.2.
The RFSP Index in use is also forwarded from source to target NG-RAN (Network Function) node when Xn or N2 (Non-service-based Interface) (Service-based Interface) is used for intra-NG-RAN (Network Function) handover.
The AMF (Network Function) stores the subscribed RFSP Index value received and the RFSP Index value in use. During the Registration procedure, the AMF (Network Function) may update the RFSP Index value in use (e.g. the AMF (Network Function) may need to update the RFSP Index value in use if the UE (Network Function) related context information in the AMF (Network Function) has changed). When the RFSP Index value in use is changed, the AMF (Network Function) immediately provides the updated RFSP Index value in use to NG-RAN (Network Function) node by modifying an existing UE (Network Function) context or by establishing a new UE (Network Function) context in RAN (Network Function) or by being configured to include the updated RFSP Index value in use in the NGAP DOWNLINK NAS (Protocol) TRANSPORT message if the user plane establishment is not needed. During inter-AMF (Network Function) mobility procedures, the source AMF (Network Function) forwards both RFSP Index values to the target AMF (Network Function). The target AMF (Network Function) may replace the received RFSP Index value in use with a new RFSP Index value in use that is based on the operator's policies and the UE (Network Function) related context information available at the target AMF (Network Function).
In order to enable UE (Network Function) idle mode mobility control and priority-based reselection mechanism considering availability of Network Slices at the network and the Network Slices allowed for a UE (Network Function), an RFSP is derived as described in clause 5.3.4.3, considering also the Allowed NSSAI and any Partially Allowed NSSAI for the UE (Network Function).
A UE (Network Function) supporting NSAG (see clause 5.15.14) may be configured, for some of the S-NSSAIs in the configured NSSAI, with NSAGs it can use as described in TS 38.300 [27], TS 38.304 [50], TS 38.331 [28], TS 38.321 [143], TS 24.501 [47] and as described in clause 5.3.4.3.4.
Editor's note:	The AMF (Network Function) can provide the Partially Allowed NSSAI without indication of the TAs where these are supported to the NG-RAN (Network Function) (in addition to providing the Partially Allowed NSSAI to the UE (Network Function)), but this will be evaluated after feedback from RAN (Network Function) WG2 and RAN (Network Function) WG3 whether and how to use the Partially Allowed NSSAI in the NG-RAN (Network Function).
The NG-RAN (Network Function) may prefer to use specific radio resources per data radio bearer(s), e.g. depending on the Network Slices associated to the data radio bearer used by the UE (Network Function). The UE (Network Function) idle mode mobility control and priority-based reselection mechanism operates as described in clause 5.3.4.3.1, and when UP resources are activated e.g. for a specific S-NSSAI the NG-RAN (Network Function) can use local policies to decide on what specific radio resources to use for the associated data radio bearer(s). A UE (Network Function) may be served by a set of data radio bearers which may be served by cells in different bands, selected based on RRM policies.
If a Network Slice, S-NSSAI, is configured to be available only in TAs covering specific dedicated frequency band(s), then there may be a need to redirect the UE (Network Function) to the dedicated frequency band(s) when such S-NSSAI is requested. If the Requested NSSAI contains S-NSSAI(s) that are not available in the UE (Network Function)'s current TA, see clause 5.15.8, the AMF (Network Function) itself or by interacting with the NSSF (Network Function) as described in clause 5.15.5.2.1 may determine a Target NSSAI to be used by the NG-RAN (Network Function), in addition to the information the AMF (Network Function) receives, such as the Allowed NSSAI and the RFSP for the Allowed NSSAI, to attempt to redirect the UE (Network Function) to a cell and TA in another frequency band and TA that supports the S-NSSAIs in the Target NSSAI. The Target NSSAI includes at least one S-NSSAI from the Requested NSSAI not available in the current TA, but available in another TA in different frequency band possibly overlapping with the current TA, and optionally additional S-NSSAIs from the Requested NSSAI that are configured to be available within the same TAs as the S-NSSAIs not available in the current TA. If the serving PLMN supports the subscription-based restrictions to simultaneous registration of network slices (see clause 5.15.12), and if the UE (Network Function) has NSSRG as part of the subscription information received from the HPLMN, the Target NSSAI includes only S-NSSAIs sharing at least one NSSRG.
The Target NSSAI may be excluding some of the S-NSSAIs in the Allowed NSSAI and include some of the rejected S-NSSAIs due to lack of support in the TA where the UE (Network Function) is located based on network policies that are in line with customer and operator agreements.
The Target NSSAI shall only include S-NSSAIs that can be provided in an Allowed NSSAI, or in an Allowed NSSAI and Partially Allowed NSSAI, for the UE (Network Function). The Target NSSAI includes at least one Rejected S-NSSAI and may include e.g.:
-	all or a subset of the Rejected S-NSSAIs for RA, all or a subset of the S-NSSAIs rejected partially in the RA, all or a subset of Partially Allowed NSSAI when none of the S-NSSAIs in the Requested S-NSSAI were available in the TA where the UE (Network Function) is;
-	all the S-NSSAIs of the Allowed NSSAI, all the S-NSSAIs of the Partially Allowed NSSAI and all or a subset of the Rejected S-NSSAIs for the RA and all or subset of S-NSSAIs rejected partially in the RA;
-	a subset of the S-NSSAIs in the Allowed NSSAI, a subset of the S-NSSAIs in the Partially Allowed NSSAI and all or a subset of the Rejected S-NSSAIs for the RA and all or subset of S-NSSAIs rejected partially in the RA, if the operator policy is to prefer this Target S-NSSAI to the Allowed NSSAI.
The AMF (Network Function) should retrieve an RFSP Index suitable for the Target NSSAI and includes the RFSP Index in the information sent to the NG-RAN (Network Function). The AMF (Network Function) retrieves the RFSP Index from the PCF (Network Function) or, in case PCF (Network Function) is not deployed the AMF (Network Function) determines the RFSP Index according to local configuration. The RFSP index associated to the Target NSSAI is considered if the NG-RAN (Network Function) succeeds to redirect the UE (Network Function) to a new TA where the Target NSSAI, or some S-NSSAIs of the Target NSSAI are supported, otherwise the RFSP index of the Allowed NSSAI is considered.
If the Requested NSSAI contains S-NSSAI(s) which map to S-NSSAI(s) of the HPLMN subject to Network Slice-Specific Authentication and Authorization that are not available in the UE (Network Function)'s current TA, the AMF (Network Function) shall proceed with the Network Slice-Specific Authentication and Authorization procedure as described in clause 4.2.9 of TS 23.502 [3]. If the AMF (Network Function) determines a new Allowed NSSAI and/or Partially Allowed NSSAI at the end of Network Slice-Specific Authentication and Authorization steps and some S-NSSAI is not available in the UE (Network Function)'s current TA, a Target NSSAI and corresponding RFSP index may be determined and provided to NG-RAN (Network Function) during UE (Network Function) Configuration Update procedure as described in clause 4.2.4.2 of TS 23.502 [3].
The NG-RAN (Network Function) shall attempt to find cells of TAs that can support all the S-NSSAIs in the Target S-NSSAIs, and if no such cell of a TA is available the RAN (Network Function) can attempt to select cells of TAs that best match the Target S-NSSAI. The NG-RAN (Network Function) shall attempt to ensure continuity of the PDU Sessions with activated User Plane associated with the S-NSSAIs in the Allowed NSSAI and/or Partially Allowed NSSAI which are in the Target NSSAI. Also, the NG-RAN (Network Function) should attempt to ensure continuity of service for the S-NSSAIs of the Allowed NSSAI and/or Partially Allowed NSSAI also available in the Target NSSAI, before prioritizing cells that are not supporting one or more of the S-NSSAI of the Allowed NSSAI and/or Partially Allowed NSSAI also available in the Target NSSAI.
The NG-RAN (Network Function) attempts to determine target cell(s) supporting the Target NSSAI considering the UE (Network Function) Radio Capabilities (i.e. the AMF (Network Function) (if available in the UE (Network Function) context) shall provide the NG-RAN (Network Function) with the current UE (Network Function) Radio Capability Information or the RACS UE (Network Function) Radio Capability ID when a Target NSSAI is provided, if the NG-RAN (Network Function) had not yet received any of them, or, if the AMF (Network Function) cannot provide any of these, the UE (Network Function) Radio Capability Information may be retrieved by the NG-RAN (Network Function) from the UE (Network Function)).
Once the target cells are determined, the NG-RAN (Network Function) initiates RRC (Protocol) redirection procedure towards the target cells, or the NG-RAN (Network Function) initiates handover for the UE (Network Function) with active PDU Sessions associated with the S-NSSAIs which are in the Target NSSAI, if possible.
After a successful redirection or handover of the UE (Network Function) to a new TA inside the current RA, the UE (Network Function) may request a PDU Session and activate UP resources for a PDU Session for S-NSSAIs of Partially Allowed NSSAI that are supported in the new TA, and the UE (Network Function) may request to register S-NSSAIs rejected partially in the RA that are not rejected in the new TA, as described in clause 5.15.17.
After a successful redirection or handover of the UE (Network Function) to a new TA outside the current RA, the UE (Network Function) shall perform a Mobility Registration Update procedure and the S-NSSAIs that the new TA supports can be allowed if the UE (Network Function) requests them. In order to ensure that the UE (Network Function) is redirected to a TA outside the current RA when there are S-NSSAIs Rejected for the RA, thus triggering a Mobility Registration Update procedure enabling the UE (Network Function) to request the S-NSSAI(s) that were rejected for the RA, the AMF (Network Function) shall set the RA so that the RA does not include TAs supporting the S-NSSAIs rejected for the RA included in the Target NSSAI when the AMF (Network Function) provides a Target NSSAI to the RAN (Network Function).
When one or more S-NSSAI(s) are associated with NSAG(s), the UE (Network Function) may perform Network Slice based cell reselection and Random Access as described in TS 38.300 [27], TS 38.304 [50], TS 38.331 [28], TS 38.321 [143] and TS 24.501 [47].
When providing NSAG Information to the UE (Network Function), the AMF (Network Function) shall also provide the NSAG priority information for the NSAGs provided in the NSAG Information. The AMF (Network Function) determines the NSAG priority information based on configured local policy of the serving PLMN or SNPN.
NOTE 1:	How the AMF (Network Function) assigns the NSAG priority information per UE (Network Function) is not specified but AMF (Network Function) can take into account information like e.g. UE (Network Function) MM capabilities, Subscribed S-NSSAIs and HPLMN.
NOTE 2:	The AMF (Network Function) can assign same priority value for NSAGs provided in the NSAG Information.
If the UE (Network Function) has received NSAG Information from the AMF (Network Function), the UE (Network Function) shall use the NSAG Information provided by the AMF (Network Function) for cell reselection and Random Access as described below. If the UE (Network Function) has not received any NSAG Information from the AMF (Network Function), the UE (Network Function) shall not use Network Slice based cell reselection and Random Access at all.
The UE (Network Function) NAS (Protocol) provides to the UE (Network Function) AS the NSAG Information as received from the AMF (Network Function) and the S-NSSAIs in the Allowed NSSAI and any Partially Allowed NSSAI as input to cell reselection, except when the UE (Network Function) intends to register with a new (including any S-NSSAIs rejected partially in the RA) set of S-NSSAIs with a Requested NSSAI different from the current Allowed NSSAI and any Partially Allowed NSSAI, in which case the UE (Network Function) NAS (Protocol) provides to the UE (Network Function) AS layer the NSAG Information as received from the AMF (Network Function) and the S-NSSAIs in the Requested NSSAI, and this may trigger a cell reselection, before sending the Registration Request including the new Requested NSSAI.
For Network Slice based Random Access, different Random Access resources may be assigned to different NSAG(s). The UE (Network Function) determines Random Access configuration among NSAGs that are published in SIB for Random Access and that are associated to the S-NSSAIs triggering the access. If the signalling transaction triggering the access attempt is related to more than one network slice, and the S-NSSAIs of these network slices are associated with more than one NSAG for Random Access, the NSAG with the highest priority is selected.
NOTE 3:	How the UE (Network Function) NAS (Protocol) provides the NSAGs priorities to UE (Network Function) AS is based internal UE (Network Function) interface, and not specified.
5G System supports the functionality of tracking and reporting UE (Network Function) mobility events.
The AMF (Network Function) provides the UE (Network Function) mobility related event reporting to NF (Network Function) that has been authorized to subscribe to the UE (Network Function) mobility event reporting service. Any NF (Network Function) service consumer such as SMF (Network Function), NEF (Network Function), TSCTSF (Network Function) or NWDAF (Network Function) that wants to be reported on the UE (Network Function) location is able to subscribe to the UE (Network Function) mobility event notification service to the AMF (Network Function) with the following parameters:
-	Event reporting type that specifies what to be reported on UE (Network Function) mobility (e.g. UE (Network Function) location, UE (Network Function) mobility on Area of Interest).
-	Event filters indicating the:
-	Area Of Interest that specifies a location area within 3GPP system. The Area Of Interest is represented by a list of Tracking Areas, list of cells or list of (R)AN node identifiers. In the case of LADN, the event consumer (e.g. SMF (Network Function)) provides the "LADN DNN" or "LADN DNN and S-NSSAI" to refer the LADN service area as the Area Of Interest. In the case of PRA, the event consumer (e.g. SMF (Network Function) or PCF (Network Function)) may provide an identifier for Area Of Interest to refer predefined area as the Area Of Interest.
-	The Area Of Interest may include a "RAN (Network Function) timing synchronization status change event" indicator, indicating that the presence in Area of Interest can be determined based on the most recent N2 (Non-service-based Interface) (Service-based Interface) connection.
-	The Area Of Interest may include an "Adjust AoI based on RA" indicator, indicating that the Area of Interest may be adjusted depending on UE (Network Function)'s RA.
-	S-NSSAI and optionally the NSI ID(s).
-	Event Reporting Information: event reporting mode, number of reports, maximum duration of reporting, event reporting condition (e.g. when the target UE (Network Function) moved into a specified Area Of Interest, immediate reporting flag).
-	Notification Endpoint of NF (Network Function) service consumer to be notified.
-	The target of event reporting that indicates a specific UE (Network Function), a group of UE (Network Function)(s) or any UE (Network Function) (i.e. all UEs). Further details on the information provided by the NF (Network Function) service consumer are provided in clause 4.15 of TS 23.502 [3].
If an NF (Network Function) service consumer subscribes to the UE (Network Function) mobility event notification service provided by AMF (Network Function) for reporting of UE (Network Function) presence in Area Of Interest, the AMF (Network Function) tracks UE (Network Function)'s location considering UE (Network Function)'s CM state and using NG-RAN (Network Function) procedures (if RRC_INACTIVE state applies to NG-RAN (Network Function)) in order to determine the UE (Network Function) presence in the Area Of Interest, as described in clause 4.15.4.2 of TS 23.502 [3]. Upon detecting the change of the UE (Network Function) presence in the Area Of Interest, the AMF (Network Function) notifies the UE (Network Function) presence in the Area Of Interest and the new UE (Network Function) location to the subscribed NF (Network Function) service consumer.
If the Area Of Interest in the subscription to the UE (Network Function) mobility event notification includes "RAN (Network Function) timing synchronization status change event" indicator as described in Table 5.2.2.3.1-1 of TS 23.502 [3], and the registration request from the UE (Network Function) includes a UE (Network Function) 5GMM Core Network Capability with an indication for "support for network reconnection due to RAN (Network Function) timing synchronization status change " as described in clause 5.4.4.a, the AMF (Network Function) reports the UE (Network Function) presence in Area of Interest based on the most recent N2 (Non-service-based Interface) (Service-based Interface) connection as described in Annex D of TS 23.502 [3].
If the Area Of Interest in the subscription to the UE (Network Function) mobility event notification includes "Adjust AoI based on RA" indicator as described in Table 5.2.2.3.1-1 in TS 23.502 [3], the AMF (Network Function) reports the UE (Network Function) presence in Area of Interest based on the most recent N2 (Non-service-based Interface) (Service-based Interface) connection as described in Annex D in TS 23.502 [3].
When the AMF (Network Function) is changed, the subscription of mobility event for a UE (Network Function) or group of UEs is transferred from the old AMF (Network Function). The new AMF (Network Function) may decide not to notify the SMF (Network Function) with the current status related to the subscription of mobility event if the new AMF (Network Function) determines that, based on MM Context of the UE (Network Function), the event is reported by the old AMF (Network Function).
In the network deployment where a UE (Network Function) may leave or enter the Area Of Interest without any notification to the 5GC in CM-CONNECTED state (i.e. in the case that RRC_INACTIVE state applies to the NG-RAN (Network Function)), the AMF (Network Function) may initiate the NG-RAN (Network Function) location reporting as described in clause 5.4.7 or N2 (Non-service-based Interface) (Service-based Interface) Notification as described in clause 4.8.3 of TS 23.502 [3] to track the UE (Network Function) presence in the Area Of Interest.
The AMF (Network Function) may provide UE (Network Function) mobility event reporting to PCF (Network Function), using Policy Control Report Triggers defined in TS 23.503 [45].
Triggers for the AMF (Network Function) to request for or subscribe to the analytics information from the NWDAF (Network Function) are internal logic in the AMF (Network Function) and may include for example:
-	UE (Network Function) access and mobility related event subscription by other NFs (e.g. SMF (Network Function), NEF (Network Function));
-	locally detected events;
-	analytics information received.
The trigger conditions may depend on operator and implementation policy in the AMF (Network Function). When a trigger condition happens, the AMF (Network Function) may decide if any analytics information is needed and if so, request for or subscription to the analytics information from the NWDAF (Network Function).
The AMF (Network Function) may, upon detection of certain local events, e.g. frequent mobility re-registration of one or more UEs, subscribe to mobility related abnormal behaviour analytics of the UE (Network Function)(s) as described in TS 23.288 [86] in order to trace UE (Network Function) mobility trend and take appropriate actions.
Reachability management is responsible for detecting whether the UE (Network Function) is reachable and providing UE (Network Function) location (i.e. access node) for the network to reach the UE (Network Function). This is done by paging UE (Network Function) and UE (Network Function) location tracking. The UE (Network Function) location tracking includes both UE (Network Function) registration area tracking (i.e. UE (Network Function) registration area update) and UE (Network Function) reachability tracking ((i.e. UE (Network Function) periodic registration area update)). Such functionalities can be either located at 5GC (in the case of CM-IDLE state) or NG-RAN (Network Function) (in the case of CM-CONNECTED state).
The UE (Network Function) and the AMF (Network Function) negotiate UE (Network Function) reachability characteristics for CM-IDLE state during Registration procedures.
Three UE (Network Function) reachability categories are negotiated between UE (Network Function) and AMF (Network Function) for CM-IDLE state:
1.	UE (Network Function) reachability allowing Mobile Terminated data while the UE (Network Function) is CM-IDLE state.
-	The UE (Network Function) location is known by the network on a Tracking Area List granularity
-	Paging procedures apply to this category.
-	Mobile originating and mobile terminated data apply in this category for both CM-CONNECTED and CM-IDLE state.
2.	Mobile Initiated Connection Only (MICO) mode:
-	Mobile originated data applies in this category for both CM-CONNECTED and CM-IDLE state.
-	Mobile terminated data is only supported when the UE (Network Function) is in CM-CONNECTED state.
3.	UE (Network Function) unreachability due to Unavailability Period:
-	Mobile originated data and Mobile terminated data are not transmitted in this category (handling of data by extending buffering may apply).
-	Paging procedure is not applicable to this category.
Whenever a UE (Network Function) in RM-REGISTERED state enters CM-IDLE state, it starts a periodic registration timer according to the periodic registration timer value received from the AMF (Network Function) during a Registration procedure.
The AMF (Network Function) allocates a periodic registration timer value to the UE (Network Function) based on local policies, subscription information and information provided by the UE (Network Function). After the expiry of the periodic registration timer, the UE (Network Function) shall perform a periodic registration. If the UE (Network Function) moves out of network coverage when its periodic registration timer expires, the UE (Network Function) shall perform a Registration procedure when it next returns to the coverage.
The AMF (Network Function) runs a Mobile Reachable timer for the UE (Network Function). The timer is started with a value longer than the UE (Network Function)'s periodic registration timer whenever the CM state for the UE (Network Function) in RM-REGISTERED state changes to CM-IDLE. If the AMF (Network Function) receives an elapsed time from RAN (Network Function) when RAN (Network Function) initiate UE (Network Function) context release indicating UE (Network Function) unreachable, the AMF (Network Function) should deduce a Mobile Reachable timer value based on the elapsed time received from RAN (Network Function) and the normal Mobile Reachable timer value. The AMF (Network Function) stops the Mobile Reachable timer, if the UE (Network Function) CM state in the AMF (Network Function) moves to CM-CONNECTED state. If the Mobile Reachable timer expires, the AMF (Network Function) determines that the UE (Network Function) is not reachable.
However, the AMF (Network Function) does not know for how long the UE (Network Function) remains not reachable, thus the AMF (Network Function) shall not immediately de-register the UE (Network Function). Instead, after the expiry of the Mobile Reachable timer, the AMF (Network Function) should clear the PPF and shall start an Implicit De-registration timer, with a relatively large value. The AMF (Network Function) shall stop the Implicit De-registration timer and set the PPF if the AMF (Network Function) moves the UE (Network Function) CM state in the AMF (Network Function) to CM-CONNECTED state.
NOTE:	If the UE (Network Function) CM state in the AMF (Network Function) is CM-IDLE, then AMF (Network Function) considers the UE (Network Function) always unreachable if the UE (Network Function) is in MICO mode (refer to clause 5.4.1.3).
If the UE (Network Function) indicates an Unavailability Period Duration, then AMF (Network Function) shall consider the UE (Network Function) as unreachable and will not trigger the Paging procedure (e.g. clear the PPF) until the UE (Network Function) registers for normal service again (e.g. set the PPF). Once the event that makes the UE (Network Function) unavailable is completed or cancelled in the UE (Network Function), the UE (Network Function) shall initiate the registration procedure in order to resume normal service.
If the PPF is not set, the AMF (Network Function) does not page the UE (Network Function) and shall reject any request for delivering DL signalling or data to this UE (Network Function).
If the Implicit De-registration timer expires before the UE (Network Function) contacts the network, the AMF (Network Function) implicitly de-register the UE (Network Function).
As part of deregistration for a particular access (3GPP or non-3GPP), the AMF (Network Function) shall request the UE (Network Function)'s related SMF (Network Function) to release the PDU Sessions established on that access.
The AMF (Network Function) considers a UE (Network Function) in RM-REGISTERED state to be reachable by CN paging if the UE (Network Function) CM state in the AMF (Network Function) is CM-IDLE state unless the UE (Network Function) applies MICO mode or the UE (Network Function) has indicated Unavailability Period Duration..
A UE (Network Function) may indicate preference for MICO mode during Initial Registration or Mobility Registration Update procedure. The AMF (Network Function), based on local configuration, Expected UE (Network Function) Behaviour and/or Network Configuration parameters if available from the UDM (Network Function), UE (Network Function) indicated preferences, UE (Network Function) subscription information and network policies, or any combination of them, determines whether MICO mode is allowed for the UE (Network Function) and indicates it to the UE (Network Function) during Registration procedure. If NWDAF (Network Function) is deployed, the AMF (Network Function) may also use analytics on UE (Network Function) mobility and/or UE (Network Function) communication generated by NWDAF (Network Function) (see TS 23.288 [86]) to decide MICO mode parameters. If the UE (Network Function) does not indicate preference for MICO mode during Registration procedure, the AMF (Network Function) shall not activate MICO mode for this UE (Network Function).
The UE (Network Function) and the AMF (Network Function) re- negotiate the MICO mode at every subsequent Registration procedure. When the UE (Network Function) is in CM-CONNECTED, the AMF (Network Function) may deactivate MICO mode by triggering Mobility Registration Update procedure through UE (Network Function) Configuration Update procedure as described in clause 4.2.4 of TS 23.502 [3].
The AMF (Network Function) assigns a registration area to the UE (Network Function) during the Registration procedure. When the AMF (Network Function) indicates MICO mode to a UE (Network Function), the registration area is not constrained by paging area size. If the AMF (Network Function) serving area is the whole PLMN, based on local policy, and subscription information, may decide to provide an "all PLMN" registration area to the UE (Network Function). In that case, re-registration to the same PLMN due to mobility does not apply.
If Mobility Restrictions are applied to a UE (Network Function) in MICO mode, the AMF (Network Function) needs to allocate an Allowed Area/Non-Allowed Area to the UE (Network Function) as specified in clause 5.3.4.1.
When the AMF (Network Function) indicates MICO mode to a UE (Network Function), the AMF (Network Function) considers the UE (Network Function) always unreachable while the UE (Network Function) CM state in the AMF (Network Function) is CM-IDLE. The AMF (Network Function) rejects any request for downlink data delivery for UE (Network Function) in MICO mode and whose UE (Network Function) CM state in the AMF (Network Function) is CM-IDLE with an appropriate cause. For MT-SMS over NAS (Protocol), the AMF (Network Function) notifies the SMSF (Network Function) that UE (Network Function) is not reachable, then the procedure of the unsuccessful Mobile terminating SMS delivery described in clause 4.13.3.9 of TS 23.502 [3] is performed. The AMF (Network Function) also defers location services, etc. The UE (Network Function) in MICO mode is only reachable for mobile terminated data or signalling when the UE (Network Function) is in CM-CONNECTED.
A UE (Network Function) in MICO mode need not listen to paging while in CM-IDLE. A UE (Network Function) in MICO mode may stop any access stratum procedures in CM-IDLE, until the UE (Network Function) initiates transition from CM-IDLE to CM-CONNECTED due to one of the following triggers:
-	A change in the UE (Network Function) (e.g. change in configuration) requires an update of its registration with the network.
-	Periodic registration timer expires.
-	MO data pending.
-	MO signalling pending (e.g. SM procedure initiated).
If a registration area that is not the "all PLMN" registration area is allocated to a UE (Network Function) in MICO mode, then the UE (Network Function) determines if it is within the registration area or not when it has MO data or MO signalling, and the UE (Network Function) performs Mobility Registration Update before the UE (Network Function) initiates the MO data or MO signalling if it is not within the registration area.
A UE (Network Function) initiating emergency service shall not indicate MICO preference during Registration procedure. When the MICO mode is already activated in the UE (Network Function), the UE (Network Function) and AMF (Network Function) shall locally disable MICO mode after PDU Session Establishment procedure for Emergency Services is completed successfully. The UE (Network Function) and the AMF (Network Function) shall not enable MICO mode until the AMF (Network Function) accepts the use of MICO mode in the next registration procedure. To enable an emergency call back, the UE (Network Function) should wait for a UE (Network Function) implementation-specific duration of time before requesting the use of MICO mode after the release of the emergency PDU session.
In order to enable power saving for MT reachability e.g. for Cellular IoT, enhancements to MICO mode are specified in clause 5.31.7:
-	MICO mode with Extended Connected Time.
-	MICO mode with Active Time.
-	MICO mode and Periodic Registration Timer Control.
During Registration procedure, the UE (Network Function) supporting the Unavailability Period feature provides "Unavailability Period Support" indication as part of 5GMM Core Network Capability in Registration Request message for initial registration and for every mobility registration. The AMF (Network Function) indicates whether the corresponding feature is supported in the AMF (Network Function) by providing the "Unavailability Period Supported" indication in Registration Accept message.
If the UE (Network Function) and network support Unavailability Period and an event is triggered in the UE (Network Function) that would make the UE (Network Function) unavailable or lose coverage (see clause 5.4.13.1) for a certain period of time, the UE (Network Function) uses Support of Unavailability Period to inform the AMF (Network Function) of the upcoming unavailability and whether it is due to NR satellite access discontinuous coverage. Use of Support of Unavailability Period for loss of coverage due to NR satellite access discontinuous coverage shall only be used if both UE (Network Function) and the AMF (Network Function) signalled "discontinuous coverage support", see clause 5.4.13.0.
If the use of Support of Unavailability Period is not due to NR satellite access discontinuous coverage, the UE (Network Function) may store its MM and SM context in the USIM or Non-Volatile memory in the ME to be able to reuse it after its unavailability period. If the UE (Network Function) can store its contexts the UE (Network Function) may trigger Mobility Registration Update procedure otherwise the UE (Network Function) shall trigger UE (Network Function)-initiated Deregistration procedure.
NOTE:	How and where the UE (Network Function) stores its contexts depends upon the UE (Network Function) implementation and the type of unavailability. The UE (Network Function) can store some or all of its contexts in the ME or USIM using existing ME or USIM functionality.
Before the start of an event that makes the UE (Network Function) unavailable, the UE (Network Function) includes an indication and type of unavailability, the Start of the Unavailability Period if known and the Unavailability Period Duration (if known) and triggers either Mobility Registration Update or UE (Network Function) initiated Deregistration procedure:
a)	If the UE (Network Function) initiates Mobility Registration Update procedure:
1)	If the UE (Network Function) did not include a Start of Unavailability Period, the AMF (Network Function) considers implicitly the Start of Unavailability Period to be the time at which it has received the Registration Request message from the UE (Network Function). If the UE (Network Function) included a Start of Unavailability Period, the Start of Unavailability Period indicates the time at which the UE (Network Function) determines it expects to be unavailable, i.e. time until which the UE (Network Function) determines it is available.
2)	The AMF (Network Function) may determine, if not provided by the UE (Network Function), or update the Unavailability Period Duration.
	If the AMF (Network Function) knows an Unavailability Period Duration (e.g. based on the type of unavailability and other information available to the AMF (Network Function) as described in clause 5.4.13.3), and the UE (Network Function) did not include an Unavailability Period Duration or the UE (Network Function) included an Unavailability Period Duration different to the Unavailability Period Duration known to the AMF (Network Function), the AMF (Network Function) may use either the Unavailability Period Duration known to the AMF (Network Function) or the Unavailability Period Duration from the UE (Network Function) as the Unavailability Period Duration. The AMF (Network Function) should include the Unavailability Period Duration known to the AMF (Network Function) in the Registration Accept. How the UE (Network Function) treats the AMF (Network Function) provided Unavailability Period Duration is up to UE (Network Function) implementation e.g. to help to determine when to return to coverage after a discontinuous coverage period, whether to listen to paging in eDRX, not to initiate any NAS (Protocol) signalling (including Service Request for MO data) within the discontinuous coverage period in case of any UL signalling/data request or the UE (Network Function) may deactivate its Access Stratum functions for NR satellite access in order to optimise power consumption until coverage returns, etc.
3)	The AMF (Network Function) indicates to the UE (Network Function) in the Registration Accept whether the UE (Network Function) is not required to perform a Registration procedure when the unavailability period has ended, is delayed or is cancelled.
4)	The AMF (Network Function) may take the Unavailability Period Duration (if available) and Start of Unavailability Period into account when determining Periodic Registration Update timer value. The AMF (Network Function) may provide a Periodic Registration Update time longer than or equal to the combination of the Unavailability Period Duration and Start of Unavailability Period to avoid interfering with the UE (Network Function) dealing with the event that causes the unavailability;
5)	The AMF (Network Function) stores the information that the UE (Network Function) is unavailable at the Start of Unavailability Period in UE (Network Function) context, and considers the UE (Network Function) is unreachable (i.e. clear the PPF in AMF (Network Function)) from then until the UE (Network Function) enters CM-CONNECTED state;
6)	While the UE (Network Function) is unreachable, all high latency communication solutions (see clause 5.31.8) apply if supported in the network, e.g. extended data buffering, downlink data buffering status report, etc; and
7)	If there is "Loss of Connectivity" event subscription for the UE (Network Function) by AF (Network Function), the AMF (Network Function) considers the remaining time in the Unavailability Period (if available) when constructing the "Loss of Connectivity" event report towards the NEF (Network Function) and the Unavailability Period is reported to the respective subscribed AF (Network Function).
b)	If the UE (Network Function) initiates UE (Network Function)-initiated Deregistration procedure:
1)	If there is "Loss of Connectivity" event subscription for the UE (Network Function) by AF (Network Function), the AMF (Network Function) considers the remaining time in the Unavailability Period when constructing the "Loss of Connectivity" event report towards the NEF (Network Function) and the Unavailability Period is reported to the respective subscribed AF (Network Function);
Unless the AMF (Network Function) indicated that the UE (Network Function) is not required to perform a Registration procedure when the unavailability period has ended, is delayed or is cancelled, then once the event which makes the UE (Network Function) unavailable is completed in the UE (Network Function) or the event is delayed to a future time or cancelled in the UE (Network Function), the UE (Network Function) triggers Registration procedure. The UE (Network Function) may also trigger a Registration procedure before the Unavailability Period has started for other reasons. Depending on the UE (Network Function) state, the Registration procedure can be Initial Registration procedure or Mobility Registration Update procedure.
If the UE (Network Function) determines an upcoming loss of coverage no longer applies or determines a new Start of Unavailability Period or Unavailability Period Duration related to the upcoming loss of coverage, the UE (Network Function) sends a new Registration Request.
The UE (Network Function) and the AMF (Network Function) re-negotiate unavailability at every Registration procedure, if it is required. If Start of Unavailability Period and/or Unavailability Period Duration is not included in a Registration procedure any pending unavailability configuration stored in the UE (Network Function) context at AMF (Network Function) is discarded.
Editor's note:	The encoding of the Start of Unavailability Period and the indication for use of Support of Unavailability will be determined by CT WG1.
For a UE (Network Function) in CM-CONNECTED state:
-	the AMF (Network Function) knows the UE (Network Function) location on a serving (R)AN node granularity.
-	the NG-RAN (Network Function) notifies the AMF (Network Function) when UE (Network Function) becomes unreachable from RAN (Network Function) point of view.
UE (Network Function) RAN (Network Function) reachability management is used by RAN (Network Function) for UEs in RRC_INACTIVE state, see TS 38.300 [27]. The location of a UE (Network Function) in RRC_INACTIVE state is known by the RAN (Network Function) on a RAN (Network Function) Notification area granularity. A UE (Network Function) in RRC_INACTIVE state is paged in cells of the RAN (Network Function) Notification area that is assigned to the UEs. The RAN (Network Function) Notification area can be a subset of cells configured in UE (Network Function)'s Registration Area or all cells configured in the UE (Network Function)'s Registration Area. UE (Network Function) in RRC_INACTIVE state performs RAN (Network Function) Notification Area Update when entering a cell that is not part of the RAN (Network Function) Notification area that is assigned to the UE (Network Function).
At transition into RRC_INACTIVE state RAN (Network Function) configures the UE (Network Function) with a periodic RAN (Network Function) Notification Area Update timer value and the timer is restarted in the UE (Network Function) with this initial timer value. After the expiry of the periodic RAN (Network Function) Notification Area Update timer in the UE (Network Function), the UE (Network Function) in RRC_INACTIVE state performs periodic RAN (Network Function) Notification Area Update, as specified in TS 38.300 [27].
To aid the UE (Network Function) reachability management in the AMF (Network Function), RAN (Network Function) uses a guard timer with a value longer than the RAN (Network Function) Notification Area Update timer value provided to the UE (Network Function). Upon the expiry of the periodic RAN (Network Function) Notification Area Update guard timer in RAN (Network Function), the RAN (Network Function) shall initiate the AN Release procedure as specified in TS 23.502 [3]. The RAN (Network Function) may provide the elapsed time since RAN (Network Function)'s last contact with the UE (Network Function) to AMF (Network Function).
Based on operator configuration, the 5GS supports the AMF (Network Function) and NG-RAN (Network Function) to apply different paging strategies for different types of traffic.
In the case of UE (Network Function) in CM-IDLE state, the AMF (Network Function) performs paging and determines the paging strategy based on e.g. local configuration, what NF (Network Function) triggered the paging and information available in the request that triggered the paging. If NWDAF (Network Function) is deployed, the AMF (Network Function) may also use analytics (i.e. statistics or predictions) on the UE (Network Function)'s mobility as provided by NWDAF (Network Function) (see TS 23.288 [86]).
In the case of UE (Network Function) in CM-CONNECTED with RRC_INACTIVE state, the NG-RAN (Network Function) performs paging and determines the paging strategy based on e.g. local configuration, and information received from AMF (Network Function) as described in clause 5.4.6.3 and SMF (Network Function) as described in clause 5.4.3.2.
In the case of Network Triggered Service Request from SMF (Network Function), the SMF (Network Function) determines the 5QI and ARP based on the downlink packet (if the SMF (Network Function) performs buffering) or the Downlink Data Report received from UPF (Network Function) (if the UPF (Network Function) performs buffering). The SMF (Network Function) includes the 5QI and ARP corresponding to the QoS Flow of the received downlink PDU in the request sent to the AMF (Network Function). If the UE (Network Function) is in CM IDLE, the AMF (Network Function) uses e.g. the 5QI and ARP to derive different paging strategies as described in clause 4.2.3.3 of TS 23.502 [3].
NOTE:	The 5QI is used by AMF (Network Function) to determine suitable paging strategies.
Paging policy differentiation is an optional feature that allows the AMF (Network Function), based on operator configuration, to apply different paging strategies for different traffic or service types provided within the same PDU Session. In this Release of the specification this feature applies only to PDU Session of IP  (Protocol)type.
When the 5GS supports the Paging Policy Differentiation (PPD) feature, the DSCP value (TOS in IPv4 / TC in IPv6) is set by the application to indicate to the 5GS which Paging Policy should be applied for a certain IP  (Protocol)packet. For example, as defined in TS 23.228 [15], the P-CSCF may support Paging Policy Differentiation by marking packet(s) to be sent towards the UE (Network Function) that relate to a specific IMS services (e.g. conversational voice as defined in IMS multimedia telephony service).
NOTE 1:	This PPD feature may be used to determine the Paging Cause Indication for Voice Service, as described in clause 5.38.3.
It shall be possible for the operator to configure the SMF (Network Function) in such a way that the Paging Policy Differentiation feature only applies to certain HPLMNs, DNNs and 5QIs. In the case of HR roaming, this configuration is done in the SMF (Network Function) in the VPLMN.
NOTE 2:	Support of Paging Policy Differentiation in the case of HR roaming requires inter operator agreements including on the DSCP value associated with this feature.
In the case of Network Triggered Service Request and UPF (Network Function) buffering downlink packets, the UPF (Network Function) shall include the DSCP in TOS (IPv4) / TC (IPv6) value from the IP  (Protocol)header of the downlink packet and an indication of the corresponding QoS Flow in the Downlink Data Report sent to the SMF (Network Function). When PPD applies, the SMF (Network Function) determines the Paging Policy Indicator (PPI) based on the DSCP received from the UPF (Network Function).
In the case of Network Triggered Service Request and SMF (Network Function) buffering downlink packets, when PPD applies, the SMF (Network Function) determines the PPI based on the DSCP in TOS (IPv4) / TC (IPv6) value from the IP  (Protocol)header of the received downlink packet and identifies the corresponding QoS Flow from the QFI of the received downlink packet.
The SMF (Network Function) includes the PPI, the ARP and the 5QI of the corresponding QoS Flow in the N11 (Service-based Interface) message sent to the AMF (Network Function). If the UE (Network Function) is in CM IDLE, the AMF (Network Function) uses this information to derive a paging strategy, and sends paging messages to NG-RAN (Network Function) over N2 (Non-service-based Interface) (Service-based Interface).
NOTE 3:	Network configuration needs to ensure that the information used as a trigger for Paging Policy Indication is not changed within the 5GS.
NOTE 4:	Network configuration needs to ensure that the specific DSCP in TOS (IPv4) / TC (IPv6) value, used as a trigger for Paging Policy Indication, is managed correctly in order to avoid the accidental use of certain paging policies.
For a UE (Network Function) in RRC_INACTIVE state the NG-RAN (Network Function) may enforce specific paging policies in the case of NG-RAN (Network Function) paging, based on 5QI, ARP and PPI associated with an incoming DL PDU. To enable this, the SMF (Network Function) instructs the UPF (Network Function) to detect the DSCP in the TOS (IPv4) / TC (IPv6) value in the IP  (Protocol)header of the DL PDU (by using a DL PDR with the DSCP for this traffic) and to transfer the corresponding PPI in the CN tunnel header (by using a QER with the PPI value). The NG-RAN (Network Function) can then utilize the PPI received in the CN tunnel header of an incoming DL PDU in order to apply the corresponding paging policy for the case the UE (Network Function) needs to be paged when in RRC_INACTIVE state. In the case of Home-Routed roaming, the V-SMF (Network Function) is responsible of controlling UPF (Network Function) setting of the PPI. In the case of PDU Session with I-SMF (Network Function), the I-SMF (Network Function) is responsible of controlling UPF (Network Function) setting of the PPI.
Paging Priority is a feature that allows the AMF (Network Function) to include an indication in the Paging Message sent to NG-RAN (Network Function) that the UE (Network Function) be paged with priority. The decision by the AMF (Network Function) whether to include Paging Priority in the Paging Message is based on the ARP value in the message received from the SMF (Network Function) for an IP  (Protocol)packet waiting to be delivered in the UPF (Network Function). If the ARP value is associated with select priority services (e.g. MPS, MCS), the AMF (Network Function) includes Paging Priority in the Paging Message. When the NG-RAN (Network Function) receives a Paging Message with Paging Priority, it handles the page with priority.
The AMF (Network Function) while waiting for the UE (Network Function) to respond to a page sent without priority receives another message from the SMF (Network Function) with an ARP associated with select priority services (e.g. MPS, MCS), the AMF (Network Function) sends another Paging message to the (R)AN including the Paging Priority. For subsequent messages, the AMF (Network Function) may determine whether to send the Paging message with higher Paging Priority based on local policy.
For a UE (Network Function) in RRC_INACTIVE state, the NG-RAN (Network Function) determines Paging Priority based on the ARP associated with the QoS Flow as provisioned by the operator policy, and the Core Network Assisted RAN (Network Function) paging information from AMF (Network Function) as described in clause 5.4.6.3.
This clause applies when no radio capability signalling optimisation is used between a UE (Network Function) and the network.
The UE (Network Function) Radio Capability information is defined in TS 38.300 [27] and contains information on RATs that the UE (Network Function) supports (e.g. power class, frequency bands, etc). Consequently, this information can be sufficiently large that it is undesirable to send it across the radio interface at every transition of UE (Network Function) CM state in the AMF (Network Function) from CM-IDLE to CM-CONNECTED. To avoid this radio overhead, the AMF (Network Function) shall store the UE (Network Function) Radio Capability information during CM-IDLE state for the UE (Network Function) and RM-REGISTERED state for the UE (Network Function) and the AMF (Network Function) shall if it is available, send its most up to date UE (Network Function) Radio Capability information to the RAN (Network Function) in the N2 (Non-service-based Interface) (Service-based Interface) REQUEST message, i.e. INITIAL CONTEXT SETUP REQUEST or UE (Network Function) RADIO CAPABILITY CHECK REQUEST.
NOTE 1:	Due to issues with the handling of dynamic UMTS security parameters, the UTRA UE (Network Function) Radio Capability information is excluded from the information that is uploaded and stored in the AMF (Network Function) (see TS 38.300 [27]).
The AMF (Network Function) deletes the UE (Network Function) radio capability when the UE (Network Function) RM state in the AMF (Network Function) transitions to RM-DEREGISTERED. When the AMF (Network Function) receives Registration Request with the Registration type set to Initial Registration or when it receives the first Registration Request after E-UTRA/EPC Attach with Registration type set to Mobility Registration Update, the AMF (Network Function) deletes the UE (Network Function) radio capability.
The UE (Network Function) Radio Capability is maintained in the core network, even during AMF (Network Function) reselection.
NOTE 2:	The UE (Network Function) Radio Capability is not transferred to EPC during the inter-system mobility.
If the UE (Network Function)'s NG-RAN (Network Function) or E-UTRAN UE (Network Function) Radio Capability information changes while in CM-IDLE state, the UE (Network Function) shall perform the Registration procedure with the Registration type set to Mobility Registration Update and it also includes "UE (Network Function) Radio Capability Update". (For specific requirements for a UE (Network Function) operating in dual-registration mode see clause 5.17.2.1). When the AMF (Network Function) receives Mobility Registration Update Request with "UE (Network Function) Radio Capability Update" requested by the UE (Network Function), it shall delete any UE (Network Function) Radio Capability information that it has stored for the UE (Network Function). If the UE (Network Function)'s NG-RAN (Network Function) UE (Network Function) Radio Capability information changes when the UE (Network Function) is in CM-IDLE with Suspend, NAS (Protocol) shall trigger AS to establish a new RRC (Protocol) connection and not resume the existing one in order to perform the Registration procedure with the Registration type set to Mobility Registration Update including "UE (Network Function) Radio Capability Update". As a result of this, the access stratum in the UE (Network Function) will discard the AS information and establish a new RRC (Protocol) connection as defined in TS 36.331 [51].
If the trigger to change the UE (Network Function)'s NG-RAN (Network Function) or E-UTRAN UE (Network Function) Radio Capability information happens when the UE (Network Function) is in CM-CONNECTED state, the UE (Network Function) shall first enter CM-IDLE state and then perform the Registration procedure with the Registration type set to Mobility Registration Update and it also includes "UE (Network Function) Radio Capability Update".
The RAN (Network Function) stores the UE (Network Function) Radio Capability information, received in the N2 (Non-service-based Interface) (Service-based Interface) message or obtained from the UE (Network Function), for the duration of the UE (Network Function) staying in RRC_CONNECTED or RRC_INACTIVE state. Before any 5G SRVCC handover attempt from NG-RAN (Network Function) to UTRAN, the RAN (Network Function) retrieves the UE (Network Function)'s UTRA UE (Network Function) Radio Capabilities from the UE (Network Function). (For specific requirements for a UE (Network Function) operating in dual-registration mode see clause 5.17.2.1).
If the AMF (Network Function) sends N2 (Non-service-based Interface) (Service-based Interface) REQUEST (i.e. INITIAL CONTEXT SETUP REQUEST or UE (Network Function) RADIO CAPABILITY CHECK REQUEST) message to NG-RAN (Network Function) without UE (Network Function) Radio Capability information in that message and there is no UE (Network Function) Radio Capability information available in RAN (Network Function), this triggers the RAN (Network Function) to request the UE (Network Function) Radio Capability from the UE (Network Function) and to upload it to the AMF (Network Function) in the N2 (Non-service-based Interface) (Service-based Interface) UE (Network Function) RADIO CAPABILITY INFO INDICATION message.
If a UE (Network Function) supports both NB-IoT and other RATs the UE (Network Function) handles the UE (Network Function) Radio capability information as follows:
-	When the UE (Network Function) is camping on NB-IoT the UE (Network Function) provides only NB-IoT UE (Network Function) radio capabilities to the network.
-	When the UE (Network Function) is not camping on NB-IoT, the UE (Network Function) provides UE (Network Function) radio capabilities for the RAT but not NB-IoT UE (Network Function) radio capabilities to the network.
In order to handle the distinct UE (Network Function) radio capabilities, the AMF (Network Function) stores a separate NB-IoT specific UE (Network Function) Radio Capability information when the UE (Network Function) provides the UE (Network Function) Radio Capability information while camping on NB-IoT.
When the UE (Network Function) is camping on NB-IoT, the AMF (Network Function) sends, if available, the NB-IoT RAT specific UE (Network Function) Radio Capability information to the E-UTRAN.
When the UE (Network Function) is not camping on NB-IoT, the AMF (Network Function) sends, if available, UE (Network Function) radio capabilities for the RAT but not NB-IoT radio capabilities.
5.4.4.1a	UE (Network Function) radio capability signalling optimisation (RACS)
With the increase of the size of UE (Network Function) radio capabilities driven e.g. by additional frequency bands and combinations thereof for E-UTRA and NR, an efficient approach to signal UE (Network Function) Radio Capability Information over the radio interface and other network interfaces is defined with RACS.
In this Release of the specification, RACS does not apply to NB-IOT.
RACS works by assigning an identifier to represent a set of UE (Network Function) radio capabilities. This identifier is called UE (Network Function) Radio Capability ID. A UE (Network Function) Radio Capability ID can be either UE (Network Function) manufacturer-assigned or PLMN-assigned, as specified in clause 5.9.10. The UE (Network Function) Radio Capability ID is an alternative to the signalling of the UE (Network Function) Radio Capability information over the radio interface, within NG-RAN (Network Function), from NG-RAN (Network Function) to E-UTRAN, from AMF (Network Function) to NG-RAN (Network Function) and between CN nodes supporting RACS.
PLMN-assigned UE (Network Function) Radio Capability ID is assigned to the UE (Network Function) using the UE (Network Function) Configuration Update Command, or Registration Accept as defined in TS 23.502 [3]. The UCMF (Network Function) shall be configured with a Version ID for PLMN-assigned UE (Network Function) Radio Capability IDs, defined in clause 5.9.10.
The UCMF (Network Function) (UE (Network Function) radio Capability Management Function) stores all UE (Network Function) Radio Capability ID mappings in a PLMN and is responsible for assigning every PLMN-assigned UE (Network Function) Radio Capability ID in this PLMN, see clause 6.2.21. The UCMF (Network Function) stores the UE (Network Function) Radio Capability IDs alongside the UE (Network Function) Radio Capability information and the UE (Network Function) Radio Capability for Paging they map to. Each UE (Network Function) Radio Capability ID stored in the UCMF (Network Function) can be associated to one or both UE (Network Function) radio capabilities formats specified in TS 36.331 [51] and TS 38.331 [28]. The two UE (Network Function) radio capabilities formats shall be identifiable by the AMF (Network Function) and UCMF (Network Function) and the AMF (Network Function) shall store the TS 38.331 [28] format only.
An NG-RAN (Network Function) which supports RACS can be configured to operate with one of two modes of operation when providing the UE (Network Function) radio capabilities to the AMF (Network Function) when the NG-RAN (Network Function) executes a UE (Network Function) Radio Capability Enquiry procedure (see TS 38.331 [28]) to retrieve UE (Network Function) radio capabilities from the UE (Network Function):
-	Mode of operation A): The NG-RAN (Network Function) provides to the AMF (Network Function) both formats (i.e. the TS 38.331 [28] format and TS 36.331 [51] format). The NG-RAN (Network Function) derives one of the UE (Network Function) Radio Capability formats using local transcoding of the other format it receives from the UE (Network Function) and extracts the E-UTRAN UE (Network Function) Radio Capability for Paging and NR UE (Network Function) Radio Capability for Paging from the UE (Network Function) Radio capabilities.
-	Mode of operation B): The NG-RAN (Network Function) provides to the AMF (Network Function) the TS 38.331 [28] format only.
In a PLMN supporting RACS only in 5GS, Mode of Operation B shall be configured.
If the PLMN supports RACS in both EPS and 5GS:
-	If RAN (Network Function) nodes in the EPS and 5GS are configured in Mode of operation B, then the UCMF (Network Function) shall be capable to transcode between TS 36.331 [51] and TS 38.331 [28] formats and the UCMF (Network Function) shall be able to generate the RAT-specific UE (Network Function) Radio Capability for Paging information from the UE (Network Function) Radio Capability.
-	If the NG-RAN (Network Function) is configured to operate according to Mode A, then also the E-UTRAN shall be configured to operate according to mode A and the UMCF is not required to transcode between TS 36.331 [51] and TS 38.331 [28] formats and the AMF (Network Function) shall provide the UE (Network Function) Radio Capability for Paging information.
When the NG-RAN (Network Function) updates the AMF (Network Function) with new UE (Network Function) radio capabilities information, the AMF (Network Function) provides the information obtained from the NG-RAN (Network Function) to the UCMF (Network Function) even if the AMF (Network Function) already has a UE (Network Function) Radio Capability ID for that UE (Network Function). The UCMF (Network Function) then returns a value of UE (Network Function) Radio Capability ID. If the value is different from the one stored in the AMF (Network Function), the AMF (Network Function) updates the UE (Network Function) Radio Capability ID it stores and provides this new value to the NG-RAN (Network Function) (if applicable) and to the UE (Network Function).
In order to be able to interpret the UE (Network Function) Radio Capability ID a Network Function or node may store a local copy of the mapping between the UE (Network Function) Radio Capability ID and its corresponding UE (Network Function) Radio Capability information i.e. a dictionary entry. When no mapping is available between a UE (Network Function) Radio Capability ID and the corresponding UE (Network Function) Radio Capability information in a Network Function or node, this Network Function or node shall be able to retrieve this mapping and store it.
-	An AMF (Network Function) which supports RACS shall store such UE (Network Function) Radio Capability ID mapping at least for all the UEs that it serves that have a UE (Network Function) Radio Capability ID assigned.
-	The NG-RAN (Network Function) performs local caching of the UE (Network Function) Radio Capability information for the UE (Network Function) Radio Capability IDs for the UEs it is serving, and potentially for other UE (Network Function) Radio Capability IDs according to suitable local policies.
-	When the NG-RAN (Network Function) needs to retrieve the mapping of a UE (Network Function) Radio Capability ID to the corresponding UE (Network Function) Radio Capability information, it queries the AMF (Network Function) using N2 (Non-service-based Interface) (Service-based Interface) signalling defined in TS 38.413 [34].
-	When the AMF (Network Function) needs to obtain a PLMN-assigned UE (Network Function) Radio Capability ID for a UE (Network Function) from the UCMF (Network Function), it provides the UE (Network Function) Radio Capability information it has for the current radio configuration of the UE (Network Function) and the IMEI/TAC for the UE (Network Function) and the UCMF (Network Function) returns a UE (Network Function) Radio Capability ID. The AMF (Network Function) shall provide to the UCMF (Network Function) the UE (Network Function) Radio Capability information (and at least in Mode A, the UE (Network Function) Radio Capability for Paging) obtained from the NG-RAN (Network Function) in one or both the TS 36.331 [51] and TS 38.331 [28] formats depending on how the RAN (Network Function) is configured. The UCMF (Network Function) stores the association of this IMEI/TAC with this UE (Network Function) Radio Capability ID and the UE (Network Function) Radio Capability information and the UE (Network Function) Radio Capability for Paging in all the formats it receives. The UE (Network Function) Radio Capability information formats the AMF (Network Function) provides shall be identifiable at the UCMF (Network Function).
-	When the AMF (Network Function) needs to obtain the UE (Network Function) Radio Capability information and the UE (Network Function) Radio Capability for Paging associated to a UE (Network Function) Radio Capability ID it provides the UE (Network Function) Radio Capability ID to the UCMF (Network Function) with an indication that it is requesting the TS 38.331 [28] format and the UCMF (Network Function) returns a mapping of the UE (Network Function) Radio Capability ID to the corresponding UE (Network Function) Radio Capability information in TS 38.331 [28] format to the AMF (Network Function).
-	UEs, AMFs and RAN (Network Function) nodes which support RACS learn the current value of the Version ID when a new PLMN-assigned UE (Network Function) Radio Capability ID is received from the UCMF (Network Function) and the Version ID it contains is different from the ones in their PLMN Assigned UE (Network Function) Radio Capability ID cache. For a PLMN, PLMN-assigned UE (Network Function) Radio Capability IDs related to old values (i.e. not current value) of the Version ID can be removed from cache but, if so, prior to removing any cached PLMN-assigned UE (Network Function) radio Capability IDs with the current value of the Version ID. The AMF (Network Function), RAN (Network Function) and UE (Network Function) may continue to use the stored PLMN assigned UE (Network Function) Radio Capability IDs with old values of the Version ID, until these are purged from cache. If an out of date PLMN assigned UE (Network Function) Radio Capability ID is removed form an AMF (Network Function) cache, the AMF (Network Function) shall proceed to assign a new PLMN assigned UE (Network Function) Radio Capability ID to all the UEs for which the UE (Network Function) context includes the removed PLMN-assigned UE (Network Function) Radio Capability ID using a UE (Network Function) Configuration Update procedure, or when these UEs perform a Registration. If the AMF (Network Function) attempts to resolve a PLMN assigned UE (Network Function) Radio capability ID with an old Version ID, the UCMF (Network Function) shall return an error code indicating that the Version ID in the UE (Network Function) radio capability ID is no longer current and proceed to assign a new UE (Network Function) Radio Capability ID to the UE (Network Function).
	If at any time the AMF (Network Function) has neither a valid UE (Network Function) Radio Capability ID nor any stored UE (Network Function) radio capabilities for the UE (Network Function), the AMF (Network Function) may trigger the RAN (Network Function) to provide the UE (Network Function) Radio Capability information and subsequently request the UCMF (Network Function) to allocate a UE (Network Function) Radio Capability ID.
-	The RAN (Network Function), in order to support MOCN network sharing scenarios, shall be capable to cache PLMN assigned UE (Network Function) Radio Capability IDs per PLMN ID.
A network may utilise the PLMN-assigned UE (Network Function) Radio Capability ID, without involving the UE (Network Function), e.g. for use with legacy UEs.
Mutual detection of the support of the RACS feature happens between directly connected NG-RAN (Network Function) nodes and between NG-RAN (Network Function) and AMF (Network Function) using protocol means as defined in TS 38.413 [34] and TS 38.423 [99]. To allow for a mix of RACS-supporting and non-RACS-supporting RAN (Network Function) nodes over the Xn interfaces, the UE (Network Function) Radio Capability ID should be included in the Path Switch signalling during Xn based handover and Handover Request during N2 (Non-service-based Interface) (Service-based Interface) based handover between AMF (Network Function) and NG-RAN (Network Function). In addition, RACS-supporting RAN (Network Function) nodes can be discovered across inter-CN node boundaries by using the mechanism defined in TS 38.413 [34] that allows the source NG-RAN (Network Function) node to retrieve information on the level of support for a certain feature at the target NG-RAN (Network Function) side by means of information provided within the Source to Target and Target to Source transparent handover containers during handover procedure. The support of RACS by peer AMFs or MMEs is based on configuration in a PLMN or across PLMNs.
A UE (Network Function) that supports WB-E-UTRA and/or NR indicates its support for RACS to AMF (Network Function) using UE (Network Function) MM Core Network Capability as defined in clause 5.4.4a.
A UE (Network Function) that supports RACS and stores an applicable UE (Network Function) Radio Capability ID for the current UE (Network Function) Radio Configuration in the PLMN, shall signal the UE (Network Function) Radio Capability ID in the Initial, and Mobility Registration procedure as defined in TS 23.502 [3] and based on triggers defined in TS 24.501 [47]. If both PLMN-assigned for the current PLMN and UE (Network Function) manufacturer-assigned UE (Network Function) Radio Capability IDs are stored in the UE (Network Function) and applicable in the PLMN, the UE (Network Function) shall signal the PLMN-assigned UE (Network Function) Radio Capability ID in the Registration Request message.
When a PLMN decides to switch to request a particular type of UE (Network Function) to use UE (Network Function) manufacturer-assigned UE (Network Function) Radio Capability ID(s):
-	The UCMF (Network Function) sends a Nucmf_UECapabilityManagement_Notify message to the AMF (Network Function) including either a list of UE (Network Function) Radio Capability IDs (if the UE (Network Function) was previously using any PLMN-assigned IDs) or the IMEI/TAC values corresponding to UE (Network Function) types that are requested to use UE (Network Function) manufacturer-assigned UE (Network Function) Radio Capability ID. These values are stored in a "UE (Network Function) Manufacturer Assigned operation requested list" in the AMF (Network Function).
-	The AMF (Network Function) uses the Registration Accept message or the UE (Network Function) Configuration Update command message to request the UE (Network Function) to delete all the PLMN-assigned UE (Network Function) Radio Capability ID(s) for this PLMN if the UE (Network Function) is, respectively, registering or is registered with PLMN-assigned ID or IMEI/TAC values matching one value in the "UE (Network Function) Manufacturer Assigned operation requested list".
NOTE 1:	It is expected that in a given PLMN the UCMF (Network Function) and AMFs will be configured to either use a UE (Network Function) manufacturer-assigned operation requested list based on a list of PLMN-assigned UE (Network Function) Radio Capability IDs or a list of IMEI/TACs, but not both.
NOTE 2:	The strategy for triggering of the deletion of PLMN-assigned UE (Network Function) Radio Capability ID(s) in the UE (Network Function) by the AMF (Network Function) is implementation-specific (e.g. can be used only towards UEs in CM-CONNECTED state).
-	a UE (Network Function) that receives indication to delete all the PLMN-assigned UE (Network Function) Radio Capability IDs in the Registration Accept message, or UE (Network Function) Configuration Update command message, shall delete any PLMN-assigned UE (Network Function) Radio Capability IDs for this PLMN. The UE (Network Function) proceeds to register with a UE (Network Function) manufacturer-assigned UE (Network Function) Radio Capability ID that is applicable to the current UE (Network Function) Radio configuration.
-	When the "UE (Network Function) Manufacturer Assigned operation requested list" contains PLMN-assigned UE (Network Function) Radio Capability IDs, the UCMF (Network Function) shall avoid re-assigning PLMN-assigned UE (Network Function) Radio Capability IDs that were added to the "UE (Network Function) Manufacturer Assigned operation requested list" in the AMFs to any UE (Network Function).
-	The AMF (Network Function) stores a PLMN-assigned ID in the "UE (Network Function) Manufacturer Assigned operation requested list" for a time duration that is implementation specific, but IMEI/TACs are stored until the UCMF (Network Function) require to remove certain TACs from the list (i.e. the list of IMEI/TACs which are requested to use UE (Network Function) manufacturer-assigned IDs in the AMF (Network Function) and UCMF (Network Function) is synchronised at all times).
-	The UCMF (Network Function) can request at any time the AMF (Network Function) to remove PLMN-assigned ID(s) or IMEI/TAC(s) values from the UE (Network Function) manufacturer-assigned operation requested list.
NOTE 3:	The AMF (Network Function) can decide to remove a UE (Network Function) Radio Capability ID from the "UE (Network Function) Manufacturer Assigned operation requested list" list e.g. because no UE (Network Function) with that UE (Network Function) Radio Capability ID has connected to the network for long time. If later a UE (Network Function) with such UE (Network Function) Radio Capability ID connects to the network, the AMF (Network Function) contacts the UCMF (Network Function) to resolve the UE (Network Function) Radio Capability ID, and at this point the UCMF (Network Function) can trigger again the deletion of the UE (Network Function) Radio Capability ID by including this in the "UE (Network Function) Manufacturer Assigned operation requested list" of the AMF (Network Function).
The serving AMF (Network Function) stores the UE (Network Function) Radio Capability ID related to selected PLMN for a UE (Network Function) in the UE (Network Function) context and provides this UE (Network Function) Radio Capability ID to NG-RAN (Network Function) as part of the UE (Network Function) context information using N2 (Non-service-based Interface) (Service-based Interface) signalling. During inter PLMN mobility, the new AMF (Network Function) shall delete the UE (Network Function) Radio Capability ID received from the old AMF (Network Function), unless the operator policy indicates that all UE (Network Function) Radio Capability IDs used in the old PLMN is also valid in the new PLMN.
NOTE 4:	If AMF (Network Function) decides to allocate TAIs of multiple PLMN IDs as part of Registration Area to the UE (Network Function) then AMF (Network Function) provides the UE (Network Function) Radio Capability ID of the new selected PLMN to the NG-RAN (Network Function) during UE (Network Function) mobility, whether the UE (Network Function) Radio Capability ID is taken from stored UE (Network Function) context previously assigned by the same new selected PLMN or generated freshly each time a new PLMN is selected is up to AMF (Network Function) implementation.
The UE (Network Function) stores the PLMN-assigned UE (Network Function) Radio Capability ID in non-volatile memory when in RM-DEREGISTERED state and can use it again when it registers in the same PLMN.
NOTE 5:	It is assumed that UE (Network Function) does not need to store the access stratum information (i.e. UE (Network Function)-E-UTRA-Capability and UE (Network Function)-NR-Capability specified in TS 36.331 [51] and TS 38.331 [28], respectively) that was indicated by the UE (Network Function) to the network when the PLMN-assigned UE (Network Function) Radio Capability ID was assigned by the network. However, it is assumed that the UE (Network Function) does store the related UE (Network Function) configuration (e.g. whether or not GERAN or UTRAN or MBMS is enabled/disabled).
At any given time at most one UE (Network Function) Radio Capability ID is used from the UE (Network Function) context in CN and RAN (Network Function) which is related to the selected PLMN.
The number of PLMN-assigned UE (Network Function) Radio Capability IDs that the UE (Network Function) stores in non-volatile memory is left up to UE (Network Function) implementation. However, to minimise the load (e.g. from radio signalling) on the Uu interface and to provide smoother inter-PLMN mobility (e.g. at land borders) the UE (Network Function) shall be able to store at least the latest 16 PLMN-assigned UE (Network Function) Radio Capability IDs (along with the PLMN that assigned them). This number is independent of the UE (Network Function) manufacturer-assigned UE (Network Function) Radio Capability ID(s) the UE (Network Function) may store.
It shall be possible for a UE (Network Function) to change, e.g. upon change in its usage settings, the set of UE (Network Function) radio capabilities in time and signal the associated UE (Network Function) Radio Capability ID, if available. The UE (Network Function) stores the mapping between the UE (Network Function) Radio Capability ID and the corresponding UE (Network Function) Radio Capability Information for every UE (Network Function) Radio Capability ID it stores.
If the UE (Network Function)'s Radio Capability Information changes and regardless of whether the UE (Network Function) has an associated UE (Network Function) Radio Capability ID for the updated UE (Network Function) Radio Capability information, the UE (Network Function) shall perform the Registration procedure by sending a Registration Request message to the AMF (Network Function) with the Registration type set to Mobility Registration Update which includes "UE (Network Function) Radio Capability Update" and:
-	If the UE (Network Function) has an associated UE (Network Function) Radio Capability ID for the updated UE (Network Function) Radio Capability information, the UE (Network Function) shall include it in the Registration Request message so that the AMF (Network Function), upon receiving it, shall update the UE (Network Function)'s context with this UE (Network Function) Radio Capability ID.
-	If the UE (Network Function) does not have an associated UE (Network Function) Radio Capability ID for the updated UE (Network Function) Radio Capability information, the UE (Network Function) shall not include any UE (Network Function) Radio Capability ID in the Registration Request message so that the AMF (Network Function), upon receiving this Registration Request without any UE (Network Function) Radio Capability ID, retrieves the UE (Network Function) radio capabilities from the UE (Network Function) as defined in clause 5.4.4.1.
The NG-RAN (Network Function) may apply RRC (Protocol) filtering of UE (Network Function) radio capabilities when it retrieves the UE (Network Function) Radio Capability Information from the UE (Network Function) as defined in TS 38.331 [28].
NOTE 6:	In a RACS supporting PLMN, the filter of UE (Network Function) radio capabilities configured in NG-RAN (Network Function) is preferably as wide in scope as possible (e.g. PLMN-wide). In this case, it corresponds e.g. to the super-set of bands, band-combinations and RATs the PLMN deploys and not only to the specific NG-RAN (Network Function) node or region.
NOTE 7:	If the filter, included in the UE (Network Function) Radio Capability information, of UE (Network Function) radio capabilities configured in two NG-RAN (Network Function) nodes is different, during handover between these two nodes, it is possible that the target NG-RAN (Network Function) node might need to enquire the UE (Network Function) for its UE (Network Function) Radio Capability Information again and trigger re-allocation of a PLMN-assigned UE (Network Function) Radio Capability ID leading to extra signalling. Additionally, a narrow filter might reduce the list of candidate target nodes.
If a UE (Network Function) supports both NB-IoT and other RATs that do support RACS (e.g. WB-E-UTRA and/or NR) then (since there is no support for RACS in NB-IoT) the UE (Network Function) handles the RACS procedures as follows:
-	NB-IoT specific UE (Network Function) Radio Capability Information is handled in UE (Network Function), NG-RAN (Network Function) and AMF (Network Function) according to clause 5.4.4.1 and in EPS according to TS 23.401 [26].
-	when the UE (Network Function) is not camping on NB-IoT, the RAN (Network Function) provides UE (Network Function) radio capabilities for other RATs but not NB-IoT UE (Network Function) radio capabilities, according to TS 38.300 [27] and TS 36.300 [30]. As a result the UE (Network Function) Radio Capability ID that is assigned by the network corresponds only to the UE (Network Function) radio capabilities of the non-NB-IoT RATs. The UE (Network Function) uses the UE (Network Function) Radio Capability IDs assigned only in Mobility Registration Update procedures performed over non-NB-IoT RATs.
Support for RACS in EPS is defined in TS 23.401 [26].

5.4.4.2a	UE (Network Function) Radio Capability Match Request
If the AMF (Network Function) requires more information on the UE (Network Function) radio capabilities support to be able to set the IMS voice over PS Session Supported Indication (see clause 5.16.3), then the AMF (Network Function) may send a UE (Network Function) Radio Capability Match Request message to the NG-RAN (Network Function). This procedure is typically used during the Registration Procedure or when AMF (Network Function) has not received the Voice Support Match Indicator (as part of the 5GMM Context).
NOTE:	During the Registration Procedure, if the AMF (Network Function) does not already have the UEs radio capabilities, and if the RAT where the UE (Network Function) is requires the establishment of AN security context prior to retrieval of radio capabilities, the AMF (Network Function) needs to initiate "Initial Context Setup" procedure as defined in TS 38.413 [34] to provide the 5G-AN with security context, before sending a UE (Network Function) Radio Capability Match Request message.
The paging assistance information contains UE (Network Function) radio related information that assists the RAN (Network Function) for efficient paging. The Paging assistance information contains:
a)	UE (Network Function) radio capability for paging information:
-	The UE (Network Function) Radio Capability for Paging Information contains information derived by the NG-RAN (Network Function) node (e.g. band support information) from the UE (Network Function) Radio Capability information. The AMF (Network Function) stores this information without needing to understand its contents.
	As the AMF (Network Function) only infrequently (e.g. at Initial Registration) prompts the NG-RAN (Network Function) to retrieve and upload the UE (Network Function) radio capabilities i.e. UE (Network Function) Radio Capability information to the AMF (Network Function), and the AMF (Network Function) may be connected to more than one NG-RAN (Network Function) RAT, it is the responsibility of the NG-RAN (Network Function) to ensure that UE (Network Function) Radio Capability for Paging Information (which is derived by the NG-RAN (Network Function) node) contains information on all NG-RAN (Network Function) RATs that the UE (Network Function) supports in that PLMN. To assist the NG-RAN (Network Function) in this task, as specified in TS 38.413 [34], the AMF (Network Function) provides its stored UE (Network Function) Radio Capability for Paging Information in every NG-AP (Protocol)  (Protocol)INITIAL CONTEXT SETUP REQUEST message sent to the NG-RAN (Network Function).
-	The UE (Network Function) Radio Capability for Paging Information is maintained in the core network, even during AMF (Network Function) reselection, and is stored in the UCMF (Network Function) alongside the UE (Network Function) Radio Capability information associated to a UE (Network Function) Radio Capability ID.
b)	Information On Recommended Cells And RAN (Network Function) nodes For Paging:
-	Information sent by the NG-RAN (Network Function), and used by the AMF (Network Function) when paging the UE (Network Function) to help determining the NG RAN (Network Function) nodes to be paged as well as to provide the information on recommended cells to each of these RAN (Network Function) nodes, in order to optimize the probability of successful paging while minimizing the signalling load on the radio path.
-	The RAN (Network Function) provides this information during N2 (Non-service-based Interface) (Service-based Interface) release.
5.4.4a	UE (Network Function) MM Core Network Capability handling
The UE (Network Function) MM Core Network Capability is split into the S1 UE (Network Function) network capability (mostly for E-UTRAN access related core network parameters) and the UE (Network Function) 5GMM Core Network Capability (mostly to include other UE (Network Function) capabilities related to 5GCN or interworking with EPS) as defined in TS 24.501 [47] and contains non radio-related capabilities, e.g. the NAS (Protocol) security algorithms, etc. The S1 UE (Network Function) network capability is transferred between all CN nodes at AMF (Network Function) to AMF (Network Function), AMF (Network Function) to MME, MME to MME, and MME to AMF (Network Function) changes. The UE (Network Function) 5GMM Core Network Capability is transferred only at AMF (Network Function) to AMF (Network Function) changes.
In order to ensure that the UE (Network Function) MM Core Network Capability information stored in the AMF (Network Function) is up to date (e.g. to handle the situation when the USIM is moved into a different device while out of coverage, and the old device did not send the Detach message; and the cases of inter-RAT Registration Area Update), the UE (Network Function) shall send the UE (Network Function) MM Core Network Capability information to the AMF (Network Function) during the Initial Registration and Mobility Registration Update procedure within the NAS (Protocol) message.
The AMF (Network Function) shall store always the latest UE (Network Function) MM Core Network Capability received from the UE (Network Function). Any UE (Network Function) MM Core Network Capability that an AMF (Network Function) receives from an old AMF (Network Function)/MME is replaced when the UE (Network Function) provides the UE (Network Function) MM Core Network Capability with Registration signalling.
If the UE (Network Function)'s UE (Network Function) MM Core Network Capability information changes (in either CM-CONNECTED or in CM-IDLE state), the UE (Network Function) shall perform a Mobility Registration Update procedure when it next returns to NG-RAN (Network Function) coverage. See clause 4.2.2 of TS 23.502 [3].
The UE (Network Function) shall indicate in the UE (Network Function) 5GMM Core Network Capability if the UE (Network Function) supports:
-	Attach in EPC with Request type "Handover" in PDN CONNECTIVITY Request message (clause 5.3.2.1 of TS 23.401 [26]).
-	EPC NAS (Protocol).
-	SMS over NAS (Protocol).
-	LCS.
-	5G SRVCC from NG-RAN (Network Function) to UTRAN, as specified in TS 23.216 [88].
-	Radio Capabilities Signalling optimisation (RACS).
-	Network Slice-Specific Authentication and Authorization.
-	Network Slice Replacement as described in clause 5.15.19.
-	Parameters in Supported Network Behaviour for 5G CIoT as described in clause 5.31.2.
-	Receiving WUS Assistance Information (E-UTRA) see clause 5.4.9.
-	Paging Subgrouping Support Indication (NR) see clause 5.4.12.
-	CAG, see clause 5.30.3.3.
-	CAG with validity information (if UE (Network Function) supports CAG), see clause 5.30.3.3.
-	Subscription-based restrictions to simultaneous registration of network slices (see clause 5.15.12).
-	Support of NSAG (see clause 5.15.14).
-	Partial Network Slice support in a RA (see clause 5.15.17).
-	Minimization of Service Interruption (MINT), as described in clause 5.40.
-	Equivalent SNPNs (see clause 5.30.2.11).
-	Unavailability Period, as described in clause 5.4.1.4.
-	Support for network reconnection due to RAN (Network Function) timing synchronization status change, see clause 5.3.4.4.
-	UE (Network Function) Configuration of network-controlled Slice Usage Policy (see clause 5.15.15.2).
-	Temporarily available network slices (see clause 5.15.16).
-	Support of S-NSSAI location availability information, as described in clause 5.15.18.2.
If a UE (Network Function) operating two or more USIMs, supports and intends to use one or more Multi-USIM features (see clause 5.38) in a PLMN for a USIM, it shall indicate in the UE (Network Function) 5GMM Core Network Capability for this USIM in this PLMN that it supports these one or more Multi-USIM features with the following indications:
-	Connection Release Supported.
-	Paging Cause Indication for Voice Service Supported.
-	Reject Paging Request Supported.
-	Paging Restriction Supported.
Otherwise, the UE (Network Function) with the capabilities of Multi-USIM features but does not intend to use them shall not indicate support of these one or more Multi-USIM features.
A UE (Network Function) not operating two or more USIMs shall indicate the Multi-USIM features are not supported.
NOTE:	It is not necessary for a UE (Network Function) operating two or more USIMs to use Multi-USIM features with all USIMs.
5.4.4b	UE (Network Function) 5GSM Core Network Capability handling
The UE (Network Function) 5GSM Core Network Capability is included in PDU Session Establishment/Modification Request.
The UE (Network Function) shall indicate in the UE (Network Function) 5GSM Core Network Capability whether the UE (Network Function) supports:
-	"Ethernet" PDU Session Type supported in EPC as PDN Type "Ethernet";
-	Reflective QoS;
-	Multi-homed IPv6 PDU Session (only if the Requested PDU Type was set to "IPv6" or "IPv4v6");
-	ATSSS capability (as referred to clause 5.32.2);
-	Transfer of Port Management Information containers.
The 5GSM Core Network Capability is transferred, if needed, from V-SMF (Network Function) to H-SMF (Network Function) during PDU Session Establishment/Modification procedure.
After the first inter-system change from EPS to 5GS for a PDU session established in EPS, the 5GSM Core Network Capability is also included in the PDU Session Modification if the Reflective QoS and/or Multi-homed IPv6 PDU Session is present.
The 5G System supports DRX architecture which allows Idle mode DRX cycle is negotiated between UE (Network Function) and the AMF (Network Function). The Idle mode DRX cycle applies in CM-IDLE state and in CM-CONNECTED with RRC_INACTIVE state.
If the UE (Network Function) wants to use UE (Network Function) specific DRX parameters, the UE (Network Function) shall include its preferred values consistently in every Initial Registration and Mobility Registration procedure separately for NR/WB-EUTRA and NB-IoT. During Initial Registration and Mobility Registration procedures performed on NB-IoT cells, the normal 5GS procedures apply. For NB-IoT, the cell broadcasts an indication of support of UE (Network Function) specific DRX for NB-IoT in that cell, and the UE (Network Function) can request UE (Network Function) specific DRX for NB-IoT in the Registration procedure irrespective of whether the cell broadcasts that support indication.
The AMF (Network Function) shall determine Accepted DRX parameters based on the received UE (Network Function) specific DRX parameters and the AMF (Network Function) should accept the UE (Network Function) requested values, but subject to operator policy the AMF (Network Function) may change the UE (Network Function) requested values.
The AMF (Network Function) shall respond to the UE (Network Function) with the Accepted DRX parameters separately for NR/WB-EUTRA and NB-IoT.
For details of DRX parameters, see TS 38.331 [28] and TS 36.331 [51].
The UE (Network Function) shall apply the DRX cycle broadcast in the cell by the RAN (Network Function) unless it has received Accepted DRX parameters for the RAT from the AMF (Network Function) and for NB-IoT the cell supports UE (Network Function) specific DRX for NB-IoT, in which case the UE (Network Function) shall apply either the DRX cycle broadcast in the cell or the Accepted DRX parameters for the RAT, as defined in TS 38.304 [50] and TS 36.304 [52].
The Periodic Registration procedure does not change the UE (Network Function)'s DRX settings.
In CM-CONNECTED with RRC_INACTIVE state, the UE (Network Function) applies either the DRX cycle negotiated with AMF (Network Function), or the DRX cycle broadcast by RAN (Network Function) or the UE (Network Function) specific DRX cycle configured by RAN (Network Function), as defined in TS 38.300 [27] and TS 38.304 [50].
Core Network assistance information for RAN (Network Function) aids the RAN (Network Function) to optimize the UE (Network Function) state transition steering and the RAN (Network Function) paging strategy formulation in RRC_INACTIVE state. The Core Network assistance information includes the information set, Core Network assisted RAN (Network Function) parameters tuning, which assist RAN (Network Function) optimize the UE (Network Function) RRC (Protocol) state transition and CM state transition decision. It also includes the information set, Core Network assisted RAN (Network Function) paging information, which assist RAN (Network Function) to formulate an optimized paging strategy when RAN (Network Function) paging is triggered.
Core Network assisted RAN (Network Function) parameters tuning aids the RAN (Network Function) to minimize the UE (Network Function) state transitions and achieve optimum network behaviour. How the RAN (Network Function) uses the CN assistance information is not defined in this specification.
Core Network assisted RAN (Network Function) parameters tuning may be derived by the AMF (Network Function) per UE (Network Function) in the AMF (Network Function) based on collection of UE (Network Function) behaviour statistics, Expected UE (Network Function) Behaviour and/or other available information about the UE (Network Function) (such as subscribed DNN, SUPI ranges, or other information). If the AMF (Network Function) maintains Expected UE (Network Function) Behaviour parameters, Network Configuration parameters (as described in clause 4.15.6.3 or 4.15.6.3a, TS 23.502 [3]) or SMF (Network Function) derived CN assisted RAN (Network Function) parameters tuning, the AMF (Network Function) may use this information for selecting the CN assisted RAN (Network Function) parameter values. If the AMF (Network Function) is able to derive the Mobility Pattern of the UE (Network Function) (as described in clause 5.3.4.2), the AMF (Network Function) may take the Mobility Pattern information into account when selecting the CN assisted RAN (Network Function) parameter values.
The SMF (Network Function) uses the SMF (Network Function)-Associated parameters (e.g. Expected UE (Network Function) Behaviour parameters or Network Configuration parameters of the UE (Network Function)) to derive the SMF (Network Function) derived CN assisted RAN (Network Function) parameters tuning. The SMF (Network Function) sends the SMF (Network Function) derived CN assisted RAN (Network Function) parameters tuning to the AMF (Network Function) during the PDU Session establishment procedure and if the SMF (Network Function)-Associated parameters change the PDU Session modification procedure is applied. The AMF (Network Function) stores the SMF (Network Function) derived CN assisted RAN (Network Function) parameters tuning in the PDU Session level context. The AMF (Network Function) uses the SMF (Network Function) derived CN assisted RAN (Network Function) parameters tuning to determine a PDU Session level "Expected UE (Network Function) activity behaviour" parameters set, which may be associated with a PDU Session ID, as described below in this clause.
The Expected UE (Network Function) Behaviour parameters or the Network Configuration parameters can be provisioned by external party via the NEF (Network Function) to the AMF (Network Function) or SMF (Network Function), as described in clause 5.20.
The CN assisted RAN (Network Function) parameters tuning provides the RAN (Network Function) with a way to understand the UE (Network Function) behaviour for these aspects:
-	"Expected UE (Network Function) activity behaviour", i.e. the expected pattern of the UE (Network Function)'s changes between CM-CONNECTED and CM-IDLE states or the duration of CM-CONNECTED state. This may be derived e.g. from the statistical information, or Expected UE (Network Function) Behaviour or from subscription information. The AMF (Network Function) derives one or more sets of the "Expected UE (Network Function) activity behaviour" parameters for the UE (Network Function) as follows:
-	AMF (Network Function) may derive and provide to the RAN (Network Function) a UE (Network Function) level of "Expected UE (Network Function) activity behaviour" parameters set considering the Expected UE (Network Function) Behaviour parameters or Network Configuration parameters received from the UDM (Network Function) (see clauses 4.15.6.3 or 4.15.6.3a of TS 23.502 [3]) and the SMF (Network Function) derived CN assisted RAN (Network Function) parameters tuning associated with a PDU Session using Control Plane CIoT 5GS Optimisation. This set of "Expected UE (Network Function) activity behaviour" parameters is valid for the UE (Network Function); and
-	AMF (Network Function) may provide to the RAN (Network Function) a PDU Session level "Expected UE (Network Function) activity behaviour" parameters set, e.g. considering the SMF (Network Function) derived CN assisted RAN (Network Function) parameters tuning, per established PDU Session. The PDU Session level "Expected UE (Network Function) activity behaviour" set of parameters is associated with and valid for a PDU Session ID. The RAN (Network Function) may consider the PDU Session level "Expected UE (Network Function) activity behaviour" parameters when the User Plane resources for the PDU Session are activated;
-	"Expected HO behaviour", i.e. the expected interval between inter-RAN (Network Function) handovers. This may be derived by the AMF (Network Function) e.g. from the Mobility Pattern information;
-	"Expected UE (Network Function) mobility", i.e. whether the UE (Network Function) is expected to be stationary or mobile. This may be derived e.g. from the statistical information or Expected UE (Network Function) Behaviour parameters or from subscription information;
-	"Expected UE (Network Function) moving trajectory" which may be derived e.g. from the statistical information or Expected UE (Network Function) Behaviour parameters or from subscription information; or
-	"UE (Network Function) Differentiation Information" including the Expected UE (Network Function) Behaviour parameters excluding the Expected UE (Network Function) moving trajectory (see clause 4.15.6.3 of TS 23.502 [3]) to support Uu operation optimisation for NB-IoT UE (Network Function) differentiation if the RAT type is NB-IoT.
The AMF (Network Function) decides when to send this information to the RAN (Network Function) as "Expected UE (Network Function) activity behaviour" carried in N2 (Non-service-based Interface) (Service-based Interface) request over the N2 (Non-service-based Interface) (Service-based Interface) interface (see TS 38.413 [34]).
NOTE:	The calculation of the CN assistance information, i.e. the algorithms used and related criteria, and the decision when it is considered suitable and stable to send to the RAN (Network Function) are vendor specific.
Core Network assisted RAN (Network Function) paging information aids the RAN (Network Function) to formulate a RAN (Network Function) paging policy and strategy in RRC_INACTIVE state, besides the PPI and QoS information associated to the QoS Flows as indicated in clause 5.4.3.
CN assisted RAN (Network Function) paging information may be derived by the AMF (Network Function) per UE (Network Function) and/or per PDU Session based on collection of UE (Network Function) behaviour statistics, Expected UE (Network Function) Behaviour and/or other available information about the UE (Network Function) (such as subscribed DNN, SUPI ranges, Multimedia priority service), and/or information received from other network functions when downlink signalling is triggered.
The CN assisted RAN (Network Function) paging information consists of a service priority (values 1 to 256) which provides AN with a way to understand how important the downlink signalling is. The AMF (Network Function) derives this service priority based on available information as described above. The method to derive the service priority is implementation depended and can be controlled by operator.
The Core Network may provide the CN assisted RAN (Network Function) paging information to RAN (Network Function) in different occasions, e.g. during downlink N1 (Non-service-based Interface) (Service-based Interface) and N2 (Non-service-based Interface) (Service-based Interface) message delivery, etc.
NG-RAN (Network Function) supports the NG-RAN (Network Function) location reporting for the services that require accurate cell identification (e.g. emergency services, lawful intercept, charging) or for the UE (Network Function) mobility event notification service subscribed to the AMF (Network Function) by other NFs. The NG-RAN (Network Function) location reporting may be used by the AMF (Network Function) when the target UE (Network Function) is in CM-CONNECTED state. The NG-RAN (Network Function) location reporting may be used by the AMF (Network Function) to determine the geographically located TAI in the case of NR satellite access.
The AMF (Network Function) may request the NG-RAN (Network Function) location reporting with event reporting type (e.g. UE (Network Function) location or UE (Network Function) presence in Area of Interest), reporting mode and its related parameters (e.g. number of reporting).
If the AMF (Network Function) requests UE (Network Function) location, the NG-RAN (Network Function) reports the current UE (Network Function) location (or last known UE (Network Function) location with time stamp if the UE (Network Function) is in RRC_INACTIVE state) based on the requested reporting parameter (e.g. one-time reporting or continuous reporting).
If the AMF (Network Function) requests UE (Network Function) location, in the case of NR satellite access, the NG-RAN (Network Function) provides all broadcast TAIs to the AMF (Network Function) as part of the ULI. The NG-RAN (Network Function) also reports the TAI where the UE (Network Function) is geographically located if this TAI can be determined.
If the AMF (Network Function) requests UE (Network Function) presence in the Area Of Interest, the NG-RAN (Network Function) reports the UE (Network Function) location and the indication (i.e. IN, OUT or UNKNOWN) when the NG-RAN (Network Function) determines the change of UE (Network Function) presence in Area Of Interest.
After N2 (Non-service-based Interface) (Service-based Interface) based Handover, if the NG-RAN (Network Function) location reporting information is required, the AMF (Network Function) shall re-request the NG-RAN (Network Function) location reporting to the target NG-RAN (Network Function) node. For Xn based Handover, the source NG-RAN (Network Function) shall transfer the requested NG-RAN (Network Function) location reporting information to target NG-RAN (Network Function) node.
The AMF (Network Function) requests the location information of the UE (Network Function) either through independent N2 (Non-service-based Interface) (Service-based Interface) procedure (i.e. NG-RAN (Network Function) location reporting as specified in clause 4.10 of TS 23.502 [3]), or by including the request in some specific N2 (Non-service-based Interface) (Service-based Interface) messages as specified in TS 38.413 [34].
Support for NG-RAN (Network Function) using unlicensed spectrum is defined in TS 38.300 [27] and TS 36.300 [30].
For NG-RAN (Network Function), in the case of NR in stand-alone mode, all cells are in unlicensed spectrum and the NR is used as primary RAT. NR or E-UTRA cells in unlicensed spectrum, can be used as secondary cells as specified in the Dual Connectivity architecture defined in clause 5.11 or in addition can be configured to support the Carrier Aggregation Architecture (CA) defined in TS 38.300 [27] and TS 36.300 [30].
For either case the serving PLMN can enforce Access Restriction for Unlicensed Spectrum (either signalled from the UDM (Network Function), or, locally generated by VPLMN policy in the AMF (Network Function)) with the following:
-	To restrict the use of NR in unlicensed spectrum as primary RAT, the AMF (Network Function) rejects the UE (Network Function) Registration procedure with appropriate cause code defined in TS 24.501 [47] if the UE (Network Function) performs initial access from NR using unlicensed spectrum. If the UE (Network Function) is accessing through some other allowed RAT, the AMF (Network Function) signals this access restriction to NG-RAN (Network Function) as part of Mobility Restriction List.
-	To restrict the use of use of unlicensed spectrum with NR or E-UTRA as secondary RAT using Dual Connectivity or Carrier Aggregation Architecture (CA) defined in TS 38.300 [27] and TS 36.300 [30], the AMF (Network Function) signals this access restriction to NG-RAN (Network Function) as part of Mobility Restriction List.
An NG-RAN (Network Function) node supporting aggregation with unlicensed spectrum using either NR or E-UTRA checks whether the UE (Network Function) is allowed to use unlicensed spectrum based on received Mobility Restriction List. If the UE (Network Function) is not allowed to use Unlicensed Spectrum, the NG-RAN (Network Function) node shall restrict the using of unlicensed spectrum, either NR or E-UTRA as secondary RATs when using either Dual Connectivity or Carrier Aggregation (CA) as defined in TS 38.300 [27] and TS 36.300 [30].
At inter-RAT handover from E-UTRAN/EPS, the Access Restriction for Unlicensed Spectrum is either already in the AMF (Network Function)'s UE (Network Function) context, or is obtained from the UDM (Network Function) during the subsequent Registration Area Update procedure (i.e. not from the source MME or source RAN (Network Function)). In both inter-RAT handover cases, any Access Restriction for use of Unlicensed Spectrum is then signalled to NG-RAN (Network Function) or enforced in AMF (Network Function).
NOTE:	This signalling of the Access Restriction during the Registration Area Update after the inter-RAT handover procedure means that there is a small risk that unlicensed spectrum resources are transiently allocated.
When the UE (Network Function) is accessing 5GS using unlicensed spectrum as primary RAT:
-	The NG-RAN (Network Function) node shall provide an indication to the AMF (Network Function) in N2 (Non-service-based Interface) (Service-based Interface) interface that NR access is using unlicensed spectrum as defined in TS 38.413 [34].
-	In order to restrict access to NR in unlicensed spectrum, cells supporting NR in unlicensed spectrum have to be deployed in Tracking Area(s) different to cells supporting licensed spectrum.
-	When the AMF (Network Function) receives an indication from NG-RAN (Network Function) over N2 (Non-service-based Interface) (Service-based Interface) whether NR in unlicensed spectrum is being used as defined in TS 38.413 [34], the AMF (Network Function) provides to the SMF (Network Function) an indication that the RAT type is NR with usage of unlicensed spectrum during PDU Session Establishment or as part of the UP activation and Handover procedures.
-	The PCF (Network Function) will also receive the indication whether the UE (Network Function) is using NR in unlicensed spectrum, when applicable, from the SMF (Network Function) during SM Policy Association Establishment or SM Policy Association Modification procedure.
-	The NFs generating CDRs shall include the indication that the UE (Network Function) is using NR in unlicensed spectrum in their CDRs.
When the UE (Network Function) is accessing NR or E-UTRA using unlicensed spectrum as secondary RAT, procedures for Usage Data Reporting for Secondary RAT as defined in clause 5.12.2 can apply.
The RAN (Network Function) and UE (Network Function) may use a Wake Up Signal (WUS) to reduce the UE (Network Function)'s idle mode power consumption. The RAN (Network Function) sends the WUS shortly before the UE (Network Function)'s paging occasion. The WUS feature enables UEs to determine that in the paging occasions immediately following their WUS occasion they will not be paged if their WUS is not transmitted, or that they might be paged if their WUS is transmitted (see TS 36.304 [52]).
To avoid waking up UEs due to an AMF (Network Function) paging other UEs across multiple cells (e.g. due to frequent UE (Network Function) mobility and/or for low paging latency services such as VoLTE), the use of WUS by the ng-eNB and the UE (Network Function) is restricted to the last used cell, i.e. the cell in which the UE (Network Function)'s RRC (Protocol) connection was last released. To support this:
a)	ng-eNBs should provide the Recommended Cells for Paging IE in the Information on Recommended Cells and RAN (Network Function) Nodes for Paging IE (see TS 38.413 [34]) to the AMF (Network Function) in the NGAP UE (Network Function) Context Release Complete, UE (Network Function) Context Suspend Request and UE (Network Function) Context Resume Request messages;
b)	if received during the last NGAP UE (Network Function) Context Release Complete or UE (Network Function) Context Suspend Request message, the AMF (Network Function) provides (without modification) the Recommended Cells for Paging as Assistance Data for Recommended Cells IE in the Assistance Data for Paging IE within the NGAP Paging message to the RAN (Network Function) (see also TS 38.413 [34]); and
c)	the AMF (Network Function) shall delete (or mark as invalid) the Information On Recommended Cells And RAND nodes For Paging when a new NGAP association is established for the UE (Network Function).
In the NGAP Paging message, the last used cell ID is sent in the Assistance Data for Recommended Cells IE in the Assistance Data for Paging IE (see TS 38.413 [34]). When receiving an NGAP Paging message for a WUS-capable UE (Network Function) that also includes the Assistance Data for Recommended Cells IE then a WUS-capable ng-eNB shall only broadcast the WUS on the cell that matches the last used cell ID.
To support the Wake Up Signal (WUS), the WUS Assistance Information is used by the ng-eNB to help determine the WUS group used when paging the UE (Network Function) (see TS 36.300 [30]).
The content of the WUS Assistance Information consists of the paging probability information. The paging probability information provides a metric on the probability of a UE (Network Function) receiving a paging message based on, e.g. statistical information.
The UE (Network Function) may in the Registration Request message provide its capability to support receiving WUS Assistance Information. If WUS Assistance Information is supported by the UE (Network Function), then the UE (Network Function) in the Registration Request message may provide the additional UE (Network Function) paging probability information. The AMF (Network Function) may use the UE (Network Function) provided paging probability, local configuration and/or previous statistical information for the UE (Network Function), when determining the WUS Assistance Information. If the UE (Network Function) supports WUS Assistance Information, the AMF (Network Function) may assign WUS Assistance Information to the UE (Network Function), even when the UE (Network Function) has not provided the additional UE (Network Function) paging probability information.
If the AMF (Network Function) has determined WUS Assistance Information for the UE (Network Function), the AMF (Network Function) provides it to the UE (Network Function) in every Registration Accept message. The AMF (Network Function) stores the WUS Assistance Information parameter in the MM context and provides it to the ng-eNB when paging the UE (Network Function).
UE (Network Function) and AMF (Network Function) shall not signal WUS Assistance Information in Registration Request, Registration Accept messages when the UE (Network Function) has an active emergency PDU session.
Support for NR satellite access is specified in TS 38.300 [27].
Editor's note:	TS 38.300 [27] not yet updated by RAN (Network Function) groups.
The AMF (Network Function) determines the RAT Type for NR satellite access, i.e. NR(LEO), NR(MEO), NR(GEO) and NR(OTHERSAT). When the UE (Network Function) is accessing NR using satellite access, an indication is provided in N2 (Non-service-based Interface) (Service-based Interface) interface indicating the type of NR satellite access, as defined in TS 38.413 [34].
Editor's note:	Further details on what type of satellite platforms OTHERSAT includes is FFS and to be aligned with RAN (Network Function) WG3.
The serving PLMN can enforce mobility restrictions for NR satellite access as specified in clause 5.3.4.1.
In order to enable efficient enforcement of Mobility Restrictions, cells of each NR satellite RAT Type (NR(LEO), NR(MEO), NR(GEO) or NR(OTHERSAT)) need to be deployed in TAs different from TAs for other NR satellite RAT Types as well as different from TAs supporting terrestrial access RAT Types.
The AMF (Network Function) may initiate deregistration of the UE (Network Function) when an N2 (Non-service-based Interface) (Service-based Interface) UE (Network Function) Context Release Request is received with cause value indicating that the UE (Network Function) is not in PLMN serving area, as specified in TS 38.413 [34].
This clause describes the specific aspects for NR satellite access.
In case of NR satellite access, the RAT Types values "NR(LEO)", "NR(MEO)", "NR(GEO)" and "NR(OTHERSAT)" are used in 5GC to distinguish the different NR satellite access types (see clause 5.4.10).
When a UE (Network Function) is accessing to the network via satellite access, the AMF (Network Function) determines the RAT type as specified in clause 5.4.10.

In order to ensure that the regulatory requirements are met, the network may be configured to enforce that the selected PLMN is allowed to operate in the current UE (Network Function) location by verifying the UE (Network Function) location during Mobility Management and Session Management procedures. In this case, when the AMF (Network Function) receives a NGAP message containing User Location Information for a UE (Network Function) using NR satellite access, the AMF (Network Function) may decide to verify the UE (Network Function) location. If the AMF (Network Function) determines based on the Selected PLMN ID and ULI (including Cell ID) received from the gNB that it is not allowed to operate at the present UE (Network Function) location the AMF (Network Function) should reject any NAS (Protocol) request with a suitable cause value. If the UE (Network Function) is already registered to the network when the AMF (Network Function) determines that it is not allowed to operate at the present UE (Network Function) location, the AMF (Network Function) may initiate deregistration of the UE (Network Function). The AMF (Network Function) should not reject the request or deregister the UE (Network Function) unless it has sufficiently accurate UE (Network Function) location information to determine that the UE (Network Function) is located in a geographical area where the PLMN is not allowed to operate.
NOTE:	The area where the UE (Network Function) is allowed to operate can be determined based on the regulatory area where the PLMN is allowed to operate based on its licensing conditions.
If the AMF (Network Function), based on the ULI, is not able to determine the UE (Network Function)'s location with sufficient accuracy to make a final decision or if the received ULI is not sufficiently reliable, the AMF (Network Function) proceeds with the Mobility Management or Session Management procedure and may initiate UE (Network Function) location procedure after the Mobility Management or Session Management procedure is complete, as specified in clause 6.10.1 of TS 23.273 [87], to determine the UE (Network Function) location. The AMF (Network Function) shall be prepared to deregister the UE (Network Function) if the information received from LMF (Network Function) indicates that the UE (Network Function) is registered to a PLMN that is not allowed to operate in the UE (Network Function) location. In the case of a NAS (Protocol) procedure, the AMF (Network Function) should either reject any NAS (Protocol) request targeted towards a PLMN that is not allowed to operate in the known UE (Network Function) location and indicate a suitable cause value, or accept the NAS (Protocol) procedure and initiate deregistration procedure once the UE (Network Function) location is known. In the deregistration message to the UE (Network Function), the AMF (Network Function) shall include a suitable cause value. For UE (Network Function) processing of the cause value indicating that the PLMN is not allowed to operate in the current UE (Network Function) location, see TS 23.122 [17] and TS 24.501 [47].
In the case of a handover procedure, if the (target) AMF (Network Function) determines that it is not allowed to operate at the current UE (Network Function) location, the AMF (Network Function) either rejects the handover, or accepts the handover and later deregisters the UE (Network Function).
Network selection principles specified in clause 5.2.2 apply also for NR satellite access.
For NR satellite access, a UE (Network Function) with location capability should use its awareness of its location to select a PLMN that is allowed to operate in the UE (Network Function) location as specified in TS 23.122 [17].
In order to ensure that the regulatory requirements are met, the network may be configured to enforce this UE (Network Function) choice by verifying the UE (Network Function) location, as described in clause 5.4.11.4.
A moving radio cell for NR satellite access may indicate support for one or more TACs for each PLMN. A UE (Network Function) that is registered with a PLMN may access a radio cell and does not need to perform a Mobility Registration Update procedure as long as at least one supported TAC for the RPLMN or equivalent to the RPLMN is part of the UE (Network Function) Registration Area. A UE (Network Function) shall perform a Mobility Registration Update procedure when accessing a radio cell where none of the supported TACs for the RPLMN or equivalent to the RPLMN are part of the UE (Network Function) Registration Area.
When indicating a last visited TAI in a Registration Update, a UE (Network Function) may indicate any TAI supported in a radio cell for the RPLMN or equivalent to the RPLMN for the last UE (Network Function) access prior to the Registration Update that is part of the UE (Network Function) Registration Area.
Editor's note:	References to RAN (Network Function) TSs are needed after RAN (Network Function) WGs have further progressed their work on TA handling in NTN.
In the case of NR satellite access with moving cells, in order to ensure that each TA is Earth-stationary even if the radio cells are moving across the Earth's surface, the NG-RAN (Network Function) may change the TAC values that are broadcast in a cell's system information as the cell moves, as described in TS 38.331 [28].
NG-RAN (Network Function) may broadcast in a cell a single TAC per PLMN and change that TAC value as the cell moves. Alternatively, the NG-RAN (Network Function) may broadcast in a cell more than one TAC for a PLMN and add or remove TAC values as the cell moves. The NG-RAN (Network Function) provides either the single broadcast TAI or all broadcast TAIs corresponding to the Selected PLMN as described in TS 38.413 [34] to the AMF (Network Function) as part of the ULI, whenever the ULI is included in the NGAP message as described in TS 38.413 [34]. The NG-RAN (Network Function) indicates, if known, also the TAI where the UE (Network Function) is geographically located.
NOTE:	The AMF (Network Function) may take the TAI where the UE (Network Function) is geographically located into account to generate a suitable Registration Area for the UE (Network Function).
Forbidden Area functionality is supported as described in clause 5.3.4.1.1 with the modifications described below:
-	The AMF (Network Function) and the UE (Network Function) receive the broadcast TAI (if a single TAI is broadcast) or all broadcast TAIs (if multiple TAIs are broadcast) from the NG-RAN (Network Function) as described clause 5.4.11.7. The AMF (Network Function) considers the UE (Network Function) to be in a Forbidden Area if the only received TAI is forbidden or if all received TAIs are forbidden based on subscription data. The UE (Network Function) considers it is in a Forbidden Area if the only received TAI is forbidden, or if all received TAIs are forbidden and is not within a Forbidden Area in the case that at least one broadcast TAI is not forbidden.
-	If AMF (Network Function) receives multiple TAIs from the NG-RAN (Network Function) and determines that some, but not all of them are forbidden by subscription or by operator policy, the AMF (Network Function) shall send the forbidden TAI(s) to the UE (Network Function) as described in clauses 4.2.2.2 and 4.2.3 in TS 23.502 [3]. The UE (Network Function) stores the TAI(s) in the appropriate Forbidden Area list and removes the TAI(s) from Registration Area if present.
Service Area Restrictions functionality is supported as described in clause 5.3.4.1.2 with the modifications described below:
-	The AMF (Network Function) receives the broadcast TAI (if a single TAI is broadcast) or all broadcast TAIs (if multiple TAIs are broadcast) from the NG-RAN (Network Function) as described clause 5.4.11.7. The AMF (Network Function) provides the UE (Network Function) with Service Area Restrictions which consist of either Allowed Areas or Non-Allowed Areas, as described in clause 5.3.4.1.2. The UE (Network Function) and AMF (Network Function) consider the UE (Network Function) to be in a Non-Allowed Area if none of the broadcast TAIs is Allowed. The UE (Network Function) and AMF (Network Function) consider the UE (Network Function) to be in an Allowed Area if at least one broadcast TAI is allowed.
The RAN (Network Function) and UE (Network Function) may use a Paging Early Indication with Paging Subgrouping (PEIPS) to reduce the UE (Network Function)'s power consumption in RRC_IDLE and RRC_INACTIVE over NR (see TS 38.304 [50]).
The paging subgrouping can be based on either the UE (Network Function)'s temporary ID or a Paging Subgroup ID allocated by the AMF (Network Function). Paging subgrouping based on the UE (Network Function)'s temporary ID is implemented within the NG-RAN (Network Function). For paging subgrouping based on UE (Network Function)'s temporary ID, the UE (Network Function)'s support is included in the UE (Network Function) Radio Capability for Paging, either derived by the NG-RAN (Network Function) from UE (Network Function) provided UE (Network Function) radio capability (see clause 5.4.4) or based on UE (Network Function) Radio Capability ID if UE (Network Function) radio capability signalling optimisation is used (see clause 5.4.4.1a).
The AMF (Network Function), when determining its paging strategy (see clause 5.4.3), should take into consideration whether a gNB is using Paging subgrouping based on the UE (Network Function)'s temporary ID.
NOTE:	Paging messages sent to that gNB can increase UE (Network Function) power consumption for other UEs that support Paging Subgrouping based on the UE (Network Function)'s temporary ID.
If paging subgroups are being allocated by the AMF (Network Function), then all AMFs connected to one gNB (including the AMFs in different PLMNs using 5G MOCN network sharing) shall use a consistent policy in allocating UEs to the paging subgroups. The AMF (Network Function) may configure up to 8 different Paging Subgroup IDs.
NOTE:	Because the UE (Network Function) uses the AMF (Network Function) allocated paging subgroup across all cells in its TAI-list, and, different, overlapping TAI lists can be allocated to different UEs, then to avoid UE (Network Function) power consumption increasing, it is likely to be necessary that all AMFs with an overlapping coverage area use a consistent policy in allocating UEs to the paging subgroups.
The NG-RAN (Network Function) node and the UE (Network Function) determine per cell which paging subgrouping method to use as defined in TS 38.304 [50] and TS 38.331 [28].
To support the Paging Early Indication with Paging Subgrouping (PEIPS), Paging Subgrouping Support Indication and the PEIPS Assistance Information is used by the AMF (Network Function) and NG-RAN (Network Function) to help determine whether PEIPS applies to the UE (Network Function) and which paging subgroup used when paging the UE (Network Function) (see TS 38.300 [27]).
In the Registration Request message, the Paging Subgrouping Support Indication indicates whether the UE (Network Function) supports PEIPS with AMF (Network Function) PEIPS Assistance Information. If the UE (Network Function) includes Paging Subgrouping Support Indication, the UE (Network Function) may also include the paging probability information to assist the AMF (Network Function). If the AMF (Network Function) supports PEIPS assistance and if the UE (Network Function) provided Paging Subgrouping Support Indication, the AMF (Network Function) stores the indication in the UE (Network Function) context in AMF (Network Function). The AMF (Network Function) may use local configuration, the UE (Network Function)'s paging probability information if provided, information provided by the RAN (Network Function) (e.g. any of the Information On Recommended Cells And RAN (Network Function) nodes For Paging), and/or previous statistical information for the UE (Network Function) to determine the AMF (Network Function) PEIPS Assistance Information. The AMF (Network Function) PEIPS Assistance Information includes the Paging Subgroup ID.
NOTE 1:	To minimise MT voice call setup latency, the AMF (Network Function) could allocate Paging Subgroup IDs taking into account whether or not the UE (Network Function) is likely to receive IMS voice over PS session calls.
NOTE 2:	To avoid MT traffic for more mobile UEs causing more stationary UEs to be woken up, the AMF (Network Function) could allocate Paging Subgroup IDs taking into account the UE (Network Function)'s mobility pattern.
If the AMF (Network Function) has determined AMF (Network Function) PEIPS Assistance Information for the UE (Network Function), the AMF (Network Function) stores it in the UE (Network Function) context in AMF (Network Function) and provides it to the UE (Network Function) in every Registration Accept message.
If the AMF (Network Function) has determined AMF (Network Function) PEIPS Assistance Information, the AMF (Network Function) shall provide it to NG RAN (Network Function) when paging the UE (Network Function). In addition, in order to support PEIPS for UEs in RRC_INACTIVE mode, the AMF (Network Function) shall provide the AMF (Network Function) PEIPS Assistance Information to NG-RAN (Network Function) as part of the RRC (Protocol) Inactive Assistance Information.
The NG-RAN (Network Function) chooses on a per-cell basis whether to use PEIPS and which paging subgrouping mechanism to use. When using AMF (Network Function) allocated subgroups, both the UE (Network Function) and NG-RAN (Network Function) use the AMF (Network Function) PEIPS Assistance Information to determine the paging subgroup to apply as defined in TS 38.300 [27].
The AMF (Network Function) may use the UE (Network Function) Configuration Update procedure (as described in clause 4.2.4 of TS 23.502 [3]) and N2 (Non-service-based Interface) (Service-based Interface) UE (Network Function) Context Modification procedure (as described in clause 8.3.4 of TS 38.413 [34]) to update the AMF (Network Function) PEIPS Assistance Information in the UE (Network Function) and NG-RAN (Network Function).
When the UE (Network Function) has an active emergency PDU Session:
-	The UE (Network Function) shall not signal Paging Subgrouping Support Indication in the Registration Request message.
The present clause 5.4.13 provides optional enhancements to support discontinuous coverage:
-	Mobility management and power saving optimization, see clause 5.4.13.1; and
-	Coverage availability information provisioning to the UE (Network Function), see clause 5.4.13.2; and
-	Coverage availability information provisioning to the AMF (Network Function), see clause 5.4.13.3; and
-	Paging, see clause 5.4.13.4; and
-	Overload control, see clause 5.4.13.5.
NOTE:	In this Release, there is no specified support for discontinuous coverage over NR in RAN (Network Function) specifications.
For NR satellite access that provides discontinuous network coverage the Mobility Management and Power Saving Optimization functionality may be used.
If both the UE (Network Function) and the network support "Unavailability Period Support", and if the UE (Network Function) determines it will lose coverage and will become unavailable, and the UE (Network Function) decides to remain in no service during that time, then:
-	the UE (Network Function) triggers the Mobility Registration Update procedure to inform the network of its unavailability, as described in clause 5.4.1.4.
-	The UE (Network Function) may be able to determine, including considering current and expected future locations of the UE (Network Function), a Start of Unavailability Period and/or Unavailability Period Duration for when it expects to be out of coverage and include them in the Mobility Registration Update procedure, as described in clause 5.4.1.4.
-	The UE (Network Function) should trigger the Mobility Registration Update procedure early enough such that the procedure, under normal conditions, is able to complete before the start of the unreachability period.
NOTE 1:	A UE (Network Function) based on implementation can combine successive periods of no satellite coverage into a single continuous period that is notified to the network if the UE (Network Function) does not require network access during this period.
NOTE 2:	UE (Network Function) informing the network of coverage gaps would increase signalling and UE (Network Function) power consumption if coverage gaps are more frequent than UE (Network Function)'s communication period.
In case the UE (Network Function) requests power saving features the AMF (Network Function) uses the procedures defined in other clauses to provide the UE (Network Function) with timers (e.g. Periodic Registration Update timer), extended DRX in CM-IDLE configuration (see clause 5.31.7.2), and MICO mode configuration (see clause 5.4.1.3), and to the NG-RAN (Network Function) Extended Connected Time (see clause 5.31.7.3) and may also consider the Unavailability Period Duration and Start of Unavailability Period (if available). This is to keep UE (Network Function) in power saving mode and avoid the network attempting to page the UE (Network Function) if it is out of satellite network coverage.
The AMF (Network Function) should adjust the mobile reachable timer or Implicit Deregistration timer or both such that the AMF (Network Function) does not implicitly deregister the UE (Network Function) while the UE (Network Function) is unavailable, see clause 5.4.1. Features described for High latency communication in clause 5.31.8 may be used to handle mobile terminated (MT) communication with UEs being unreachable due to discontinuous coverage and the Unavailability Period Duration and Start of Unavailability Period (if available) may be used to when determining Maximum Time Offset.
Tracking Area or RAT specific configuration in the AMF (Network Function) may be used to set timer values based on typical coverage periods of a satellite system.
NOTE 3:	For example, if a satellite system only provides coverage to a UE (Network Function) for 20 minutes when a satellite passes, and the maximum time before a satellite passes any point on the earth is 10 hours, the AMF (Network Function) could configure the periodic registration timer and Mobile Reachable timer to be just greater than 20 minutes and the Implicit Deregistration timer to be greater than 10 hours to avoid unintended implicit detach due to coverage gap. Such configuration does not require AMF (Network Function) to be aware of detailed coverage times for each UE (Network Function) or for different locations.
The UE (Network Function) may send Mobility Registration Update procedure to inform the network of its UE (Network Function) unavailability period (see clause 5.4.1.4) even if Mobility Management back-off timer is running.
A UE (Network Function) may use satellite coverage availability information for satellite access to support discontinuous coverage operations. Satellite coverage availability information can be provided to a UE (Network Function) by an external server via a PDU Session or SMS. The protocol and format of satellite coverage availability information via PDU session or SMS is not defined in this release of the specification, but some examples on possible information that constitutes the satellite coverage availability information is defined in Annex Q.
The AMF (Network Function) may use satellite coverage availability information to support satellite access by UEs with discontinuous coverage operation. Satellite coverage availability information may be provisioned to the AMF (Network Function) by O&M.
The satellite coverage availability information provisioned to the AMF (Network Function) describes when and where satellite coverage is expected to be available in an area. The satellite coverage availability information is not UE (Network Function) specific and can be applied by the AMF (Network Function) for any UE (Network Function) in the affected area.
In the case of NR satellite access that provides discontinuous network coverage, AMF (Network Function) may utilize sub-area paging as described in clause 4.2.3.3 of TS 23.502 [3] (e.g. first page in the last known cell-id or TA and retransmission in all registered TAs). The AMF (Network Function) may utilize the location information as received at or before the AN release due to the discontinuous coverage for paging optimisation.
The AMF (Network Function) may e.g. receive UE (Network Function) location from NG-RAN (Network Function) during the Registration procedure e.g. triggered for Mobility Management and Power Saving Optimization for discontinuous network coverage as described in clause 5.4.13.1, or the AMF (Network Function) may request NG-RAN (Network Function) location reporting when the UE (Network Function) is in CM-CONNECTED state as described in clause 5.4.7.
The AMF (Network Function) and UE (Network Function) may only use the procedure defined in this clause if both the UE (Network Function) and AMF (Network Function) indicate support for "Unavailability Period Support", see clause 5.4.13.1. A UE (Network Function) indicating support for "Unavailability Period Support" shall support the procedures defined in this clause when leaving coverage and re-gaining coverage for an NR satellite RAT.
In order to avoid a large number of UEs causing excessive signalling load on the network when leaving coverage or re-gaining coverage after being out of coverage, the AMF (Network Function) may determine a Maximum Time Offset controlling when UEs are allowed to initiate NAS (Protocol) signalling with the network, as described in this clause.
In this case, the AMF (Network Function) determines this Maximum Time Offset based on network configuration, priority users and priority service as specified in TS 23.122 [17] and TS 24.501 [47]. The AMF (Network Function) sends this Maximum Time Offset to individual UEs during the Registration procedure or UE (Network Function) Configuration Update procedure.
If the UE (Network Function) receives a Maximum Time Offset from the network in a Registration Accept or UE (Network Function) Configuration Update Command message, the UE (Network Function) shall replace any previously received Maximum Time Offset on the same RAT type and PLMN with this one.
When the UE (Network Function) knows a later time at which coverage will be lost and when the UE (Network Function) does not send Mobility Registration Update to the AMF (Network Function) in advance (see clause 5.4.13.1), the UE (Network Function) determines a random value up to and including the latest Maximum Time Offset for this PLMN and RAT type and determines an earlier time equal to the later time when coverage will be lost less the random value. The UE (Network Function) shall send the Mobility Registration Update at that earlier time to the AMF (Network Function) indicating the loss of coverage.
Upon returning in coverage after being out of coverage due to discontinuous coverage, the UE (Network Function) sets the discontinuous coverage wait timer value to a random value up to and including the latest Maximum Time Offset for this PLMN and RAT type, and starts this timer. The UE (Network Function) shall not initiate any NAS (Protocol) signalling on that RAT Type and PLMN while the discontinuous coverage wait timer is running.
The UE (Network Function) shall stop the discontinuous coverage wait timer and initiate NAS (Protocol) signalling if the UE (Network Function) receives paging message, has pending emergency services or when UE (Network Function) enters a TAI outside the registration area.
Editor's note:	It is for CT WG1 to decide whether the Maximum Time Offset will require a new IE or reuse existing IE used for MINT i.e. disaster return wait range information. SA WG2 specifications will be aligned based on CT WG1 decision.
This clause describe the specific aspects for untrusted non-3GPP access, trusted non-3GPP access and W-5GAN access.
This clause applies to Non-3GPP access network corresponding to the Untrusted Non-3GPP access network, to the Trusted Non-3GPP access network and to the W-5GAN. In the case of W-5GAN the UE (Network Function) mentioned in this clause corresponds to 5G-RG or to the W-AGF (Network Function) in the case of FN-RG. In the case of N5CW devices access 5GC via trusted WLAN access networks, the UE (Network Function) mentioned in this clause corresponds to TWIF (Network Function).
The UE (Network Function) shall enter RM-DEREGISTERED state and the AMF (Network Function) shall enter RM-DEREGISTERED state for the UE (Network Function) on non-3GPP access as follows:
-	at the UE (Network Function) and at the AMF (Network Function), after performing an Explicit Deregistration procedure;
-	at the AMF (Network Function), after the Network non-3GPP Implicit Deregistration timer has expired.
-	at the UE (Network Function), after the UE (Network Function) non-3GPP Deregistration timer has expired.
NOTE:	This is assumed to leave sufficient time to allow the UE (Network Function) to re-activate UP connections for the established PDU Sessions over 3GPP or non-3GPP access.
Whenever a UE (Network Function) registered over non-3GPP access enters CM-IDLE state for the non-3GPP access, it starts the UE (Network Function) non-3GPP Deregistration timer according to the value received from the AMF (Network Function) during a Registration procedure.
Over non-3GPP access, the AMF (Network Function) runs the Network non-3GPP Implicit Deregistration timer. The Network non-3GPP Implicit Deregistration timer is started with a value longer than the UE (Network Function)'s non-3GPP Deregistration timer, whenever the CM state for the UE (Network Function) registered over non-3GPP access changes to CM-IDLE for the non-3GPP access.
For a UE (Network Function) that is registered over Non-3GPP access, a change of the point of attachment (e.g. change of WLAN AP) shall not lead the UE (Network Function) to perform a Registration procedure.
A UE (Network Function) that is registered over non-3GPP access may trigger a Mobility Registration Update procedure via a new non-3GPP AN node (i.e. N3IWF (Network Function) or TNGF (Network Function)) to switch traffic from an old non-3GPP access to a new non-3GPP access.
Traffic switching from an old non-3GPP access to and from a wireline access is not supported in this Release.
Traffic switching from an old non-3GPP access to new non-3GPP access is supported only when PLMN of the new non-3GPP access is the same PLMN of the old non-3GPP access.
A UE (Network Function) shall not provide 3GPP-specific parameters (e.g. indicate a preference for MICO mode) during registration over a non-3GPP access.
During registration procedure the AMF (Network Function) may determine whether the serving N3IWF (Network Function)/TNGF (Network Function) is appropriate based on the slices supported by the N3IWFs/TNGFs as specified in clause 6.3.6 and clause 6.3.12 respectively.
This clause applies to Non-3GPP access network corresponding to the Untrusted Non-3GPP access network, to the Trusted Non-3GPP access network and to the W-5GAN. The UE (Network Function) mentioned in this clause corresponds to the 5G-RG in the case of W-5GAN and to the W-AGF (Network Function) in the case of FN-RG. In the case of N5CW devices access 5GC via trusted WLAN access networks, the UE (Network Function) mentioned in this clause corresponds to TWIF (Network Function).
A UE (Network Function) that successfully establishes a Non-3GPP Access Connection to the 5GC over a Non-3GPP access transitions to CM-CONNECTED state for the Non-3GPP access.
In the case of Untrusted Non-3GPP access to 5GC, the Non-3GPP Access Connection corresponds to an NWu connection.
In the case of Trusted access to 5GC, the Non-3GPP Access Connection corresponds to an NWt connection.
In the case of N5CW devices access 5GC via trusted WLAN access networks, the Non-3GPP Access Connection corresponds to an Yt' connection.
In the case of Wireline access to 5GC, the Non-3GPP Access Connection corresponds to a Y4 connection and to Y5 connection.
A UE (Network Function) does not establish multiple simultaneous Non-3GPP Access Connection to the 5GC.
The Non-3GPP Access Connection is released either as a result of an Explicit Deregistration procedure or an AN Release procedure.
In the case of Untrusted Non-3GPP access, Trusted Non-3GPP access and W-5GAN access to 5GC, the N3IWF (Network Function), TNGF (Network Function), TWIF (Network Function) and W-AGF (Network Function) may in addition explicitly release the NWu, NWt, Yt', Y4 and Y5 signalling connection due to NWu, NWt, Yt', Y4 and Y5 connection failure, respectively. In the case of NWu and NWt, the release may be determined by the "dead peer detection" mechanism in IKEv2 defined in RFC 7296 [60]. In the case of Y4 and Y5 the release may be detected for example by lost of synchronisation of physical link, lost of PPPoE session, etc. Further details on how NWu, NWt, Yt', Y4 and Y5 connection failure is detected is out of scope of 3GPP specifications.
For W-5GCAN, the W-AGF (Network Function) explicitly releases the N2 (Non-service-based Interface) (Service-based Interface) connection due to Y4 or Y5 connection failure, as determined by the "dead peer detection" mechanism in DOCSIS MULPI [89].
The release of the Non-3GPP Access Connection between the UE (Network Function) and the N3IWF (Network Function), TNGF (Network Function), TWIF (Network Function) or W-AGF (Network Function) shall be interpreted as follows:
-	By the N3IWF (Network Function), TNGF (Network Function), TWIF (Network Function) and W-AGF (Network Function) as a criterion to release the N2 (Non-service-based Interface) (Service-based Interface) connection.
-	By the UE (Network Function) as a criterion for the UE (Network Function) to transition to CM-IDLE. A UE (Network Function) registered over non-3GPP access remains in RM-REGISTERED state, unless the Non-3GPP Access Connection release occurs as part of a Deregistration procedure over non-3GPP access in which case the UE (Network Function) enters the RM-DEREGISTERED state. When the UE (Network Function) in RM-REGISTERED transitions to CM-IDLE, the UE (Network Function) non-3GPP Deregistration timer starts running in the UE (Network Function). The UE (Network Function) non-3GPP Deregistration timer stops when the UE (Network Function) moves to CM-CONNECTED state or to the RM-DEREGISTERED state.
NOTE 1:	When moved to CM-IDLE state over one access, the UE (Network Function) can attempt to re-activate UP connections for the PDU Sessions over other access, per UE (Network Function) policies and depending on the availability of these accesses.
NOTE 2:	The release of the NWu, NWt, Yt', Y4 or Y5 at the UE (Network Function) can occur as a result of explicit signalling from the N3IWF (Network Function), TNGF (Network Function), TWIF (Network Function) or W-AGF (Network Function) respectively, e.g. IKE INFORMATION EXCHANGE in the case of NWu or as a result of the UE (Network Function) detecting NWu, NWt, Yt', Y4 or Y5 connection failure, e.g. as determined by the "dead peer detection" mechanism in IKEv2 as defined in RFC 7296 [60] for NWu, NWt and Yt' or W-5GAN access specific mechanism for Y4 and Y5. Further details on how the UE (Network Function) detects NWu, NWt, Yt', Y4 or Y5 connection failure is out of scope of 3GPP specifications.
In the case of Non-3GPP access, when the AMF (Network Function) releases the N2 (Non-service-based Interface) (Service-based Interface) interface, the N3IWF (Network Function), TNGF (Network Function), TWIF (Network Function) and W-AGF (Network Function) shall release all the resources associated with the UE (Network Function) including the Non-3GPP Access Connection with the UE (Network Function) and its corresponding N3 (Non-service-based Interface) (Service-based Interface) resources. A release of the N2 (Non-service-based Interface) (Service-based Interface) connection by the AMF (Network Function) shall set the CM state for the UE (Network Function) in the AMF (Network Function) to CM-IDLE.
NOTE 3:	It is assumed that a UE (Network Function) configured to receive services from a 5GC over non-3GPP access that is RM-DEREGISTERED or CM-IDLE over the non-3GPP access will attempt to establish Non-3GPP Access Connection and transition to CM-CONNECTED state whenever the UE (Network Function) successfully connects to a non-3GPP access unless prohibited by the network to make a N3GPP Access Connection (e.g. due to network congestion).
An UE (Network Function) cannot be paged on Non-3GPP access network.
When a UE (Network Function) registered simultaneously over a 3GPP access and a non-3GPP access moves all the PDU Sessions to one of the accesses, whether the UE (Network Function) initiates a Deregistration procedure in the access that has no PDU Sessions is up to the UE (Network Function) implementation.
Release of PDU Sessions over the non-3GPP access does not imply the release of N2 (Non-service-based Interface) (Service-based Interface) connection.
When the UE (Network Function) has PDU Sessions routed over the non-3GPP access and the UE (Network Function) state becomes CM-IDLE for the non-3GPP access, these PDU Sessions are not released to enable the UE (Network Function) to move the PDU Sessions over the 3GPP access based on UE (Network Function) policies. The core network maintains the PDU Sessions but deactivates the N3 (Non-service-based Interface) (Service-based Interface) user plane connection for such PDU Sessions.
This clause applies to Non-3GPP access network corresponding to the Untrusted Non-3GPP access network, to the Trusted Non-3GPP access network and to the W-5GAN. The UE (Network Function) mentioned in this clause corresponds to 5G-RG, in the case of W-5GAN or to W-AGF (Network Function) in the case of support of FN-RG. In the case of N5CW devices access 5GC via trusted WLAN access networks, the UE (Network Function) mentioned in this clause corresponds to TWIF (Network Function).
An UE (Network Function) cannot be paged over Non-3GPP access network.
If the UE (Network Function) states in the AMF (Network Function) are CM-IDLE and RM-REGISTERED for the non-3GPP access, there may be PDU Sessions that were last routed over the non-3GPP access and without user plane resources. If the AMF (Network Function) receives a message with a Non-3GPP Access Type indication from an SMF (Network Function) for a PDU Session corresponding to a UE (Network Function) that is CM-IDLE for non-3GPP access, and the UE (Network Function) is registered over 3GPP access in the same PLMN as the one registered over non-3GPP access, a Network Triggered Service Request may be performed over the 3GPP access independently of whether the UE (Network Function) is CM-IDLE or CM-CONNECTED over the 3GPP access. In this case, the AMF (Network Function) provides an indication that the procedure is related to non-3GPP access, as specified in clause 5.6.8.
NOTE:	The UE (Network Function) behaviour upon such network triggered Service Request is specified in clause 5.6.8.
This clause applies to Non-3GPP access network corresponding to the Untrusted Non-3GPP access network, to the Trusted Non-3GPP access network and to the W-5GAN. In the case of W-5GAN the UE (Network Function) mentioned in this clause corresponds to 5G-RG and to W-AGF (Network Function) in the case of support of FN-RG. In the case of N5CW devices access 5GC via trusted WLAN access networks, the UE (Network Function) mentioned in this clause corresponds to TWIF (Network Function).
For a UE (Network Function) in CM-CONNECTED state:
-	the AMF (Network Function) knows the UE (Network Function) location on a N3IWF (Network Function), TNGF (Network Function), TWIF (Network Function) and W-AGF (Network Function) node granularity.
-	the N3IWF (Network Function), TNGF (Network Function), TWIF (Network Function) and W-AGF (Network Function) releases the N2 (Non-service-based Interface) (Service-based Interface) connection when UE (Network Function) becomes unreachable from N3IWF (Network Function), TNGF (Network Function), TWIF (Network Function) and W-AGF (Network Function) point of view, i.e. upon Non-3GPP Access Connection release.
The 5GC supports a PDU Connectivity Service i.e. a service that provides exchange of PDUs between a UE (Network Function) and a data network identified by a DNN. The PDU Connectivity Service is supported via PDU Sessions that are established upon request from the UE (Network Function).
The Subscription Information for each S-NSSAI may contain a Subscribed DNN list and one default DNN. When the UE (Network Function) does not provide a DNN in a NAS (Protocol) Message containing PDU Session Establishment Request for a given S-NSSAI, the serving AMF (Network Function) determines the DNN for the requested PDU Session by selecting the default DNN for this S-NSSAI if a default DNN is present in the UE (Network Function)'s Subscription Information; otherwise the serving AMF (Network Function) selects a locally configured DNN for this S-NSSAI.
The expectation is that the URSP in the UE (Network Function) is always up to date using the procedure defined in clause 4.16.12.2 of TS 23.502 [3] and therefore the UE (Network Function) requested DNN will be up to date.
In order to cover cases that UE (Network Function) operates using local configuration, but also other cases where operator policies can be used in order to replace an "up to date" UE (Network Function) requested DNN with another DNN used only internally in the network, during UE (Network Function) Registration procedure the PCF (Network Function) may indicate, to the AMF (Network Function), the operator policies to be used at PDU Session Establishment for DNN replacement of a UE (Network Function) requested DNN. PCF (Network Function) may indicate a policy for DNN replacement of UE (Network Function) requested DNNs not supported by the network, and/or indicate a list of UE (Network Function) requested DNNs per S-NSSAI valid for the serving network, that are subject for replacement (details are described in TS 23.503 [45]).
If the DNN provided by the UE (Network Function) is not supported by the network and AMF (Network Function) cannot select an SMF (Network Function) by querying NRF (Network Function), the AMF (Network Function) shall reject the NAS (Protocol) Message containing PDU Session Establishment Request from the UE (Network Function) with a cause indicating that the DNN is not supported unless the PCF (Network Function) provided the policy to perform a DNN replacement of unsupported DNNs.
If the DNN requested by the UE (Network Function) is indicated for replacement or the DNN provided by the UE (Network Function) is not supported by the network and the PCF (Network Function) provided the policy to perform DNN replacement of UE (Network Function) requested DNNs not supported by the network, the AMF (Network Function) shall interact with the PCF (Network Function) to perform a DNN replacement. During PDU Session Establishment procedure and as a result of DNN replacement, the PCF (Network Function) provides the selected DNN that is applicable for the S-NSSAI requested by the UE (Network Function) at the PDU Session Establishment. The AMF (Network Function) uses the selected DNN in the query towards the NRF (Network Function) for the SMF (Network Function) selection, as specified in clause 6.3.2, and provides both requested and selected DNN to the selected SMF (Network Function). For PDU Session with Home-routed Roaming whether to perform DNN replacement is based on operator agreements.
NOTE 1:	The selected DNN is determined based on operator preferences and can differ from subscribed DNNs. The matching of selected DNN to S-NSSAI is assumed to be based on network configuration.
Each PDU Session supports a single PDU Session type i.e. supports the exchange of a single type of PDU requested by the UE (Network Function) at the establishment of the PDU Session. The following PDU Session types are defined: IPv4, IPv6, IPv4v6, Ethernet, Unstructured.
PDU Sessions are established (upon UE (Network Function) request), modified (upon UE (Network Function) and 5GC request) and released (upon UE (Network Function) and 5GC request) using NAS (Protocol) SM signalling exchanged over N1 (Non-service-based Interface) (Service-based Interface) between the UE (Network Function) and the SMF (Network Function). Upon request from an Application (Protocol) Server, the 5GC is able to trigger a specific application in the UE (Network Function). When receiving that trigger message, the UE (Network Function) shall pass it to the identified application in the UE (Network Function). The identified application in the UE (Network Function) may establish a PDU Session to a specific DNN, see clause 4.4.5.
SMF (Network Function) may support PDU Sessions for LADN where the access to a DN (Network Function) is only available in a specific LADN service area. This is further defined in clause 5.6.5.
SMF (Network Function) may support PDU Sessions for a 5G VN group which offers a virtual data network capable of supporting 5G LAN-type service over the 5G system. This is further defined in clause 5.8.2.13.
The SMF (Network Function) is responsible of checking whether the UE (Network Function) requests are compliant with the user subscription. For this purpose, it retrieves and requests to receive update notifications on SMF (Network Function) level subscription data from the UDM (Network Function). Such data may indicate per DNN and per S-NSSAI of the HPLMN:
-	The allowed PDU Session Types and the default PDU Session Type.
-	The allowed SSC modes and the default SSC mode.
-	QoS Information (refer to clause 5.7): the subscribed Session-AMBR, Default 5QI and Default ARP.
-	The IP  (Protocol)Index information.
-	The static IP  (Protocol)address/prefix.
-	The subscribed User Plane Security Policy.
-	the Charging Characteristics to be associated with the PDU Session. Whether this information is provided by the UDM (Network Function) to a SMF (Network Function) in another PLMN (for PDU Sessions in LBO mode) is defined by operator policies in the UDM (Network Function)/UDR (Network Function).
NOTE 2:	The content of the Charging Characteristics as well as the usage of the Charging Characteristics by the SMF (Network Function) are defined in TS 32.255 [68].
A PDU Session may support:
(a)	a single-access PDU Connectivity Service, in which case the PDU Session is associated with a single access type at a given time, i.e. either 3GPP access or non-3GPP access; or
(b) a multi-access PDU Connectivity Service, in which case the PDU Session is simultaneously associated with both 3GPP access and non-3GPP access and simultaneously associated with two independent N3 (Non-service-based Interface) (Service-based Interface)/N9 (Service-based Interface) tunnels between the PSA (Network Function) and RAN (Network Function)/AN.
A PDU Session supporting a single-access PDU Connectivity Service is also referred to as single-access PDU Session, while a PDU Session supporting a multi-access PDU Connectivity Service is referred to as Multi-Access PDU (MA PDU) Session and it is used to support the ATSSS feature (see clause 5.32 for details).
A UE (Network Function) that is registered over multiple accesses chooses over which access to establish a PDU Session. As defined in TS 23.503 [45], the HPLMN may send policies to the UE (Network Function) to guide the UE (Network Function) selection of the access over which to establish a PDU Session.
NOTE 3:	In this Release of the specification, at any given time, a PDU Session is routed over only a single access network, unless it is an MA PDU Session in which case it can be routed over one 3GPP access network and one Non 3GPP access network concurrently.
A UE (Network Function) may request to move a single-access PDU Session between 3GPP and Non 3GPP accesses. The decision to move single-access PDU Sessions between 3GPP access and Non 3GPP access is made on a per PDU Session basis, i.e. the UE (Network Function) may, at a given time, have some PDU Sessions using 3GPP access while other PDU Sessions are using Non 3GPP access.
If the UE (Network Function) is attempting to move a single-access PDU session from 3GPP access to non-3GPP access and the PDU session is associated with control plane only indication, then the AMF (Network Function) shall reject the PDU Session Establishment request as related CIoT 5GS optimisation features are not supported over non-3GPP access as described in clause 5.4.5.2.5 of TS 24.501 [47]. If the UE (Network Function) is attempting to move a single-access PDU session from non-3GPP access to NB-N1 (Non-service-based Interface) (Service-based Interface) mode of 3GPP access, the PDU Session Establishment request would also be rejected by AMF (Network Function) when the UP resources for the UE (Network Function) exceed the maximum number of supported UP resources as described in clause 5.4.5.2.4 of TS 24.501 [47].
In a PDU Session Establishment Request message sent to the network, the UE (Network Function) shall provide a PDU Session ID. The PDU Session ID is unique per UE (Network Function) and is the identifier used to uniquely identify one of a UE (Network Function)'s PDU Sessions. The PDU Session ID shall be stored in the UDM (Network Function) to support handover between 3GPP and non-3GPP access when different PLMNs are used for the two accesses. The UE (Network Function) also provides as described in TS 24.501 [47]:
(a)	PDU Session Type.
(b)	S-NSSAI of the HPLMN that matches the application (that is triggering the PDU Session Request) within the NSSP in the URSP rules or within the UE (Network Function) Local Configuration as defined in clause 6.1.2.2.1 of TS 23.503 [45].
NOTE 4:	If the UE (Network Function) cannot determine any S-NSSAI after performing the association of the application to a PDU Session, then it does not indicate any S-NSSAI in the PDU Session Establishment procedure as defined in clause 5.15.5.3.
(c)	S-NSSAI of the Serving PLMN from the Allowed NSSAI, corresponding to the S-NSSAI of the HPLMN (b).
NOTE 5:	In non-roaming scenario the mapping of the Allowed NSSAI to HPLMN S-NSSAIs is not provided to the UE (Network Function) (because the S-NSSAI of the Serving PLMN (c) has the same value of the S-NSSAI of the HPLMN (b)), therefore the UE (Network Function) provides in the PDU Session Request only the S-NSSAI of the Serving PLMN (c).
NOTE 6:	In roaming scenarios the UE (Network Function) provides in the PDU Session Request both the S-NSSAI of the HPLMN (b) and the S-NSSAI of the VPLMN from the Allowed NSSAI (c) that maps to the S-NSSAI of the HPLMN.
(d)	DNN (Data Network Name).
(e)	SSC mode (Service and Session Continuity mode defined in clause 5.6.9.2).
Additionally, if the UE (Network Function) supports ATSSS and wants to activate a MA PDU Session, the UE (Network Function) shall provide Request Type as "MA PDU Request" and shall indicate the supported ATSSS capabilities (see clause 5.32 for details).
Table 5.6.1-1: Attributes of a PDU Session

Subscription Information may include a wildcard DNN per subscribed S-NSSAI: when a wildcard DNN is associated with a subscribed S-NSSAI, the subscription allows, for this S-NSSAI, the UE (Network Function) to establish a PDU Session using any DNN value.
NOTE 7:	The SMF (Network Function) is made aware whether the DNN of a PDU Session being established corresponds to an explicitly subscribed DNN or corresponds to a wildcard DNN. Thus, the SMF (Network Function) can reject a PDU Session establishment if the DNN of the PDU Session is not part of explicitly subscribed DNN(s) and local policies in the SMF (Network Function) require UE (Network Function) to have a subscription to this DNN.
A UE (Network Function) may establish multiple PDU Sessions, to the same data network or to different data networks, via 3GPP and via and Non-3GPP access networks at the same time.
A UE (Network Function) may establish multiple PDU Sessions to the same Data Network and served by different UPF (Network Function) terminating N6 (Non-service-based Interface) (Service-based Interface).
A UE (Network Function) with multiple established PDU Sessions may be served by different SMF (Network Function).
The SMF (Network Function) shall be registered and deregistered on a per PDU Session granularity in the UDM (Network Function).
The user plane paths of different PDU Sessions (to the same or to different DNN) belonging to the same UE (Network Function) may be completely disjoint between the AN and the UPF (Network Function) interfacing with the DN (Network Function).
When the SMF (Network Function) cannot control the UPF (Network Function) terminating the N3 (Non-service-based Interface) (Service-based Interface) interface used by a PDU Session and SSC mode 2/3 procedures are not applied to the PDU Session, an I-SMF (Network Function) is inserted between the SMF (Network Function) and the AMF (Network Function) and handling of PDU Session(s) is described in clause 5.34.
NOTE 8:	User Plane resources for PDU Sessions of a UE (Network Function), except for regulatory prioritized service like Emergency Services and MPS, can be deactivated by the SMF (Network Function) if the UE (Network Function) is only reachable for regulatory prioritized services.
The SMF (Network Function) serving a PDU session (i.e. Anchor) can be changed during lifetime of the PDU session either within the same SMF (Network Function) set or, if the Context Transfer Procedures as specified in clause 4.26 of TS 23.502 [3] are supported, between SMFs in different SMF (Network Function) sets.
The AMF (Network Function) and SMF (Network Function) are separate Network Functions.
N1 (Non-service-based Interface) (Service-based Interface) related interaction with SMF (Network Function) is as follows:
-	The single N1 (Non-service-based Interface) (Service-based Interface) termination point is located in AMF (Network Function). The AMF (Network Function) forwards SM related NAS (Protocol) information to the SMF (Network Function) based on the PDU Session ID in the NAS (Protocol) message. Further SM NAS (Protocol) exchanges (e.g. SM NAS (Protocol) message responses) for N1 (Non-service-based Interface) (Service-based Interface) NAS (Protocol) signalling received by the AMF (Network Function) over an access (e.g. 3GPP access or non-3GPP access) are transported over the same access.
-	The serving PLMN ensures that subsequent SM NAS (Protocol) exchanges (e.g. SM NAS (Protocol) message responses) for N1 (Non-service-based Interface) (Service-based Interface) NAS (Protocol) signalling received by the AMF (Network Function) over an access (e.g. 3GPP access or non-3GPP access) are transported over the same access.
-	SMF (Network Function) handles the Session management part of NAS (Protocol) signalling exchanged with the UE (Network Function).
-	The UE (Network Function) shall only initiate PDU Session Establishment in RM-REGISTERED state.
-	When a SMF (Network Function) has been selected to serve a specific PDU Session, AMF (Network Function) has to ensure that all NAS (Protocol) signalling related with this PDU Session is handled by the same SMF (Network Function) instance.
-	Upon successful PDU Session Establishment, the AMF (Network Function) and SMF (Network Function) stores the Access Type that the PDU Session is associated.
N11 (Service-based Interface) related interaction with SMF (Network Function) is as follows:
-	The AMF (Network Function) reports the reachability of the UE (Network Function) based on a subscription from the SMF (Network Function), including:
-	The UE (Network Function) location information with respect to the area of interest indicated by the SMF (Network Function).
-	The SMF (Network Function) indicates to AMF (Network Function) when a PDU Session has been released.
-	Upon successful PDU Session Establishment, AMF (Network Function) stores the identification of serving SMF (Network Function) of UE (Network Function) and SMF (Network Function) stores the identification of serving AMF (Network Function) of UE (Network Function) including the AMF (Network Function) set. When trying to reach the AMF (Network Function) serving the UE (Network Function), the SMF (Network Function) may need to apply the behaviour described for "the other CP NFs" in clause 5.21.
N2 (Non-service-based Interface) (Service-based Interface) related interaction with SMF (Network Function) is as follows:
-	Some N2 (Non-service-based Interface) (Service-based Interface) signalling (such as handover related signalling) may require the action of both AMF (Network Function) and SMF (Network Function). In such case, the AMF (Network Function) is responsible to ensure the coordination between AMF (Network Function) and SMF (Network Function). The AMF (Network Function) may forward the SM N2 (Non-service-based Interface) (Service-based Interface) signalling towards the corresponding SMF (Network Function) based on the PDU Session ID in N2 (Non-service-based Interface) (Service-based Interface) signalling.
-	SMF (Network Function) shall provide PDU Session Type together with PDU Session ID to NG-RAN (Network Function), in order to facilitate NG-RAN (Network Function) to apply suitable header compression mechanism to packet of different PDU type. Details refer to TS 38.413 [34].
N3 (Non-service-based Interface) (Service-based Interface) related interaction with SMF (Network Function) is as follows:
-	Selective activation and deactivation of UP connection of existing PDU Session is defined in clause 5.6.8.
N4 (Service-based Interface) related interaction with SMF (Network Function) is as follows:
-	When it is made aware by the UPF (Network Function) that some DL data has arrived for a UE (Network Function) without downlink N3 (Non-service-based Interface) (Service-based Interface) tunnel information, the SMF (Network Function) interacts with the AMF (Network Function) to initiate Network Triggered Service Request procedure. In this case, if the SMF (Network Function) is aware that the UE (Network Function) is unreachable or if the UE (Network Function) is reachable only for regulatory prioritized service and the PDU Session is not for regulatory prioritized service, then the SMF (Network Function) shall not inform DL data notification to the AMF (Network Function)
The AMF (Network Function) is responsible of selecting the SMF (Network Function) per procedures described in clause 6.3.2. For this purpose, it gets subscription data from the UDM (Network Function) that are defined in that clause. Furthermore, it retrieves the subscribed UE (Network Function)-AMBR from the UDM (Network Function), and optionally dynamic serving network UE (Network Function)-AMBR from PCF (Network Function) based on operator local policy, and sends to the (R)AN as defined in clause 5.7.2
AMF (Network Function)-SMF (Network Function) interactions to support LADN are defined in clause 5.6.5.
In order to support charging and to fulfil regulatory requirement (in order to provide NPLI (Network Provided Location Information) as defined in TS 23.228 [15]) related with the set-up, modification and release of IMS Voice calls or with SMS transfer the following applies
-	At the time of the PDU Session Establishment, the AMF (Network Function) provides the SMF (Network Function) with the PEI of the UE (Network Function) if the PEI is available at the AMF (Network Function).
-	When it forwards UL NAS (Protocol) or N2 (Non-service-based Interface) (Service-based Interface) signalling to a peer NF (Network Function) (e.g. to SMF (Network Function) or to SMSF (Network Function)) or during the UP connection activation of a PDU Session, the AMF (Network Function) provides any User Location Information it has received from the 5G-AN as well as the Access Type (3GPP - Non 3GPP) of the AN over which it has received the UL NAS (Protocol) or N2 (Non-service-based Interface) (Service-based Interface) signalling. The AMF (Network Function) also provides the corresponding UE (Network Function) Time Zone. In addition, in order to fulfil regulatory requirement (i.e. providing Network Provided Location Information (NPLI), as defined in TS 23.228 [15]) when the access is non-3GPP, the AMF (Network Function) may also provide the last known 3GPP access User Location Information with its age, if the UE (Network Function) is still attached to the same AMF (Network Function) for 3GPP access (i.e. valid User Location Information).
The User Location Information, the access type and the UE (Network Function) Time Zone may be further provided by SMF (Network Function) to PCF (Network Function). The PCF (Network Function) may get this information from the SMF (Network Function) in order to provide NPLI to applications (such as IMS) that have requested it.
The User Location Information may correspond to:
-	In the case of 3GPP access: TAI, Cell-Id. The AMF (Network Function) includes only the Primary Cell-Id even if it had received also the Cell-Id of the Primary cell in the Secondary RAN (Network Function) node from NG-RAN (Network Function).
-	In the case of Untrusted non-3GPP access: TAI, the UE (Network Function) local IP  (Protocol)address used to reach the N3IWF (Network Function) and optionally the UDP  (Protocol)source port number if NAT is detected.
-	In the case of Trusted non-3GPP access: TAI, TNAP/TWAP Identifier, the UE (Network Function)/N5CW device local IP  (Protocol)address used to reach the TNGF (Network Function)/TWIF (Network Function) and optionally the UDP  (Protocol)source port number if NAT is detected.
	When the UE (Network Function) uses WLAN based on IEEE 802.11 technology to reach the TNGF (Network Function), the TNAP Identifier shall include the SSID of the access point to which the UE (Network Function) is attached. The TNAP Identifier shall include at least one of the following elements, unless otherwise determined by the TWAN operator's policies:
-	the BSSID (see IEEE Std 802.11-2012 [106]);
-	civic address information of the TNAP to which the UE (Network Function) is attached.
	The TWAP Identifier shall include the SSID of the access point to which the NC5W is attached. The TWAP Identifier shall also include at least one of the following elements, unless otherwise determined by the TWAN operator's policies:
-	the BSSID (see IEEE Std 802.11-2012 [106]);
-	civic address information of the TWAP to which the UE (Network Function) is attached.
NOTE 1:	The SSID can be the same for several TNAPs/TWAPs and SSID only cannot provide a location, but it might be sufficient for charging.
NOTE 2:	the BSSID associated with a TNAP/TWAP is assumed to be static.
-	In the case of W-5GAN access: The User Location Information for W-5GAN is defined in TS 23.316 [84].
When the SMF (Network Function) receives a request to provide Access Network Information reporting while there is no action to carry out towards the 5G-AN or the UE (Network Function) (e.g. no QoS Flow to create / Update / modify), the SMF (Network Function) may request User Location Information from the AMF (Network Function).
The interaction between AMF (Network Function) and SMF (Network Function)(s) for the case of a I-SMF (Network Function) insertion, relocation or removal for a PDU session is described in clause 5.34.
In the case of roaming the 5GC supports following possible deployments scenarios for a PDU Session:
-	"Local Break Out" (LBO) where the SMF (Network Function) and all UPF (Network Function)(s) involved by the PDU Session are under control of the VPLMN.
-	"Home Routed" (HR) where the PDU Session is supported by a SMF (Network Function) function under control of the HPLMN, by a SMF (Network Function) function under control of the VPLMN, by at least one UPF (Network Function) under control of the HPLMN and by at least one UPF (Network Function) under control of the VPLMN. In this case the SMF (Network Function) in HPLMN selects the UPF (Network Function)(s) in the HPLMN and the SMF (Network Function) in VPLMN selects the UPF (Network Function)(s) in the VPLMN. This is further described in clause 6.3. Home Routed with Session Breakout in VPLMN (HR-SBO) is described in clause 6.7 of TS 23.548 [130].
NOTE 1:	The use of an UPF (Network Function) in the VPLMN e.g. enables VPLMN charging, VPLMN LI and minimizes the impact on the HPLMN of the UE (Network Function) mobility within the VPLMN (e.g. for scenarios where SSC mode 1 applies).
Different simultaneous PDU Sessions of an UE (Network Function) may use different modes: Home Routed and LBO. The HPLMN can control via subscription data per DNN and per S-NSSAI whether a PDU Session is to be set-up in HR or in LBO mode.
In the case of PDU Sessions per Home Routed deployment:
-	NAS SM terminates in the SMF (Network Function) in VPLMN.
-	The SMF (Network Function) in VPLMN forwards to the SMF (Network Function) in the HPLMN SM related information.
-	The SMF (Network Function) in the HPLMN receives the SUPI of the UE (Network Function) from the SMF (Network Function) in the VPLMN during the PDU Session Establishment procedure.
-	The SMF (Network Function) in HPLMN is responsible to check the UE (Network Function) request with regard to the user subscription and to possibly reject the UE (Network Function) request in the case of mismatch. The SMF (Network Function) in HPLMN obtains subscription data directly from the UDM (Network Function).
-	The SMF (Network Function) in HPLMN may send QoS requirements associated with a PDU Session to the SMF (Network Function) in VPLMN. This may happen during the PDU Session Establishment procedure and after the PDU Session is established. The interface between SMF (Network Function) in HPLMN and SMF (Network Function) in VPLMN is also able to carry (N9 (Service-based Interface)) User Plane forwarding information exchanged between SMF (Network Function) in HPLMN and SMF (Network Function) in VPLMN. The SMF (Network Function) in the VPLMN may check QoS requests from the SMF (Network Function) in HPLMN with respect to roaming agreements.
In home routed roaming case, the AMF (Network Function) selects an SMF (Network Function) in the VPLMN and a SMF (Network Function) in the HPLMN as described in clause 6.3.2 and in clause 4.3.2.2.3.3 of TS 23.502 [3], and provides the identifier of the selected SMF (Network Function) in the HPLMN to the selected SMF (Network Function) in the VPLMN.
In roaming with LBO, the AMF (Network Function) selects a SMF (Network Function) in the VPLMN as described in clause 6.3.2 and in clause 4.3.2.2.3.2 of TS 23.502 [3]. In this case, when handling a PDU Session Establishment Request message, the SMF (Network Function) in the VPLMN may reject the N11 (Service-based Interface) message (related with the PDU Session Establishment Request message) with a proper N11 (Service-based Interface) cause. This triggers the AMF (Network Function) to select both a new SMF (Network Function) in the VPLMN and a SMF (Network Function) in the HPLMN in order to handle the PDU Session using home routed roaming.
In order to support selective traffic routing to the DN (Network Function) or to support SSC mode 3 as defined in clause 5.6.9.2.3, the SMF (Network Function) may control the data path of a PDU Session so that the PDU Session may simultaneously correspond to multiple N6 (Non-service-based Interface) (Service-based Interface) interfaces. The UPF (Network Function) that terminates each of these interfaces is said to support PDU Session Anchor functionality. Each PDU Session Anchor supporting a PDU Session provides a different access to the same DN (Network Function). Further, the PDU Session Anchor assigned at PDU Session Establishment is associated with the SSC mode of the PDU Session and the additional PDU Session Anchor(s) assigned within the same PDU Session e.g. for selective traffic routing to the DN (Network Function) are independent of the SSC mode of the PDU Session. When a PCC rule including the Application (Protocol) Function influence on traffic routing Enforcement Control information defined in clause 6.3.1 of TS 23.503 [45] is provided to the SMF (Network Function), the SMF (Network Function) can decide whether to apply traffic routing (by using UL Classifier functionality or IPv6 multi-homing) based on DNAI(s) included in the PCC rule.
NOTE 1:	Application Function influence on traffic routing Enforcement Control information can be either determined by the PCF (Network Function) when requested by AF (Network Function) via NEF (Network Function) as described in clause 5.6.7.1 or statically pre-configured in the PCF (Network Function).
NOTE 2:	Selective traffic routing to the DN (Network Function) supports, for example, deployments where some selected traffic is forwarded on an N6 (Non-service-based Interface) (Service-based Interface) interface to the DN (Network Function) that is "close" to the AN serving the UE (Network Function).
This may correspond to
-	The Usage of UL Classifier functionality for a PDU Session defined in clause 5.6.4.2.
-	The Usage of an IPv6 multi-homing for a PDU Session defined in clause 5.6.4.3.
SMF (Network Function) may also take decision to apply traffic routing (by using UL Classifier functionality or IPv6 multi-homing) in EAS Discovery with EASDF (Network Function) procedure described in TS 23.548 [130].
In the case of PDU Sessions of type IPv4 or IPv6 or IPv4v6 or Ethernet, the SMF (Network Function) may decide to insert in the data path of a PDU Session an "UL CL" (Uplink classifier). The UL CL is a functionality supported by an UPF (Network Function) that aims at diverting (locally) some traffic matching traffic filters provided by the SMF (Network Function). The insertion and removal of an UL CL is decided by the SMF (Network Function) and controlled by the SMF (Network Function) using generic N4 (Service-based Interface) and UPF (Network Function) capabilities. The SMF (Network Function) may decide to insert in the data path of a PDU Session a UPF (Network Function) supporting the UL CL functionality during or after the PDU Session Establishment, or to remove from the data path of a PDU Session a UPF (Network Function) supporting the UL CL functionality after the PDU Session Establishment. The SMF (Network Function) may include more than one UPF (Network Function) supporting the UL CL functionality in the data path of a PDU Session.
The UE (Network Function) is unaware of the traffic diversion by the UL CL, and does not involve in both the insertion and the removal of UL CL. In the case of a PDU Session of IPv4 or IPv6 or IPv4v6 type, the UE (Network Function) associates the PDU Session with either a single IPv4 address or a single IPv6 Prefix or both of them allocated by the network.
When an UL CL functionality has been inserted in the data path of a PDU Session, there are multiple PDU Session Anchors for this PDU Session. These PDU Session Anchors provide different access to the same DN (Network Function). In the case of a PDU Session of IPv4 or IPv6 or IPv4v6 type, only one IPv4 address and/or IPv6 prefix is provided to the UE (Network Function). The SMF (Network Function) may be configured with local policies for some (DNN, S-NSSAI) combinations to release the PDU Session when there is a PSA (Network Function) associated with the IPv4 address allocated to the UE (Network Function) and this PSA (Network Function) has been removed.
NOTE 0:	The use of only one IPv4 address and/or IPv6 prefix with multiple PDU Session Anchors assumes that when needed, appropriate mechanisms are in place to correctly forward packets on the N6 (Non-service-based Interface) (Service-based Interface) reference point. The mechanisms for packet forwarding on the N6 (Non-service-based Interface) (Service-based Interface) reference point between the PDU Session Anchor providing local access and the DN (Network Function) are outside the scope of this specification.
The UL CL provides forwarding of UL traffic towards different PDU Session Anchors and merge of DL traffic to the UE (Network Function) i.e. merging the traffic from the different PDU Session Anchors on the link towards the UE (Network Function). This is based on traffic detection and traffic forwarding rules provided by the SMF (Network Function).
The UL CL applies filtering rules (e.g. to examine the destination IP  (Protocol)address/Prefix of UL IP  (Protocol)packets sent by the UE (Network Function)) and determines how the packet should be routed. The UPF (Network Function) supporting an UL CL may also be controlled by the SMF (Network Function) to support traffic measurement for charging, traffic replication for LI and bit rate enforcement (Session-AMBR per PDU Session).
NOTE 1:	When N9 (Service-based Interface) forwarding tunnel exists between source ULCL and target ULCL, the Session-AMBR per PDU Session can be enforced by the source UL CL UPF (Network Function).
NOTE 2:	The UPF (Network Function) supporting an UL CL may also support a PDU Session Anchor for connectivity to the local access to the data network (including e.g. support of tunnelling or NAT on N6 (Non-service-based Interface) (Service-based Interface)). This is controlled by the SMF (Network Function).
Additional UL CLs (and thus additional PDU Session Anchors) can be inserted in the data path of a PDU Session to create new data paths for the same PDU Session. The way to organize the data path of all UL CLs in a PDU Session is up to operator configuration and SMF (Network Function) logic and there is only one UPF (Network Function) supporting UL CL connecting to the (R)AN via N3 (Non-service-based Interface) (Service-based Interface) interface, except when session continuity upon UL CL relocation is used.
The insertion of an ULCL in the data path of a PDU Session is depicted in Figure 5.6.4.2-1.

Figure 5.6.4.2-1: User plane Architecture for the Uplink Classifier
NOTE 3:	It is possible for a given UPF (Network Function) to support both the UL CL and the PDU Session Anchor functionalities.
Due to UE (Network Function) mobility the network may need to relocate the UPF (Network Function) acting as UL CL and establish a new PSA (Network Function) for local access to the DN (Network Function). To support session continuity during UL CL relocation the network may establish a temporary N9 (Service-based Interface) forwarding tunnel between the source UL CL and target UL CL. The AF (Network Function) may influence the creation of the N9 (Service-based Interface) forwarding tunnel as described in clause 5.6.7.1.
The N9 (Service-based Interface) forwarding tunnel is maintained until:
-	all active traffic flowing on it ceases to exist for:
-	a configurable period of time; or
-	a period of time indicated by the AF (Network Function);
-	until the AF (Network Function) informs the SMF (Network Function) that it can release the source PSA (Network Function) providing local access to the DN (Network Function).
During the existence of the N9 (Service-based Interface) forwarding tunnel the UPF (Network Function) acting as target UL CL is configured with packet filters that:
-	force uplink traffic from existing data sessions between UE (Network Function) and the application in the source local part of the DN (Network Function) (as defined in TS 23.548 [130]) into the N9 (Service-based Interface) forwarding tunnel towards the source UL CL.
-	force any traffic related to the application in the target local part of the DN (Network Function) to go to the new local part of the DN (Network Function) via the target PSA (Network Function).
SMF (Network Function) may send a Late Notification to AF (Network Function) to inform it about the DNAI change as described in clause 4.3.6.3 of TS 23.502 [3]. This notification can be used by the AF (Network Function) e.g. to trigger mechanisms in the source local part of the DN (Network Function) to redirect the ongoing traffic sessions towards an application in the target local part of the DN (Network Function). SMF (Network Function) can also send late notification to the target AF (Network Function) instance if associated with this target local part of the DN (Network Function).
The procedure for session continuity upon UL CL relocation is described in clause 4.3.5.7 of TS 23.502 [3].
When an I-SMF (Network Function) is inserted for a PDU Session, the details of UL CL insertion which is controlled by an I-SMF (Network Function) is described in clause 5.34.4.
A PDU Session may be associated with multiple IPv6 prefixes. This is referred to as multi-homed PDU Session. The multi-homed PDU Session provides access to the Data Network via more than one PDU Session Anchor. The different user plane paths leading to the different PDU Session Anchors branch out at a "common" UPF (Network Function) referred to as a UPF (Network Function) supporting "Branching Point" functionality. The Branching Point provides forwarding of UL traffic towards the different PDU Session Anchors and merge of DL traffic to the UE (Network Function) i.e. merging the traffic from the different PDU Session Anchors on the link towards the UE (Network Function).
The UPF (Network Function) supporting a Branching Point functionality may also be controlled by the SMF (Network Function) to support traffic measurement for charging, traffic replication for LI and bit rate enforcement (Session-AMBR per PDU Session). The insertion and removal of a UPF (Network Function) supporting Branching Point is decided by the SMF (Network Function) and controlled by the SMF (Network Function) using generic N4 (Service-based Interface) and UPF (Network Function) capabilities. The SMF (Network Function) may decide to insert in the data path of a PDU Session a UPF (Network Function) supporting the Branching Point functionality during or after the PDU Session Establishment, or to remove from the data path of a PDU Session a UPF (Network Function) supporting the Branching Point functionality after the PDU Session Establishment.
Multi homing of a PDU Session applies only for PDU Sessions of IPv6 type. When the UE (Network Function) requests a PDU Session of type "IPv4v6" or "IPv6" the UE (Network Function) also provides an indication to the network whether it supports a Multi-homed IPv6 PDU Session.
The use of multiple IPv6 prefixes in a PDU Session is characterised by the following:
-	The UPF (Network Function) supporting a Branching Point functionality is configured by the SMF (Network Function) to spread UL traffic between the PDU Session Anchors based on the Source Prefix of the PDU (which may be selected by the UE (Network Function) based on routing information and preferences received from the network).
-	IETF RFC 4191 [8] is used to configure routing information and preferences into the UE (Network Function) to influence the selection of the source Prefix.
NOTE 1:	This corresponds to Scenario 1 defined in IETF RFC 7157 [7] "IPv6 Multi-homing without Network Address Translation". This allows to make the Branching Point unaware of the routing tables in the Data Network and to keep the first hop router function in the PDU Session Anchors.
-	The multi-homed PDU Session may be used to support make-before-break service continuity to support SSC mode 3. This is illustrated in Figure 5.6.4.3-1.
-	The multi-homed PDU Session may also be used to support cases where UE (Network Function) needs to access both a local service (e.g. local server) and a central service (e.g. the internet), illustrated in Figure 5.6.4.3-2.
-	The UE (Network Function) shall use the method specified in clause 4.3.5.3 of TS 23.502 [3] to determine if a multi-homed PDU Session is used to support the service continuity case shown in Figure 5.6.4.3-1, or if it is used to support the local access to DN (Network Function) case shown in Figure 5.6.4.3-2.

Figure 5.6.4.3-1: Multi-homed PDU Session: service continuity case
NOTE 2:	It is possible for a given UPF (Network Function) to support both the Branching Point and the PDU Session Anchor functionalities.

Figure 5.6.4.3-2: Multi-homed PDU Session: local access to same DN (Network Function)
NOTE 3:	It is possible for a given UPF (Network Function) to support both the Branching Point and the PDU Session Anchor functionalities.
The access to a DN (Network Function) via a PDU Session for a LADN is only available in a specific LADN service area. A LADN service area is a set of Tracking Areas. LADN is a service provided by the serving PLMN. It includes:
-	LADN service applies only to 3GPP accesses and does not apply in Home Routed case.
-	The usage of LADN DNN requires an explicit subscription to this DNN or subscription to a wildcard DNN.
-	Whether a DNN corresponds to a LADN service is an attribute of a DNN and is per PLMN.
The UE (Network Function) is configured to know whether a DNN is a LADN DNN on a per-PLMN basis, and an association between application and LADN DNN. The configured association is considered to be a UE (Network Function) local configuration defined in TS 23.503 [45]. Alternatively, the UE (Network Function) gets the information whether a DNN is a LADN DNN from LADN Information during (re-)registration procedure as described in this clause.
NOTE 1:	No other procedure for configuring the UE (Network Function) to know whether a DNN is a LADN DNN is defined in this release of the specifications.
NOTE 2:	The procedure for configuring the UE (Network Function) to know an association between application and LADN DNN is not defined in this release of the specifications.
LADN service area and LADN DNN are configured in the AMF (Network Function) on a per DN (Network Function) basis, i.e. for different UEs accessing the same LADN, the configured LADN service area is the same regardless of other factors (e.g. UE (Network Function)'s Registration Area or UE (Network Function) subscription).
NOTE 3:	If a LADN is not available in any TA of an AMF (Network Function)'s service area, the AMF (Network Function) is not required to be configured with any LADN related information for that DNN.
LADN Information (i.e. LADN Service Area Information and LADN DNN) is provided by AMF (Network Function) to the UE (Network Function) during the Registration procedure or UE (Network Function) Configuration Update procedure. For each LADN DNN configured in the AMF (Network Function), the corresponding LADN Service Area Information includes a set of Tracking Areas that belong to the Registration Area that the AMF (Network Function) assigns to the UE (Network Function) (i.e. the intersection of the LADN service area and the assigned Registration Area). The AMF (Network Function) shall not create Registration Area based on the availability of LADNs.
NOTE 4:	It is thus possible that the LADN Service Area Information sent by the AMF (Network Function) to the UE (Network Function) contains only a sub-set of the full LADN service area as the LADN service area can contain TA(s) outside of the registration area of the UE (Network Function) or outside of the area served by the AMF (Network Function).
When the UE (Network Function) performs a successful (re-)registration procedure, the AMF (Network Function) may provide to the UE (Network Function), based on local configuration (e.g. via OAM) about LADN, on UE (Network Function) location, and on UE (Network Function) subscription information received from the UDM (Network Function) about subscribed DNN(s), the LADN Information for the list of LADN available to the UE (Network Function) in that Registration Area in the Registration Accept message.
The UE (Network Function) may provide either the LADN DNN(s) to retrieve the LADN Information for the indicated LADN DNN(s) or an indication of Requesting LADN Information to retrieve the LADN Information for all LADN(s) available in the current Registration Area.
The list of LADN is determined as follows:
-	If neither LADN DNN nor an indication of requesting LADN Information is provided in the Registration Request message, the list of LADN is the LADN DNN(s) in subscribed DNN list except for wildcard DNN.
-	If the UE (Network Function) provides LADN DNN(s) in the Registration Request message, the list of LADN is LADN DNN(s) the UE (Network Function) requested if the UE (Network Function) subscribed DNN(s) includes the requested LADN DNN or if a wildcard DNN is included in the UE (Network Function)'s subscription data.
NOTE 5:	It is assumed that an application can use only one LADN DNN at a time.
-	If the UE (Network Function) provides an indication of requesting LADN Information in the Registration Request message, the list of LADN is all the LADN DNN(s) configured in the AMF (Network Function) if the wildcard DNN is subscribed, or the LADN DNN(s) which is in subscribed DNN list and no wildcard DNN is subscribed.
The UE (Network Function) considers the retrieved LADN Information valid only for the registered PLMN and the E-PLMN(s) if the LADN Service Area Information includes Tracking Areas that belong to E-PLMN(s). Additionally, an LADN DNN discovered by the UE (Network Function) via the retrieved LADN Information is considered an LADN DNN also in the E-PLMNs of the Registered PLMN, i.e. the UE (Network Function) can request LADN Information for the discovered LADN DNN in the E-PLMNs.
During the subsequent Registration procedure, if the network does not provide LADN Information for a DNN, the UE (Network Function) deletes any LADN Information for that DNN.
When the LADN Information for the UE (Network Function) in the 5GC is changed, the AMF (Network Function) shall update LADN Information to the UE (Network Function) through UE (Network Function) Configuration Update/Registration procedure as described in clauses 4.2.4 / 4.2.2.2.2 of TS 23.502 [3].
When receiving PDU Session Establishment with LADN DNN or Service Request for the established PDU Session corresponding to LADN, the AMF (Network Function) determines UE (Network Function) presence in LADN service area and forwards it to the SMF (Network Function) if the requested DNN is configured at the AMF (Network Function) as a LADN DNN.
Based on the LADN Service Area Information in the UE (Network Function), the UE (Network Function) determines whether it is in or out of a LADN service area. If the UE (Network Function) does not have the LADN Service Area Information for a LADN DNN, the UE (Network Function) shall consider it is out of the LADN service area.
The UE (Network Function) takes actions as follows:
a)	When the UE (Network Function) is out of a LADN service area, the UE (Network Function):
-	shall not request to activate UP connection of a PDU Session for this LADN DNN;
-	shall not attempt to send user data as payload of a NAS (Protocol) message (see clause 5.31.4.1) using a PDU Session for this LADN DNN;
-	shall not establish/modify a PDU Session for this LADN DNN (except for PS Data Off status change reporting for an established PDU Session);
-	need not release any existing PDU Session for this LADN DNN unless UE (Network Function) receives explicit SM PDU Session Release Request message from the network.
b)	When the UE (Network Function) is in a LADN service area, the UE (Network Function):
-	may request a PDU Session Establishment/Modification for this LADN DNN;
-	may request to activate UP connection of the existing PDU Session for this LADN DNN;
-	may attempt to send user data as payload of a NAS (Protocol) message (see clause 5.31.4.1) using a PDU Session for this LADN DNN.
NOTE 6:	The evaluation of Service Area Restrictions will be performed before the evaluation of LADN service area, if the UE (Network Function) has overlapping areas between Service Area Restrictions and LADN service area.
The SMF (Network Function) supporting a DNN is configured with information about whether this DNN is a LADN DNN or not.
When receiving SM request corresponding an LADN from the AMF (Network Function), the SMF (Network Function) determines whether the UE (Network Function) is inside LADN service area based on the indication (i.e. UE (Network Function) Presence in LADN service area) received from the AMF (Network Function). If the SMF (Network Function) does not receive the indication, the SMF (Network Function) considers that the UE (Network Function) is outside of the LADN service area. The SMF (Network Function) shall reject the request if the UE (Network Function) is outside of the LADN service area.
When the SMF (Network Function) receives a request for PDU Session Establishment with the LADN DNN, it shall subscribe to "UE (Network Function) mobility event notification" for reporting UE (Network Function) presence in Area of Interest by providing LADN DNN to the AMF (Network Function) as described in clauses 5.6.11 and 5.3.4.4.
Based on the notification about the UE (Network Function) presence in LADN service area notified by AMF (Network Function) (i.e. IN, OUT, or UNKNOWN), the SMF (Network Function) takes actions as follows based on operator's policy:
a)	When SMF (Network Function) is informed that the UE (Network Function) presence in a LADN service area is OUT, the SMF (Network Function) shall:
-	release the PDU Session immediately; or
-	deactivate the user plane connection for the PDU Session and it shall not attempt to send user data as payload of a NAS (Protocol) message (see clause 5.31.4.1) while maintaining the PDU Session and ensure the Data Notification is disabled and the SMF (Network Function) may release the PDU Session if the SMF (Network Function) is not informed that the UE (Network Function) moves into the LADN service area after a period.
b)	When SMF (Network Function) is informed that the UE (Network Function) presence a LADN service area is IN, the SMF (Network Function) shall:
-	ensure that Data Notification is enabled.
-	trigger the Network triggered Service Request procedure for a LADN PDU Session to active the UP connection or send user data as payload of a NAS (Protocol) message (see clause 5.31.4.1) when the SMF (Network Function) receives downlink data or Data Notification from UPF (Network Function).
c)	When the SMF (Network Function) is informed that the UE (Network Function) presence in a LADN service area is UNKNOWN, the SMF (Network Function) may:
-	ensure that Data Notification is enabled.
-	trigger the Network triggered Service Request procedure for a LADN PDU Session to active the UP connection or send user data as payload of a NAS (Protocol) message (see clause 5.31.4.1) when the SMF (Network Function) receives downlink data or Data Notification from UPF (Network Function).
SMF (Network Function) may make use of UE (Network Function) mobility analytics provided by NWDAF (Network Function), as described in clause 6.7.2 of TS 23.288 [86], to determine UE (Network Function) presence pattern in LADN service area and take a decision how to handle LADN PDN Session (e.g. release the PDU Session immediately, or deactivate the user plane connection for the PDU Session with maintaining the PDU Session).
5.6.5a	Supporting LADN per DNN and S-NSSAI
The 5GS may support LADN per DNN and S-NSSAI, and the functions specified in clause 5.6.5 are used (with the extension to apply per DNN and S-NSSAI whenever applicable) with the following enhancements:
-	The UE (Network Function) indicates the support of LADN per DNN and S-NSSAI in the UE (Network Function) MM Core Network Capability of the Registration Request message.
-	The LADN service area can be provisioned for a group (e.g. 5G VN group) or an individual subscriber using UDM (Network Function)/NEF (Network Function) parameter provisioning service triggered by AF (Network Function) request as described in clause 4.15.6 of TS 23.502 [3].
-	LADN service area per DNN and S-NSSAI may be configured in the AMF (Network Function). The LADN service area may also be provided to AMF (Network Function) as part of the subscription data from UDM (Network Function).
-	The LADN Service Area Information provided to the UE (Network Function) is determined by AMF (Network Function), based on the Registration Area that the AMF (Network Function) assigns to the UE (Network Function) and either the local configured LADN service area or the LADN service area received from UDM (Network Function). In case there is both a configured LADN service area and a LADN service area received from UDM (Network Function), the AMF (Network Function) decides based on operator configuration which one takes precedence.
-	If the UE (Network Function) indicates support of LADN per DNN and S-NSSAI, the AMF (Network Function) may provide the LADN Service Area Information per LADN DNN and S-NSSAI to the UE (Network Function).
-	If the UE (Network Function) does not indicate support of LADN per DNN and S-NSSAI and the AMF (Network Function) has a LADN service area for the DNN as well as a LADN service area for the DNN and S-NSSAI, the AMF (Network Function) may determine the LADN Service Area Information per LADN DNN sent to UE (Network Function) using the LADN service area for the DNN as described in clause 5.6.5.
-	If the UE (Network Function) does not indicate support of LADN per DNN and S-NSSAI and the AMF (Network Function) has no LADN service area for the DNN but there is a LADN service area for the DNN and S-NSSAI, then the AMF (Network Function) may determine the LADN Service Area Information per LADN DNN sent to UE (Network Function) using this LADN service area for the DNN and S-NSSAI as the LADN service area for that DNN as described in clause 5.6.5 if the UE (Network Function) is not subscribed to the same DNN for multiple S-NSSAI(s) (i.e. the UE (Network Function) is subscribed to the DNN for a single S-NSSAI only).
NOTE:	In order to serve the UEs that do not support LADN per DNN and S-NSSAIs, the operator can avoid using the same DNN for multiple S-NSSAIs if LADN service area is configured per DNN and S-NSSAI.
-	If the UE (Network Function) does not indicate support of LADN per DNN and S-NSSAI and the AMF (Network Function) neither has a LADN service area for the DNN nor has a LADN service area for the DNN and S-NSSAI, the AMF (Network Function) shall not provide any LADN Information to the UE (Network Function).
-	The AMF (Network Function) enforces the LADN Service Area per LADN DNN and S-NSSAI in the same way as is described in clause 5.6.5 with the difference that the LADN service area is defined per DNN and S-NSSAI.
-	The UE (Network Function) enforces the LADN Service Area per LADN DNN and S-NSSAI, if received from the AMF (Network Function), in the same way as is described in clause 5.6.5 with the difference that the LADN service area is defined per DNN and S-NSSAI.
-	If the AMF (Network Function) enforces the LADN Service Area per LADN DNN and S-NSSAI for the UE (Network Function), the AMF (Network Function) indicates to the SMF (Network Function) during PDU Session Establishment that the PDU Session is subject to LADN per LADN DNN and S-NSSAI. If indicated by AMF (Network Function) at PDU Session Establishment that PDU Session is subject to LADN per LADN DNN and S-NSSAI, the SMF (Network Function) configures the DNN of PDU Session as LADN DNN and subscribes to "UE (Network Function) mobility event notification" for reporting UE (Network Function) presence in Area of Interest by providing LADN DNN and S-NSSAI to the AMF (Network Function) as described in clauses 5.6.11 and 5.3.4.4.
At PDU Session Establishment to a DN (Network Function):
-	The DN (Network Function)-specific identity (TS 33.501 [29]) of a UE (Network Function) may be authenticated/authorized by the DN (Network Function).
NOTE 1: the DN (Network Function)-AAA server may belong to the 5GC or to the DN (Network Function).
-	If the UE (Network Function) provides authentication/authorization information corresponding to a DN (Network Function)-specific identity during the Establishment of the PDU Session, and the SMF (Network Function) determines that Secondary authentication/authorization of the PDU Session Establishment is required based on the SMF (Network Function) policy associated with the DN (Network Function), the SMF (Network Function) passes the authentication/authorization information of the UE (Network Function) to the DN (Network Function)-AAA server via the UPF (Network Function) if the DN (Network Function)-AAA server is located in the DN (Network Function). If the SMF (Network Function) determines that Secondary authentication/authorization of the PDU Session Establishment is required but the UE (Network Function) has not provided a DN (Network Function)-specific identity as part of the PDU Session Establishment request, the SMF (Network Function) requests the UE (Network Function) to indicate a DN (Network Function)-specific identity using EAP procedures as described in TS 33.501 [29]. If the Secondary authentication/authorization of the PDU Session Establishment fails, the SMF (Network Function) rejects the PDU Session Establishment.
NOTE 2:	If the DN (Network Function)-AAA server is located in the 5GC and reachable directly, then the SMF (Network Function) may communicate with it directly without involving the UPF (Network Function).
-	The DN (Network Function)-AAA server may authenticate/authorize the PDU Session Establishment.
-	When DN (Network Function)-AAA server authorizes the PDU Session Establishment, it may send DN (Network Function) Authorization Data for the established PDU Session to the SMF (Network Function). The DN (Network Function) authorization data for the established PDU Session may include one or more of the following:
-	A DN (Network Function) Authorization Profile Index which is a reference to authorization data for policy and charging control locally configured in the SMF (Network Function) or PCF (Network Function).
-	a list of allowed MAC  (Protocol)addresses for the PDU Session; this shall apply only for PDU Session of Ethernet PDU type and is further described in clause 5.6.10.2.
-	a list of allowed VLAN tags for the PDU Session; this shall apply only for PDU Session of Ethernet PDU type and is further described in clause 5.6.10.2.
-	DN (Network Function) authorized Session AMBR for the PDU Session. The DN (Network Function) Authorized Session AMBR for the PDU Session takes precedence over the subscribed Session-AMBR received from the UDM (Network Function).
-	Framed Route information (see clause 5.6.14) for the PDU Session.
-	L2TP information, such as LNS IP  (Protocol)address and/or LNS host name, as described in TS 29.561 [132].
SMF (Network Function) policies may require DN (Network Function) authorization without Secondary authentication/authorization. In that case, when contacting the DN (Network Function)-AAA server for authorization, the SMF (Network Function) provides the GPSI of the UE (Network Function) if available.
Such Secondary authentication/authorization takes place for the purpose of PDU Session authorization in addition to:
-	The 5GC access authentication handled by AMF (Network Function) and described in clause 5.2.
-	The PDU Session authorization enforced by SMF (Network Function) with regards to subscription data retrieved from UDM (Network Function).
Based on local policies the SMF (Network Function) may initiate Secondary authentication/authorization at PDU Session Establishment. The SMF (Network Function) provides the GPSI, if available, in the signalling exchanged with the DN (Network Function)-AAA during Secondary authentication/authorization.
After the successful Secondary authentication/authorization, a session is kept between the SMF (Network Function) and the DN (Network Function)-AAA.
The UE (Network Function) provides the authentication/authorization information required to support Secondary authentication/authorization by the DN (Network Function) over NAS (Protocol) SM.
If a UE (Network Function) is configured with DNNs, which are subject to secondary authentication/authorization, the UE (Network Function) stores an association between the DNN and corresponding credentials for the secondary authentication/authorization.
NOTE 3:	How the UE (Network Function) is aware that a DNN is subject to secondary authentication/authorization (e.g. based on local configuration) is out of scope of this specification.
The UE (Network Function) may support remote provisioning of credentials for secondary authentication/authorization, as specified in clause 5.39.
A UE (Network Function) that supports to be provisioned with the credentials used for secondary authentication/authorization over UP remote provisioning shall use connectivity over an S-NSSAI/DNN which can access the provisioning server to establish a PDU session for remote provisioning as defined in clause 5.39.
NOTE 4:	The credentials for secondary authentication/authorization are not specified.
SMF (Network Function) policies or subscription information (such as defined in Table 5.2.3.3.1 of TS 23.502 [3]) may trigger the need for SMF (Network Function) to request the Secondary authentication/authorization and/or UE (Network Function) IP  (Protocol)address / Prefix from the DN (Network Function)-AAA server.
When SMF (Network Function) adds a PDU Session Anchor (such as defined in clause 5.6.4) to a PDU Session Secondary authentication/authorization is not carried out, but SMF (Network Function) policies may require SMF (Network Function) to notify the DN (Network Function) when a new prefix or address has been added to or removed from a PDU Session or N6 (Non-service-based Interface) (Service-based Interface) traffic routing information has been changed for a PDU Session.
When SMF (Network Function) gets notified from UPF (Network Function) with the addition or removal of MAC  (Protocol)addresses to/from a PDU Session, the SMF (Network Function) policies may require SMF (Network Function) to notify the DN (Network Function)-AAA server.
Indication of PDU Session Establishment rejection is transferred by SMF (Network Function) to the UE (Network Function) via NAS (Protocol) SM.
If the DN (Network Function)-AAA sends DN (Network Function) Authorization Data for the authorized PDU Session to the SMF (Network Function) and dynamic PCC is deployed, the SMF (Network Function) sends the PCF (Network Function) the DN (Network Function) authorized Session AMBR and/or DN (Network Function) Authorization Profile Index in the DN (Network Function) Authorization Data for the established PDU Session.
If the DN (Network Function)-AAA sends DN (Network Function) Authorization Profile Index in DN (Network Function) Authorization Data to the SMF (Network Function) and dynamic PCC is not deployed, the SMF (Network Function) uses the DN (Network Function) Authorization Profile Index to refer the locally configured information.
NOTE 5:	DN (Network Function) Authorization Profile Index is assumed to be pre-negotiated between the operator and the administrator of DN (Network Function)-AAA server.
If the DN (Network Function)-AAA does not send DN (Network Function) Authorization Data for the established PDU Session, the SMF (Network Function) may use locally configured information.
At any time, a DN (Network Function)-AAA server may revoke the authorization for a PDU Session or update DN (Network Function) Authorization Data for a PDU Session. According to the request from DN (Network Function)-AAA server, the SMF (Network Function) may release or update the PDU Session. See clause 5.6.14 when the update involves Framed Route information.
At any time, a DN (Network Function)-AAA server or SMF (Network Function) may trigger Secondary Re-authentication procedure for a PDU Session established with Secondary Authentication as specified in clause 11.1.3 of TS 33.501 [29].
During Secondary Re-authentication/Re-authorization, if the SMF (Network Function) receives from DN (Network Function)-AAA the DN (Network Function) authorized Session AMBR and/or DN (Network Function) Authorization Profile Index, the SMF (Network Function) shall report the received value(s) to the PCF (Network Function).
The procedure for secondary authentication/authorization by a DN (Network Function)-AAA server during the establishment of a PDU Session is described in clause 4.3.2.3 of TS 23.502 [3].
The support for L2TP on N6 (Non-service-based Interface) (Service-based Interface) is further specified in clause 5.8.2.16, and the procedure for establishment of L2TP tunnelling on N6 (Non-service-based Interface) (Service-based Interface) for a PDU Session is described in clause 4.3.2.4 of TS 23.502 [3].
NOTE 6:	The L2TP Tunnel information sent to the SMF (Network Function) can, for example, be provisioned in the DN (Network Function)-AAA server per DNN/S-NSSAI or per SUPI or GPSI.
The content of this clause applies to non-roaming and to LBO deployments i.e. to cases where the involved entities (AF (Network Function), PCF (Network Function), SMF (Network Function), UPF (Network Function)) belong to the Serving PLMN or AF (Network Function) belongs to a third party with which the Serving PLMN has an SLA agreement.
AF (Network Function) influence on traffic routing may apply in the case of Home Routed deployments with Session Breakout (HR SBO) as defined in TS 23.548 [130]. In that case when an AF (Network Function) belonging to the V-PLMN (or with an offloading SLA with the V PLMN) desires to provide Traffic Influence policies it may invoke at the V-NEF (Network Function) the API defined in this clause and provide the information listed in Table 5.6.7-1 below but the corresponding Traffic Influence information is provided directly from V-NEF (Network Function) to V-SMF (Network Function) bypassing the PCF (Network Function). This is further defined in TS 23.548 [130] clause 6.7.2. and the rest of the clause 5.6.7.1 does not address how information related with AF (Network Function) influence on traffic routing may be provided to the SMF (Network Function) in the case of HR SBO.
PCF (Network Function) shall not apply AF (Network Function) requests to influence traffic routing to PDU Sessions established in Home Routed mode.
The AF (Network Function) may determine the common EAS/DNAI for the UE (Network Function) set in order to indicate a common EAS or common local part of DN (Network Function), and provide the common EAS/DNAI to the 5GS.
An AF (Network Function) may send requests to influence SMF (Network Function) routeing decisions for traffic of PDU Session. The AF (Network Function) requests may influence UPF (Network Function) (re)selection and (I-)SMF (Network Function) (re)selection and allow routeing user traffic to a local access to a Data Network (identified by a DNAI).
The AF (Network Function) may issue requests on behalf of applications not owned by the PLMN serving the UE (Network Function).
If the operator does not allow an AF (Network Function) to access the network directly, the AF (Network Function) shall use the NEF (Network Function) to interact with the 5GC, as described in clause 6.2.10.
The AF (Network Function) may be in charge of the (re)selection or relocation of the applications within the local part of the DN (Network Function) (as defined in TS 23.548 [130]). Such functionality is not defined. For this purpose, the AF (Network Function) may request to get notified about events related with PDU Sessions.
In the case of AF (Network Function) instance change, the AF (Network Function) may send request of AF (Network Function) relocation information.
The AF (Network Function) requests are sent to the PCF (Network Function) via N5 (Service-based Interface) (in the case of requests targeting specific on-going PDU Sessions of individual UE (Network Function)(s), for an AF (Network Function) allowed to interact directly with the 5GC NFs) or via the NEF (Network Function). The AF (Network Function) requests that target existing or future PDU Sessions of multiple UE (Network Function)(s) or of any UE (Network Function) are sent via the NEF (Network Function) and may target multiple PCF (Network Function)(s), as described in clause 6.3.7.2. The PCF (Network Function)(s) transform(s) the AF (Network Function) requests into policies that apply to PDU Sessions. When the AF (Network Function) has subscribed to UP path management event notifications from SMF (Network Function)(s) (including notifications on how to reach a GPSI over N6 (Non-service-based Interface) (Service-based Interface)), such notifications are sent either directly to the AF (Network Function) or via an NEF (Network Function) (without involving the PCF (Network Function)). For AF (Network Function) interacting with PCF (Network Function) directly or via NEF (Network Function), the AF (Network Function) requests may contain the information as described in the Table 5.6.7-1:
Table 5.6.7-1: Information element contained in AF (Network Function) request

For each information element mentioned above in the AF (Network Function) request, the detailed description is as follows:
1)	Information to identify the traffic. The traffic can be identified in the AF (Network Function) request by
-	Either a DNN and possibly slicing information (S-NSSAI) or an AF (Network Function)-Service-Identifier
-	When the AF (Network Function) provides an AF (Network Function)-Service-Identifier i.e. an identifier of the service on behalf of which the AF (Network Function) is issuing the request, the 5G Core maps this identifier into a target DNN and slicing information (S-NSSAI)
-	When the NEF (Network Function) processes the AF (Network Function) request the AF (Network Function)-Service-Identifier may be used to authorize the AF (Network Function) request.
-	An application identifier or traffic filtering information (e.g. IP  (Protocol)5 Tuple). The application identifier refers to an application handling UP traffic and is used by the UPF (Network Function) to detect the traffic of the application.
	When the AF (Network Function) request is for influencing SMF (Network Function) routing decisions, the information is to identify the traffic to be routed.
	When the AF (Network Function) request is for subscription to notifications about UP path management events, the information is to identify the traffic that the events relate to.
2)	Information about the N6 (Non-service-based Interface) (Service-based Interface) traffic routing requirements for traffic identified as defined in 1). This includes:
-	Information about the N6 (Non-service-based Interface) (Service-based Interface) traffic routing requirements that is provided per DNAI: for each DNAI, the N6 (Non-service-based Interface) (Service-based Interface) traffic routing requirements may contain a routing profile ID and/or N6 (Non-service-based Interface) (Service-based Interface) traffic routing information.
-	An optional indication of traffic correlation, when the information in 4) identifies a group of UEs. This implies the targeted PDU Sessions should be correlated by a common DNAI in the user plane for the traffic identified in 1). If this indication is provided by the AF (Network Function), the 5GC should select a common DNAI for the target PDU Sessions from the list of DNAI(s) specified in 3).
NOTE 1:	The N6 (Non-service-based Interface) (Service-based Interface) traffic routing requirements are related to the mechanism enabling traffic steering in the local access to the DN (Network Function). The routing profile ID refers to a pre-agreed policy between the AF (Network Function) and the 5GC. This policy may refer to different steering policy ID(s) sent to SMF (Network Function) and e.g. based on time of the day etc.
NOTE 2:	The mechanisms enabling traffic steering in the local access to the DN (Network Function) are not defined.
3)	Potential locations of applications towards which the traffic routing should apply. The potential location of application is expressed as a list of DNAI(s). If the AF (Network Function) interacts with the PCF (Network Function) via the NEF (Network Function), the NEF (Network Function) may map the AF (Network Function)-Service-Identifier information to a list of DNAI(s). The DNAI(s) may be used for UPF (Network Function) (re)selection and (I-)SMF (Network Function) (re)selection. When only one DNAI is included, and the Indication of traffic correlation is available, the DNAI is used as common DNAI for UEs identified by AF (Network Function) request.
4)	Information on the set of target UE (Network Function)(s). This may correspond to:
-	Individual UEs (i.e. one or a list of UEs) identified using GPSI, or an IP  (Protocol)address/Prefix or a MAC  (Protocol)address.
-	Group(s) of UEs identified by External Group Identifier(s) as defined in TS 23.682 [36] when the AF (Network Function) interacts via the NEF (Network Function), or Internal-Group Identifier (see clause 5.9.7) when the AF (Network Function) interacts directly with the PCF (Network Function).
-	Any UE (Network Function) accessing the combination of DNN, S-NSSAI and DNAI(s).
-	External Group ID(s) or any UE (Network Function) can both be complemented with External Subscriber Category(s) for a more granular selection of UEs. NEF (Network Function) may map this to Internal Group ID(s) or a combination of Internal Group ID(s) and Subscriber Category(s), defined in TS 23.503 [45].
NOTE 3:	Only NEF (Network Function) is aware of the External Subscriber Category. As a user can be associated with multiple Subscriber Category(s), some values of Subscriber Category(s) can correspond to an SLA between an application provider represented by an AF (Network Function) and the 5GC operator. In the NEF (Network Function) API, the combination of application identifier and External Subscriber Category can also be used to refer to this SLA.
	When the PDU Session type is IPv4 or IPv6 or IPv4v6, and the AF (Network Function) provides an IP  (Protocol)address and/or an IP  (Protocol)Prefix, or when the PDU Session type is Ethernet and the AF (Network Function) provides a MAC  (Protocol)address, this allows the PCF (Network Function) to identify the PDU Session for which this request applies and the AF (Network Function) request applies only to that specific PDU Session of the UE (Network Function). In this case, additional information such as the UE (Network Function) identity may also be provided to help the PCF (Network Function) to identify the correct PDU Session.
	Otherwise, the request targets multiple UE (Network Function)(s) and shall apply to any existing or future PDU Sessions that match the parameters in the AF (Network Function) request.
	When the AF (Network Function) request targets an individual or a list of UE (Network Function)(s) and GPSI is provided within the AF (Network Function) request, the GPSI is mapped to SUPI according to the subscription information received from UDM (Network Function).
	When the AF (Network Function) request targets any UE (Network Function) or a group of UE (Network Function), the AF (Network Function) request is likely to influence multiple PDU Sessions possibly served by multiple SMFs and PCFs.
	When the AF (Network Function) request targets a group of UE (Network Function) it provides one or several group identifiers in its request. The group identifiers provided by the AF (Network Function) are mapped to Internal-Group identifiers. Members of the group have Group Identifier(s) in their subscription. The Internal-Group Identifier(s) is(are) stored in UDM (Network Function), retrieved by SMF (Network Function) from UDM (Network Function) and passed by SMF (Network Function) to PCF (Network Function) at PDU Session set-up. The PCF (Network Function) can then map the AF (Network Function) request with user subscription and determine whether an AF (Network Function) request targeting a Group of users applies to a PDU Session. When External Subscriber Category(s) is provided, the NEF (Network Function) maps External Subscriber Category(s) into Subscriber Category(s), the PCF (Network Function) can map the AF (Network Function) request with user subscription and then creates PCC rules for UEs that have the Susbscriber Category(s) in their subscription.
	When the AF (Network Function) request is for influencing SMF (Network Function) routing decisions, the information is to identify UE (Network Function)(s) whose traffic is to be routed.
	When the AF (Network Function) request is for subscription to notifications about UP path management events, the information is to identify UE (Network Function)(s) whose traffic the events relate to.
	When the AF (Network Function) request is for traffic forwarding in a PDU Session serving for TSC, the MAC  (Protocol)address used by the PDU Session is determined by the AF (Network Function) to identify UE (Network Function) whose traffic is to be routed according to the previously stored binding relationship of the 5GS Bridge and the port number of the traffic forwarding information received from TSN network.
5)	Indication of application relocation possibility. This indicates whether an application can be relocated once a location of the application is selected by the 5GC. If application relocation is not possible, the 5GC shall ensure that for the traffic related with an application, no DNAI change takes place once selected for this application.
6)	Temporal validity condition. This is provided in the form of time interval(s) or duration(s) during which the AF (Network Function) request is to be applied.
	When the AF (Network Function) request is for influencing SMF (Network Function) routing decisions, the temporal validity condition indicates when the traffic routing is to apply.
	When the AF (Network Function) request is for subscription to notifications about UP path management events, the temporal validity condition indicates when the notifications are to be generated.
7)	Spatial validity condition on the UE (Network Function)(s) location. This is provided in the form of validity area(s). If the AF (Network Function) interacts with the PCF (Network Function) via the NEF (Network Function), it may provide geographical area (e.g. a civic address or shapes) and the NEF (Network Function) maps the information to areas of validity based on pre-configuration. The PCF (Network Function) in turn determines area(s) of interest based on validity area(s).
	When the AF (Network Function) request is for influencing SMF (Network Function) routing decisions, the spatial validity condition indicates that the request applies only to the traffic of UE (Network Function)(s) located in the specified location.
	When the AF (Network Function) request is for subscription to notifications about UP path management events, the spatial validity condition indicates that the subscription applies only to the traffic of UE (Network Function)(s) located in the specified location.
8)	Information on AF (Network Function) subscription to corresponding SMF (Network Function) events.
	The AF (Network Function) may request to be subscribed to change of UP path associated with traffic identified in the bullet 1) above. The AF (Network Function) request contains:
-	A type of subscription (subscription for Early and/or Late notifications).
	The AF (Network Function) subscription can be for Early notifications and/or Late notifications. In the case of a subscription for Early notifications, the SMF (Network Function) sends the notifications before the (new) UP path is configured. In the case of a subscription for Late notifications, the SMF (Network Function) sends the notification after the (new) UP path has been configured.
-	Notification target address for receiving event notification.
-	Optionally, an indication of "AF (Network Function) acknowledgment to be expected".
	The indication implies that the AF (Network Function) will provide a response to the notifications of UP path management events to the 5GC. The SMF (Network Function) may, according to this indication, determine to wait for a response from the AF (Network Function) before the SMF (Network Function) configures in the case of early notification, or activates in the case of late notification, the new UP path as described in clause 5.6.7.2.
-	Optionally, an immediate reporting flag.
	The immediate reporting flag is included when AF (Network Function) subscribe for candidate DNAI(s) of UE (Network Function) for common EAS/DNAI selection. With this flag, SMF (Network Function) should immediately response AF (Network Function) with the candidate DNAI(s) using Notification of user plane management event as described in clause 4.3.6.3 in TS 23.502 [3].
	The AF (Network Function) subscription can also request to receive information associating the GPSI of the UE (Network Function) with the IP  (Protocol)address(es) of the UE (Network Function) and/or with actual N6 (Non-service-based Interface) (Service-based Interface) traffic routing to be used to reach the UE (Network Function) on the PDU Session; in this case the corresponding information is sent by the SMF (Network Function) regardless of whether a DNAI applies to the PDU Session.
9)	An AF (Network Function) transaction identifier referring to the AF (Network Function) request. This allows the AF (Network Function) to update or remove the AF (Network Function) request and to identify corresponding UP path management event notifications. The AF (Network Function) transaction identifier is generated by the AF (Network Function).
	When the AF (Network Function) interacts with the PCF (Network Function) via the NEF (Network Function), the NEF (Network Function) maps the AF (Network Function) transaction identifier to an AF (Network Function) transaction internal identifier, which is generated by the NEF (Network Function) and used within the 5GC to identify the information associated to the AF (Network Function) request. The NEF (Network Function) maintains the mapping between the AF (Network Function) transaction identifier and the AF (Network Function) transaction internal identifier. The relation between the two identifiers is implementation specific.
	When the AF (Network Function) interacts with the PCF (Network Function) directly, the AF (Network Function) transaction identifier provided by the AF (Network Function) is used as AF (Network Function) transaction internal identifier within the 5GC.
10)	Indication of UE (Network Function) IP  (Protocol)address preservation. This indicates UE (Network Function) IP  (Protocol)address related to the traffic identified in bullet 1) should be preserved. If this indication is provided by the AF (Network Function), the 5GC should preserve the UE (Network Function) IP  (Protocol)address by preventing reselection of PSA (Network Function) UPF (Network Function) for the identified traffic once the PSA (Network Function) UPF (Network Function) is selected.
11)	Information for EAS IP  (Protocol)Replacement in 5GC. This indicates the Source EAS identifier and Target EAS identifier (i.e. IP  (Protocol)addresses and port numbers of the source and target EAS) for a service subject to Edge Computing.
12)	User Plane Latency Requirement. This includes AF (Network Function) requirements for User Plane latency. (see clause 6.3.6 of TS 23.548 [130]).
13)	Information on AF (Network Function) change. The AF (Network Function) relocation information includes:
-	AF (Network Function) Identifier: the identifier of the target AF (Network Function) instance.
NOTE 4:	The AF (Network Function) relocation information is applicable for interaction with NEF (Network Function) only and it is not stored in UDR (Network Function) or transferred to PCF (Network Function), even for the case AF (Network Function) directly interacts with PCF (Network Function).
14)	Indication for EAS relocation. This indicates the application(s) are to be relocated.
15)	Indication for Simultaneous Connectivity over source and target PSA (Network Function) at Edge Relocation (see clause 6.3.4 of TS 23.548 [130]). Indicates that source and target PSA (Network Function) should coexist for some time at PSA (Network Function) relocation, and may influence the establishment of a temporary N9 (Service-based Interface) forwarding tunnel between the source UL CL and target UL CL. It may also provide guidance for the time interval after the described traffic ceases when the connectivity over the source PSA (Network Function) may be removed.
16)	Traffic Correlation ID. Identification of a set of UEs subjecting to the AF (Network Function) request and accessing the application identified by the Traffic Description. UEs associated with the same Traffic Correlation ID and accessing the application identified by the Traffic Description should connect to a common EAS or EAS(es) corresponding to a common DNAI.
	The following attributes may be provided with the Traffic Correlation ID:
-	EAS Correlation indication. Indicates selecting a common EAS for a set of UEs identified by Traffic Correlation ID and accessing the application identified by the Traffic Description.
-	Common EAS IP  (Protocol)address. IP  (Protocol)address of the common EAS to be accessed by the UEs in the set of UE (Network Function) subject to AF (Network Function) request, for the application identified by the Traffic Description.
NOTE 5:	In the case of common EAS selection, if Traffic Correlation ID is provided, either EAS Correlation indication or Common EAS will be included in AF (Network Function) request.
-	FQDN(s). FQDN(s) corresponding to the application to be accessed by a set of UEs. When FQDN(s) is included, it is used for influencing EAS discovery procedure as defined in TS 23.548 [130].
-	Indication of traffic correlation as described in 2).
An AF (Network Function) may send requests to influence SMF (Network Function) routeing decisions, for event subscription or for both.
The AF (Network Function) may request to be subscribed to notifications about UP path management events, i.e. a UP path change occurs for the PDU Session. The corresponding notification about a UP path change sent by the SMF (Network Function) to the AF (Network Function) may indicate the DNAI and /or the N6 (Non-service-based Interface) (Service-based Interface) traffic routing information and/or common EAS that has changed as described in clause 4.3.6.3 of TS 23.502 [3]. It may include the AF (Network Function) transaction internal identifier, the type of notification (i.e. early notification or late notification), the Identity of the source and/or target DNAI, the IP  (Protocol)address/prefix of the UE (Network Function) or the MAC  (Protocol)address used by the UE (Network Function), the GPSI and the N6 (Non-service-based Interface) (Service-based Interface) traffic routing information related to the 5GC UP. The AF (Network Function) may subscribe for notifications of candidate DNAI(s) for UE (Network Function) if AF (Network Function) selection of common EAS/DNAI for a set of UEs is used.
NOTE 6:	The change from the UP path status where no DNAI applies to a status where a DNAI applies indicates the activation of this AF (Network Function) request; the change from the UP path status where a DNAI applies to a status where no DNAI applies indicates the de-activation of this AF (Network Function) request.
	In the case of IP  (Protocol)PDU Session Type, the IP  (Protocol)address/prefix of the UE (Network Function) together with N6 (Non-service-based Interface) (Service-based Interface) traffic routing information indicates to the AF (Network Function) how to reach over the User Plane the UE (Network Function) identified by its GPSI. N6 (Non-service-based Interface) (Service-based Interface) traffic routing information indicates any tunnelling that may be used over N6 (Non-service-based Interface) (Service-based Interface). The nature of this information depends on the deployment.
NOTE 7:	N6 (Non-service-based Interface) (Service-based Interface) traffic routing information can e.g. correspond to the identifier of a VPN or to explicit tunnelling information such as a tunnelling protocol identifier together with a Tunnel identifier.
NOTE 8:	In the case of Unstructured PDU Session type the nature of the N6 (Non-service-based Interface) (Service-based Interface) traffic routing information related to the 5GC UP is described in clause 5.6.10.3.
	In the case of Ethernet PDU Session Type, the MAC  (Protocol)address of the UE (Network Function) together with N6 (Non-service-based Interface) (Service-based Interface) traffic routing information indicates to the AF (Network Function) how to reach over the User Plane the UE (Network Function) identified by its GPSI. The UE (Network Function) MAC  (Protocol)address (es) is reported by the UPF (Network Function) as described in clause 5.8.2.12. The N6 (Non-service-based Interface) (Service-based Interface) traffic routing information can be, e.g. a VLAN ID or the identifier of a VPN or a tunnel identifier at the UPF (Network Function).
When notifications about UP path management events are sent to the AF (Network Function) via the NEF (Network Function), if required, the NEF (Network Function) maps the UE (Network Function) identify information, e.g. SUPI, to the GPSI and the AF (Network Function) transaction internal identifier to the AF (Network Function) transaction identifier before sending the notifications to the AF (Network Function).
The PCF (Network Function), based on information received from the AF (Network Function), operator's policy, optionally service experience analytics per UP path received from NWDAF (Network Function), etc. authorizes the request received from the AF (Network Function) and determines for each DNAI, a traffic steering policy ID (derived from the routing profile ID provided by the AF (Network Function)) and/or the N6 (Non-service-based Interface) (Service-based Interface) traffic routing information (as provided by the AF (Network Function)) to be sent to the SMF (Network Function) as part of the PCC rules. The traffic steering policy IDs are configured in the SMF (Network Function) or in the UPF (Network Function). The traffic steering policy IDs are related to the mechanism enabling traffic steering to the DN (Network Function).
The DNAIs are related to the information considered by the SMF (Network Function) for UPF (Network Function) selection and (I-)SMF (Network Function) (re)selection, e.g. for diverting (locally) some traffic matching traffic filters provided by the PCF (Network Function).
The PCF (Network Function) acknowledges a request targeting an individual PDU Session to the AF (Network Function) or to the NEF (Network Function).
For PDU Session that corresponds to the AF (Network Function) request, the PCF (Network Function) provides the SMF (Network Function) with a PCC rule that is generated based on the AF (Network Function) request, Local routing indication from the PDU Session policy control subscription information and taking into account UE (Network Function) location presence in area of interest (i.e. Presence Reporting Area). The PCC rule contains the information to identify the traffic, information about the DNAI(s) towards which the traffic routing should apply and optionally, an indication of traffic correlation and/or an indication of application relocation possibility and/or indication of UE (Network Function) IP  (Protocol)address preservation. The PCC rule also contains per DNAI a traffic steering policy ID and/or N6 (Non-service-based Interface) (Service-based Interface) traffic routing information, if the N6 (Non-service-based Interface) (Service-based Interface) traffic routing information is explicitly provided in the AF (Network Function) request.
If Traffic Correlation ID is included in the AF (Network Function) request, with EAS Correlation Indication or Common EAS, and FQDN(s) parameters, the Traffic Correlation ID and the EAS Correlation Indication or Common EAS, and FQDN(s) will be included in the PCC rule sent to SMF (Network Function). The SMF (Network Function) can use the Traffic Correlation ID to determine that the UE (Network Function) belongs to a set of UEs identified by Traffic Correlation ID and a common EAS should be selected for the set of UE (Network Function) for the traffic identified by Traffic Descriptor as described in clause 6.2.3.2.5 of TS 23.548 [130].
If Traffic Correlation ID is included in the AF (Network Function) request, NEF (Network Function) updates the AF (Network Function) influence data in the UDR (Network Function) with the NEF (Network Function) Notification Endpoint to indicate it as responsible of the set of UEs associated with the Traffic correlation ID and to be notified with 5GC determined information as described in clause 6.2.3.2.7 of TS 23.548 [130].
The PCF (Network Function) provides in the PCC rule with information to notify to the NEF (Network Function) with 5GC determined information related to the UE (Network Function) members of the set of UEs identified by traffic correlation ID.
If Traffic Correlation ID, and traffic correlation indication and FQDN(s) is included in the AF (Network Function) request, the Traffic Correlation ID and the traffic correlation indication will be included in the PCC rule sent to SMF (Network Function). The SMF (Network Function) can use the Traffic Correlation ID to determine that the UE (Network Function) belongs to a set of UEs identified by Traffic Correlation ID and the UE (Network Function) needs to connect to EAS(s) corresponding to a common DNAI selected for the set of UE (Network Function) for the traffic identified by Traffic Descriptor, as described in clause 6.2.3.2.6 of TS 23.548 [130].
The PCF (Network Function) may also provide in the PCC rule information to subscribe the AF (Network Function) (or the NEF (Network Function)) to SMF (Network Function) events (UP path changes) corresponding to the AF (Network Function) request in which case it provides the information on AF (Network Function) subscription to corresponding SMF (Network Function) events received in the AF (Network Function) request. This is done by providing policies at PDU Session set-up or by initiating a PDU Session Modification procedure. When initiating a PDU Session set-up or PDU Session Modification procedure, the PCF (Network Function) considers the latest known UE (Network Function) location to determine the PCC rules provided to the SMF (Network Function). The PCF (Network Function) evaluates the temporal validity condition of the AF (Network Function) request and informs the SMF (Network Function) to activate or deactivate the corresponding PCC rules according to the evaluation result. When policies specific to the PDU Session and policies general to multiple PDU Sessions exist, the PCF (Network Function) gives precedence to the PDU Session specific policies over the general policies. The PCF (Network Function) authorizes the AF (Network Function) request of User Plane Latency Requirements. If the PCF (Network Function) determines that the requirements can't be authorized, the PCF (Network Function) rejects the AF (Network Function) request.
The spatial validity condition is resolved at the PCF (Network Function). In order to do that, the PCF (Network Function) subscribes to the SMF (Network Function) to receive notifications about change of UE (Network Function) location in an area of interest (i.e. Presence Reporting Area). The subscribed area of interest may be the same as spatial validity condition, or may be a subset of the spatial validity condition (e.g. a list of TAs) based on the latest known UE (Network Function) location. When the SMF (Network Function) detects that UE (Network Function) entered the area of interest subscribed by the PCF (Network Function), the SMF (Network Function) notifies the PCF (Network Function) and the PCF (Network Function) provides to the SMF (Network Function) the PCC rules described above by triggering a PDU Session Modification. When the SMF (Network Function) becomes aware that the UE (Network Function) left the area subscribed by the PCF (Network Function), the SMF (Network Function) notifies the PCF (Network Function) and the PCF (Network Function) provides updated PCC rules by triggering a PDU Session Modification. SMF (Network Function) notifications to the PCF (Network Function) about UE (Network Function) location in or out of the subscribed area of interest are triggered by UE (Network Function) location change notifications received from the AMF (Network Function) or by UE (Network Function) location information received during a Service Request or Handover procedure.
When the PCC rules are activated, the SMF (Network Function) may, based on local policies, take the information in the PCC rules and, optionally, the Service Experience analytics and/or DN (Network Function) Performance analytics per UP path (including UPF (Network Function) and/or DNAI and/or AS instance) as defined in clause 6.4.3 and clause 6.14.3, respectively, of TS 23.288 [86] into account to:
-	(re)select UP paths (including DNAI(s)) for PDU Sessions. The SMF (Network Function) is responsible for handling the mapping between the UE (Network Function) location (TAI / Cell-Id) and DNAI(s) associated with UPF (Network Function) and applications and the selection of the UPF (Network Function)(s) that serve a PDU Session. This is described in clause 6.3.3. If the PDU Session is of IP  (Protocol)type and if Indication of UE (Network Function) IP  (Protocol)address preservation is included in the PCC rules, the SMF (Network Function) should preserve the UE (Network Function) IP  (Protocol)address, by not reselecting the related PSA (Network Function) UPF (Network Function) once the PSA (Network Function) UPF (Network Function) is selected, for the traffic identified in the PCC rule. If the user plane latency requirement is included in the PCC rules, the SMF (Network Function) chooses the PSA (Network Function) UPF (Network Function) that satisfies the user plane latency requirement. If the PCC rules are related to a 5G VN group served by the SMF (Network Function) and if the PCC rule includes an indication of traffic correlation, the SMF (Network Function) should select a common DNAI for the PDU Sessions of the 5G VN group, see clause 5.29.
-	configure traffic steering at UPF (Network Function), including activating mechanisms for traffic multi-homing or enforcement of an UL Classifier (UL CL). Such mechanisms are defined in clause 5.6.4. This may include that the SMF (Network Function) is providing the UPF (Network Function) with packet handling instructions (i.e. PDRs and FARs) for steering traffic to the local access to the DN (Network Function). The packet handling instructions are generated by the SMF (Network Function) using the traffic steering policy ID and/or the N6 (Non-service-based Interface) (Service-based Interface) traffic routing information in the PCC rules corresponding to the applied DNAI. In the case of UP path reselection, the SMF (Network Function) may configure the source UPF (Network Function) to forward traffic to the UL CL/BP so that the traffic is steered towards the target UPF (Network Function).
-	if Information on AF (Network Function) subscription to corresponding SMF (Network Function) events has been provided in the PCC rule, inform the AF (Network Function) of the (re)selection of the UP path (UP path change). If the information includes an indication of "AF (Network Function) acknowledgment to be expected", the SMF (Network Function) may decide to wait for a response from the AF (Network Function) before it activates the new UP path, as described in clause 5.6.7.2.
When an I-SMF (Network Function) is inserted for a PDU Session, the I-SMF (Network Function) insertion, relocation or removal to a PDU session shall be transparent (i.e. not aware) to the PCF (Network Function) and to the AF (Network Function). The processing of the AF (Network Function) influence on traffic routing is described in clause 5.34 and detailed procedure is described in clause 4.23.6 of TS 23.502 [3].
In order to avoid or minimize service interruption during PSA (Network Function) relocation for a PDU session of SSC mode 3, or a PDU session with UL CL or branch point, according to the indication of "AF (Network Function) acknowledgment to be expected" on AF (Network Function) subscription to corresponding SMF (Network Function) events (DNAI change) (that may be provided in PCC rules received from the PCF (Network Function) as defined in clause 5.6.7.1 except in HR-SBO case or that may be provided directly by V-NEF (Network Function) to V-SMF (Network Function) as defined in TS 23.548 [130] clause 6.7.2 in case of HR-SBO) or according to local configuration (e.g. DN (Network Function)-related policies) the SMF (Network Function) may wait for a response from the AF (Network Function) after sending a notification (an early notification or a late notification) to the AF (Network Function). In the case of late notification, based on the indication of "AF (Network Function) acknowledgment to be expected" on AF (Network Function) subscription, the SMF (Network Function) may send the notification before activating the UP path towards a new DNAI (possibly through a new PSA (Network Function)).
NOTE 1:	Before the UP path toward the new DNAI is activated, application traffic data (if any exists) is still routed toward the old DNAI.
The notification sent from the SMF (Network Function) to the AF (Network Function) indicates UP path management events (DNAI change) as described in clause 5.6.7.1. The AF (Network Function) can confirm the DNAI change indicated in the notification with the SMF (Network Function) by sending a positive response to the notification to the SMF (Network Function) or reject the DNAI change by sending a negative response.
NOTE 2:	The AF (Network Function) can determine whether application relocation is needed according to the notification of DNAI change. If not, the AF (Network Function) can send a positive response to the SMF (Network Function) immediately; otherwise, the AF (Network Function) sends the positive response after application relocation is completed or a negative response if the AF (Network Function) determines that the application relocation cannot be completed on time (e.g. due to temporary congestion). The AF (Network Function) decision and behaviours on application relocation are not defined. However, the new DNAI may be associated with a new AF (Network Function). In such cases, the SMF (Network Function) and the old AF (Network Function) cancel earlier subscribed UP path management event notifications, and the new AF (Network Function) subscribes to receive UP path management event notifications from the SMF (Network Function).
The AF (Network Function) can include N6 (Non-service-based Interface) (Service-based Interface) traffic routing information related to the target DNAI in a positive response sent to the SMF (Network Function). The SMF (Network Function) configures the N6 (Non-service-based Interface) (Service-based Interface) traffic routing information from the AF (Network Function) response to the PSA (Network Function) on the UP path.
The AF (Network Function) can include the EAS relocation Indication to indicate the application(s) to be relocated.
In the case of early notification, based on the indication of "AF (Network Function) acknowledgment to be expected" on AF (Network Function) subscription, the SMF (Network Function) does not configure the UP path towards the new DNAI until it receives a positive AF (Network Function) response as specified in clause 4.3.6.3 of TS 23.502 [3].
In the case of late notification, based on the indication of "AF (Network Function) acknowledgment to be expected" on AF (Network Function) subscription, the SMF (Network Function) does not activate the UP path towards the new DNAI until it receives a positive AF (Network Function) response as specified in clause 4.3.5 of TS 23.502 [3].
NOTE 3:	After the UP path toward the new DNAI is activated, data is routed toward the new DNAI.
If the SMF (Network Function) receives a negative response at any time, the SMF (Network Function) keeps using the original DNAI and may cancel related PSA (Network Function) relocation or addition. The SMF (Network Function) may perform DNAI reselection afterwards if needed.
The SMF (Network Function) can assume according to local policy a negative response if a response is expected and but not received from the AF (Network Function) within a certain time window.
When Early/Late Notification happens, the SMF (Network Function) notifies AF (Network Function) about the target DNAI and may indicate capability of supporting EAS IP  (Protocol)replacement in 5GC.When EAS relocation is performed, the AF (Network Function) sends an/a early/late notification response to the SMF (Network Function) after the EAS relocation is completed, which may include the Information for EAS IP  (Protocol)Replacement in 5GC. The SMF (Network Function) may instruct the local PSA (Network Function) with the EAS IP  (Protocol)address replacement using "Outer Header Creation" as defined in clause 5.8.5.6 and "Outer Header Removal" as defined in clause 5.8.5.3. If local PSA (Network Function) relocation is required, the SMF (Network Function) may request the target local PSA (Network Function) to buffer uplink traffic as described in clause 6.3.5 of TS 23.548 [130].
AF (Network Function) relocation may be triggered by SMF (Network Function) e.g. in relationship with DNAI change due to UE (Network Function) mobility. In the case of AF (Network Function) relocation involving different DNAI(s), it is possible that the source EHE is unaware of other/target EHE specific deployment details. In such cases, when SMF (Network Function) selects a target DNAI (e.g. based on current UE (Network Function) location), the SMF (Network Function) may determine based on the EDI that the target DNAI is not supported by the source AF (Network Function). The SMF (Network Function) determines the target AF (Network Function) ID based on the target DNAI and the EDI. Accordingly, as part of Early/Late Notification, the SMF (Network Function) provides the target AF (Network Function) ID to the source AF (Network Function) as described in clause 4.3.6.3 of TS 23.502 [3].
This clause applies to the case when a UE (Network Function) has established multiple PDU Sessions. The activation of a UP connection of an existing PDU Session causes the activation of its UE (Network Function)-CN User Plane connection (i.e. data radio bearer and N3 (Non-service-based Interface) (Service-based Interface) tunnel).
For the activation of a UP connection the service area restrictions as specified in clause 5.3.4.1.1 apply.
For the UE (Network Function) in the CM-IDLE state in 3GPP access, either UE (Network Function) or Network-Triggered Service Request procedure may support independent activation of UP connection of existing PDU Session. For the UE (Network Function) in the CM-IDLE state in non-3GPP access, UE (Network Function)-Triggered Service Request procedure allows the re-activation of UP connection of existing PDU Sessions, and may support independent activation of UP connection of existing PDU Session.
A UE (Network Function) in the CM-CONNECTED state invokes a Service Request (see clause 4.2.3.2 of TS 23.502 [3]) procedure to request the independent activation of the UP connection of existing PDU Sessions.
Network Triggered re-activation of UP connection of existing PDU Sessions is handled as follows:
-	If the UE (Network Function) CM state in the AMF (Network Function) is already CM-CONNECTED on the access (3GPP, non-3GPP) associated to the PDU Session in the SMF (Network Function), the network may re-activate the UP connection of a PDU Session using a Network Initiated Service Request procedure.
Otherwise:
-	If the UE (Network Function) is registered in both 3GPP and non-3GPP accesses and the UE (Network Function) CM state in the AMF (Network Function) is CM-IDLE in non-3GPP access, the UE (Network Function) can be paged or notified through the 3GPP access for a PDU Session associated in the SMF (Network Function) (i.e. last routed) to the non-3GPP access:
-	If the UE (Network Function) CM state in the AMF (Network Function) is CM-IDLE in 3GPP access, the paging message may include the access type associated with the PDU Session in the SMF (Network Function). The UE (Network Function), upon reception of the paging message containing an access type, shall reply to the 5GC via the 3GPP access using the NAS (Protocol) Service Request message, which shall contain the list of PDU Sessions associated with the received access type and whose UP connections can be re-activated over 3GPP (i.e. the list does not contain the PDU Sessions whose UP connections cannot be re-activated on 3GPP based on UE (Network Function) policies and whether the S-NSSAIs of these PDU Sessions are within the Allowed NSSAI for 3GPP access). If the PDU Session for which the UE (Network Function) has been paged is in the list of the PDU Sessions provided in the NAS (Protocol) Service Request and the paging was triggered by pending DL data, the 5GC shall re-activate the PDU Session UP connection over 3GPP access. If the paging was triggered by pending DL signalling, the Service Request succeeds without re-activating the PDU session UP connection over the 3GPP access and the pending DL signalling is delivered to the UE (Network Function) over the 3GPP access;
-	If the UE (Network Function) CM state in the AMF (Network Function) is CM-CONNECTED in 3GPP access, the notification message shall include the non-3GPP Access Type. The UE (Network Function), upon reception of the notification message, shall reply to the 5GC via the 3GPP access using the NAS (Protocol) Service Request message, which shall contain the List of Allowed PDU Sessions that can be re-activated over 3GPP or an empty List of Allowed PDU Sessions if no PDU Sessions are allowed to be re-activated over 3GPP access.
NOTE:	A UE (Network Function) that is in a coverage of a non-3GPP access and has PDU Session(s) that are associated in the UE (Network Function) (i.e. last routed) to non-3GPP access, is assumed to attempt to connect to it without the need to be paged.
-	If the UE (Network Function) is registered in both 3GPP and non-3GPP accesses served by the same AMF (Network Function) and the UE (Network Function) CM state in the AMF (Network Function) is CM-IDLE in 3GPP access and is in CM-CONNECTED in non 3GPP access, the UE (Network Function) can be notified through the non-3GPP for a PDU Session associated in the SMF (Network Function) (i.e. last routed) to the 3GPP access. The notification message shall include the 3GPP Access Type. Upon reception of the notification message, when 3GPP access is available, the UE (Network Function) shall reply to the 5GC via the 3GPP access using the NAS (Protocol) Service Request message.
In addition to the above, a PDU Session may be established as an always-on PDU Session as described in clause 5.6.13.
The deactivation of the UP connection of an existing PDU Session causes the corresponding data radio bearer and N3 (Non-service-based Interface) (Service-based Interface) tunnel to be deactivated. The UP connection of different PDU Sessions can be deactivated independently when a UE (Network Function) is in CM-CONNECTED state in 3GPP access or non-3GPP access. At the deactivation of the UP of a PDU Session using a N9 (Service-based Interface) tunnel whose end-point is controlled by an I-SMF (Network Function), the N9 (Service-based Interface) tunnel is preserved. If a PDU Session is an always-on PDU Session, the SMF (Network Function) should not deactivate a UP connection of this PDU Session due to inactivity.
The support for session and service continuity in 5G System architecture enables to address the various continuity requirements of different applications/services for the UE (Network Function). The 5G System supports different session and service continuity (SSC) modes defined in this clause. The SSC mode associated with a PDU Session does not change during the lifetime of a PDU Session. The following three modes are specified with further details provided in the next clause:
-	With SSC mode 1, the network preserves the connectivity service provided to the UE (Network Function). For the case of PDU Session of IPv4 or IPv6 or IPv4v6 type, the IP  (Protocol)address is preserved.
-	With SSC mode 2, the network may release the connectivity service delivered to the UE (Network Function) and release the corresponding PDU Session(s). For the case of IPv4 or IPv6 or IPv4v6 type, the release of the PDU Session induces the release of IP  (Protocol)address(es) that had been allocated to the UE (Network Function).
-	With SSC mode 3, changes to the user plane can be visible to the UE (Network Function), while the network ensures that the UE (Network Function) suffers no loss of connectivity. A connection through new PDU Session Anchor point is established before the previous connection is terminated in order to allow for better service continuity. For the case of IPv4 or IPv6 or IPv4v6 type, the IP  (Protocol)address is not preserved in this mode when the PDU Session Anchor changes.
NOTE:	In this Release of the specification, the addition/removal procedure of additional PDU Session Anchor in a PDU Session for local access to a DN (Network Function) is independent from the SSC mode of the PDU Session.
For a PDU Session of SSC mode 1, the UPF (Network Function) acting as PDU Session Anchor at the establishment of the PDU Session is maintained regardless of the access technology (e.g. Access Type and cells) a UE (Network Function) is successively using to access the network.
In the case of a PDU Session of IPv4 or IPv6 or IPv4v6 type, IP  (Protocol)continuity is supported regardless of UE (Network Function) mobility events.
In this Release of the specification, when IPv6 multihoming or UL CL applies to a PDU Session of in SSC mode 1, and the network allocates (based on local policies) additional PDU Session Anchors to such a PDU Session, these additional PDU Session Anchors may be released or allocated, and the UE (Network Function) does not expect that the additional IPv6 prefix is maintained during the lifetime of PDU Session.
SSC mode 1 may apply to any PDU Session type and to any access type.
A UE (Network Function) supporting PDU Connectivity shall support SSC mode 1.
If a PDU Session of SSC mode 2 has a single PDU Session Anchor, the network may trigger the release of the PDU Session and instruct the UE (Network Function) to establish a new PDU Session to the same data network immediately. The trigger condition depends on operator policy e.g. request from Application (Protocol) Function, based on load status, etc. At establishment of the new PDU Session, a new UPF (Network Function) acting as PDU Session Anchor can be selected.
Otherwise, if a PDU Session of SSC mode 2 has multiple PDU Session Anchors (i.e. in the case of multi-homed PDU Sessions or in the case that UL CL applies to a PDU Session of SSC mode 2), the additional PDU Session Anchors may be released or allocated.
SSC mode 2 may apply to any PDU Session type and to any access type.
SSC mode 2 is optional to be supported in the UE (Network Function).
NOTE 1:	Features depending on SSC mode 2 will not work with the lack of support for SSC mode 2 in the UE (Network Function).
NOTE 2:	In UL CL mode, the UE (Network Function) is not involved in PDU Session Anchor re-allocation, so that the existence of multiple PDU Session Anchors is not visible to the UE (Network Function).
For PDU Session of SSC mode 3, the network allows the establishment of UE (Network Function) connectivity via a new PDU Session Anchor to the same data network before connectivity between the UE (Network Function) and the previous PDU Session Anchor is released. When trigger conditions apply, the network decides whether to select a PDU Session Anchor UPF (Network Function) suitable for the UE (Network Function)'s new conditions (e.g. point of attachment to the network).
In this Release of specification, SSC mode 3 only applies to IP  (Protocol)PDU Session type and to any access type.
In the case of a PDU Session of IPv4 or IPv6 or IPv4v6 type, during the procedure of change of PDU Session Anchor, the following applies:
a.	For a PDU Session of IPv6 type, the new IP  (Protocol)prefix anchored on the new PDU Session Anchor may be allocated within the same PDU Session (relying on IPv6 multi-homing specified in clause 5.6.4.3), or
b.	The new IP  (Protocol)address and/or IP  (Protocol)prefix may be allocated within a new PDU Session that the UE (Network Function) is triggered to establish.
After the new IP  (Protocol)address/prefix has been allocated, the old IP  (Protocol)address/prefix is maintained during some time indicated to the UE (Network Function) via NAS (Protocol) signalling (as described in clause 4.3.5.2 of TS 23.502 [3]) or via Router Advertisement (as described in clause 4.3.5.3 of TS 23.502 [3]) and then released.
If a PDU Session of SSC mode 3 has multiple PDU Session Anchors (i.e. in the case of multi-homed PDU Sessions or in the case that UL CL applies to a PDU Session of SSC mode 3), the additional PDU Session Anchors may be released or allocated.
SSC mode 3 is optional to be supported in the UE (Network Function).
NOTE:	Features depending on SSC mode 3 will not work with the lack of support for SSC mode 3 in the UE (Network Function).
SSC mode selection is done by the SMF (Network Function) based on the allowed SSC modes -including the default SSC mode) in the user subscription as well as the PDU Session type and if present, the SSC mode requested by the UE (Network Function).
The operator may provision a SSC mode selection policy (SSCMSP) to the UE (Network Function) as part of the URSP rule -see clause 6.6.2 of TS 23.503 [45]). The UE (Network Function) shall use the SSCMSP to determine the type of session and service continuity mode associated with an application or group of applications for the UE (Network Function) as described in clause 6.6.2.3 of TS 23.503 [45]. If the UE (Network Function) does not have SSCMSP, the UE (Network Function) can select a SSC mode based on UE (Network Function) Local Configuration as described in TS 23.503 [45], if applicable. If the UE (Network Function) cannot select a SSC mode, the UE (Network Function) requests the PDU Session without providing the SSC mode.
NOTE 1:	The UE (Network Function) can use the SSC Mode Selection component of the URSP rule with match-all traffic descriptor if there is no SSC mode in the UE (Network Function) local configuration.
The SSC mode selection policy rules provided to the UE (Network Function) can be updated by the operator by updating the URSP rule.
The SMF (Network Function) receives from the UDM (Network Function) the list of allowed SSC modes and the default SSC mode per DNN per S-NSSAI as part of the subscription information.
If a UE (Network Function) provides an SSC mode when requesting a new PDU Session, the SMF (Network Function) selects the SSC mode by either accepting the requested SSC mode or rejecting the PDU Session Establishment Request message with the cause value and the SSC mode(s) allowed to be used back to UE (Network Function) based on the PDU Session type, subscription and/or local configuration. Based on that cause value and the SSC mode(s) allowed to be used, the UE (Network Function) may re-attempt to request the establishment of that PDU Session with the SSC mode allowed to be used or using another URSP rule.
If a UE (Network Function) does not provide an SSC mode when requesting a new PDU Session, then the SMF (Network Function) selects the default SSC mode for the data network listed in the subscription or applies local configuration to select the SSC mode.
SSC mode 1 shall be assigned to the PDU Session when static IP  (Protocol)address/prefix is allocated to the PDU Session based on the static IP  (Protocol)address/prefix subscription for the DNN and S-NSSAI. The SMF (Network Function) shall inform the UE (Network Function) of the selected SSC mode for a PDU Session.
The UE (Network Function) shall not request and the network shall not assign SSC mode 3 for the PDU Session of Unstructured type or Ethernet type.
NOTE 2:	To avoid issues for UEs not supporting all SSC modes, the operator can, in the subscription data and local configuration, include at least SSC mode 1 in the allowed SSC modes, and set default SSC mode to 1 (since all UEs supporting PDU sessions are mandated to support SSC mode 1). Still the 5GC can trigger PDU session release with a cause code indicating reactivation due to, e.g. restoration or user plane path optimization purposes, though this may cause interruption of the service.
The IP  (Protocol)address allocation is defined in clause 5.8.1
The UE (Network Function) may acquire following configuration information from the SMF (Network Function), during the lifetime of a PDU Session:
-	Address(es) of P-CSCF(s);
-	Address(es) of DNS server(s).
-	If the UE (Network Function) indicates support of DNS over (D) TLS to the network and the network wants to enforce the use of DNS over (D)TLS, the configuration information is sent by the SMF (Network Function) via PCO may also include the corresponding DNS server security information as specified in TS 24.501 [47] and TS 33.501 [29].
-	the GPSI of the UE (Network Function).
The UE (Network Function) may acquire from the SMF (Network Function), at PDU Session Establishment, the MTU that the UE (Network Function) shall consider, see clause 5.6.10.4.
The UE (Network Function) may provide following information to the SMF (Network Function) during the lifetime of a PDU Session:
-	an indication of the support of P-CSCF re-selection based on procedures specified in TS 24.229 [62] (clauses B.2.2.1C and L (Service-based Interface).2.2.1C).
-	PS data off status of the UE (Network Function).
NOTE 2:	An operator can deploy NAT functionality in the network; the support of NAT is not specified in this release of the specification, though UPF (Network Function) can expose mapping between public and private IP  (Protocol)addresses.
For a PDU Session set up with the Ethernet PDU Session type, the SMF (Network Function) and the UPF (Network Function) acting as PDU Session Anchor (PSA (Network Function)) can support specific behaviours related with the fact the PDU Session carries Ethernet frames.
Depending on operator configuration related with the DNN, different configurations for how Ethernet traffic is handled on N6 (Non-service-based Interface) (Service-based Interface) may apply, for example:
-	Configurations with a 1-1 relationship between a PDU Session and a N6 (Non-service-based Interface) (Service-based Interface) interface possibly corresponding to a dedicated tunnel established over N6 (Non-service-based Interface) (Service-based Interface). In this case the UPF (Network Function) acting as PSA (Network Function) transparently forwards Ethernet frames between the PDU Session and its corresponding N6 (Non-service-based Interface) (Service-based Interface) interface, and it does not need to be aware of MAC  (Protocol)addresses used by the UE (Network Function) in order to route down-link traffic.
-	Configurations, where more than one PDU Session to the same DNN (e.g. for more than one UE (Network Function)) corresponds to the same N6 (Non-service-based Interface) (Service-based Interface) interface. In this case the UPF (Network Function) acting as PSA (Network Function) needs to be aware of MAC  (Protocol)addresses used by the UE (Network Function) in the PDU Session in order to map down-link Ethernet frames received over N6 (Non-service-based Interface) (Service-based Interface) to the appropriate PDU Session. Forwarding behaviour of the UPF (Network Function) acting as PSA (Network Function) is managed by SMF (Network Function) as specified in clause 5.8.2.5.
NOTE 1:	The "MAC addresses used by the UE (Network Function)" correspond to any MAC  (Protocol)address used by the UE (Network Function) or any device locally connected to the UE (Network Function) and using the PDU Session to communicate with the DN (Network Function).
Based on operator configuration, the SMF (Network Function) may request the UPF (Network Function) acting as the PDU Session Anchor to respond to ARP/IPv6 Neighbour Solicitation requests based on local cache information, i.e. the mapping between the UE (Network Function) MAC  (Protocol)address to the UE (Network Function) IP  (Protocol)address, and the DN (Network Function) where the PDU Session is connected to, or to redirect the ARP traffic from the UPF (Network Function) to the SMF (Network Function). Responding to ARP/IPv6 ND based on local cache information applies to ARP/IPv6 ND received in both UL and DL directions.
NOTE 2:	Responding to ARP/ND from a local cache assumes the UE (Network Function) or the devices behind the UE (Network Function) acquire their IP  (Protocol)address via in-band mechanisms that the SMF (Network Function)/UPF (Network Function) can detect and by this link the IP  (Protocol)address to the MAC  (Protocol)address.
NOTE 3:	This mechanism is intended to avoid broadcasting or multicasting the ARP/IPv6 ND to every UE (Network Function).
Ethernet Preamble and Start of Frame delimiter are not sent over 5GS:
-	For UL traffic the UE (Network Function) strips the preamble and frame check sequence (FCS) from the Ethernet frame.
-	For DL traffic the PDU Session Anchor strips the preamble and frame check sequence (FCS) from the Ethernet frame.
Neither a MAC  (Protocol)nor an IP  (Protocol)address is allocated by the 5GC to the UE (Network Function) for a PDU Session.
The PSA (Network Function) shall store the MAC  (Protocol)addresses received from the UE (Network Function), and associate those with the appropriate PDU Session.
The SMF (Network Function) may receive a list of allowed VLAN tags from DN (Network Function)-AAA (for a maximum of 16 VLAN tags) or may be locally configured with allowed VLAN tags values. The SMF (Network Function) may also be configured with instructions on VLAN handling (e.g. the VLAN tag to be inserted or removed, S-TAG to be inserted or removed). Taking this into account, the SMF (Network Function) determines the VLAN handling for the PDU Session, and instructs the UPF (Network Function) to accept or discard the UE (Network Function) traffic based on the allowed VLAN tags, as well as to handle VLAN tags (addition/removal) via PDR (Outer header removal) and FAR (UPF (Network Function) applying Outer header creation of a Forwarding policy). For example:
-	The UPF (Network Function) may insert (for uplink traffic) and remove (for downlink traffic) a S-TAG on N6 (Non-service-based Interface) (Service-based Interface) or N19 (Service-based Interface) or internal interface ("5G VN internal") for the traffic from and to the UE (Network Function).
-	The UPF (Network Function) may insert (for uplink traffic) and remove (for downlink traffic) a VLAN tag on the N6 (Non-service-based Interface) (Service-based Interface) interface while there is no VLAN in the traffic to and from the UE (Network Function).
-	The UPF (Network Function) may discard any UE (Network Function) traffic that does not contain any allowed VLAN tag when the UPF (Network Function) handles the UE (Network Function) uplink or downlink traffic.
NOTE 4:	This can be used for traffic steering to N6 (Non-service-based Interface) (Service-based Interface)-LAN but also for N6 (Non-service-based Interface) (Service-based Interface)-based traffic forwarding related with 5G-VN service described in clause 5.29.4
Apart from specific conditions related to the support of PDU sessions over W-5GAN defined in TS 23.316 [84], the UPF (Network Function) shall not remove VLAN tags sent by the UE (Network Function) and the UPF (Network Function) shall not insert VLAN tags for the traffic sent to the UE (Network Function).
PDU(s) containing a VLAN tag shall be switched only within the same VLAN by a PDU Session Anchor.
The UE (Network Function) may acquire from the SMF (Network Function), at PDU Session Establishment, the MTU of the Ethernet frames' payload that the UE (Network Function) shall consider, see clause 5.6.10.4.
NOTE 5:	The UE (Network Function) may operate in bridge mode with regard to a LAN it is connecting to the 5GS, thus different MAC  (Protocol)addresses may be used as source address of different frames sent UL over a single PDU Session (and destination MAC  (Protocol)address of different frames sent DL over the same PDU Session).
NOTE 6:	Entities on the LAN connected to the 5GS by the UE (Network Function) may have an IP  (Protocol)address allocated by the DN (Network Function) but the IP  (Protocol)layer is considered as an application layer which is not part of the Ethernet PDU Session.
NOTE 7:	In this Release of the specification, only the UE (Network Function) connected to the 5GS is authenticated, not the devices behind such UE (Network Function).
NOTE 8:	5GS does not support the scenario where a MAC  (Protocol)address or if VLAN applies a (MAC address, VLAN) combination is used on more than one PDU Session for the same DNN and S-NSSAI.
NOTE 9:	This Release of the specification does not guarantee that the Ethernet network remains loop-free. Deployments need to be verified on an individual basis that loops in the Ethernet network are avoided.
NOTE 10:	This Release of the specification does not guarantee that the Ethernet network properly and quickly reacts to topology changes. Deployments need to be verified on an individual basis how they react to topology changes.
Different Frames exchanged on a PDU Session of Ethernet type may be served with different QoS over the 5GS. Thus, the SMF (Network Function) may provide to the UPF (Network Function) Ethernet Packet Filter Set and forwarding rule(s) based on the Ethernet frame structure and UE (Network Function) MAC  (Protocol)address(es). The UPF (Network Function) detects and forwards Ethernet frames based on the Ethernet Packet Filter Set and forwarding rule(s) received from the SMF (Network Function). This is further defined in clauses 5.7 and 5.8.2.
When a PDU Session of Ethernet PDU type is authorized by a DN (Network Function) as described in clause 5.6.6, the DN (Network Function)-AAA server may, as part of authorization data, provide the SMF (Network Function) with a list of allowed MAC  (Protocol)addresses for this PDU Session; the list is limited to a maximum of 16 MAC  (Protocol)addresses. When the list has been provided for a PDU Session, the SMF (Network Function) sets corresponding filtering rules in the UPF (Network Function)(s) acting as PDU Session Anchor for the PDU Session. The UPF (Network Function) discards any UL traffic that does not contain one of these MAC  (Protocol)addresses as a source address if the list of allowed MAC  (Protocol)addresses is provided.
In this Release of specification, the PDU Session of Ethernet PDU Session type is restricted to SSC mode 1 and SSC mode 2.
For a PDU Session established with the Ethernet PDU Session type, the SMF (Network Function) may, upon PCF (Network Function) request, need to ensure reporting to the PCF (Network Function) of all Ethernet MAC  (Protocol)addresses used as UE (Network Function) address in a PDU Session. In this case, as defined in clause 5.8.2.12, the SMF (Network Function) controls the UPF (Network Function) to report the different MAC  (Protocol)addresses used as source address of frames sent UL by the UE (Network Function) in the PDU Session.
NOTE 11:	This relates to whether AF (Network Function) control on a per MAC  (Protocol)address is allowed on the PDU Session as defined in clause 6.1.1.2 of TS 23.503 [45].
The PCF (Network Function) may activate or deactivate the reporting of the UE (Network Function) MAC  (Protocol)address using the "UE (Network Function) MAC  (Protocol)address change" Policy Control Request Trigger as defined in Table 6.1.3.5-1 of TS 23.503 [45].
The SMF (Network Function) may relocate the UPF (Network Function) acting as the PDU Session Anchor for an Ethernet PDU Session as defined in clause 4.3.5.8 of TS 23.502 [3]. The relocation may be triggered by a mobility event such as a handover, or may be triggered independent of UE (Network Function) mobility, e.g. due to load balancing reasons. In order to relocate the PSA (Network Function) UPF (Network Function), the reporting of the UE (Network Function) MAC  (Protocol)addresses needs to be activated by the SMF (Network Function).
Different Point-to-Point (PtP) tunnelling techniques may be used to deliver Unstructured PDU Session type data to the destination (e.g. application server) in the Data Network via N6 (Non-service-based Interface) (Service-based Interface).
Point-to-point tunnelling based on UDP/IP  (Protocol)encapsulation as described below may be used. Other techniques may be supported. Regardless of addressing scheme used from the UPF (Network Function) to the DN (Network Function), the UPF (Network Function) shall be able to map the address used between the UPF (Network Function) and the DN (Network Function) to the PDU Session.
When Point-to-Point tunnelling based on UDP/IPv6 is used, the following considerations apply:
-	IPv6 prefix allocation for PDU Sessions are performed locally by the (H-)SMF (Network Function) without involving the UE (Network Function).
-	The UPF (Network Function)(s) acts as a transparent forwarding node for the payload between the UE (Network Function) and the destination in the DN (Network Function).
-	For uplink, the UPF (Network Function) forwards the received Unstructured PDU Session type data to the destination in the data network over the N6 (Non-service-based Interface) (Service-based Interface) PtP tunnel using UDP/IPv6 encapsulation.
-	For downlink, the destination in the data network sends the Unstructured PDU Session type data using UDP/IPv6 encapsulation with the IPv6 address of the PDU Session and the 3GPP defined UDP  (Protocol)port for Unstructured PDU Session type data. The UPF (Network Function) acting as PDU Session Anchor decapsulates the received data (i.e. removes the UDP/IPv6 headers) and forwards the data identified by the IPv6 prefix of the PDU Session for delivery to the UE (Network Function).
-	The (H-)SMF (Network Function) performs the IPv6 related operations but the IPv6 prefix is not provided to the UE (Network Function), i.e. Router Advertisements and DHCPv6 are not performed. The SMF (Network Function) assigns an IPv6 Interface Identifier for the PDU Session. The allocated IPv6 prefix identifies the PDU Session of the UE (Network Function).
-	For AF (Network Function) influence on traffic routing (described in clause 5.6.7), when the N6 (Non-service-based Interface) (Service-based Interface) PtP tunnelling is used over the DNAI and the AF (Network Function) provides, by value, information about N6 (Non-service-based Interface) (Service-based Interface) traffic routing requirements in the AF (Network Function) request, the AF (Network Function) provides N6 (Non-service-based Interface) (Service-based Interface) PtP tunnelling requirements (IPv6 address and UDP  (Protocol)port of the tunnel end in the DN (Network Function)) as the N6 (Non-service-based Interface) (Service-based Interface) traffic routing information associated to the DNAI; when the SMF (Network Function) notifies the AF (Network Function) of UP path management events, it includes the N6 (Non-service-based Interface) (Service-based Interface) PtP tunnel information related to the UP (the IPv6 address and the 3GPP defined UDP  (Protocol)port of the tunnel end at the UPF (Network Function)) as N6 (Non-service-based Interface) (Service-based Interface) traffic routing information in the notification.
In this Release of the specification there is support for maximum one 5G QoS Flow per PDU Session of Type Unstructured.
In this Release of specification, the PDU Session of Unstructured PDU Session type is restricted to SSC mode 1 and SSC mode 2.
The UE (Network Function) may acquire from the SMF (Network Function), at PDU Session Establishment, the MTU that the UE (Network Function) shall consider, see clause 5.6.10.4.
In order to avoid data packet fragmentation between the UE (Network Function) and the UPF (Network Function) acting as PSA (Network Function), the link MTU size in the UE (Network Function) should be set to the value provided by the network as part of the IP  (Protocol)configuration. The link MTU size for IPv4 is sent to the UE (Network Function) by including it in the PCO (see TS 24.501 [47]). The link MTU size for IPv6 is sent to the UE (Network Function) by including it in the IPv6 Router Advertisement message (see RFC 4861 [54]).
NOTE 1:	Ideally the network configuration ensures that for PDU Session type IPv4v6 the link MTU values provided to the UE (Network Function) via PCO and in the IPv6 Router Advertisement message are the same. In cases where this condition cannot be met, the MTU size selected by the UE (Network Function) is unspecified.
When using a PDU Session type Unstructured, the maximum uplink packet size, and when using Ethernet, the Ethernet frames' payload, that the UE (Network Function) should use may be provided by the network as a part of the session management configuration by encoding it within the PCO (see TS 24.501 [47]).
When using a PDU Session type Unstructured, to provide a consistent environment for application developers, the network shall use a maximum packet size of at least 128 octets (this applies to both uplink and downlink).
When the MT and the TE are separated, the TE may either be pre-configured to use a specific default MTU size or the TE may use an MTU size provided by the network via the MT. Thus, it is not always possible to set the MTU value by means of information provided by the network.
NOTE 2:	In network deployments that have MTU size of 1500 octets in the transport network, providing a link MTU value of 1358 octets (as shown in Figure J-1) to the UE (Network Function) as part of the IP  (Protocol)configuration information from the network will prevent the IP  (Protocol)layer fragmentation within the transport network between the UE (Network Function) and the UPF (Network Function). For network deployments that uniformly support transport with larger MTU size than 1500 octets (for example with ethernet jumbo frames of MTU size up to 9216 octets), providing a link MTU value of MTU minus 142 octets to the UE (Network Function) as part of the IP  (Protocol)configuration information from the network will prevent the IP  (Protocol)layer fragmentation within the transport network between the UE (Network Function) and the UPF (Network Function). Link MTU considerations are discussed further in Annex J.
NOTE 3:	As the link MTU value is provided as a part of the session management configuration information, a link MTU value can be provided during each PDU Session establishment. In this release, dynamic adjustment of link MTU for scenarios where MTU is not uniform across transport are not addressed.
When a PDU Session is established or modified, or when the user plane path has been changed (e.g. UPF (Network Function) re-allocation/addition/removal), SMF (Network Function) may determine an Area of Interest, e.g. based on UPF (Network Function) Service Area, subscription by PCF (Network Function) for reporting UE (Network Function) presence in Presence Reporting Area, etc.
For 3GPP access, the Area of Interest corresponds:
-	either to Presence Information that may correspond to:
-	a list of Tracking Areas; or
-	a list of Presence Reporting Area ID(s) and optionally the elements comprising TAs and/or NG-RAN (Network Function) nodes and/or cells identifiers corresponding to the PRA ID(s); or
-	a LADN DNN; or
-	a LADN DNN and a S-NSSAI.
For Non-3GPP access, the Area of Interest corresponds to:
-	N3GPP TAI (see clause 5.3.2.3).
For UE (Network Function) location change into or out of an "area of interest", the SMF (Network Function) subscribes to "UE (Network Function) mobility event notification" service provided by AMF (Network Function) for reporting of UE (Network Function) presence in Area of Interest as described in clause 5.3.4.4. The AMF (Network Function) may send the UE (Network Function) location to the SMF (Network Function) along with the notification, e.g. for UPF (Network Function) selection. Upon reception of a notification from AMF (Network Function), the SMF (Network Function) determines how to deal with the PDU Session, e.g. reallocate UPF (Network Function).
In the case of LADN, the SMF (Network Function) provides the LADN DNN to the AMF (Network Function) to subscribe to "UE (Network Function) mobility event notification" for reporting UE (Network Function) presence in LADN service area. Upon reception of a notification from the AMF (Network Function), the SMF (Network Function) determines how to deal with the PDU Session as described in clause 5.6.5.
For use cases related to policy control and charging decisions, the PCF (Network Function) may subscribe to event reporting from the SMF (Network Function) or the AMF (Network Function), for UE (Network Function) presence in a Presence Reporting Area.
A Presence Reporting Area can be:
-	A "UE (Network Function)-dedicated Presence Reporting Area", defined in the subscriber profile and composed of a short list of TAs and/or NG-RAN (Network Function) nodes and/or cells identifiers in a PLMN; or derived from the Area of Interest provided by the Application (Protocol) Function to the PCF (Network Function) (see clause 5.6.7) and composed of a short list of TAs and/or NG-RAN (Network Function) nodes and/or cells identifiers in a PLMN; or
-	A "Core Network predefined Presence Reporting Area", predefined in the AMF (Network Function) and composed of a short list of TAs and/or NG-RAN (Network Function) nodes and/or cells identifiers in a PLMN.
In the case of Change of UE (Network Function) Presence in Presence Reporting Area, for core network predefined Presence Reporting Area, the AMF (Network Function) determines the "area of interest" corresponding to the Presence Reporting Area Identifier(s), provided by the PCF (Network Function) or the SMF (Network Function), as a list of TAIs and/or cell identifiers and/or NG-RAN (Network Function) node identifiers based on local configuration. For UE (Network Function)-dedicated Presence Reporting Areas, the subscription for UE (Network Function) location change notification for an "area of interest" shall contain the PRA Identifier(s) and the list(s) of TAs, or NG-RAN (Network Function) Node identifier and/or cell identifiers composing the Presence Reporting Area(s). For Core Network predefined Presence Reporting Areas, the subscription for UE (Network Function) location change notification for an "area of interest" shall contain the PRA identifier(s).
NOTE 1:	If the Presence Reporting Area (PRA) and RAN (Network Function) Notification Area (RNA) are partially overlapping, the PCF (Network Function) will not get notified for the change of PRA when UE (Network Function) enters or leaves the PRA but remains in the RNA in CM-CONNECTED with RRC_INACTIVE state, because AMF (Network Function) is not informed.
Each Core Network predefined Presence Reporting Area can be configured with a priority level in the AMF (Network Function). In order to prevent overload, the AMF (Network Function) may set the reporting for one or more of the received Presence Reporting Area(s) to inactive under consideration of the priority configured for each of Core Network predefined Presence Reporting Area(s), while storing the reporting request for this Presence Reporting Area in the UE (Network Function) context.
NOTE 2:	Change of UE (Network Function) presence in Presence Reporting Area reporting does not apply to home routed roaming.
The AMF (Network Function) may be configured with a PRA identifier which refers to a Set of Core Network predefined Presence Reporting Areas. If the PCF (Network Function) subscribes to change of UE (Network Function) location for an area of interest for a Set of Presence reporting areas and provides a PRA identifier then the SMF (Network Function) may subscribe for event reporting for this Set of Presence Reporting Areas by only indicating this PRA Identifier in the area of interest. When the Presence Reporting Area(s) to be reported belong to a set of Core Network predefined Presence Reporting Areas in which the AMF (Network Function) is requested to report on change of UE (Network Function) presence, the AMF (Network Function) shall additionally add to the report the PRA Identifier of the Set of Core Network predefined Presence Reporting Areas.
Upon change of AMF (Network Function), the PRA identifier(s) and if provided, the list(s) of Presence Reporting Area elements are transferred for all PDU sessions as part of MM Context information to the target AMF (Network Function) during the mobility procedure. If one or more Presence Reporting Area(s) was set to inactive, the target AMF (Network Function) may decide to reactivate one or more of the inactive Presence Reporting Area(s). The target AMF (Network Function) indicates per PDU session to the corresponding SMF (Network Function)/PCF (Network Function) the PRA identifier(s) and whether the UE (Network Function) is inside or outside the Presence Reporting Area(s) as well as the inactive Presence Reporting Area(s), if any.
NOTE 3:	The target AMF (Network Function) cannot set the Presence Reporting Area(s) received from the source serving node to inactive.
The subscription may be maintained during the life of PDU Session, regardless of the UP activation state of PDU Session (i.e. whether UP connection of the PDU Session is activated or not).
SMF (Network Function) may determine a new area of interest, and send a new subscription to the AMF (Network Function) with the new area of interest.
SMF (Network Function) un-subscribes to "UE (Network Function) mobility event notification" service when PDU Session is released.
The SMF (Network Function) may provide a Network Instance to the UPF (Network Function) in FAR and/or PDR via N4 (Service-based Interface) Session Establishment or N4 (Service-based Interface) Modification procedures.
NOTE 1:	a Network Instance can be defined e.g. to separate IP  (Protocol)domains, e.g. when a UPF (Network Function) is connected to 5G-ANs in different IP  (Protocol)domains, overlapping UE (Network Function) IP  (Protocol)addresses assigned by multiple Data Networks, transport network isolation in the same PLMN, etc.
NOTE 2:	As the SMF (Network Function) can provide over N2 (Non-service-based Interface) (Service-based Interface) the Network Instance it has selected for the N3 (Non-service-based Interface) (Service-based Interface) CN Tunnel Info, the 5G AN does not need to provide Network Instance to the 5GC.
The SMF (Network Function) determines the Network Instance based on local configuration.
The SMF (Network Function) may determine the Network Instance for N3 (Non-service-based Interface) (Service-based Interface) and N9 (Service-based Interface) interfaces, taking into account e.g. UE (Network Function) location, registered PLMN ID of UE (Network Function), S-NSSAI of the PDU Session.
The SMF (Network Function) may determine the Network Instance for N6 (Non-service-based Interface) (Service-based Interface) interface taking into account e.g. (DNN, S-NSSAI) of the PDU Session.
The SMF (Network Function) may determine the Network Instance for N19 (Service-based Interface) interface taking into account e.g. the (DNN, S-NSSAI) identifying a 5G VN group.
NOTE 3:	As an example, the UPF (Network Function) can use the Network Instance included in the FAR, together with other information such as Outer header creation (IP  (Protocol)address part) and Destination interface in the FAR, to determine the interface in UPF (Network Function) (e.g. VPN or Layer 2 technology) for forwarding of the traffic.
An always-on PDU Session is a PDU Session for which User Plane resources have to be activated during every transition from CM-IDLE mode to CM-CONNECTED state.
Based on an indication from upper layers, a UE (Network Function) may request to establish a PDU Session as an always-on PDU Session. The SMF (Network Function) decides whether the PDU Session can be established as an always-on PDU Session. In Home Routed roaming case, based on local policies, the V-SMF (Network Function) shall be involved to determine whether the PDU Session can be established as an always-on PDU Session.
If the UE (Network Function) requests the 5GC to modify a PDU Session, which was established in EPS, to an always-on PDU Session after the first inter-system change from EPS to 5GS, the SMF (Network Function) decides whether the PDU Session can be established as an always-on PDU Session based on the procedure described above.
The UE (Network Function) shall request activation of User Plane resources for always-on PDU Sessions even if there are no pending uplink data for this PDU Session or when the Service Request is triggered for signalling only or when the Service Request is triggered for paging response only.
If the UE (Network Function) has one or more established PDU Sessions which are not accepted by the network as always-on PDU Sessions and the UE (Network Function) has no uplink user data pending to be sent for those PDU Sessions, the UE (Network Function) shall not request for activating User Plane resources for those PDU sessions.
Framed Routing is only defined for PDU Sessions of the IP  (Protocol)type (IPv4, IPv6, IPv4v6) and allows to support an IP  (Protocol)network behind a UE (Network Function), such that a range of IPv4 addresses or IPv6 prefixes is reachable over a single PDU Session, e.g. for enterprise connectivity. Framed Routes are IP  (Protocol)routes behind the UE (Network Function).
A PDU Session may be associated with multiple Framed Routes. Each Framed Route refers to a range of IPv4 addresses (i.e. an IPv4 address and an IPv4 address mask) or a range of IPv6 Prefixes (i.e. an IPv6 Prefix and an IPv6 Prefix length). The set of one or more Framed Routes associated to a PDU Session is contained in the Framed Route information. The network does not send Framed Route information to the UE (Network Function): devices in the network(s) behind the UE (Network Function) get their IP  (Protocol)address by mechanisms out of the scope of 3GPP specifications. See RFC 2865 [73], RFC 3162 [74].
Framed Route information is provided by the SMF (Network Function) to the UPF (Network Function) (acting as PSA (Network Function)) as part of Packet Detection Rule (PDR, see clause 5.8.5.3) related with the network side (N6 (Non-service-based Interface) (Service-based Interface)) of the UPF (Network Function).
NOTE:	SMF (Network Function) can take the UPF (Network Function) capabilities into account when selecting PSA (Network Function) UPF (Network Function), to ensure that the SMF (Network Function) chooses PSA (Network Function) UPF (Network Function)(s) that support Framed Routing for PDU Sessions to DNN and/or slices deemed to support Framed Routing e.g. DNN and/or slices intended to support RG or if Framed Route information has been received as part of Session Management Subscription data.
The Framed Route information may be provided to the SMF (Network Function) by:
-	the DN (Network Function)-AAA server as part of PDU Session Establishment authentication/authorization by a DN (Network Function)-AAA server (as defined in clause 5.6.6); or by
-	Session Management Subscription data associated with DNN and S-NSSAI sent by UDM (Network Function) (as defined in clause 5.2.3.3.1 of TS 23.502 [3]).
	If the SMF (Network Function) receives Framed Route information both from DN (Network Function)-AAA and from UDM (Network Function), the information received from DN (Network Function)-AAA takes precedence and supersedes the information received from UDM (Network Function).
The IPv4 address / IPv6 Prefix allocated to the UE (Network Function) as part of the PDU Session establishment (e.g. delivered in NAS (Protocol) PDU Session Establishment Accept) may belong to one of the Framed Routes associated with the PDU Session or may be dynamically allocated outside of such Framed Routes.
If PCC applies to the PDU Session, at PDU Session establishment the SMF (Network Function) reports to the PCF (Network Function) the Framed Route information corresponding to the PDU Session (as described in clause 6.1.3.5 of TS 23.503 [45]). In this case, in order to support session binding, the PCF (Network Function) may further report to the BSF (Network Function) the Framed Route information corresponding to the PDU Session (as described in clause 6.1.2.2 of TS 23.503 [45]).
If the UDM (Network Function) or DN (Network Function)-AAA updates the Framed Route information during the lifetime of the PDU Session, the SMF (Network Function) releases the PDU Session and may include in the release request an indication for the UE (Network Function) to re-establish the PDU Session.
Triggers for the SMF (Network Function) to request for or subscribe to the analytics information from the NWDAF (Network Function) are internal logic may include for example:
-	UE (Network Function) PDU Session related event subscription by other NFs (e.g. AMF (Network Function), NEF (Network Function));
-	UE (Network Function) access and mobility event reports from the AMF (Network Function);
-	locally detected events;
-	analytics information received.
The trigger conditions may depend on operator and implementation policy in the SMF (Network Function). When a trigger condition happens, the SMF (Network Function) may decide if any analytics information is needed and if so, request for or subscription to the analytics information from the NWDAF (Network Function).
The SMF (Network Function) may, upon detection of certain local events, e.g. number of PDU sessions establishment or released reaches a threshold in a specific area, request for or subscribe to network analytics related to "Abnormal behaviour" as described in TS 23.288 [86] to detect whether there are any exceptional UE (Network Function) behaviours in this area.
Service Function Chaining, also called N6 (Non-service-based Interface) (Service-based Interface)-LAN Traffic Steering, refers to the steering of subscriber's traffic flows to appropriate operator or 3rd party Service Functions (e.g. NAT, antimalware, parental control, DDoS protection) in the N6 (Non-service-based Interface) (Service-based Interface)-LAN.
The content of this clause applies to non-roaming and to Home Routed roaming scenario, i.e. to cases where the involved entities (AF (Network Function), PCF (Network Function), SMF (Network Function), UPF (Network Function)) belong to the Home PLMN and the AF (Network Function) has an agreement with the Home PLMN.
The PCF (Network Function) controls Service Function Chaining by provisioning and modifying traffic steering control information for N6 (Non-service-based Interface) (Service-based Interface)-LAN Traffic Steering as described in TS 23.503 [45], e.g. clause 6.1.3.14. The traffic steering control information for N6 (Non-service-based Interface) (Service-based Interface)-LAN Traffic Steering consists of a traffic description and a reference to a traffic steering policy that is configured in the SMF (Network Function)/UPF (Network Function).
The PCF (Network Function) derives the TSP ID(s) (that can be different for uplink and downlink directions) based on operator configuration and sends the TSP ID(s) to the SMF (Network Function) as part of the N6 (Non-service-based Interface) (Service-based Interface)-LAN Traffic Steering Enforcement Control information in the PCC rule as described in clause 6.3.1 of TS 23.503 [45].
When the PCC rule is activated or updated with N6 (Non-service-based Interface) (Service-based Interface)-LAN Traffic Steering Enforcement Control information, the SMF (Network Function) sets the Forwarding Policy (uplink and/or downlink) within the FAR(s) based on the authorized TSP ID(s) in the PCC rule and under consideration of the direction. In case that Application (Protocol) Function influence on traffic routing Enforcement Control information and N6 (Non-service-based Interface) (Service-based Interface)-LAN Traffic Steering Enforcement Control information are both provided for the uplink direction, the SMF (Network Function) shall derive N4 (Service-based Interface) rules which instruct the UPF (Network Function) to pass the traffic through the relevant Service Function(s) deployed in the N6 (Non-service-based Interface) (Service-based Interface)-LAN before steering the traffic to the local data network. The SMF (Network Function) provides instructions to UPF (Network Function) for N6 (Non-service-based Interface) (Service-based Interface)-LAN traffic steering as further detailed in clause 5.8.5.6.
The UPF (Network Function) applies traffic steering mechanism based on Forwarding Policy, i.e. the UPF (Network Function) performs deployment specific actions as configured for the Forwarding Policy.
NOTE 1:	It is assumed that all UPFs in the operator network serving as PSA (Network Function) for the DNN/S-NSSAI/DNAI subject to N6 (Non-service-based Interface) (Service-based Interface)-LAN traffic steering need to be configured with the same traffic steering information for N6 (Non-service-based Interface) (Service-based Interface)-LAN traffic steering.
When performing deployment specific actions configured for the Forwarding Policy, the UPF (Network Function) may support traffic steering related functionality and user plane encapsulation protocols that are out of 3GPP scope (e.g. as defined by other standards organizations).
NOTE 2:	The existing user plane mechanisms (e.g. VXLAN, NSH, GENEVE, GRE, VLAN, etc.) defined at IETF are reused as applicable by the PSA (Network Function) UPF (Network Function) to support N6 (Non-service-based Interface) (Service-based Interface)-LAN traffic steering.
The mechanism used for forwarding the traffic between the Service Functions within the N6 (Non-service-based Interface) (Service-based Interface)-LAN is out of 3GPP scope.
An AF (Network Function) may request the steering of user plane traffic to a pre-configured chain of Service Functions on N6 (Non-service-based Interface) (Service-based Interface)-LAN.
In the non-roaming scenario, Application (Protocol) Function influence on Service Function Chaining and Application (Protocol) Function influence on traffic routing (as defined in clause 5.6.7) can be applicable to the same traffic simultaneously.
It is assumed that a service level agreement exists between the operator and a third party that includes a list of authorized predefined Service Function Chains (SFCs), each SFC being identified based on a Service Function Chaining identifier (SFC ID). The AF (Network Function) may request the selected traffic flows to be steered towards a specific SFC, either at PDU Session establishment or any time after PDU Session establishment.
The AF (Network Function) requests may be sent to the PCF (Network Function) via the NEF (Network Function). When SFC ID is included in the AF (Network Function) request, the parameters listed in Table 5.6.16.2-1 may be included in the AF (Network Function) request.
Table 5.6.16.2-1: Information element contained in AF (Network Function) request

The PCF (Network Function) checks whether the SFC ID received from the AF (Network Function) corresponds to an authorized predefined SFC according to the service level agreement with this AF (Network Function). Based on the SFC ID received from the AF (Network Function), the PCF (Network Function) derives the TSP ID(s) (that can be different for uplink and downlink directions) and sends the TSP ID(s) and optionally Metadata (as provided by the AF (Network Function)) to the SMF (Network Function) as part of the PCC rule(s) as described in clause 6.3.1 of TS 23.503 [45].
The SMF (Network Function) behaves in the same way it is described in clause 5.6.16.1. If the SMF (Network Function) has received Metadata in the N6 (Non-service-based Interface) (Service-based Interface)-LAN Traffic Steering Enforcement Control information of the PCC rule, the SMF (Network Function) forwards the Metadata to the UPF (Network Function) via N4 (Service-based Interface) in the corresponding FAR as described in clause 5.8.5.6.
The 5G QoS model is based on QoS Flows. The 5G QoS model supports both QoS Flows that require guaranteed flow bit rate (GBR QoS Flows) and QoS Flows that do not require guaranteed flow bit rate (Non-GBR QoS Flows). The 5G QoS model also supports Reflective QoS (see clause 5.7.5).
The QoS Flow is the finest granularity of QoS differentiation in the PDU Session. A QoS Flow ID (QFI) is used to identify a QoS Flow in the 5G System. User Plane traffic with the same QFI within a PDU Session receives the same traffic forwarding treatment (e.g. scheduling, admission threshold). The QFI is carried in an encapsulation header on N3 (Non-service-based Interface) (Service-based Interface) (and N9 (Service-based Interface)) i.e. without any changes to the e2e packet header. QFI shall be used for all PDU Session Types. The QFI shall be unique within a PDU Session. The QFI may be dynamically assigned or may be equal to the 5QI (see clause 5.7.2.1).
Within the 5GS, a QoS Flow is controlled by the SMF (Network Function) and may be preconfigured, or established via the PDU Session Establishment procedure (see clause 4.3.2 of TS 23.502 [3]), or the PDU Session Modification procedure (see clause 4.3.3 of TS 23.502 [3].
Any QoS Flow is characterised by:
-	A QoS profile provided by the SMF (Network Function) to the AN via the AMF (Network Function) over the N2 (Non-service-based Interface) (Service-based Interface) reference point or preconfigured in the AN;
-	One or more QoS rule(s) and optionally QoS Flow level QoS parameters (as specified in TS 24.501 [47]) associated with these QoS rule(s) which can be provided by the SMF (Network Function) to the UE (Network Function) via the AMF (Network Function) over the N1 (Non-service-based Interface) (Service-based Interface) reference point and/or derived by the UE (Network Function) by applying Reflective QoS control; and
-	One or more UL and DL PDR(s) provided by the SMF (Network Function) to the UPF (Network Function).
Within the 5GS, a QoS Flow associated with the default QoS rule is required to be established for a PDU Session and remains established throughout the lifetime of the PDU Session. This QoS Flow should be a Non-GBR QoS Flow (further details are described in clause 5.7.2.7).
A QoS Flow is associated with QoS requirements as specified by QoS parameters and QoS characteristics.
NOTE:	The QoS Flow associated with the default QoS rule provides the UE (Network Function) with connectivity throughout the lifetime of the PDU Session. Possible interworking with EPS motivates the recommendation for this QoS Flow to be of type Non-GBR.
A QoS Flow may be enabled with PDU Set based QoS handling as described in clause 5.37.5. For such QoS Flows, PDU Set QoS Parameters (see clause 5.7.7) are determined by the PCF (Network Function) and provided by SMF (Network Function) to the NG-RAN (Network Function) as part of the QoS profile.
A QoS Flow may either be 'GBR' or 'Non-GBR' depending on its QoS profile. The QoS profile of a QoS Flow is sent to the (R)AN and it contains QoS parameters as described below (details of QoS parameters are described in clause 5.7.2):
-	For each QoS Flow, the QoS profile shall include the QoS parameters:
-	5G QoS Identifier (5QI); and
-	Allocation and Retention Priority (ARP).
-	For each QoS Flow, the QoS profile may also include the QoS parameters:
-	PDU Set QoS Parameters (described in clause 5.7.7).
-	For each Non-GBR QoS Flow only, the QoS profile may also include the QoS parameter:
-	Reflective QoS Attribute (RQA).
-	For each GBR QoS Flow only, the QoS profile shall also include the QoS parameters:
-	Guaranteed Flow Bit Rate (GFBR) - UL and DL; and
-	Maximum Flow Bit Rate (MFBR) - UL and DL; and
-	In the case of a GBR QoS Flow only, the QoS profile may also include one or more of the QoS parameters:
-	Notification control;
-	Maximum Packet Loss Rate - UL and DL.
NOTE:	In this Release of the specification, the Maximum Packet Loss Rate (UL, DL) is only provided for a GBR QoS Flow belonging to voice media.
Each QoS profile has one corresponding QoS Flow identifier (QFI) which is not included in the QoS profile itself.
The usage of a dynamically assigned 5QI for a QoS Flow requires in addition the signalling of the complete 5G QoS characteristics (described in clause 5.7.3) as part of the QoS profile.
When a standardized or pre-configured 5QI is used for a QoS Flow, some of the 5G QoS characteristics may be signalled as part of the QoS profile (as described in clause 5.7.3).
5.7.1.2a	Alternative QoS Profile
The Alternative QoS Profile(s) can be optionally provided for a GBR QoS Flow with Notification control enabled. If the corresponding PCC rule contains the related information (as described in TS 23.503 [45]), the SMF (Network Function) shall provide, in addition to the QoS profile, a prioritized list of Alternative QoS Profile(s) to the NG-RAN (Network Function). If the SMF (Network Function) provides a new prioritized list of Alternative QoS Profile(s) to the NG-RAN (Network Function) (if the corresponding PCC rule information changes), the NG-RAN (Network Function) shall replace any previously stored list with it.
An Alternative QoS Profile represents a combination of QoS parameters PDB, PER, Averaging Window and GFBR to which the application traffic is able to adapt. For delay-critical GBR QoS flows, an Alternative QoS Profile may also include an MDBV.
NOTE 1:	There is no requirement that the GFBR monotonically decreases, nor that the PDB or PER monotonically increase as the Alternative QoS Profiles become less preferred.
When the NG-RAN (Network Function) sends a notification to the SMF (Network Function) that the QoS profile is not fulfilled, the NG-RAN (Network Function) shall, if the currently fulfilled values match an Alternative QoS Profile, include also the reference to the Alternative QoS Profile to indicate the QoS that the NG-RAN (Network Function) currently fulfils (see clause 5.7.2.4). The NG-RAN (Network Function) shall enable the SMF (Network Function) to determine when an NG-RAN (Network Function) node supports the Alternative QoS feature but cannot fulfil even the least preferred Alternative QoS Profile.
NOTE 2:	To reduce the risk that GBR QoS Flows are released in case of RAN (Network Function) resource limitations (and then experience difficulties in being re-established), Application (Protocol) Functions can set the least preferred Alternative Service Requirement to an undemanding level.
The following options are supported to control QoS Flows:
1)	For Non-GBR QoS Flows, and when standardized 5QIs or pre-configured 5QIs are used and when the 5QI is within the range of the QFI (i.e. a value less than 64), the 5QI value may be used as the QFI of the QoS Flow.
(a)	A default ARP shall be pre-configured in the AN; or
 (b)	The ARP and the QFI shall be sent to RAN (Network Function) over N2 (Non-service-based Interface) (Service-based Interface) at PDU Session Establishment or at PDU Session Modification and when NG-RAN (Network Function) is used every time the User Plane of the PDU Session is activated; and
2)	For all other cases (including GBR and Non-GBR QoS Flows), a dynamically assigned QFI shall be used. The 5QI value may be a standardized, pre-configured or dynamically assigned. The QoS profile and the QFI of a QoS Flow shall be provided to the (R)AN over N2 (Non-service-based Interface) (Service-based Interface) at PDU Session Establishment/Modification and when NG-RAN (Network Function) is used every time the User Plane of the PDU Session is activated.
Only options 1b and 2 may apply to 3GPP ANs. Options 1a, 1b and 2 may apply to Non-3GPP access.
NOTE:	Pre-configured 5QI values cannot be used when the UE (Network Function) is roaming.
The UE (Network Function) performs the classification and marking of UL User plane traffic, i.e. the association of UL traffic to QoS Flows, based on QoS rules. These QoS rules may be explicitly provided to the UE (Network Function) (i.e. explicitly signalled QoS rules using the PDU Session Establishment/Modification procedure), pre-configured in the UE (Network Function) or implicitly derived by the UE (Network Function) by applying Reflective QoS (see clause 5.7.5). A QoS rule contains the QFI of the associated QoS Flow, a Packet Filter Set (see clause 5.7.6) and a precedence value (see clause 5.7.1.9). An explicitly signalled QoS rule contains a QoS rule identifier which is unique within the PDU Session and is generated by SMF (Network Function).
There can be more than one QoS rule associated with the same QoS Flow (i.e. with the same QFI).
When the UE (Network Function) informs the network about the number of supported Packet Filters for signalled QoS rules for the PDU Session (during the PDU Session Establishment procedure or using the PDU Session Modification procedure as described in clause 5.17.2.2.2 after the first inter-system change from EPS to 5GS for a PDU Session established in EPS and transferred from EPS with N26 (Service-based Interface) interface), the SMF (Network Function) shall ensure that the sum of the Packet Filters used by all signalled QoS rules for a PDU Session does not exceed the number indicated by the UE (Network Function).
A default QoS rule is required to be sent to the UE (Network Function) for every PDU Session establishment and it is associated with a QoS Flow. For IP  (Protocol)type PDU Session or Ethernet type PDU Session, the default QoS rule is the only QoS rule of a PDU Session which may contain a Packet Filter Set that allows all UL packets, and in this case, the highest precedence value shall be used for the QoS rule.
NOTE 2:	How the UE (Network Function) evaluates UL packets against the Packet Filter Set in a QoS rule is described in clause 5.7.1.5.
NOTE 3:	The QoS rule pre-configured in the UE (Network Function) is only used together with option 1a for control QoS Flows as described in clause 5.7.1.3. How to keep the consistency of QFI and Packet Filter Set between UE (Network Function) and network is out of scope in this release of the specification.
For Unstructured type PDU Session, the default QoS rule does not contain a Packet Filter Set, and in this case the default QoS rule defines the treatment of all packets in the PDU Session.
As long as the default QoS rule does not contain a Packet Filter Set or contains a Packet Filter Set that allows all UL packets, Reflective QoS should not be applied for the QoS Flow which the default QoS rule is associated with and the RQA should not be sent for this QoS Flow.
The SMF (Network Function) performs the binding of PCC rules to QoS Flows based on the QoS and service requirements (as defined in TS 23.503 [45]). The SMF (Network Function) assigns the QFI for a new QoS Flow and derives its QoS profile, corresponding UPF (Network Function) instructions and QoS Rule(s) from the PCC rule(s) bound to the QoS Flow and other information provided by the PCF (Network Function).
When applicable, the SMF (Network Function) provides the following information for the QoS Flow to the (R)AN:
-	QFI;
-	QoS profile as described in clause 5.7.1.2.
-	optionally, Alternative QoS Profile(s) as described in clause 5.7.1.2a;
For each PCC rule bound to a QoS Flow, the SMF (Network Function) provides the following information to the UPF (Network Function) enabling classification, bandwidth enforcement and marking of User Plane traffic (the details are described in clause 5.8):
-	a DL PDR containing the DL part of the SDF template;
-	an UL PDR containing the UL part of the SDF template;
NOTE 1:	If a DL PDR for an bidirectional SDF is associated with a QoS Flow other than the one associated with the default QoS rule and the UE (Network Function) has not received any instruction to use this QoS Flow for the SDF in uplink direction (i.e. neither a corresponding QoS rule is sent to the UE (Network Function) nor the Reflective QoS Indication is set in the PCC rule), it means that the UL PDR for the same SDF has to be associated with the QoS Flow associated with the default QoS rule.
-	the PDR precedence value (see clause 5.7.1.9) for both PDRs is set to the precedence value of the PCC rule;
-	QoS related information (e.g. MBR for an SDF, GFBR and MFBR for a GBR QoS Flow) as described in clause 5.8.2;
-	the corresponding packet marking information (e.g. the QFI, the transport level packet marking value (e.g. the DSCP value of the outer IP  (Protocol)header);
-	optionally, the Reflective QoS Indication is included in the QER associated with the DL PDR (as described in clause 5.7.5.3).
For each PCC rule bound to a QoS Flow, when applicable, the SMF (Network Function) generates an explicitly signalled QoS rule (see clause 5.7.1.4) according to the following principles and provides it to the UE (Network Function) together with an add operation:
-	A unique (for the PDU Session) QoS rule identifier is assigned;
-	The QFI in the QoS rule is set to the QFI of the QoS Flow to which the PCC rule is bound;
-	The Packet Filter Set of the QoS rule is generated from the UL SDF filters and optionally the DL SDF filters of the PCC rule (but only from those SDF filters that have an indication for being signalled to the UE (Network Function), as defined in TS 23.503 [45]);
-	The QoS rule precedence value is set to the precedence value of the PCC rule for which the QoS rule is generated;
-	for a dynamically assigned QFI, the QoS Flow level QoS parameters (e.g. 5QI, GFBR, MFBR, Averaging Window, see TS 24.501 [47]) are signalled to UE (Network Function) in addition to the QoS rule(s) associated to the QoS Flow. The QoS Flow level QoS parameters of an existing QoS Flow may be updated based on the MBR and GBR information received in the PCC rule (MBR and GBR per SDF are however not provided to UE (Network Function) over N1 (Non-service-based Interface) (Service-based Interface) in the case of more than one SDF) or, if the PCF (Network Function) has not indicated differently, when Notification control or handover related signalling indicates that the QoS parameter the NG-RAN (Network Function) is currently fulfilling for the QoS Flow have changed (see clause 5.7.2.4).
Changes in the binding of PCC rules to QoS Flows as well as changes in the PCC rules or other information provided by the PCF (Network Function) can require QoS Flow changes which the SMF (Network Function) has to provide to (R)AN, UPF (Network Function) and/or UE (Network Function). In the case of changes in the explicitly signalled QoS rules associated to a QoS Flow, the SMF (Network Function) provides the explicitly signalled QoS rules and their operation (i.e. add/modify/delete) to the UE (Network Function).
NOTE 2:	The SMF (Network Function) cannot provide, update or remove pre-configured QoS rules or UE (Network Function) derived QoS rules.
The principle for classification and marking of User Plane traffic and mapping of QoS Flows to AN resources is illustrated in Figure 5.7.1.5-1.

Figure 5.7.1.5-1: The principle for classification and User Plane marking for QoS Flows and mapping to AN Resources
In DL, incoming data packets are classified by the UPF (Network Function) based on the Packet Filter Sets of the DL PDRs in the order of their precedence (without initiating additional N4 (Service-based Interface) signalling). The UPF (Network Function) conveys the classification of the User Plane traffic belonging to a QoS Flow through an N3 (Non-service-based Interface) (Service-based Interface) (and N9 (Service-based Interface)) User Plane marking using a QFI. The AN binds QoS Flows to AN resources (i.e. Data Radio Bearers of in the case of 3GPP RAN (Network Function)). There is no strict 1:1 relation between QoS Flows and AN resources. It is up to the AN to establish the necessary AN resources that QoS Flows can be mapped to, and to release them. The AN shall indicate to the SMF (Network Function) when the AN resources onto which a QoS Flow is mapped are released.
If no matching DL PDR is found, the UPF (Network Function) shall discard the DL data packet.
In UL:
-	For a PDU Session of Type IP  (Protocol)or Ethernet, the UE (Network Function) evaluates UL packets against the UL Packet Filters in the Packet Filter Set in the QoS rules based on the precedence value of QoS rules in increasing order until a matching QoS rule (i.e. whose Packet Filter matches the UL packet) is found.
-	If no matching QoS rule is found, the UE (Network Function) shall discard the UL data packet.
-	For a PDU Session of Type Unstructured, the default QoS rule does not contain a Packet Filter Set and allows all UL packets.
NOTE 3:	Only the default QoS rule exist for a PDU Session of Type Unstructured.
	The UE (Network Function) uses the QFI in the corresponding matching QoS rule to bind the UL packet to a QoS Flow. The UE (Network Function) then binds QoS Flows to AN resources.
The following characteristics apply for processing of DL traffic:
-	UPF (Network Function) maps User Plane traffic to QoS Flows based on the PDRs.
-	UPF (Network Function) performs Session-AMBR enforcement as specified in clause 5.7.1.8 and performs counting of packets for charging.
-	UPF (Network Function) transmits the PDUs of the PDU Session in a single tunnel between 5GC and (R)AN, the UPF (Network Function) includes the QFI in the encapsulation header. In addition, UPF (Network Function) may include an indication for Reflective QoS activation in the encapsulation header.
-	UPF (Network Function) performs transport level packet marking in DL on a per QoS Flow basis. The UPF (Network Function) uses the transport level packet marking value provided by the SMF (Network Function) (as described in clause 5.8.2.7).
-	(R)AN maps PDUs from QoS Flows to access-specific resources based on the QFI and the associated 5G QoS profile, also taking into account the N3 (Non-service-based Interface) (Service-based Interface) tunnel associated with the DL packet.
NOTE:	Packet Filters are not used for the mapping of QoS Flows onto access-specific resources in (R)AN.
-	If Reflective QoS applies, the UE (Network Function) creates a new derived QoS rule as defined in clause 5.7.5.2.
Following characteristics apply for processing of UL traffic:
-	UE (Network Function) uses the stored QoS rules to determine mapping between UL User Plane traffic and QoS Flows. UE (Network Function) marks the UL PDU with the QFI of the QoS rule containing the matching Packet Filter and transmits the UL PDUs using the corresponding access specific resource for the QoS Flow based on the mapping provided by (R)AN. For NG-RAN (Network Function), the UL behaviour is specified in clause 10.5.2 of TS 38.300 [27].
-	(R)AN transmits the PDUs over N3 (Non-service-based Interface) (Service-based Interface) tunnel towards UPF (Network Function). When passing an UL packet from (R)AN to CN, the (R)AN includes the QFI value, in the encapsulation header of the UL PDU, and selects the N3 (Non-service-based Interface) (Service-based Interface) tunnel.
-	(R)AN performs transport level packet marking in the UL on a per QoS Flow basis with a transport level packet marking value that is determined based on the 5QI, the Priority Level (if explicitly signalled) and the ARP priority level of the associated QoS Flow.
-	UPF (Network Function) verifies whether QFIs in the UL PDUs are aligned with the QoS Rules provided to the UE (Network Function) or implicitly derived by the UE (Network Function) in the case of Reflective QoS).
-	UPF (Network Function) and UE (Network Function) perform Session-AMBR enforcement as specified in clause 5.7.1.8 and the UPF (Network Function) performs counting of packets for charging.
UL and DL Session-AMBR (see clause 5.7.2.6) shall be enforced by the UPF (Network Function), if the UPF (Network Function) receives the Session-AMBR values from the SMF (Network Function) as described in clause 5.8.2.7 and clause 5.8.5.4.
For UL Classifier PDU Sessions, UL and DL Session-AMBR (see clause 5.7.2.6) shall be enforced in the SMF (Network Function) selected UPF (Network Function) that supports the UL Classifier functionality. In addition, the DL Session-AMBR shall be enforced separately in every UPF (Network Function) that terminates the N6 (Non-service-based Interface) (Service-based Interface) interface (i.e. without requiring interaction between the UPFs) (see clause 5.6.4).
For multi-homed PDU Sessions, UL and DL Session-AMBR shall be enforced in the UPF (Network Function) that supports the Branching Point functionality. In addition, the DL Session-AMBR shall be enforced separately in every UPF (Network Function) that terminates the N6 (Non-service-based Interface) (Service-based Interface) interface (i.e. without requiring interaction between the UPFs) (see clause 5.6.4).
NOTE:	The DL Session-AMBR is enforced in every UPF (Network Function) terminating the N6 (Non-service-based Interface) (Service-based Interface) interface to reduce unnecessary transport of traffic which may be discarded by the UPF (Network Function) performing the UL Classifier/Branching Point functionality due to the amount of the DL traffic for the PDU Session exceeding the DL Session-AMBR. Discarding DL packets in the UL Classifier/Branching Point could cause erroneous PDU counting for support of charging
The (R)AN shall enforce UE (Network Function)-AMBR (see clause 5.7.2.6) in UL and DL per UE (Network Function) for Non-GBR QoS Flows.
The UE (Network Function) shall perform UL rate limitation on PDU Session basis for Non-GBR traffic using Session-AMBR, if the UE (Network Function) receives a Session-AMBR.
MBR per SDF is mandatory for GBR QoS Flows but optional for Non-GBR QoS Flows. The MBR is enforced in the UPF (Network Function).
The MFBR is enforced in the UPF (Network Function) in the Downlink for GBR QoS Flows. The MFBR is enforced in the (R)AN in the Downlink and Uplink for GBR QoS Flows. For non-3GPP access, the UE (Network Function) should enforce MFBR in the Uplink for GBR QoS Flows.
The QoS control for Unstructured PDUs is performed at the PDU Session level and in this Release of the specification there is only support for maximum of one 5G QoS Flow per PDU Session of Type Unstructured.
When a PDU Session is set up for transferring unstructured PDUs, SMF (Network Function) provides the QFI which will be applied to any packet of the PDU Session to the UPF (Network Function) and UE (Network Function).
The QoS rule precedence value and the PDR precedence value determine the order in which a QoS rule or a PDR, respectively, shall be evaluated. The evaluation of the QoS rules or PDRs is performed in increasing order of their precedence value.
If a supporting NG-RAN (Network Function) receives for a UE (Network Function) a UE (Network Function)-Slice-MBR (see clause 5.7.2.6) for an S-NSSAI from the AMF (Network Function), the NG-RAN (Network Function) shall apply this UE (Network Function)-Slice-MBR for all PDU Sessions of that UE (Network Function) corresponding to the S-NSSAI which have an active user plane if feasible. In particular, the NG-RAN (Network Function) shall enforce this UE (Network Function)-Slice-MBR as follows:
1)	Whenever a request for a GBR QoS Flow establishment or modification is received, the NG-RAN (Network Function) admission control shall ensure that the sum of the GFBR values of the admitted GBR QoS Flows is not exceeding the UE (Network Function)-Slice-MBR and, if the QoS Flow cannot be admitted, the NG-RAN (Network Function) shall reject the establishment/modification of the QoS Flow.
NOTE:	If the UE (Network Function)-Slice-MBR would be exceeded by a new/modified GBR QoS Flow, the NG-RAN (Network Function) determines whether the new/modified GBR QoS Flow can pre-empt any existing GBR QoS Flow of the UE (Network Function)'s PDU Session(s) corresponding to the same S-NSSAI based on their ARP values (as per clause 5.7.2.2), e.g. to support certain priority services (e.g. MPS). If this is not possible, the NG-RAN (Network Function) can reject the establishment/modification of the QoS Flow.
2)	The NG-RAN (Network Function) shall ensure that the aggregated bitrate across all GBR and Non-GBR QoS Flows belonging to those PDU Sessions is not exceeding the UE (Network Function)-Slice-MBR, while always guaranteeing the GFBR of every GBR QoS Flow of those PDU Sessions as described in clause 5.7.2.5.
In the case of home-routed roaming, the V-SMF (Network Function) may apply VPLMN policies related with the SLA negotiated with the HPLMN or with QoS values supported by the VPLMN. Such policies may result in a situation that the V-SMF (Network Function) does not accept the PDU Session or does not accept some of the QoS Flows requested by the H-SMF (Network Function).
QoS constraints represent the QoS that the VPLMN can accept for the QoS Flow associated with the default QoS rule and the PDU Session based on SLA or based on QoS values supported by the VPLMN. The QoS constraints may contain 5QI, 5QI Priority Level and ARP for the QoS Flow associated with the default QoS rule and highest Session-AMBR accepted by the VPLMN.
NOTE:	For this Release of the specification, QoS constraints apply only to the non-GBR default QoS Flow.
At PDU Session Establishment for home-routed roaming, to reduce the risk of PDU Session establishment failure due to QoS from the HPLMN not being compliant with SLA, the V-SMF (Network Function) may provide the VPLMN local policy in QoS constraints to the H-SMF (Network Function) as specified in clause 4.3.2.2.2 of TS 23.502 [3].
For intra-5GS mobility with V-SMF (Network Function) insertion or V-SMF (Network Function) change (e.g. inter-PLMN mobility), as specified in clause 4.23 of TS 23.502 [3], the new/target V-SMF (Network Function) may validate the currently applied QoS against the QoS constraints. The new/target V-SMF (Network Function) provides QoS constraints to the H-SMF (Network Function) during the mobility procedure. The new/target V-SMF (Network Function) may temporarily accept a higher QoS even if the currently applied QoS exceeds the QoS constraints. Alternatively, for the QoS parameters related with the QoS constraints, the V-SMF (Network Function) may locally downgrade these values before providing the corresponding QoS profiles to 5G AN. The V-SMF (Network Function) may decide to release the PDU Session if the HPLMN does not provide updated QoS compliant with the QoS constraints after the mobility procedure.
For IMS voice service (e.g. the IMS DNN defined by the GSMA), the V-SMF (Network Function), based on local policy, may override the ARP received from HPLMN over N16 (Service-based Interface) if the ARP indicates priority not in line with the local policy in VPLMN. The ARP override in the serving PLMN applies to both the QoS Flow associated with the default QoS rule and the QoS Flows for IMS voice, to apply the same allocation and retention priority for all users (i.e. roamers and non-roamers). For MPS (clause 5.16.5), the same allocation and retention priority is applied to all MPS service users (i.e. roamers and non-roamers), when roaming agreements are in place and where regulatory requirements apply.
A 5QI is a scalar that is used as a reference to 5G QoS characteristics defined in clause 5.7.4, i.e. access node-specific parameters that control QoS forwarding treatment for the QoS Flow (e.g. scheduling weights, admission thresholds, queue management thresholds, link layer protocol configuration, etc.).
Standardized 5QI values have one-to-one mapping to a standardized combination of 5G QoS characteristics as specified in Table 5.7.4-1.
The 5G QoS characteristics for pre-configured 5QI values are pre-configured in the AN.
Standardized or pre-configured 5G QoS characteristics, are indicated through the 5QI value, and are not signalled on any interface, unless certain 5G QoS characteristics are modified as specified in clauses 5.7.3.3, 5.7.3.4, 5.7.3.6, and 5.7.3.7.
The 5G QoS characteristics for QoS Flows with dynamically assigned 5QI are signalled as part of the QoS profile.
NOTE:	On N3 (Non-service-based Interface) (Service-based Interface), each PDU (i.e. in the tunnel used for the PDU Session) is associated with one 5QI via the QFI carried in the encapsulation header.
The QoS parameter ARP contains information about the priority level, the pre-emption capability and the pre-emption vulnerability. This allows deciding whether a QoS Flow establishment/modification/handover may be accepted or needs to be rejected in the case of resource limitations (typically used for admission control of GBR traffic). It may also be used to decide which existing QoS Flow to pre-empt during resource limitations, i.e. which QoS Flow to release to free up resources.
The ARP priority level defines the relative importance of a QoS Flow. The range of the ARP priority level is 1 to 15 with 1 as the highest priority.
The ARP priority levels 1-8 should only be assigned to QoS Flows for services that are authorized to receive prioritized treatment within an operator domain (i.e. that are authorized by the serving network). The ARP priority levels 9-15 may be assigned to QoS Flows for services that are authorized by the home network and thus applicable when a UE (Network Function) is roaming.
NOTE:	This ensures that future releases may use ARP priority level 1-8 to indicate e.g. emergency and other priority services within an operator domain in a backward compatible manner. This does not prevent the use of ARP priority level 1-8 in roaming situation in the case that appropriate roaming agreements exist that ensure a compatible use of these priority levels.
The ARP pre-emption capability defines whether a QoS Flow may get resources that were already assigned to another QoS Flow with a lower priority. The ARP pre-emption vulnerability defines whether a QoS Flow may lose the resources assigned to it in order to admit a QoS Flow with higher priority. The ARP pre-emption capability and the ARP pre-emption vulnerability shall be either set to 'enabled' or 'disabled'.
The ARP pre-emption vulnerability of the QoS Flow which the default QoS rule is associated with should be set appropriately to minimize the risk of a release of this QoS Flow.
The details of how the SMF (Network Function) sets the ARP for a QoS Flow are further described in clause 5.7.2.7.
The Reflective QoS Attribute (RQA) is an optional parameter which indicates that certain traffic (not necessarily all) carried on this QoS Flow is subject to Reflective QoS. Only when the RQA is signalled for a QoS Flow, the (R)AN enables the transfer of the RQI for AN resource corresponding to this QoS Flow. The RQA may be signalled to NG-RAN (Network Function) via the N2 (Non-service-based Interface) (Service-based Interface) reference point at UE (Network Function) context establishment in NG-RAN (Network Function) and at QoS Flow establishment or modification.
The QoS Parameter Notification control indicates whether notifications are requested from the NG-RAN (Network Function) when the "GFBR can no longer (or can again) be guaranteed" for a QoS Flow during the lifetime of the QoS Flow. Notification control may be used for a GBR QoS Flow if the application traffic is able to adapt to the change in the QoS (e.g. if the AF (Network Function) is capable to trigger rate adaptation).
The SMF (Network Function) shall only enable Notification control when the QoS Notification Control parameter is set in the PCC rule (received from the PCF (Network Function)) that is bound to the QoS Flow. The Notification control parameter is signalled to the NG-RAN (Network Function) as part of the QoS profile.
5.7.2.4.1a	Notification Control without Alternative QoS Profiles
If, for a given GBR QoS Flow, Notification control is enabled and the NG-RAN (Network Function) determines that the GFBR, the PDB or the PER of the QoS profile cannot be fulfilled, NG-RAN (Network Function) shall send a notification towards SMF (Network Function) that the "GFBR can no longer be guaranteed". Furthermore, the NG-RAN (Network Function) shall keep the QoS Flow (i.e. while the NG-RAN (Network Function) is not fulfilling the requested QoS profile for this QoS Flow), unless specific conditions at the NG-RAN (Network Function) require the release of the NG-RAN (Network Function) resources for this GBR QoS Flow, e.g. due to Radio link failure or RAN (Network Function) internal congestion. The NG-RAN (Network Function) should try to fulfil the GFBR, the PDB and the PER of the QoS profile again.
NOTE 1:	NG-RAN (Network Function) can decide that the "GFBR can no longer be guaranteed" based on, e.g. measurements like queuing delay or system load.
Upon receiving a notification from the NG-RAN (Network Function) that the "GFBR can no longer be guaranteed", the SMF (Network Function) may forward the notification to the PCF (Network Function), see TS 23.503 [45].
When the NG-RAN (Network Function) determines that the GFBR, the PDB and the PER of the QoS profile can be fulfilled again for a QoS Flow (for which a notification that the "GFBR can no longer be guaranteed" has been sent), the NG-RAN (Network Function) shall send a notification, informing the SMF (Network Function) that the "GFBR can be guaranteed" again and the SMF (Network Function) may forward the notification to the PCF (Network Function), see TS 23.503 [45]. The NG-RAN (Network Function) shall send a subsequent notification that the "GFBR can no longer be guaranteed" whenever necessary.
NOTE 2:	It is assumed that NG-RAN (Network Function) implementation will apply some hysteresis before determining that the "GFBR can be guaranteed again" and therefore a frequent signalling of "GFBR can be guaranteed again" followed by "GFBR can no longer be guaranteed" is not expected.
NOTE 3:	If the QoS Flow is modified, the NG-RAN (Network Function) restarts the check whether the "GFBR can no longer be guaranteed" according to the updated QoS profile. If the Notification control parameter is not included in the updated QoS profile, the Notification control is disabled.
During a handover, the Source NG-RAN (Network Function) does not inform the Target NG-RAN (Network Function) about whether the Source NG-RAN (Network Function) has sent a notification for a QoS Flow that the "GFBR can no longer be guaranteed". The Target NG-RAN (Network Function) performs admission control rejecting any QoS Flows for which resources cannot be permanently allocated. The accepted QoS Flows are included in the N2 (Non-service-based Interface) (Service-based Interface) Path Switch Request or N2 (Non-service-based Interface) (Service-based Interface) Handover Request Acknowledge message from the NG-RAN (Network Function) to the AMF (Network Function). The SMF (Network Function) shall interpret the fact that a QoS Flow is listed as transferred QoS Flow in the Nsmf_PDUSession_UpdateSMContext Request received from the AMF (Network Function) as a notification that "GFBR can be guaranteed again" for this QoS Flow unless the SMF (Network Function) is also receiving a reference to an Alternative QoS Profile for this QoS Flow (which is described in clause 5.7.2.4.2). After the handover is successfully completed, the Target NG-RAN (Network Function) shall send a subsequent notification that the "GFBR can no longer be guaranteed" for such a QoS Flow whenever necessary. If the SMF (Network Function) has previously notified the PCF (Network Function) that the "GFBR can no longer be guaranteed" and the SMF (Network Function) does not receive an explicit notification that the "GFBR can no longer be guaranteed" for that QoS Flow from the Target NG-RAN (Network Function) within a configured time, the SMF (Network Function) shall notify the PCF (Network Function) that the "GFBR can be guaranteed again".
5.7.2.4.1b	Notification control with Alternative QoS Profiles
If, for a given GBR QoS Flow, Notification control is enabled and the NG-RAN (Network Function) has received a list of Alternative QoS Profile(s) for this QoS Flow and supports the Alternative QoS Profile handling, the following shall apply:
1)	If the NG-RAN (Network Function) determines that the GFBR, the PDB or the PER of the QoS profile cannot be fulfilled, NG-RAN (Network Function) shall send a notification towards SMF (Network Function) that the "GFBR can no longer be guaranteed". Before sending a notification that the "GFBR can no longer be guaranteed" towards the SMF (Network Function), the NG-RAN (Network Function) shall check whether the GFBR, the PDB and the PER that the NG-RAN (Network Function) currently fulfils match any of the Alternative QoS Profile(s) in the indicated priority order. If there is a match, the NG-RAN (Network Function) shall indicate the reference to the matching Alternative QoS Profile with the highest priority together with the notification to the SMF (Network Function).
	If there is no match, the NG-RAN (Network Function) shall send a notification that the "GFBR can no longer be guaranteed" towards the SMF (Network Function) indicating that the lowest Alternative QoS Profile cannot be fulfilled (unless specific conditions at the NG-RAN (Network Function) require the release of the NG-RAN (Network Function) resources for this GBR QoS Flow, e.g. due to Radio link failure or RAN (Network Function) internal congestion).
2)	If a notification that the "GFBR can no longer be guaranteed" has been sent to the SMF (Network Function) and the NG-RAN (Network Function) determines that the currently fulfilled GFBR, PDB or PER are different (better or worse) from the situation indicated in the last notification, the NG-RAN (Network Function) shall send a notification (i.e. "GFBR can no longer be guaranteed" or "GFBR can be guaranteed again") to the SMF (Network Function) and indicate the current situation (unless specific conditions at the NG-RAN (Network Function) require the release of the NG-RAN (Network Function) resources for this GBR QoS Flow, e.g. due to Radio link failure or RAN (Network Function) internal congestion).
NOTE 1:	The current situation is either that the QoS Profile can be fulfilled (which is implicitly indicated by the "GFBR can be guaranteed again" notification itself), that a different Alternative QoS Profile can be fulfilled, or that the lowest priority Alternative QoS Profile cannot be fulfilled.
3)-	The NG-RAN (Network Function) should always try to fulfil the QoS profile and, if this is not possible, any Alternative QoS Profile that has higher priority.
NOTE 2:	In order to avoid a too frequent signalling to the SMF (Network Function), it is assumed that NG-RAN (Network Function) implementation can apply hysteresis (e.g. via a configurable time interval) before notifying the SMF (Network Function) that the currently fulfilled values match the QoS Profile or a different Alternative QoS Profile of higher priority. It is also assumed that the PCF (Network Function) has ensured that the QoS values within the different Alternative QoS Profile(s) are not too close to each other.
4)	Upon receiving a notification from the NG-RAN (Network Function), the SMF (Network Function) may inform the PCF (Network Function). If it does so, the SMF (Network Function) shall indicate the currently fulfilled situation to the PCF (Network Function). See TS 23.503 [45].
5)	If the PCF (Network Function) has not indicated differently, the SMF (Network Function) uses NAS (Protocol) signalling (that is sent transparently through the RAN (Network Function)) to inform the UE (Network Function) about changes in the QoS parameters (i.e. 5QI, GFBR, MFBR) that the NG-RAN (Network Function) is currently fulfilling for the QoS Flow after Notification control has occurred.
During handover, the prioritized list of Alternative QoS Profile(s) (if available) is provided to the Target NG-RAN (Network Function) per QoS Flow in addition to the QoS profile. If the Target NG-RAN (Network Function) is not able to guarantee the GFBR, the PDB and the PER included in the QoS profile and if Alternative QoS Profiles are provided to the Target NG-RAN (Network Function) and the Target NG-RAN (Network Function) supports Alternative QoS Profiles, the Target NG-RAN (Network Function) checks whether the GFBR, the PDB and the PER values that it can fulfil match any of the Alternative QoS Profile(s) taking the priority order into account. If there is a match between one of the Alternative QoS Profiles and the GFBR, the PDB and the PER values that Target NG-RAN (Network Function) can fulfil, the Target NG-RAN (Network Function) shall accept the QoS Flow and indicate the reference to that Alternative QoS Profile to the Source NG-RAN (Network Function).
For delay-critical GBR QoS flows, the Target NG-RAN (Network Function) also takes into consideration whether it is able to accept the MDBV if it is included in the Alternative QoS profile.
If there is no match to any Alternative QoS Profile, the Target NG-RAN (Network Function) rejects QoS Flows for which the Target NG-RAN (Network Function) is not able to guarantee the GFBR, the PDB, the PER and if available, an associated MDBV included in the QoS profile.
After the handover is completed and a QoS Flow has been accepted by the Target NG-RAN (Network Function) based on an Alternative QoS Profile, the Target NG-RAN (Network Function) shall treat this QoS Flow in the same way as if it had sent a notification that the "GFBR can no longer be guaranteed" with a reference to that Alternative QoS Profile to the SMF (Network Function) (as described in clause 5.7.2.4.1b).
If a QoS Flow has been accepted by the Target NG-RAN (Network Function) based on an Alternative QoS Profile, the reference to the matching Alternative QoS Profile is provided from the Target NG-RAN (Network Function) to the AMF (Network Function) (which forwards the message to the SMF (Network Function)) during the Xn and N2 (Non-service-based Interface) (Service-based Interface) based handover procedures as described in TS 23.502 [3]. After the handover is completed successfully, the SMF (Network Function) shall send a notification to the PCF (Network Function) that the "GFBR can no longer be guaranteed" for a QoS Flow (see TS 23.503 [45] for details) if the SMF (Network Function) has received a reference to an Alternative QoS Profile and this reference indicates a change in the previously notified state of this QoS Flow. If the PCF (Network Function) has not indicated differently, the SMF (Network Function) shall also use NAS (Protocol) signalling (that is sent transparently through the RAN (Network Function)) to inform the UE (Network Function) about the QoS parameters (i.e. 5QI, GFBR, MFBR) corresponding to the new state of the QoS Flow.
NOTE:	A state change for the QoS Flow comprises a change from QoS profile fulfilled to Alternative QoS Profile fulfilled as well as the state change between fulfilled Alternative QoS Profiles.
If a QoS Flow has been accepted by the Target NG-RAN (Network Function) based on the QoS Profile, the SMF (Network Function) shall interpret the fact that a QoS Flow is listed as transferred QoS Flow in the message received from the AMF (Network Function) as a notification that "GFBR can be guaranteed again" for this QoS Flow. After the handover is successfully completed, the Target NG-RAN (Network Function) performs as described in clause 5.7.2.4.1b. If the SMF (Network Function) has previously notified the PCF (Network Function) that the "GFBR can no longer be guaranteed" and the SMF (Network Function) does not receive an explicit notification that the "GFBR can no longer be guaranteed" for that QoS Flow from the Target NG-RAN (Network Function) within a configured time, the SMF (Network Function) shall notify the PCF (Network Function) that the "GFBR can be guaranteed again".
If a QoS Flow has been accepted by the Target NG-RAN (Network Function) and SMF (Network Function) did not receive from the Target NG-RAN (Network Function) a reference to any Alternative QoS Profile and the SMF (Network Function) has previously informed the UE (Network Function) about QoS parameters corresponding to any of the Alternative QoS Profile(s), the SMF (Network Function) shall use NAS (Protocol) signalling to inform the UE (Network Function) about the QoS parameters corresponding to the QoS Profile.
During QoS Flow establishment and modification, a prioritized list of Alternative QoS Profile(s) can be provided to the NG-RAN (Network Function) for the QoS Flow in addition to the QoS profile. If the NG-RAN (Network Function) is not able to guarantee the GFBR, the PDB and the PER included in the QoS profile and if Alternative QoS Profiles are provided to the NG-RAN (Network Function) and the NG-RAN (Network Function) supports Alternative QoS Profiles, the NG-RAN (Network Function) shall check whether the GFBR, the PDB and the PER values that it can fulfil match at least one of the Alternative QoS Profile(s) taking the priority order into account. If there is a match between one of the Alternative QoS Profiles and the GFBR, the PDB and if available, associated MDBV and the PER values that the NG-RAN (Network Function) can fulfil, the NG-RAN (Network Function) shall accept the QoS Flow and indicate the reference to that Alternative QoS Profile to the SMF (Network Function). If there is no match to any Alternative QoS Profile, the NG-RAN (Network Function) shall reject the QoS Flow establishment or modification.
After a successful QoS Flow establishment or modification during which the NG-RAN (Network Function) indicated that the currently fulfilled QoS matches one of the Alternative QoS Profiles, the NG-RAN (Network Function) shall treat this QoS Flow in the same way as if it had sent a notification that the "GFBR can no longer be guaranteed" with a reference to that Alternative QoS Profile to the SMF (Network Function) (as described in clause 5.7.2.4.1b).
If the SMF (Network Function) has received a reference to an Alternative QoS Profile during QoS Flow establishment and modification the SMF (Network Function) may inform the PCF (Network Function) about it (as described in TS 23.503 [45]).
If the PCF (Network Function) has not indicated differently, the SMF (Network Function) shall use NAS (Protocol) signalling (that is sent transparently through the RAN (Network Function)) to inform the UE (Network Function) about the QoS parameters (i.e. 5QI, GFBR, MFBR) corresponding to the referenced Alternative QoS Profile.
For GBR QoS Flows only, the following additional QoS parameters exist:
-	Guaranteed Flow Bit Rate (GFBR) - UL and DL;
-	Maximum Flow Bit Rate (MFBR) -- UL and DL.
The GFBR denotes the bit rate that is guaranteed to be provided by the network to the QoS Flow over the Averaging Time Window. The MFBR limits the bit rate to the highest bit rate that is expected by the QoS Flow (e.g. excess traffic may get discarded or delayed by a rate shaping or policing function at the UE (Network Function), RAN (Network Function), UPF (Network Function)). Bit rates above the GFBR value and up to the MFBR value, may be provided with relative priority determined by the Priority Level of the QoS Flows (see clause 5.7.3.3).
GFBR and MFBR are signalled to the (R)AN in the QoS Profile and signalled to the UE (Network Function) as QoS Flow level QoS parameter (as specified in TS 24.501 [47]) for each individual QoS Flow.
NOTE 1:	The GFBR is recommended as the lowest acceptable service bitrate where the service will survive.
NOTE 2:	For each QoS Flow of Delay-critical GBR resource type, the SMF (Network Function) can ensure that the GFBR of the QoS Flow can be achieved with the MDBV of the QoS Flow using the QoS Flow binding functionality described in clause 6.1.3.2.4 of TS 23.503 [45].
NOTE 3:	The network can set MFBR larger than GFBR for a particular QoS Flow based on operator policy and the knowledge of the end point capability, i.e. support of rate adaptation at application / service level.
Each PDU Session of a UE (Network Function) is associated with the following aggregate rate limit QoS parameter:
-	per Session Aggregate Maximum Bit Rate (Session-AMBR).
The Session-AMBR is signalled to the appropriate UPF (Network Function) entity/ies to the UE (Network Function) and to the (R)AN (to enable the calculation of the UE (Network Function)-AMBR). The Session-AMBR limits the aggregate bit rate that can be expected to be provided across all Non-GBR QoS Flows for a specific PDU Session. The Session-AMBR is measured over an AMBR averaging window which is a standardized value. The Session-AMBR is not applicable to GBR QoS Flows.
Each UE (Network Function) is associated with the following aggregate rate limit QoS parameter:
-	per UE (Network Function) Aggregate Maximum Bit Rate (UE (Network Function)-AMBR).
The UE (Network Function)-AMBR limits the aggregate bit rate that can be expected to be provided across all Non-GBR QoS Flows of a UE (Network Function). Each (R)AN shall set its UE (Network Function)-AMBR to the sum of the Session-AMBR of all PDU Sessions with active user plane to this (R)AN up to the value of the UE (Network Function)-AMBR received from AMF (Network Function). The UE (Network Function)-AMBR is a parameter provided to the (R)AN by the AMF (Network Function) based on the value of the subscribed UE (Network Function)-AMBR retrieved from UDM (Network Function) or the dynamic serving network UE (Network Function)-AMBR retrieved from PCF (Network Function) (e.g. for roaming subscriber). The AMF (Network Function) provides the UE (Network Function)-AMBR provided by PCF (Network Function) to (R)AN if available. The UE (Network Function)-AMBR is measured over an AMBR averaging window which is a standardized value. The UE (Network Function)-AMBR is not applicable to GBR QoS Flows.
Each group of PDU Sessions of the UE (Network Function) for the same slice (S-NSSAI) may be associated with the following aggregate rate limit QoS parameter:
-	per UE (Network Function) per Slice-Maximum Bit Rate (UE (Network Function)-Slice-MBR).
The UE (Network Function)-Slice-MBR limits the aggregate bit rate that can be expected to be provided across all GBR and Non-GBR QoS Flows corresponding to PDU Sessions of the UE (Network Function) for the same slice (S-NSSAI) which have an active user plane. Each supporting NG-RAN (Network Function) shall set its UE (Network Function)-Slice-MBR to the sum of the Session-AMBR and MFBR for GBR QoS Flows of all PDU Sessions corresponding to the slice (S-NSSAI) with active user plane to this NG-RAN (Network Function) up to the value of the UE (Network Function)-Slice-MBR corresponding to the slice (S-NSSAI) received from AMF (Network Function). The UE (Network Function)-Slice-MBR is measured over an AMBR averaging window which is a standardized value. The UE (Network Function)-Slice-MBR is an optional parameter provided to the NG-RAN (Network Function) by the AMF (Network Function) as described in clause 5.15.13.
NOTE:	The AMBR averaging window is only applied to Session-AMBR, UE (Network Function)-AMBR and UE (Network Function)-Slice-MBR measurement and the AMBR averaging windows for Session-AMBR and UE (Network Function)-AMBR are standardised to the same value.
For each PDU Session Setup, the SMF (Network Function) retrieves the subscribed Session-AMBR values as well as the subscribed default values for the 5QI and the ARP and optionally, the 5QI Priority Level, from the UDM (Network Function). The subscribed default 5QI value shall be a Non-GBR 5QI from the standardized value range.
NOTE 1:	The 5QI Priority Level can be added to the subscription information to achieve an overwriting of the standardized or preconfigured 5QI Priority Level e.g. in scenarios where dynamic PCC is not deployed or the PCF (Network Function) is unavailable or unreachable.
The SMF (Network Function) may change the subscribed values for the default 5QI and the ARP and if received, the 5QI Priority Level, based on interaction with the PCF (Network Function) as described in TS 23.503 [45] or, if dynamic PCC is not deployed, based on local configuration, to set QoS parameters for the QoS Flow associated with the default QoS rule.
For QoS Flow(s) of the PDU Session other than the QoS Flow associated with the default QoS rule, the SMF (Network Function) shall set the ARP priority level, the ARP pre-emption capability and the ARP pre-emption vulnerability to the respective values in the PCC rule(s) bound to that QoS Flow (as described in TS 23.503 [45]). If dynamic PCC is not deployed, the SMF (Network Function) shall set the ARP priority level, the ARP pre-emption capability and the ARP pre-emption vulnerability based on local configuration.
NOTE 2:	The local configuration in the SMF (Network Function) can e.g. make use of the subscribed value for the ARP priority level and apply locally configured values for the ARP pre-emption capability and ARP pre-emption vulnerability.
If dynamic PCC is not deployed, the SMF (Network Function) can have a DNN based configuration to enable the establishment of a GBR QoS Flow as the QoS Flow that is associated with the default QoS rule. This configuration contains a standardized GBR 5QI as well as GFBR and MFBR for UL and DL.
NOTE 3:	Interworking with EPS is not possible for a PDU Session with a GBR QoS Flow as the QoS Flow that is associated with the default QoS rule.
The SMF (Network Function) may change the subscribed Session-AMBR values (for UL and/or DL), based on interaction with the PCF (Network Function) as described in TS 23.503 [45] or, if dynamic PCC is not deployed, based on local configuration, to set the Session-AMBR values for the PDU Session.
The Maximum Packet Loss Rate (UL, DL) indicates the maximum rate for lost packets of the QoS Flow that can be tolerated in the uplink and downlink direction. This is provided to the QoS Flow if it is compliant to the GFBR
NOTE:	In this Release of the specification, the Maximum Packet Loss Rate (UL, DL) can only be provided for a GBR QoS Flow belonging to voice media.
QoS parameters that are applicable only for or wireline access networks (W-5GAN) are specified in TS 23.316 [84].
This clause specifies the 5G QoS characteristics associated with 5QI. The characteristics describe the packet forwarding treatment that a QoS Flow receives edge-to-edge between the UE (Network Function) and the UPF (Network Function) in terms of the following performance characteristics:
1	Resource type (Non-GBR, GBR, Delay-critical GBR);
2	Priority Level;
3	Packet Delay Budget (including Core Network Packet Delay Budget);
4	Packet Error Rate;
5	Averaging window (for GBR and Delay-critical GBR resource type only);
6	Maximum Data Burst Volume (for Delay-critical GBR resource type only).
The 5G QoS characteristics should be understood as guidelines for setting node specific parameters for each QoS Flow e.g. for 3GPP radio access link layer protocol configurations.
Standardized or pre-configured 5G QoS characteristics, are indicated through the 5QI value, and are not signalled on any interface, unless certain 5G QoS characteristics are modified as specified in clauses 5.7.3.3, 5.7.3.4, 5.7.3.6, and 5.7.3.7.
NOTE:	As there are no default values specified, pre-configured 5G QoS characteristics have to include all of the characteristics listed above.
Signalled 5G QoS characteristics are provided as part of the QoS profile and shall include all of the characteristics listed above.
The resource type determines if dedicated network resources related to a QoS Flow-level Guaranteed Flow Bit Rate (GFBR) value are permanently allocated (e.g. by an admission control function in a radio base station).
GBR QoS Flows are therefore typically authorized "on demand" which requires dynamic policy and charging control. A GBR QoS Flow uses either the GBR resource type or the Delay-critical GBR resource type. The definition of PDB and PER are different for GBR and Delay-critical GBR resource types, and the MDBV parameter applies only to the Delay-critical GBR resource type.
A Non-GBR QoS Flow may be pre-authorized through static policy and charging control. A Non-GBR QoS Flow uses only the Non-GBR resource type.
The Priority Level associated with 5G QoS characteristics indicates a priority in scheduling resources among QoS Flows. The lowest Priority Level value corresponds to the highest priority.
The Priority Level shall be used to differentiate between QoS Flows of the same UE (Network Function), and it shall also be used to differentiate between QoS Flows from different UEs.
In the case of congestion, when all QoS requirements cannot be fulfilled for one or more QoS Flows, the Priority Level shall be used to select for which QoS Flows the QoS requirements are prioritised such that a QoS Flow with Priority Level value N (Service-based Interface) is priorized over QoS Flows with higher Priority Level values (i.e. N (Service-based Interface)+1, N (Service-based Interface)+2, etc).In the case of no congestion, the Priority Level should be used to define the resource distribution between QoS Flows. In addition, the scheduler may prioritize QoS Flows based on other parameters (e.g. resource type, radio condition) in order to optimize application performance and network capacity.
Every standardized 5QI is associated with a default value for the Priority Level -specified in QoS characteristics Table 5.7.4.1). Priority Level may also be signalled together with a standardized 5QI to the -R)AN, and if it is received, it shall be used instead of the default value.
Priority Level may also be signalled together with a pre-configured 5QI to the (R)AN, and if it is received, it shall be used instead of the pre-configured value.
The Packet Delay Budget (PDB) defines an upper bound for the time that a packet may be delayed between the UE (Network Function) and the N6 (Non-service-based Interface) (Service-based Interface) termination point at the UPF (Network Function). The PDB applies to the DL packet received by the UPF (Network Function) over the N6 (Non-service-based Interface) (Service-based Interface) interface, and to the UL packet sent by the UE (Network Function). For a certain 5QI the value of the PDB is the same in UL and DL. In the case of 3GPP access, the PDB is used to support the configuration of scheduling and link layer functions (e.g. the setting of scheduling priority weights and HARQ target operating points). For GBR QoS Flows using the Delay-critical resource type, a packet delayed more than PDB is counted as lost if the data burst is not exceeding the MDBV within the period of PDB and the QoS Flow is not exceeding the GFBR. For GBR QoS Flows with GBR resource type not exceeding GFBR, 98 percent of the packets shall not experience a delay exceeding the 5QI's PDB.
The 5G Access Network Packet Delay Budget (5G-AN PDB) is determined by subtracting a static value for the Core Network Packet Delay Budget (CN PDB), which represents the delay between any N6 (Non-service-based Interface) (Service-based Interface) termination point at the UPF (Network Function) (for any UPF (Network Function) that may possibly be selected for the PDU Session) and the 5G-AN from a given PDB.
NOTE 1:	For a standardized 5QI, the static value for the CN PDB is specified in the QoS characteristics Table 5.7.4-1.
NOTE 2:	For a non-standardized 5QI, the static value for the CN PDB is homogeneously configured in the network.
For GBR QoS Flows using the Delay-critical resource type, in order to obtain a more accurate delay budget PDB available for the NG-RAN (Network Function), a dynamic value for the CN PDB, which represents the delay between the UPF (Network Function) terminating N6 (Non-service-based Interface) (Service-based Interface) for the QoS Flow and the 5G-AN, can be used. If used for a QoS Flow, the NG-RAN (Network Function) shall apply the dynamic value for the CN PDB instead of the static value for the CN PDB (which is only related to the 5QI). Different dynamic value for CN PDB may be configured per uplink and downlink direction.
NOTE 3:	The configuration of transport network on CN tunnel can be different per UL and DL, which can be different value for CN PDB per UL and DL.
NOTE 4:	It is expected that the UPF (Network Function) deployment ensures that the dynamic value for the CN PDB is not larger than the static value for the CN PDB. This avoids that the functionality that is based on the 5G-AN PDB (e.g. MDBV, NG-RAN (Network Function) scheduler) has to handle an unexpected value.
The dynamic value for the CN PDB of a Delay-critical GBR 5QI may be configured in the network in two ways:
-	Configured in each NG-RAN (Network Function) node, based on a variety of inputs such as different IP  (Protocol)address(es) or TEID range of UPF (Network Function) terminating the N3 (Non-service-based Interface) (Service-based Interface) tunnel and based on different combinations of PSA (Network Function) UPF (Network Function) to NG-RAN (Network Function) under consideration of any potential I-UPF (Network Function), etc;
-	Configured in the SMF (Network Function), based on different combinations of PSA (Network Function) UPF (Network Function) to NG-RAN (Network Function) under consideration of any potential I-UPF (Network Function). The dynamic value for the CN PDB for a particular QoS Flow shall be signalled to NG-RAN (Network Function) (during PDU Session Establishment, PDU Session Modification, Xn/N2 (Non-service-based Interface) (Service-based Interface) handover and the Service Request procedures) when the QoS Flow is established or the dynamic value for the CN PDB of a QoS Flow changes, e.g. when an I-UPF (Network Function) is inserted by the SMF (Network Function).
If the NG-RAN (Network Function) node is configured locally with a dynamic value for the CN PDB for a Delay-critical GBR 5QI, and receives a different value via N2 (Non-service-based Interface) (Service-based Interface) signalling for a QoS Flow with the same 5QI, local configuration in RAN (Network Function) node determines which value takes precedence.
Services using a GBR QoS Flow and sending at a rate smaller than or equal to the GFBR can in general assume that congestion related packet drops will not occur.
NOTE 5:	Exceptions (e.g. transient link outages) can always occur in a radio access system which may then lead to congestion related packet drops. Packets surviving congestion related packet dropping may still be subject to non-congestion related packet losses (see PER below).
Services using Non-GBR QoS Flows should be prepared to experience congestion-related packet drops and delays. In uncongested scenarios, 98 percent of the packets should not experience a delay exceeding the 5QI's PDB.
The PDB for Non-GBR and GBR resource types denotes a "soft upper bound" in the sense that an "expired" packet, e.g. a link layer SDU that has exceeded the PDB, does not need to be discarded and is not added to the PER. However, for a Delay-critical GBR resource type, packets delayed more than the PDB are added to the PER and can be discarded or delivered depending on local decision.
The Packet Error Rate (PER) defines an upper bound for the rate of PDUs (e.g. IP  (Protocol)packets) that have been processed by the sender of a link layer protocol (e.g. RLC  (Protocol)in RAN (Network Function) of a 3GPP access) but that are not successfully delivered by the corresponding receiver to the upper layer (e.g. PDCP  (Protocol)in RAN (Network Function) of a 3GPP access). Thus, the PER defines an upper bound for a rate of non-congestion related packet losses. The purpose of the PER is to allow for appropriate link layer protocol configurations (e.g. RLC  (Protocol)and HARQ in RAN (Network Function) of a 3GPP access). For every 5QI the value of the PER is the same in UL and DL. For GBR QoS Flows with Delay-critical GBR resource type, a packet which is delayed more than PDB is counted as lost, and included in the PER unless the data burst is exceeding the MDBV within the period of PDB or the QoS Flow is exceeding the GFBR.
Each GBR QoS Flow shall be associated with an Averaging window. The Averaging window represents the duration over which the GFBR and MFBR shall be calculated (e.g. in the (R)AN, UPF (Network Function), UE (Network Function)).
Every standardized 5QI (of GBR and Delay-critical GBR resource type) is associated with a default value for the Averaging window (specified in QoS characteristics Table 5.7.4.1). The averaging window may also be signalled together with a standardized 5QI to the (R)AN and UPF (Network Function), and if it is received, it shall be used instead of the default value.
The Averaging window may also be signalled together with a pre-configured 5QI to the (R)AN, and if it is received, it shall be used instead of the pre-configured value.
Each GBR QoS Flow with Delay-critical resource type shall be associated with a Maximum Data Burst Volume (MDBV).
MDBV denotes the largest amount of data that the 5G-AN is required to serve within a period of 5G-AN PDB.
Every standardized 5QI (of Delay-critical GBR resource type) is associated with a default value for the MDBV (specified in QoS characteristics Table 5.7.4.1). The MDBV may also be signalled together with a standardized 5QI to the (R)AN, and if it is received, it shall be used instead of the default value.
The MDBV may also be signalled together with a pre-configured 5QI to the (R)AN, and if it is received, it shall be used instead of the pre-configured value.
Standardized 5QI values are specified for services that are assumed to be frequently used and thus benefit from optimized signalling by using standardized QoS characteristics. Dynamically assigned 5QI values (which require a signalling of QoS characteristics as part of the QoS profile) can be used for services for which standardized 5QI values are not defined. The one-to-one mapping of standardized 5QI values to 5G QoS characteristics is specified in table 5.7.4-1.
Table 5.7.4-1: Standardized 5QI to QoS characteristics mapping

NOTE:	It is preferred that a value less than 64 is allocated for any new standardised 5QI of Non-GBR resource type. This is to allow for option 1 to be used as described in clause 5.7.1.3 (as the QFI is limited to less than 64).
Reflective QoS enables the UE (Network Function) to map UL User Plane traffic to QoS Flows without SMF (Network Function) provided QoS rules and it applies for IP  (Protocol)PDU Session and Ethernet PDU Session. This is achieved by creating UE (Network Function) derived QoS rules in the UE (Network Function) based on the received DL traffic. It shall be possible to apply Reflective QoS and non-Reflective QoS concurrently within the same PDU Session.
For a UE (Network Function) supporting Reflective QoS functionality, the UE (Network Function) shall create a UE (Network Function) derived QoS rule for the uplink traffic based on the received DL traffic if Reflective QoS function is used by the 5GC for some traffic flows. The UE (Network Function) shall use the UE (Network Function) derived QoS rules to determine mapping of UL traffic to QoS Flows.
If the 3GPP UE (Network Function) supports Reflective QoS functionality, the UE (Network Function) should indicate support of Reflective QoS to the network (i.e. SMF (Network Function)) for every PDU Session. For PDU Sessions established in EPS and PDU Sessions transferred from EPS without N26 (Service-based Interface) interface, the UE (Network Function) indicates Reflective QoS support using the PDU Session Establishment procedure. After the first inter-system change from EPS to 5GS for PDU Sessions established in EPS and transferred from EPS with N26 (Service-based Interface) interface, the UE (Network Function) indicates Reflective QoS support using the PDU Session Modification procedure as described in clause 5.17.2.2.2. The UE (Network Function) as well as the network shall apply the information whether or not the UE (Network Function) indicated support of Reflective QoS throughout the lifetime of the PDU Session.
NOTE:	The logic driving a supporting UE (Network Function) under exceptional circumstances to not indicate support of Reflective QoS for a PDU Session is implementation dependent.
Under exceptional circumstances, which are UE (Network Function) implementation dependent, the UE (Network Function) may decide to revoke previously indicated support for Reflective QoS using the PDU Session Modification procedure. In such a case, the UE (Network Function) shall delete all derived QoS rules for this PDU Session and the network shall stop any user plane enforcement actions related to Reflective QoS for this PDU Session. In addition, the network may provide signalled QoS rules for the SDFs for which Reflective QoS was used before. The UE (Network Function) shall not indicate support for Reflective QoS for this PDU Session for the remaining lifetime of the PDU Session.
If under the same exceptional circumstances mentioned above and while NAS (Protocol) level MM or SM congestion control timer is running, the UE (Network Function) needs to revoke a previously indicated support for Reflective QoS, the UE (Network Function) performs PDU Session Release procedure that is exempt from MM and SM congestion control as defined in clause 5.19.7.
The UE (Network Function) derived QoS rule contains following parameters:
-	One UL Packet Filter (in the Packet Filter Set as defined in clause 5.7.6);
-	QFI;
-	Precedence value (see clause 5.7.1.9).
Upon receiving DL packet, one UL Packet Filter derived from the received DL packet as described in this clause is used to identify a UE (Network Function) derived QoS rule within a PDU Session.
For PDU Session of IP  (Protocol)type, the UL Packet Filter is derived based on the received DL packet as follows:
-	When Protocol ID / Next Header is set to TCP  (Protocol)or UDP, by using the source and destination IP  (Protocol)addresses, source and destination port numbers, and the Protocol ID / Next Header field itself.
-	When Protocol ID / Next Header is set to UDP, if the received DL packet is UDP-encapsulated IPSec protected packet, by using the source and destination IP  (Protocol)addresses, source and destination port numbers, the Security Parameter Index, and the Protocol ID / Next Header field itself. In this case, if an uplink IPSec SA corresponding to a downlink IPSec SA of the SPI in the DL packet exists and the SPI of the uplink IPSec SA is known to the NAS (Protocol) layer, then the UL Packet Filter contains an SPI of the uplink IPSec SA.
-	When Protocol ID / Next Header is set to ESP, by using the source and destination IP  (Protocol)addresses, the Security Parameter Index, and the Protocol ID / Next Header field itself. If the received DL packet is an IPSec protected packet, and an uplink IPSec SA corresponding to a downlink IPSec SA of the SPI in the DL packet exists and the SPI of the uplink IPSec SA is known to the NAS (Protocol) layer, then the UL Packet Filter contains an SPI of the uplink IPSec SA.
NOTE 1:	In this Release of the specification for PDU Sessions of IP  (Protocol)type the use of Reflective QoS is restricted to service data flows for which Protocol ID / Next Header is set to TCP, UDP  (Protocol)or ESP.
NOTE 2:	The UE (Network Function) does not verify whether the downlink packets with RQI indication match the restrictions on Reflective QoS.
NOTE 3:	How to determine the received DL packet is UDP-encapsulated IPSec protected packet is defined in RFC 3948 [138]. UDP  (Protocol)encapsulation for ESP is used when a NAT is detected, and there can be different Security Parameter Indexes within the same IP-tuples.
For PDU Session of Ethernet type the UL Packet Filter is derived based on the received DL packet by using the source and destination MAC  (Protocol)addresses, the Ethertype on received DL packet is used as Ethertype for UL packet. In the case of presence of IEEE Std 802.1Q [98], the VID and PCP in IEEE Std 802.1Q [98] header(s) of the received DL packet is also used as the VID and PCP field for the UL Packet Filter. When double IEEE Std 802.1Q [98] tagging is used, only the outer (S-TAG) is taken into account for the UL Packet Filter derivation.
NOTE 4:	In this Release of the specification for PDU Sessions of Ethernet type the use of Reflective QoS is restricted to service data flows for which 802.1Q [98] tagging is used.
The QFI of the UE (Network Function) derived QoS rule is set to the value received in the DL packet.
When Reflective QoS is activated the precedence value for all UE (Network Function) derived QoS rules is set to a standardised value.
Reflective QoS is controlled on per-packet basis by using the Reflective QoS Indication (RQI) in the encapsulation header on N3 (Non-service-based Interface) (Service-based Interface) (and N9 (Service-based Interface)) reference point together with the QFI and together with a Reflective QoS Timer (RQ Timer) value that is either signalled to the UE (Network Function) upon PDU Session Establishment (or upon PDU Session Modification as described in clause 5.17.2.2.2) or set to a default value. The RQ Timer value provided by the core network is at the granularity of PDU Session (the details are specified in TS 24.501 [47]).
When the 5GC determines that Reflective QoS has to be used for a specific SDF belonging to a QoS Flow, the SMF (Network Function) shall provide the RQA (Reflective QoS Attribute) within the QoS Flow's QoS profile to the NG-RAN (Network Function) on N2 (Non-service-based Interface) (Service-based Interface) reference point unless it has been done so before. When the RQA has been provided to the NG-RAN (Network Function) for a QoS Flow and the 5GC determines that the QoS Flow carries no more SDF for which Reflective QoS has to be used, the SMF (Network Function) should signal the removal of the RQA (Reflective QoS Attribute) from the QoS Flow's QoS profile to the NG-RAN (Network Function) on N2 (Non-service-based Interface) (Service-based Interface) reference point.
NOTE 1:	The SMF (Network Function) could have a timer to delay the sending of the removal of the RQA. This would avoid signalling to the RAN (Network Function) in the case of new SDFs subject to Reflective QoS are bound to this QoS Flow in the meantime.
When the 5GC determines to use Reflective QoS for a specific SDF, the SMF (Network Function) shall ensure that the UPF (Network Function) applies the RQI marking (e.g. by setting the indication to use Reflective QoS in the QER associated with the DL PDR if not already set) for this SDF. The SMF (Network Function) shall also ensure that the uplink packets for this SDF can be received by the UPF (Network Function) from the QoS Flow to which the DL PDR of the SDF is associated with as specified in TS 29.244 [65], e.g. by generating a new UL PDR for this SDF for that QoS Flow and providing it to the UPF (Network Function).
When the UPF (Network Function) is instructed by the SMF (Network Function) to apply RQI marking, the UPF (Network Function) shall set the RQI in the encapsulation header on the N3 (Non-service-based Interface) (Service-based Interface) (or N9 (Service-based Interface)) reference point for every DL packet corresponding to this SDF.
When an RQI is received by (R)AN in a DL packet on N3 (Non-service-based Interface) (Service-based Interface) reference point, the (R)AN shall indicate to the UE (Network Function) the QFI and the RQI of that DL packet.
Upon reception of a DL packet with RQI:
-	if a UE (Network Function) derived QoS rule with a Packet Filter corresponding to the DL packet does not already exist,
-	the UE (Network Function) shall create a new UE (Network Function) derived QoS rule with a Packet Filter corresponding to the DL packet (as described in clause 5.7.5.2); and
-	the UE (Network Function) shall start, for this UE (Network Function) derived QoS rule, a timer set to the RQ Timer value.
-	otherwise,
-	the UE (Network Function) shall restart the timer associated to this UE (Network Function) derived QoS rule; and
-	if the QFI associated with the downlink packet is different from the QFI associated with the UE (Network Function) derived QoS rule, the UE (Network Function) shall update this UE (Network Function) derived QoS rule with the new QFI.
NOTE 2:	Non-3GPP ANs does not need N2 (Non-service-based Interface) (Service-based Interface) signalling to enable Reflective QoS. Non 3GPP accesses are expected to send transparently the QFI and RQI to the UE (Network Function). If the UPF (Network Function) does not include the RQI, no UE (Network Function) derived QoS rule will be generated. If RQI is included to assist the UE (Network Function) to trigger an update of the UE (Network Function) derived QoS rule, the reception of PDU for a QFI restarts the RQ Timer.
Upon timer expiry associated with a UE (Network Function) derived QoS rule the UE (Network Function) deletes the corresponding UE (Network Function) derived QoS rule.
When the 5GC determines not to use Reflective QoS for a specific SDF any longer:
-	The SMF (Network Function) shall ensure that the UPF (Network Function) stops applying RQI marking as specified in TS 29.244 [65] (e.g. by removing the indication to use Reflective QoS from the QER associated with the DL PDR) for this SDF.
-	When the UPF (Network Function) receives this instruction to stop applying RQI marking, the UPF (Network Function) shall no longer set the RQI in the encapsulation header on the N3 (Non-service-based Interface) (Service-based Interface) (or N9 (Service-based Interface)) reference point DL packets corresponding to this SDF.
-	The SMF (Network Function) shall also ensure that, after an operator configurable time, the uplink packets for this SDF will not be accepted by the UPF (Network Function) over the QoS Flow on which Reflective QoS was applied for this SDF as specified in TS 29.244 [65], e.g. by removing the UL PDR for this SDF from that QoS Flow.
NOTE 3:	The operator configurable time has to be at least as long as the RQ Timer value to ensure that no UL packet would be dropped until the UE (Network Function) derived QoS rule is deleted by the UE (Network Function).
When the 5GC determines to change the binding of the SDF while Reflective QoS is used for this SDF, the SMF (Network Function) shall ensure that the uplink packets for this SDF are accepted over the newly bound QoS Flow and, for an operator configurable time, over the previously bound QoS Flow.
The Packet Filter Set is used in the QoS rule and the PDR to identify one or more packet (IP  (Protocol)or Ethernet) flow(s).
NOTE 1:	A QoS Flow is characterised by PDR(s) and QoS rule(s) as described in clause 5.7.1.1.
NOTE 2:	DL Packet Filter in a Packet Filter Set of a QoS rule may be needed by the UE (Network Function) e.g. for the purpose of IMS precondition.
The Packet Filter Set may contain one or more Packet Filter(s). Every Packet Filter is applicable for the DL direction, the UL direction or both directions.
NOTE 3:	The Packet Filter in the Packet Filter Set of the default QoS rule that allows all UL traffic (also known as match-all Packet Filter) is described in TS 24.501 [47].
There are two types of Packet Filter Set, i.e. IP  (Protocol)Packet Filter Set, and Ethernet Packet Filter Set, corresponding to those PDU Session Types.
For IP  (Protocol)PDU Session Type, the Packet Filter Set shall support Packet Filters based on at least any combination of:
-	Source/destination IP  (Protocol)address or IPv6 prefix.
-	Source / destination port number.
-	Protocol ID of the protocol above IP/Next header type.
-	Type of Service (TOS) (IPv4) / Traffic class (IPv6) and Mask.
-	Flow Label (IPv6).
-	Security parameter index.
-	Packet Filter direction.
NOTE 1:	A value left unspecified in a Packet Filter matches any value of the corresponding information in a packet.
NOTE 2:	An IP  (Protocol)address or Prefix may be combined with a prefix mask.
NOTE 3:	Port numbers may be specified as port ranges.
For Ethernet PDU Session Type, the Packet Filter Set shall support Packet Filters based on at least any combination of:
-	Source/destination MAC  (Protocol)address.
-	Ethertype as defined in IEEE 802.3 [131].
-	Customer-VLAN tag (C-TAG) and/or Service-VLAN tag (S-TAG) VID fields as defined in IEEE Std 802.1Q [98].
-	Customer-VLAN tag (C-TAG) and/or Service-VLAN tag (S-TAG) PCP/DEI fields as defined in IEEE Std 802.1Q [98].
-	IP  (Protocol)Packet Filter Set, in the case that Ethertype indicates IPv4/IPv6 payload.
-	Packet Filter direction.
NOTE 1:	The MAC  (Protocol)address may be specified as address ranges.
NOTE 2:	A value left unspecified in a Packet Filter matches any value of the corresponding information in a packet.
PDU Set QoS Parameters are used to support PDU Set based QoS handling in the NG-RAN (Network Function). At least one PDU Set QoS Parameter shall be sent to the NG-RAN (Network Function) to enable PDU Set based QoS handling.
The following PDU Set QoS Parameters are specified:
1.	PDU Set Delay Budget (PSDB).
2.	PDU Set Error Rate (PSER).
3.	PDU Set Integrated Handling Information (PSIHI).
The QoS Profile may include the PDU Set QoS Parameters described in this clause (see clause 5.7.1.2). The PCF (Network Function) determines the PDU Set QoS Parameters based on information provided by AF (Network Function) and/or local configuration. The PDU Set QoS parameters are sent to the SMF (Network Function) as part of PCC rule. The SMF (Network Function) sends them to NG-RAN (Network Function) as part of the QoS Profile.
If the NG-RAN (Network Function) receives PDU Set QoS Parameters and supports them, it enables the PDU Set based QoS handling and applies PDU Set QoS Parameters as described in this clause.
Editor's note:	[XRM] The applicability and details of supporting PDU Set handling in uplink direction may be updated based on RAN (Network Function) WG's progress.
The PDU Set Delay Budget (PSDB) defines an upper bound for the delay that a PDU Set may experience for the transfer between the UE (Network Function) and the N6 (Non-service-based Interface) (Service-based Interface) termination point at the UPF (Network Function), i.e. the duration between the reception time of the first PDU (at the N6 (Non-service-based Interface) (Service-based Interface) termination point for DL or the UE (Network Function) for UL) and the time when all PDUs of a PDU Set have been successfully received (at the UE (Network Function) for DL or N6 (Non-service-based Interface) (Service-based Interface) termination point for UL). PSDB applies to the DL PDU Set received by the PSA (Network Function) UPF (Network Function) over the N6 (Non-service-based Interface) (Service-based Interface) interface, and to the UL PDU Set sent by the UE (Network Function).
NOTE:	To enable support for PSDB, it is required that a maximum inter arrival time between the first received PDU and the last received PDU of a PDU Set complies with SLA. This maximum inter arrival time does not exceed PSDB. NG-RAN (Network Function) behaviour when the SLA is not fulfilled is out of scope of this specification.
A QoS Flow is associated with only one PDU Set Delay Budget. The value of the PDU Set Delay Budget is the same in UL and DL. PSDB is an optional parameter that may be provided by the PCF (Network Function). The provided PSDB can be used by the NG-RAN (Network Function) to support the configuration of scheduling and link layer functions.
When the PSDB is available, the PSDB supersedes the PDB for the given QoS Flow.
The AN PSDB is derived at NG-RAN (Network Function) by subtracting CN PDB (as described in clause 5.7.3.4) from the PSDB.
The PDU Set Error Rate (PSER) defines an upper bound for the rate of PDU Sets that have been processed by the sender of a link layer protocol (e.g. RLC  (Protocol)in RAN (Network Function) of a 3GPP access) but that are not successfully delivered by the corresponding receiver to the upper layer (e.g. PDCP  (Protocol)in RAN (Network Function) of a 3GPP access). Thus, the PSER defines an upper bound for a rate of non-congestion related PDU Set losses. The purpose of the PSER is to allow for appropriate link layer protocol configurations (e.g. RLC  (Protocol)and HARQ in RAN (Network Function) of a 3GPP access).
NOTE 1:	In this Release, a PDU Set is considered as successfully delivered only when all PDUs of a PDU Set are delivered successfully.
NOTE 2:	How RAN (Network Function) enforces PSER is up to RAN (Network Function) implementation.
A QoS Flow is associated with only one PDU Set Error Rate. PSER is an optional parameter. If the PSER is available, the PSER supersedes the PER. The value of the PDU Set Error Rate is the same in UL and DL.
The PDU Set Integrated Handling Information (PSIHI) indicates whether all PDUs of the PDU Set are needed for the usage of the PDU Set by the application layer in the receiver side. PSIHI is an optional parameter.
User Plane Function(s) handle the user plane path of PDU Sessions. 3GPP specifications support deployments with a single UPF (Network Function) or multiple UPFs for a given PDU Session. UPF (Network Function) selection is performed by SMF (Network Function). The details of UPF (Network Function) selection is described in clause 6.3.3. The number of UPFs supported for a PDU Session is unrestricted.
For an IPv4 type PDU Session or an IPv6 type PDU Session without multi-homing or an IPv4v6 type PDU Session, when multiple PDU Session Anchors are used (due to UL CL being inserted), only one IPv4 address and/or IPv6 prefix is allocated for the PDU Session. For an IPv6 multi-homed PDU Session there are multiple IPv6 prefixes allocated for the PDU Session as described in clause 5.6.4.3.
If the SMF (Network Function) had requested the UPF (Network Function) to proxy ARP or IPv6 Neighbour Solicitation for an Ethernet DNN, the UPF (Network Function) should respond to the ARP or IPv6 Neighbour Solicitation Request, itself.
Deployments with one single UPF (Network Function) used to serve a PDU Session do not apply to the Home Routed case and may not apply to the cases described in clause 5.6.4.
Deployments where a UPF (Network Function) is controlled either by a single SMF (Network Function) or multiple SMFs (for different PDU Sessions) are supported.
UPF (Network Function) traffic detection capabilities may be used by the SMF (Network Function) in order to control at least following features of the UPF (Network Function):
-	Traffic detection (e.g. classifying traffic of IP  (Protocol)type, Ethernet type, or unstructured type)
-	Traffic reporting (e.g. allowing SMF (Network Function) support for charging).
-	QoS enforcement (The corresponding requirements are defined in clause 5.7).
-	Traffic routing (e.g. as defined in clause 5.6.4. for UL CL or IPv6 multi-homing).
This clause contains detailed functional descriptions for some of the functions provided by the UPF (Network Function). It is described how the SMF (Network Function) instructs it's corresponding UP function and which control parameters are used.
The UE (Network Function) IP  (Protocol)address management includes allocation and release of the UE (Network Function) IP  (Protocol)address as well as renewal of the allocated IP  (Protocol)address, where applicable.
The UE (Network Function) shall perform the association of the application to a new PDU Session described in clause 6.1.2.2.1 of TS 23.503 [45], with the following considerations:
-	If there is a matching URSP rule, except the URSP rule with the "match all" Traffic descriptor, or a matching UE (Network Function) Local Configuration containing a PDU Session Type of "IPv4", "IPv6" or "IPv4v6", then the UE (Network Function) shall set the requested PDU Session Type to the PDU Session Type contained in the matching URSP rule or in the matching UE (Network Function) Local Configuration, if this PDU Session Type is supported by the UE (Network Function)'s IP  (Protocol)stack capabilities Detailed operation is described in TS 24.526 [110].
-	Otherwise, if a URSP Rule with the "match all" Traffic descriptor exists, the UE (Network Function) shall set the requested PDU Session Type to the PDU Session Type contained in the "match all" URSP Rule, if this PDU Session Type is supported by the UE (Network Function)'s IP  (Protocol)stack capabilities. Detailed operation is described in TS 24.526 [110].
-	Otherwise, the UE (Network Function) shall set the requested PDU Session Type during the PDU Session Establishment procedure based on its IP  (Protocol)stack capabilities as follows:
-	A UE (Network Function) which supports IPv6 and IPv4 shall set the requested PDU Session Type "IPv4v6".
-	A UE (Network Function) which supports only IPv4 shall request for PDU Session Type "IPv4".
-	A UE (Network Function) which supports only IPv6 shall request for PDU Session Type "IPv6".
-	When the IP  (Protocol)version capability of the UE (Network Function) is unknown in the UE (Network Function) (as in the case when the MT and TE are separated and the capability of the TE is not known in the MT), the UE (Network Function) shall request for PDU Session Type "IPv4v6".
The SMF (Network Function) selects PDU Session Type of the PDU Session as follows:
-	If the SMF (Network Function) receives a request with PDU Session Type set to "IPv4v6", the SMF (Network Function) selects either PDU Session Type "IPv4" or "IPv6" or "IPv4v6" based on DNN configuration, subscription data and operator policies.
-	If the SMF (Network Function) receives a request for PDU Session Type "IPv4" or "IPv6" and the requested IP  (Protocol)version is supported by the DNN the SMF (Network Function) selects the requested PDU Session type.
In its answer to the UE (Network Function), the SMF (Network Function) may indicate the PDU Session Types not allowed for the combination of (DNN, S-NNSAI). In this case, the UE (Network Function) shall not request another PDU Session to the same (DNN, S-NNSAI) for PDU Session Types indicated as not allowed by the network. In the case that the initial PDU Session was established with a PDU Session Type and the UE (Network Function) needs another single IP  (Protocol)version PDU Session Type, the UE (Network Function) may initiate another PDU Session Establishment procedure to this (DNN, S-NNSAI) in order to activate a second PDU session with that PDU Session Type.
An SMF (Network Function) shall ensure that the IP  (Protocol)address management procedure is based on the selected PDU Session Type. If IPv4 PDU Session Type is selected, an IPv4 address is allocated to the UE (Network Function). Similarly, if IPv6 PDU Session type is selected, an IPv6 prefix is allocated. If IPv4v6 PDU Session Type is selected, both an IPv4 address and an IPv6 prefix are allocated. For Roaming case, the SMF (Network Function) in this clause refers to the SMF (Network Function) controlling the UPF (Network Function)(s) acting as PDU Session Anchor. i.e. H-SMF (Network Function) in home routed case and V-SMF (Network Function) in local breakout case. For home routed case, V-SMF (Network Function) forwards the PDU Session Type requested by UE (Network Function) to H-SMF (Network Function) without interpreting it. V-SMF (Network Function) sends back to UE (Network Function) the PDU Session Type selected by H-SMF (Network Function). The SMF (Network Function) shall process the UE (Network Function) IP  (Protocol)address management related messages, maintain the corresponding state information and provide the response messages to the UE (Network Function).
The 5GC and UE (Network Function) support the following mechanisms:
a.	During PDU Session Establishment procedure, the SMF (Network Function) sends the IP  (Protocol)address to the UE (Network Function) via SM NAS (Protocol) signalling. The IPv4 address allocation and/or IPv4 parameter configuration via DHCPv4 (according to RFC 2131 [9]) can also be used once PDU Session is established.
b.	/64 IPv6 prefix allocation shall be supported via IPv6 Stateless Auto-configuration according to RFC 4862 [10], if IPv6 is supported. The details of Stateless IPv6 Address Autoconfiguration are described in clause 5.8.2.2.3. IPv6 parameter configuration via Stateless DHCPv6 (according to RFC 3736 [14]) may also be supported. IPv6 Prefix Delegation using DHCPv6 may be supported for allocating additional IPv6 prefixes for a PDU Session. The details of Prefix Delegation are described in clause 5.8.2.2.4.
For scenarios with RG connecting to 5GC, additional features for IPv6 address allocation and IPv6 prefix delegation are supported, as described in TS 23.316 [84].
To allocate the IP  (Protocol)address via DHCPv4, the UE (Network Function) may indicate to the network within the Protocol Configuration Options that the UE (Network Function) requests to obtain the IPv4 address with DHCPv4, or obtain the IP  (Protocol)address during the PDU Session Establishment procedure. This implies the following behaviour both for static and dynamic address allocation:
-	The UE (Network Function) may indicate that it requests to obtain an IPv4 address as part of the PDU Session Establishment procedure. In such a case, the UE (Network Function) relies on the 5GC network to provide IPv4 address to the UE (Network Function) as part of the PDU Session Establishment procedure.
-	The UE (Network Function) may indicate that it requests to obtain the IPv4 address after the PDU Session Establishment procedure by DHCPv4. That is, when the 5GC network supports DHCPv4 and allows that, it does not provide the IPv4 address for the UE (Network Function) as part of the PDU Session Establishment procedure. The network may respond to the UE (Network Function) by setting the allocated IPv4 Address to 0.0.0.0. After the PDU Session Establishment procedure is completed, the UE (Network Function) uses the connectivity with the 5GC and initiates the IPv4 address allocation on its own using DHCPv4. However, if the 5GC network provides IPv4 address to the UE (Network Function) as part of the PDU Session Establishment procedure, the UE (Network Function) should accept the IPv4 address indicated in the PDU Session Establishment procedure.
-	If the UE (Network Function) sends no IP  (Protocol)Address Allocation request, the SMF (Network Function) determines whether DHCPv4 is used between the UE (Network Function) and the SMF (Network Function) or not, based on per DNN configuration.
If dynamic policy provisioning is deployed, and the PCF (Network Function) was not informed of the IPv4 address at PDU Session Establishment procedure, the SMF (Network Function) shall inform the PCF (Network Function) about an allocated IPv4 address. If the IPv4 address is released, the SMF (Network Function) shall inform the PCF (Network Function) about the de-allocation of an IPv4 address.
In order to support DHCP based IP  (Protocol)address configuration, the SMF (Network Function) shall act as the DHCP server towards the UE (Network Function). The PDU Session Anchor UPF (Network Function) does not have any related DHCP functionality. The SMF (Network Function) instructs the PDU Session Anchor UPF (Network Function) serving the PDU Session to forward DHCP packets between the UE (Network Function) and the SMF (Network Function) over the user plane.
When DHCP is used for external data network assigned addressing and parameter configuration, the SMF (Network Function) shall act as the DHCP client towards the external DHCP server. The UPF (Network Function) does not have any related DHCP functionality. In the case of DHCP server on the external data network, the SMF (Network Function) instructs a UPF (Network Function) with N6 (Non-service-based Interface) (Service-based Interface) connectivity to forward DHCP packets between the UE (Network Function) and the SMF (Network Function) and the external DHCP server over the user plane.
The 5GC may also support the allocation of a static IPv4 address and/or a static IPv6 prefix based on subscription information in the UDM (Network Function) or based on the configuration on a per-subscriber, per-DNN basis and per-S-NSSAI.
If the static IP  (Protocol)address/prefix is stored in the UDM (Network Function), during PDU Session Establishment procedure, the SMF (Network Function) retrieves this static IP  (Protocol)address/prefix from the UDM (Network Function). If the static IP  (Protocol)address/prefix is not stored in the UDM (Network Function) subscription record, it may be configured on a per-subscriber, per-DNN and per-S-NSSAI basis in the DHCP/DN (Network Function)-AAA server and the SMF (Network Function) retrieves the IP  (Protocol)address/prefix for the UE (Network Function) from the DHCP/DN (Network Function)-AAA server. This IP  (Protocol)address/prefix is delivered to the UE (Network Function) in the same way as a dynamic IP  (Protocol)address/prefix. It is transparent to the UE (Network Function) whether the PLMN or the external data network allocates the IP  (Protocol)address and whether the IP  (Protocol)address is static or dynamic.
For IPv4 or IPv6 or IPv4v6 PDU Session Type, during PDU Session Establishment procedure, the SMF (Network Function) may receive a Subscriber's IP  (Protocol)Index from the UDM (Network Function). If the UE (Network Function) IP  (Protocol)address/prefix was not already allocated and provided to PCF (Network Function) when SMF (Network Function) initiates the SM policy association, the SMF (Network Function) may receive a Subscribers IP  (Protocol)Index from the PCF (Network Function). If the SMF (Network Function) received a Subscriber's IP  (Protocol)index from both UDM (Network Function) and PCF (Network Function), the SMF (Network Function) shall apply the Subscriber's IP  (Protocol)Index received from the PCF (Network Function). The SMF (Network Function) may use the Subscriber's IP  (Protocol)Index to assist in selecting how the IP  (Protocol)address is to be allocated when multiple allocation methods, or multiple instances of the same method are supported. In the case of Home Routed roaming, the H-SMF (Network Function) may receive the IP  (Protocol)index from the H-PCF (Network Function).
NOTE:	The IP  (Protocol)Index can e.g. be used to select between different IP  (Protocol)pools, including between IP  (Protocol)pools with overlapping private address range. To support deployments with overlapping private IPv4 address, the IP  (Protocol)domain corresponding to IP  (Protocol)index can also be provided from UDM (Network Function) to SMF (Network Function) as part of the subscription data and then provided to PCF (Network Function).
When Static IP  (Protocol)addresses for a PDU session are not used, the actual allocation of the IP  (Protocol)Address(es) for a PDU Session may use any of the following mechanisms:
-	The SMF (Network Function) allocates the IP  (Protocol)address from a pool that corresponds to the PDU Session Anchor (UPF (Network Function)) that has been selected
-	The UE (Network Function) IP  (Protocol)address is obtained from the UPF (Network Function). In that case the SMF (Network Function) shall interact with the UPF (Network Function) via N4 (Service-based Interface) procedures to obtain a suitable IP  (Protocol)address. The SMF (Network Function) provides the UPF (Network Function) with the necessary information allowing the UPF (Network Function) to derive the proper IP  (Protocol)address (e.g. the network instance).
-	In the case that the UE (Network Function) IP  (Protocol)address is obtained from the external data network, additionally, the SMF (Network Function) shall also send the allocation, renewal and release related request messages to the external data network, i.e. DHCP/DN (Network Function)-AAA server, and maintain the corresponding state information. The IP  (Protocol)address allocation request sent to DHCP/DN (Network Function)-AAA server may include the IP  (Protocol)address pool ID to identify which range of IP  (Protocol)address is to be allocated. In this case the SMF (Network Function) is provisioned with separate IP  (Protocol)address pool ID(s), and the mapping between IP  (Protocol)address pool ID and UPF (Network Function) Id, DNN, S-NSSAI, IP  (Protocol)version. The provision is done by OAM or during the N4 (Service-based Interface) Association Setup procedure.
A given IP  (Protocol)address pool is controlled by a unique entity (either the SMF (Network Function) or the UPF (Network Function) or an external server). The IP  (Protocol)address managed by the UPF (Network Function) can be partitioned into multiple IP  (Protocol)address pool partition(s), i.e. associated with multiple IP  (Protocol)address pool ID(s).
When the SMF (Network Function) is configured to obtain UE (Network Function) IP  (Protocol)addresses from the UPF (Network Function), the SMF (Network Function) may select a UPF (Network Function) based upon support of this feature. The SMF (Network Function) determines whether the UPF (Network Function) supports this feature via NRF (Network Function) or via N4 (Service-based Interface) capability negotiation during N4 (Service-based Interface) Association Setup. If no appropriate UPF (Network Function) support the feature, the SMF (Network Function) may allocate UE (Network Function) IP  (Protocol)addresses, if configured to do so.
The IP  (Protocol)address/prefix is released by the SMF (Network Function) (e.g. upon release of the PDU Session), likewise the UPF (Network Function) considers that any IP  (Protocol)address it has allocated within a N4 (Service-based Interface) session are released when this N4 (Service-based Interface) session is released.
UPF (Network Function) may use NAT between the UE (Network Function) and the Data Network, and thus the 5GC allocated (private) UE (Network Function) IP  (Protocol)address may not be visible on the N6 (Non-service-based Interface) (Service-based Interface) reference point.
When the UE (Network Function) has an IPv6 multi-homed PDU Session the UE (Network Function) selects the source IPv6 prefix according to IPv6 multi-homed routing rules pre-configured in the UE (Network Function) or received from network. IPv6 multi-homed routing rules received from the network have a higher priority than IPv6 multi-homed routing rules pre-configured in the UE (Network Function)
The SMF (Network Function) can generate the IPv6 multi-homed routing rules for a UE (Network Function) based on local configuration or dynamic PCC rules received from the PCF (Network Function) as defined in TS 23.503 [45]. If dynamic PCC is deployed, the SMF (Network Function) generates the IPv6 multi-home routing rules for a source IPv6 prefix based on the SDF Templates of those PCC rules which contain the DNAI corresponding to the newly assigned IPv6 prefix. The SMF (Network Function) can send IPv6 multi-homed routing rules to the UE (Network Function) to influence the source IPv6 prefix selection in IPv6 Router Advertisement (RA) messages according to RFC 4191 [8] at any time during the lifetime of the IPv6 multi-homed PDU Session. Such messages are sent via the UPF (Network Function).
NOTE:	For multiple IPv4 PDU Session and multiple IPv6 PDU Session cases, routing rule based PDU Session selection is not specified in this Release of the specification.
If Stateless IPv6 Address Autoconfiguration is used for IPv6 address allocation to the UE (Network Function), after PDU Session Establishment the UE (Network Function) may send a Router Solicitation message to the SMF (Network Function) to solicit a Router Advertisement message. The SMF (Network Function) sends a Router Advertisement message (solicited or unsolicited) to the UE (Network Function). The Router Advertisement messages shall contain the IPv6 prefix.
After the UE (Network Function) has received the Router Advertisement message, it constructs a full IPv6 address via IPv6 Stateless Address Autoconfiguration in accordance with RFC 4862 [10]. To ensure that the link-local address generated by the UE (Network Function) does not collide with the link-local address of the UPF (Network Function) and the SMF (Network Function), the SMF (Network Function) shall provide an interface identifier (see RFC 4862 [10]) to the UE (Network Function) and the UE (Network Function) shall use this interface identifier to configure its link-local address. For Stateless Address Autoconfiguration however, the UE (Network Function) can choose any interface identifier to generate IPv6 addresses, other than link-local, without involving the network. However, the UE (Network Function) shall not use any identifiers defined in TS 23.003 [19] as the basis for generating the interface identifier. For privacy, the UE (Network Function) may change the interface identifier used to generate full IPv6 address, as defined in TS 23.221 [23] without involving the network. Any prefix that the SMF (Network Function) advertises to the UE (Network Function) is globally unique. The SMF (Network Function) shall also record the relationship between the UE (Network Function)'s identity (SUPI) and the allocated IPv6 prefix. Because any prefix that the SMF (Network Function) advertises to the UE (Network Function) is globally unique, there is no need for the UE (Network Function) to perform Duplicate Address Detection for any IPv6 address configured from the allocated IPv6 prefix. Even if the UE (Network Function) does not need to use Neighbor Solicitation messages for Duplicate Address Detection, the UE (Network Function) may, for example, use them to perform Neighbor Unreachability Detection towards the SMF (Network Function), as defined in RFC 4861 [54]. Therefore, the SMF (Network Function) shall respond with a Neighbor Advertisement upon receiving a Neighbor Solicitation message from the UE (Network Function).
In IPv6 multi-homing PDU session, SMF (Network Function) shall not allocate an interface identifier when a new IPv6 prefix allocated corresponding to the new PDU Session Anchor.
The above IPv6 related messages (e.g. Router Solicitation, Router Advertisement, Neighbor Solicitation, Neighbor Advertisement) are transferred between the SMF (Network Function) and UE (Network Function) via the UPF (Network Function)(s). If the Control Plane CIoT 5GS Optimisation is enabled for a PDU session, the above IPv6 related messages are transferred between the SMF (Network Function) and UE (Network Function) via the AMF (Network Function) after PDU Session Establishment, see clauses 4.3.2.2.1 and 4.3.2.2.2 of TS 23.502 [3], using the Mobile Terminated Data Transport in Control Plane CIoT 5GS Optimisation procedures.
Optionally, a single network prefix shorter than the default /64 prefix may be assigned to a PDU Session. In this case, the /64 default prefix used for IPv6 stateless autoconfiguration will be allocated from this network prefix; the remaining address space from the network prefix can be delegated to the PDU Session using prefix delegation after the PDU Session establishment and IPv6 prefix allocation via IPv6 stateless address autoconfiguration as defined in clause 5.8.2.2.3.
Depending on configuration, the SMF (Network Function) may obtain the prefix from a locally provisioned pool, from the PSA (Network Function) UPF (Network Function) or from the external DN (Network Function).
The address space provided is maintained as an IPv6 address space pool available to the PDU Session for DHCPv6 IPv6 prefix requests with the exclusion of the IPv6 prefix that is allocated to the PDU Session during PDU Session establishment as defined in clause 5.8.2.2.3. The total IPv6 address space available for the PDU Session (UE (Network Function) PDU Session prefix and UE (Network Function) PDU Session IPv6 address space pool) shall be possible to aggregate into one IPv6 prefix that will represent all IPv6 addresses that the UE (Network Function) may use.
If the UE (Network Function) had indicated that it supports prefix exclusion and the prefix to be delegated to the UE (Network Function) includes the /64 prefix that was allocated to the PDU Session, the SMF (Network Function) shall utilise the prefix exclusion feature as specified for DHCPv6 Prefix Delegation in IETF RFC 6603 [162].
NOTE:	Support of the IPv6 prefix delegation in the SMF (Network Function) is assumed to be ensured by the operator e.g. by configuring specific DNN/S-NSSAI for PDU Sessions that are used by UEs that utilize IPv6 prefix delegation.
The UE (Network Function) uses DHCPv6 to request additional IPv6 prefixes (i.e. prefixes in addition to the default prefix) from the SMF (Network Function) after completing stateless IPv6 address autoconfiguration procedures. The UE (Network Function) acts as a "Requesting Router" as described in IETF RFC 8415 [163] and inserts one or more IA_PD option(s) into a DHCPv6 Solicit message sent from the UE (Network Function) to the SMF (Network Function) via the user plane and the UPF (Network Function). The SMF (Network Function) acts as the DHCP server and fulfils the role of a "Delegating Router" according to IETF RFC 8415 [163]. The UE (Network Function) optionally includes the RAPID_COMMIT option in the DHCPv6 Solicit message to trigger two-message DHCPv6 procedure instead of the four-message DHCPv6 procedure. The UE (Network Function) shall include OPTION_PD_EXCLUDE option code in an OPTION_ORO option to indicate support for prefix exclusion. In response to the DHCPv6 Solicit message, the UE (Network Function) receives a DHCPv6 Reply message with one or more IA_PD prefix(es) for every IA_PD option that it sent in the DHCPv6 Solicit message. The SMF (Network Function) delegates a prefix excluding the default prefix with help of OPTION_PD_EXCLUDE. Prefix exclusion procedures shall follow IETF RFC 6603 [162].
For scenarios with RG connecting to 5GC, additional feature for IPv6 Prefix Delegation via DHCPv6 is defined in TS 23.316 [84].
CN Tunnel Info is the Core Network address of a N3 (Non-service-based Interface) (Service-based Interface)/N9 (Service-based Interface) tunnel corresponding to the PDU Session. It comprises the TEID and the IP  (Protocol)address which is used by the UPF (Network Function) on the N3 (Non-service-based Interface) (Service-based Interface)/N9 (Service-based Interface) tunnel for the PDU Session.
The CN Tunnel Info allocation and release is performed by the UPF (Network Function). The SMF (Network Function) shall indicate to the UPF (Network Function) when the UPF (Network Function) is required to allocate/release CN Tunnel Info.

The UPF (Network Function) shall manage the CN Tunnel Info space. When a new CN Tunnel Info is needed, the SMF (Network Function) shall request over N4 (Service-based Interface) the UPF (Network Function) to allocate CN Tunnel Info for the applicable N3 (Non-service-based Interface) (Service-based Interface)/N9 (Service-based Interface) reference point. In response, the UPF (Network Function) provides CN Tunnel Info to the SMF (Network Function). In the case of PDU Session Release or a UPF (Network Function) is removed from the user plane path of an existing PDU Session, the SMF (Network Function) shall request UPF (Network Function) to release CN Tunnel Info for the PDU Session. If the corresponding N4 (Service-based Interface) Session is released the UPF (Network Function) releases the associated CN Tunnel Info.
This clause describes the detection process at the UPF (Network Function) that identifies the packets belonging to a session, or a service data flow.
The SMF (Network Function) is responsible for instructing the UP function about how to detect user data traffic belonging to a Packet Detection Rule (PDR). The other parameters provided within a PDR describe how the UP function shall treat a packet that matches the detection information.
The SMF (Network Function) controls the traffic detection at the UP function by providing detection information for every PDR.
For IPv4 or IPv6 or IPv4v6 PDU Session type, detection information is a combination of:
-	CN tunnel info.
-	Network instance.
-	QFI.
-	IP  (Protocol)Packet Filter Set as defined in clause 5.7.6.2.
-	Application Identifier: The Application (Protocol) Identifier is an index to a set of application detection rules configured in UPF (Network Function).
-	FQDN Filter for DNS Query message.
For Ethernet PDU Session type, detection information is a combination of:
-	CN tunnel info.
-	Network instance.
-	QFI.
-	Ethernet Packet Filter Set as defined in clause 5.7.6.3.
In this Release of the specification for Unstructured PDU Session Type, the UPF (Network Function) does not perform-QoS Flow level traffic detection for QoS enforcement.
Traffic detection information sent by the SMF (Network Function) to the UPF (Network Function) for a PDU Session may be associated with Network instance for detection and routing of traffic over N6 (Non-service-based Interface) (Service-based Interface). In the case of IP  (Protocol)PDU Session Type, Network Instances can, e.g. be used by the UPF (Network Function) for traffic detection and routing in the case of different IP  (Protocol)domains or overlapping IP  (Protocol)addresses. In the case of Ethernet PDU Session Type, different Network Instances can e.g. be configured in the UPF (Network Function) with different ways to handle the association between N6 (Non-service-based Interface) (Service-based Interface) and the PDU Sessions.
Based on SMF (Network Function) instructions, UPF (Network Function) may identify the PDU Sets, according to the Protocol Description in PDR, to derive the PDU Set Information for DL traffics and send it to RAN (Network Function) via DL GTP-U (Protocol) header of each PDU identified as belonging to a PDU Set. The PDU Set Information, is described in clause 5.37.5. The PDU Set identification can be done by UPF (Network Function) implementation or by detecting RTP/SRTP header or payload. The details of the RTP/SRTP headers, header extensions and/or payloads used to identify PDU Sets are defined in TS 26.522 [179].
The SMF (Network Function) controls user-plane packet forwarding for traffic detected by a PDR by providing a FAR with instructions to the UPF (Network Function), including:
-	Forwarding operation information;
-	Forwarding target information.
The details of the forwarding target and operation will depend on the scenario and is described below. The following forwarding functionality is required by the UPF (Network Function):
-	Apply N3 (Non-service-based Interface) (Service-based Interface) /N9 (Service-based Interface) tunnel related handling, i.e. encapsulation.
-	Forward the traffic to/from the SMF (Network Function), e.g. as described in Table 5.8.2.5.2-1.
-	Forward the SM PDU DN (Network Function) Request Container from SMF (Network Function) to DN (Network Function)-AAA server
-	Forward the traffic according to locally configured policy for traffic steering.
-	Forward the traffic according to N4 (Service-based Interface) rules of a 5G VN group for 5G VN group communication.
-	Forward the traffic to/from the EASDF (Network Function).
Data forwarding between the SMF (Network Function) and UPF (Network Function) is transmitted on the user plane tunnel established on N4 (Service-based Interface) interface, defined in TS 29.244 [65].
Scenarios for data forwarding between the SMF (Network Function) and UPF (Network Function) are defined as below:
Table 5.8.2.5.2-1: Scenarios for data forwarding between the SMF (Network Function) and UPF (Network Function)

When configuring an UPF (Network Function) acting as PSA (Network Function) for an Ethernet PDU Session Type, the SMF (Network Function) may instruct the UPF (Network Function) to route the traffic based on detected MAC  (Protocol)addresses as follows.
-	The UPF (Network Function) learns the MAC  (Protocol)address(es) connected via N6 (Non-service-based Interface) (Service-based Interface) based on the source MAC  (Protocol)addresses of the DL traffic received on a N6 (Non-service-based Interface) (Service-based Interface) Network Instance.
-	The UPF (Network Function) learns the MAC  (Protocol)address(es) of UE (Network Function)(s) and devices connected behind, if any, based on the source MAC  (Protocol)address contained within the UL traffic received on a PDU Session (N3 (Non-service-based Interface) (Service-based Interface)/N9 (Service-based Interface) interface).
-	The UPF (Network Function) forwards DL unicast traffic (with a known destination address) on a PDU Session determined based on the source MAC  (Protocol)address(es) used by the UE (Network Function) for the UL traffic.
-	The UPF (Network Function) forwards UL unicast traffic (with a known destination address) on a port (PDU Session or N6 (Non-service-based Interface) (Service-based Interface) interface) determined based on the source MAC  (Protocol)address(es) learned beforehand.
-	In the case of multicast and broadcast traffic (if the destination MAC  (Protocol)address is a broadcast or multicast address):
-	for DL traffic received by UPF (Network Function) on a N6 (Non-service-based Interface) (Service-based Interface) Network Instance the UPF (Network Function) should forward the traffic to every DL PDU Session (corresponding to any N4 (Service-based Interface) Session) associated with this Network Instance
-	for uplink traffic received by UPF (Network Function) over a PDU session on a N3 (Non-service-based Interface) (Service-based Interface)/N9 (Service-based Interface) interface, the UPF (Network Function) should forward the traffic to the N6 (Non-service-based Interface) (Service-based Interface) interface and downlink to every PDU session (except toward the one of the incoming traffic) associated with the same N6 (Non-service-based Interface) (Service-based Interface) Network Instance
-	for uplink and downlink unicast traffic received by UPF (Network Function), if the destination MAC  (Protocol)has not been learnt, the UPF (Network Function) should forward the traffic to every PDU session associated with the same N6 (Non-service-based Interface) (Service-based Interface) Network Instance and towards the N6 (Non-service-based Interface) (Service-based Interface) interface. In any case the traffic is not replicated on the PDU Session or the N6 (Non-service-based Interface) (Service-based Interface) interface of the incoming traffic.
NOTE 1:	The UPF (Network Function) can consider a PDU Session or a N6 (Non-service-based Interface) (Service-based Interface) interface to be active or inactive in order to avoid forwarding loops. User data traffic is not sent on inactive PDU sessions or inactive N6 (Non-service-based Interface) (Service-based Interface) interface. This release of the specification does not further specify how the UPF (Network Function) determines whether a PDU Session or N6 (Non-service-based Interface) (Service-based Interface) interface is considered active or inactive.
NOTE 2:	This release of the specification supports only a single N6 (Non-service-based Interface) (Service-based Interface) interface in a UPF (Network Function) associated with the N6 (Non-service-based Interface) (Service-based Interface) Network Instance.
-	if the traffic is received with a VLAN ID, the above criteria apply only towards the N6 (Non-service-based Interface) (Service-based Interface) interface or PDU session matching the same VLAN ID, unless the UPF (Network Function) is instructed to remove the VLAN ID in the incoming traffic.
NOTE 3:	This release of the specification supports Independent VLAN Learning (IVL) and does not support Shared VLAN Learning (SVL), as described in IEEE Std 802.1Q [98].
-	if the destination MAC  (Protocol)address of traffic refers to the same N6 (Non-service-based Interface) (Service-based Interface) interface or PDU session on which the traffic has been received, the frame shall be dropped.
In order to handle scenarios where a device behind a UE (Network Function) is moved from a source UE (Network Function) to a target UE (Network Function), a MAC  (Protocol)address is considered as no longer associated with a UPF (Network Function) interface (source UE (Network Function)'s PDU session) when the MAC  (Protocol)address has not been detected as Source MAC  (Protocol)address in UL traffic for a pre-defined period of time or the MAC  (Protocol)address has been detected under a different interface (target UE (Network Function)'s PDU Session or N6 (Non-service-based Interface) (Service-based Interface)).
NOTE 4:	The UPF (Network Function)/NW-TT may also be provided with static filtering entries as described in clause 5.28.3. How the UPF (Network Function) uses the static filtering entry to achieve forwarding of Ethernet frames to one or more egress ports is up to UPF (Network Function) implementation. The externally observable behaviour of 5GS Bridge needs to comply with IEEE Std 802.1Q [98].
For ARP/IPv6 Neighbour Solicitation traffic, a SMF (Network Function)'s request to respond to ARP/IPv6 Neighbour Solicitation based on local cache information or to redirect such traffic from the UPF (Network Function) to the SMF (Network Function) overrules the traffic forwarding rules described above.
NOTE 5:	Local policies in UPF (Network Function) associated with the Network Instance can prevent local traffic switching in the UPF (Network Function) between PDU Sessions either for unicast traffic only or for any traffic. In the case where UPF (Network Function) policies prevent local traffic switching for any traffic (thus for broadcast/multicast traffic) some mechanism such as responding to ARP/ND based on local cache information or local multicast group handling is needed to ensure that upper layer protocol can run on the Ethernet PDU sessions.
The SMF (Network Function) may ask to get notified with the source MAC  (Protocol)addresses used by the UE (Network Function), e.g. if the PCF (Network Function) has subscribed to UE (Network Function) MAC  (Protocol)address change notifications, as described in TS 23.503 [45].
In order to request the UPF (Network Function) to act as defined above, the SMF (Network Function) may, for each PDU Session corresponding to a Network Instance, set an Ethernet PDU Session Information in a DL PDR that identifies all (DL) Ethernet packets matching the PDU session. Alternatively, for unicast traffic the SMF (Network Function) may provide UPF (Network Function) with dedicated forwarding rules related with MAC  (Protocol)addresses notified by the UPF (Network Function).
The SMF (Network Function) shall support interfaces towards CHF (Network Function) and PCF (Network Function). The SMF (Network Function) interacts with CHF (Network Function) and PCF (Network Function) based on information received from other control plane NFs and user plane related information received from the UPF (Network Function).
QoS Flow level, PDU Session level and subscriber related information remain at the SMF (Network Function), and only usage information is requested from the UPF (Network Function).
Triggered by the PCC rules received from the PCF (Network Function) or preconfigured information available at SMF (Network Function), as well as from the CHF (Network Function) for online charging method via quota management mechanisms, the SMF (Network Function) shall provide Usage Reporting Rules to the UPF (Network Function) for controlling how usage reporting is performed.
The SMF (Network Function) shall request the report of the relevant usage information for Usage Monitoring, based on Monitoring Keys and triggers which are specified in TS 23.503 [45]. Each Usage Reporting Rule requested for usage monitoring control is associated with the PDR(s) whose traffic is to be accounted under this rule. The SMF (Network Function) shall generate the Usage Reporting Rule for each Monitoring-key within the active PCC Rule(s), either preconfigured or received from the PCF (Network Function) and also shall keep the mapping between them. Multiple Usage Reporting Rules may be associated with the same PDR.
The SMF (Network Function) shall request the report of the relevant usage information for offline and online charging, based on Charging keys and additional triggers which are specified in TS 32.255 [68]. Each Usage Reporting Rule requested for offline or online charging is associated with the PDR(s) whose traffic is to be accounted under this rule. The SMF (Network Function) shall generate the Usage Reporting Rule for each Charging key and Sponsor Identity (if applicable) within the active PCC Rule(s), either preconfigured or received from the PCF (Network Function), and also shall keep the mapping between them. Multiple Usage Reporting Rules may be associated with the same PDR.
The SMF (Network Function) function shall also provide reporting trigger events to the UPF (Network Function) for when to report usage information. The reporting trigger events (e.g. triggers, threshold information etc.) shall be supported for the PDU Session level reporting as well as on Rule level basis as determined by the SMF (Network Function). The triggers may be provided as a volume, time or event to cater for the different charging/usage monitoring models supported by the TS 23.503 [45] for usage monitoring and by TS 32.255 [68] for converged offline and online charging. The SMF (Network Function) shall decide on the thresholds value(s) based on allowance received from PCF (Network Function), CHF (Network Function) or based on local configuration. Other parameters for instructing the UPF (Network Function) to report usage information are defined in TS 29.244 [65].
When the PCC Rule attribute Service Data flow handling while requesting credit (specified in TS 23.503 [45]) indicates "non-blocking", the SMF (Network Function) shall request the report of the relevant usage information for the Charging key and Sponsor Identity (if applicable) and provide a default threshold value to the UPF (Network Function) while waiting for the quota from the CHF (Network Function).
In some cases, the same Usage Reporting Rule can be used for different purposes (for both usage monitoring and charging), e.g. in the case that the same set of PDR(s), measurement method, trigger event, threshold, etc. apply. Similarly a reported measurement can be used for different purposes by the SMF (Network Function).
The UPF (Network Function) shall support reporting of usage information to the SMF (Network Function). The UPF (Network Function) shall be capable to support reporting based on different triggers, including:
-	Periodic reporting with period defined by the SMF (Network Function).
-	Usage thresholds provided by the SMF (Network Function).
-	Report on demand received from the SMF (Network Function).
The SMF (Network Function) shall make sure that the multiple granularity levels required by the reporting keys in the Usage Reporting rules satisfy the following aggregation levels without requiring a knowledge of the granularity levels by the UPF (Network Function):
-	PDU Session level reporting;
-	Traffic flow (for both charging and usage monitoring) level reporting as defined by the reporting keys in the Usage Reporting Rule (see the description above).
Based on the mapping between Monitoring key and PCC rule stored at the SMF (Network Function), the SMF (Network Function) shall combine the reported information with session and subscriber related information which is available at the SMF (Network Function), for Usage Monitoring reporting over the corresponding Npcf interface (N7 (Service-based Interface) reference point).
Based on the mapping between Charging key and Sponsor Identity (if applicable) and PCC rule stored at the SMF (Network Function), the SMF (Network Function) shall combine the reported information with session and subscriber related information which is available at the SMF (Network Function), for offline and online charging reporting over the corresponding charging interfaces.
This functionality is specified in TS 32.255 [68].
The usage information shall be collected in the UPF (Network Function) and reported to the SMF (Network Function) as defined in 5.8.2.6, based on Monitoring Keys and triggers which are specified in TS 23.503 [45].
ARP is used for admission control (i.e. retention and pre-emption of the new QoS Flow). The value of ARP is not required to be provided to the UPF (Network Function).
For every QoS Flow, the SMF (Network Function) shall determine the transport level packet marking value (e.g. the DSCP in the outer IP  (Protocol)header) based on the 5QI, the Priority Level (if explicitly signalled) and optionally, the ARP priority level and provide the transport level packet marking value to the UPF (Network Function).
The SMF (Network Function) shall provide the Session-AMBR values of the PDU Session to the UPF (Network Function) so that the UPF (Network Function) can enforce the Session-AMBR of the PDU Session across all Non-GBR QoS Flows of the PDU Session.
SMF (Network Function) shall provide the GFBR and MFBR value for each GBR QoS Flow of the PDU Session to the UPF (Network Function). SMF (Network Function) may also provide the Averaging window to the UPF (Network Function), if Averaging window is not configured at the UPF (Network Function) or if it is different from the default value configured at the UPF (Network Function).
SMF (Network Function) may decide to activate ECN marking for L4S by PSA (Network Function) UPF (Network Function) for the QoS Flow (see clause 5.37). In this case, the SMF (Network Function) shall send an ECN marking for L4S indicator to UPF (Network Function).
A predefined PCC rule is configured in the SMF (Network Function).
The traffic detection filters, e.g. IP  (Protocol)Packet Filter, required in the UP function can be configured either in the SMF (Network Function) and provided to the UPF (Network Function), as service data flow filter(s), or be configured in the UPF (Network Function), as the application detection filter identified by an application identifier. For the latter case, the application identifier has to be configured in the SMF (Network Function) and the UPF (Network Function).
The traffic steering policy information can be only configured in the UPF (Network Function), together with traffic steering policy identifier(s), while the SMF (Network Function) has to be configured with the traffic steering policy identifier(s).
Policies for traffic handling in the UPF (Network Function), which are referred by some identifiers corresponding to the parameters of a PCC rule, can be configured in the UPF (Network Function). These traffic handling policies are configured as predefined QER(s), FAR(s) and URR(s).
When a predefined PCC rule is activated/deactivated by the PCF (Network Function), SMF (Network Function) shall decide what information has to be provided to the UPF (Network Function) to enforce the rule based on where the traffic detection filters (i.e. service data flow filter(s) or application detection filter), traffic steering policy information and the policies used for the traffic handling in the UPF (Network Function) are configured and where they are enforced:
-	If the predefined PCC rule contains an application identifier for which corresponding application detection filters are configured in the UPF (Network Function), the SMF (Network Function) shall provide a corresponding application identifier to the UPF (Network Function);
-	If the predefined PCC rule contains traffic steering policy identifier(s), the SMF (Network Function) shall provide a corresponding traffic steering policy identifier(s) to the UPF (Network Function);
-	If the predefined PCC rule contains service data flow filter(s), the SMF (Network Function) shall provide them to the UPF (Network Function);
-	If the predefined PCC rule contains some parameters for which corresponding policies for traffic handling in the UPF (Network Function) are configured in the UPF (Network Function), the SMF (Network Function) shall activate those traffic handling policies via their rule ID(s).
The SMF (Network Function) shall maintain the mapping between a PCC rule received over Npcf and the flow level PDR rule(s) used on N4 (Service-based Interface) interface.
The application detection filters required in the UPF (Network Function) can be configured either in the SMF (Network Function) and provided to the UPF (Network Function) as the service data flow filter, or be configured in the UP function identified by an application identifier.
When receiving a dynamic PCC rule from the PCF (Network Function) which contains an application identifier and/or parameters for traffic handling in the UPF (Network Function):
-	if the application detection filter is configured in the SMF (Network Function), the SMF (Network Function) shall provide it in the service data flow filter to the UPF (Network Function), as well as parameters for traffic handling in the UPF (Network Function) received from the dynamic PCC rule;
-	otherwise, the application detection filters is configured in UPF (Network Function), the SMF (Network Function) shall provide to UPF (Network Function) with the application identifier and the parameters for traffic handling in the UPF (Network Function) as required based on the dynamic PCC rule.
The SMF (Network Function) shall maintain the mapping between a PCC rule received over Npcf and the flow level PDR(s) used on N4 (Service-based Interface) interface.
The uplink application's traffic redirection may be enforced either in the SMF (Network Function) (as specified in 5.8.2.5 Control of user plane forwarding) or directly in the UPF (Network Function). The redirect destination may be provided in the dynamic PCC rule or be preconfigured, either in the SMF (Network Function) or in the UPF (Network Function).
When receiving redirect information (redirection enabled/disabled and redirect destination) within a dynamic PCC rule or being activated/deactivated by the PCF (Network Function) for the predefined redirection policies, SMF (Network Function) shall decide whether to provide and what information to be provided to the UPF (Network Function) based on where the redirection is enforced and where the redirect destination is acquired/preconfigured. When redirection is enforced in the UPF (Network Function) and the redirect destination is acquired from the dynamic PCC rule or is configured in the SMF (Network Function), SMF (Network Function) shall provide the redirect destination to the UPF (Network Function). When redirection is enforced in the SMF (Network Function), SMF (Network Function) shall instruct the UPF (Network Function) to forward applicable user plane traffic to the SMF (Network Function).
The NEF (Network Function) (PFDF (Network Function)) shall provide PFD(s) to the SMF (Network Function) on the request of SMF (Network Function) (pull mode) or on the request of PFD management from NEF (Network Function) (push mode), as described in TS 23.503 [45]. The NEF (Network Function) may subscribe to NWDAF (Network Function) to get PDF determination analytics for known applications, and may create, update, or delete PFD(s) based on the analytics as specified in TS 23.288 [86]. The SMF (Network Function) shall provide the PFD(s) to the UPF (Network Function), which have active PDR(s) with the application identifier corresponding to the PFD(s).
The SMF (Network Function) supports the procedures in clause 4.4.3.5 of TS 23.502 [3], for management of PFDs. PFD(s) is cached in the SMF (Network Function), and the SMF (Network Function) maintains a caching timer associated to the PFD(s). When the caching timer expires and there's no active PCC rule that refers to the corresponding application identifier, the SMF (Network Function) informs the UPF (Network Function) to remove the PFD(s) identified by the application identifier using the PFD management message.
When a PDR is provided for an application identifier corresponding to the PFD(s) that are not already provided to the UPF (Network Function), the SMF (Network Function) shall provide the PFD(s) to the UPF (Network Function) (if there are no PFD(s) cached, the SMF (Network Function) retrieves them from the NEF (Network Function) (PFDF (Network Function)) as specified in TS 23.503 [45]). When any update of the PFD(s) is received from NEF (Network Function) (PFDF (Network Function)) by SMF (Network Function) (using "push" or "pull" mode), and there are still active PDRs in UPF (Network Function) for the application identifier, the SMF (Network Function) shall provision the updated PFD set corresponding to the application identifier to the UPF (Network Function) using the PFD management message.
NOTE 1:	SMF (Network Function) can assure not to overload N4 (Service-based Interface) signalling while managing PFD(s) to the UPF (Network Function), e.g. forwarding the PFD(s) to the right UPF (Network Function) where the PFD(s) is enforced.
When the UPF (Network Function) receives the updated PFD(s) from either the same or different SMF (Network Function) for the same application identifier, the latest received PFD(s) shall overwrite any existing PFD(s) stored in the UPF (Network Function).
NOTE 2:	For the case a single UPF (Network Function) is controlled by multiple SMFs, the conflict of PFD(s) corresponding to the same application identifier provided by different SMF (Network Function) can be avoided by operator enforcing a well-planned NEF (Network Function) (PFDF (Network Function)) and SMF (Network Function)/UPF (Network Function) deployment.
When a PFD is removed/modified and this PFD was used to detect application traffic related to an application identifier in a PDR of an N4 (Service-based Interface) session and the UPF (Network Function) has reported the application start to the SMF (Network Function) as defined in clause 4.4.2.2 of TS 23.502 [3] for the application instance corresponding to this PFD, the UPF (Network Function) shall report the application stop to the SMF (Network Function) for the corresponding application instance identifier if the removed/modified PFD in UPF (Network Function) results in that the stop of the application instance is not being able to be detected.
If the PFDs are managed by local O&M procedures, PFD retrieval is not used; otherwise, the PFDs retrieved from NEF (Network Function) (PFDF (Network Function)) override any PFDs pre-configured in the SMF (Network Function). When all the PFDs retrieved from the NEF (Network Function) (PFDF (Network Function)) for an application identifier are removed, the pre-configured PFDs are used. The SMF (Network Function) shall provide either the PFDs retrieved from NEF (Network Function) (PFDF (Network Function)) or the pre-configured PFDs for an application identifier to the UPF (Network Function).
Sending of "end marker" is a functionality which involve SMF (Network Function) and UPF (Network Function) in order to assist the reordering function in the Target RAN (Network Function). As part of the functionality, constructing of end marker packets can either be done in the SMF (Network Function) or in the UPF (Network Function), as described in clauses 5.8.2.9.1 and 5.8.2.9.2. Whether constructing of end marker packets is performed by SMF (Network Function) or UPF (Network Function) is determined by network configuration.
In the case of inter NG-RAN (Network Function) Handover procedure without UPF (Network Function) change, SMF (Network Function) shall indicate the UPF (Network Function) to switch the N3 (Non-service-based Interface) (Service-based Interface) path(s) by sending an N4 (Service-based Interface) Session Modification Request message with the new AN Tunnel Info of NG RAN (Network Function) and in addition, provide an indication to the UPF (Network Function) to send the end marker packet(s) on the old N3 (Non-service-based Interface) (Service-based Interface) user plane path.
On receiving this indication, the UPF (Network Function) shall construct end marker packet(s) and send it for each N3 (Non-service-based Interface) (Service-based Interface) GTP-U (Protocol) tunnel towards the source NG RAN (Network Function) after sending the last PDU on the old path.
In the case of inter NG-RAN (Network Function) Handover procedure with change of the UPF (Network Function) terminating N3 (Non-service-based Interface) (Service-based Interface), the SMF (Network Function) shall request the UPF (Network Function) with N9 (Service-based Interface) reference point to the UPF (Network Function) terminating N3 (Non-service-based Interface) (Service-based Interface) to switch the N9 (Service-based Interface) user plane path(s) by sending an N4 (Service-based Interface) Session Modification Request message (N4 (Service-based Interface) session ID, new CN Tunnel Info of the UPF (Network Function) terminating N3 (Non-service-based Interface) (Service-based Interface)) and in addition, provide an indication to this UPF (Network Function) to send the end marker packet(s) on the old path.
On receiving this indication, the UPF (Network Function) shall construct end marker packet(s) and send it for each N9 (Service-based Interface) GTP-U (Protocol) tunnel towards the source UPF (Network Function) after sending the last PDU on the old path.
On receiving the end marker packet(s) on N9 (Service-based Interface) GTP-U (Protocol) tunnel, source UPF (Network Function) shall forward the end marker packet(s) and send it for each N3 (Non-service-based Interface) (Service-based Interface) GTP-U (Protocol) tunnel towards the source NG RAN (Network Function).
UPF (Network Function) referred in this clause is the UPF (Network Function) terminates N3 (Non-service-based Interface) (Service-based Interface) reference point.
It is assumed that the PDU Session for the UE (Network Function) comprises of an UPF (Network Function) that acts as a PDU Session Anchor and an intermediate UPF (Network Function) terminating N3 (Non-service-based Interface) (Service-based Interface) reference point at the time of this Handover procedure.
In the case of inter NG-RAN (Network Function) Handover procedure without UPF (Network Function) change, SMF (Network Function) shall indicate the UPF (Network Function) to switch the N3 (Non-service-based Interface) (Service-based Interface) path(s) by sending an N4 (Service-based Interface) Session Modification Request message (N4 (Service-based Interface) session ID, new AN Tunnel Info of NG RAN (Network Function)). After sending the last PDU on the old path, UPF (Network Function) shall replace the old AN Tunnel Info with the new one and responds with an N4 (Service-based Interface) Session Modification Response message to acknowledge the success of path switch.
When the path switch is finished, SMF (Network Function) constructs the end marker packet(s) and sends it to the UPF (Network Function). UPF (Network Function) then forwards the packet(s) to the source NG RAN (Network Function).
In the case of inter NG-RAN (Network Function) Handover procedure with UPF (Network Function) change, SMF (Network Function) shall indicate the PSA (Network Function) UPF (Network Function) to switch the N9 (Service-based Interface) user plane path(s) by sending an N4 (Service-based Interface) Session Modification Request message (N4 (Service-based Interface) session ID, new CN Tunnel Info of UPF (Network Function)). After sending the last PDU on the old N9 (Service-based Interface) path, PSA (Network Function) UPF (Network Function) shall replace the old CN Tunnel Info with the new one and responds with an N4 (Service-based Interface) Session Modification Response message to acknowledge the success of path switch.
When the path switch is finished, SMF (Network Function) constructs the end marker packet(s) and sends it to PSA (Network Function) UPF (Network Function). PSA (Network Function) UPF (Network Function) then forwards the packet(s) to the source UPF (Network Function).
5GC shall support per PDU Session tunnelling on N3 (Non-service-based Interface) (Service-based Interface) between (R)AN and UPF (Network Function) and N9 (Service-based Interface) between UPFs. If there exist more than one UPF (Network Function) involved for the PDU Session, any tunnel(s) between UPFs (e.g. in the case of two UPFs, between the UPF (Network Function) that is an N3 (Non-service-based Interface) (Service-based Interface) terminating point and the UPF (Network Function) for PDU Session Anchor) remains established when a UE (Network Function) enters CM-IDLE state. In the case of downlink data buffering by UPF (Network Function), when mobile terminated (MT) traffic arrives at the PDU Session Anchor UPF (Network Function), it is forwarded to the UPF (Network Function) which buffer the data packet via N9 (Service-based Interface) tunnel. See clause 5.8.3 for more details on UPF (Network Function) buffering. In the case of Home Routed roaming, the SMF (Network Function) in HPLMN is not aware of the UP activation state of a PDU Session.
When the UP connection of the PDU Session is deactivated, the SMF (Network Function) may release the UPF (Network Function) of N3 (Non-service-based Interface) (Service-based Interface) terminating point. In that case the UPF (Network Function) (e.g. the Branching Point/UL CL or PDU Session Anchor) connecting to the released UPF (Network Function) of N3 (Non-service-based Interface) (Service-based Interface) terminating point will buffer the DL packets. Otherwise, when the UPF (Network Function) with the N3 (Non-service-based Interface) (Service-based Interface) connection is not released, this UPF (Network Function) will buffer the DL packets.
When the UP connection of the PDU Session is activated due to a down-link data arrived and a new UPF (Network Function) is allocated to terminate the N3 (Non-service-based Interface) (Service-based Interface) connection, a data forwarding tunnel between the UPF (Network Function) that has buffered packets and the newly allocated UPF (Network Function) is established, so that the buffered data packets are transferred from the old UPF (Network Function) that has buffered packets to the newly allocated UPF (Network Function) via the data forwarding tunnel.
For a PDU Session whose the UP connection is deactivated and the SMF (Network Function) has subscribed the location change notification, when the SMF (Network Function) is notified of UE (Network Function)'s new location from the AMF (Network Function) and detects that the UE (Network Function) has moved out of the service area of the existing intermediate UPF (Network Function), the SMF (Network Function) may decide to maintain the intermediate UPF (Network Function), remove the established tunnel between UPFs (in the case of removal of the intermediate UPF (Network Function)) or reallocate the tunnel between UPFs (in the case of reallocation of the intermediate UPF (Network Function)).
The parameters used by SMF (Network Function) to control the functionality of the UPF (Network Function) as well as to inform SMF (Network Function) about events occurring at the UPF (Network Function) are described in clause 5.8.5.
For Ethernet PDU Session type, the SMF (Network Function) may control the UPF (Network Function) to report the different MAC  (Protocol)(Ethernet) addresses used as source address of frames sent UL by the UE (Network Function) in a PDU Session. These MAC  (Protocol)addresses are called UE (Network Function) MAC  (Protocol)addresses.
This control and the corresponding reporting takes place over N4 (Service-based Interface).
NOTE:	This is e.g. used to support reporting of all UE (Network Function) MAC  (Protocol)addresses in a PDU Session to the PCF (Network Function) as described in clause 5.6.10.2.
The UPF (Network Function) reports the removal of a UE (Network Function) MAC  (Protocol)address based on the detection of absence of traffic during an inactivity time. The inactivity time value is provided by the SMF (Network Function) to the UPF (Network Function).
The SMF (Network Function) may configure the UPF (Network Function)(s) to apply different traffic forwarding methods to route traffic between PDU Sessions for a single 5G VN group. For example, depending on the destination address, some packet flows may be forwarded locally, while other packet flows are forwarded via N19 (Service-based Interface) and other packet flows are forwarded to N6 (Non-service-based Interface) (Service-based Interface).
If a single SMF (Network Function) serves the DNN/S-NSSAI of the 5G VN group, the UPF (Network Function) local switching, N6 (Non-service-based Interface) (Service-based Interface)-based forwarding and N19 (Service-based Interface)-based forwarding methods described in clause 5.29.4 are coordinated by the SMF (Network Function). If an SMF (Network Function) set serves the DNN/S-NSSAI of the 5G VN group, implementation based mechanisms can be used between SMF (Network Function)(s) that are part of the SMF (Network Function) set for controlling the connectivity between the PSA (Network Function) UPFs of the UE (Network Function) members of the 5G VN group.
When a 5G VN group communication is extended in a wide area, bigger than the service area of any SMF (Network Function) set serving the DNN/S-NSSAI of the 5G VN group, multiple SMF (Network Function) sets might control the PDU Sessions of the UE (Network Function) members of the 5G VN group. In this case, N6 (Non-service-based Interface) (Service-based Interface)/N19 (Service-based Interface) connectivity between PSA (Network Function) UPFs of the UE (Network Function) members of the 5G VN group controlled by different SMF (Network Function) sets, is achieved via OAM configuration. As a deployment option, a subset of the UPFs controlled by an SMF (Network Function) Set may be configured with the N6 (Non-service-based Interface) (Service-based Interface)/N19 (Service-based Interface) connectivity to enable 5G VN group communication across SMF (Network Function) Sets. N6 (Non-service-based Interface) (Service-based Interface) connectivity between PSA (Network Function) UPFs via a DN (Network Function) may also exist.
5G VN group communication includes one to one communication and one to many communication. One to one communication supports forwarding of unicast traffic between two UEs within a 5G VN, or between a UE (Network Function) and a device on the DN (Network Function). One to many communication supports forwarding of multicast traffic and broadcast traffic from one UE (Network Function) (or device on the DN (Network Function)) to many/all UEs within a 5G VN and devices on the DN (Network Function).
Traffic forwarding within the 5G VN group is realized by using a UPF (Network Function) internal interface ("5G VN internal") and a two-step detection and forwarding process. In the first step, the packets received from any 5G VN group member (via it's PDU Session, via N6 (Non-service-based Interface) (Service-based Interface) or via N19 (Service-based Interface)) are forwarded to the UPF (Network Function) internal interface (i.e. Destination Interface set to "5G VN internal"). In the second step, PDRs installed at the UPF (Network Function) internal interface (i.e. Source Interface set to "5G VN internal") detect the packet and forward it to the respective 5G VN group member (via it's PDU Session, via N6 (Non-service-based Interface) (Service-based Interface) or via N19 (Service-based Interface)). The details of the PDR and FAR configuration are described in the following clauses.
For UEs belonging to the same 5G VN group and having PDU Sessions that correspond to N4 (Service-based Interface) Sessions in the same PSA (Network Function) UPF (Network Function), the following applies for traffic that is sent from one of these UEs to another one of these UEs using local switching: The incoming traffic for one PDU Session will match the corresponding N4 (Service-based Interface) Session's PDR(s) of the source PDU Session (based on GTP-U (Protocol) header information). The traffic is then sent back to classification in that UPF (Network Function) (via the internal interface) and will match another N4 (Service-based Interface) Session corresponding to the destination PDU Session (based on destination address in the PDU). The PDU is then forwarded to the target UE (Network Function).
If 5G VN group members' PDU Sessions are served by different PSA (Network Function) UPFs and N19 (Service-based Interface)-based forwarding is applied, the SMF (Network Function) creates a group-level N4 (Service-based Interface) Session with each involved UPF (Network Function) to enable N19 (Service-based Interface)-based forwarding and N6 (Non-service-based Interface) (Service-based Interface)-based forwarding. When the traffic is then sent back to classification in that UPF (Network Function) (via the internal interface) it may match group-level N4 (Service-based Interface) Session corresponding to the 5G VN group (based on destination address in the PDU or a default PDR rule with match-all packet filter). The PDU is then forwarded to N6 (Non-service-based Interface) (Service-based Interface) or to the UPF (Network Function) indicated in the group-level N4 (Service-based Interface) Session via corresponding N19 (Service-based Interface) tunnel. This enables the PDU to be sent to the target group member in the other UPF (Network Function) or to the device in the DN (Network Function).
In the case of N19 (Service-based Interface)-based forwarding is not applied for a 5G VN group, group level N4 (Service-based Interface) session is not required.
If more than one 5G VN group has to be supported in the PLMN, the N4 (Service-based Interface) rule attribute Network Instance is used in addition to the UPF (Network Function) internal interface and set to a value representing the 5G VN group. This keeps the traffic of different 5G VN groups separate from each other and thus enables isolation of the 5G VN group communication during the packet detection and forwarding process. The SMF (Network Function) shall provide the PDRs and FARs related to the UPF (Network Function) internal interface as follows whenever more than one 5G VN group has to be supported in the PLMN:
-	The FAR with Destination Interface set to "5G VN internal" shall also contain the Network Instance set to the value representing the 5G VN group.
-	The PDR with Source Interface set to "5G VN internal" shall also contain the Network Instance set to the value representing the 5G VN group.
Forwarding Ethernet unicast traffic towards the PDU Session corresponding to the Destination MAC  (Protocol)address of an Ethernet frame may correspond:
-	either to the SMF (Network Function) explicitly configuring DL PDR(s) with the MAC  (Protocol)addresses detected by the UPF (Network Function) on PDU Sessions and reported to the SMF (Network Function); this is further described in clause 5.8.2.13.1;
-	or to the SMF (Network Function) relying on MAC  (Protocol)address learning in UPF (Network Function) as defined in clause 5.8.2.5.3. To request this UPF (Network Function) behaviour the SMF (Network Function) sets the Ethernet PDU Session Information indication in the DL PDR of the "5G VN internal" interface related with a 5G VN group. This may apply in the case that all PDU Sessions related with this 5G VN group are served by the same PSA (Network Function) or by multiple PSAs not inter-connected via N19 (Service-based Interface).
For Ethernet traffic on 5G-VN, in the former case above where SMF (Network Function) explicitly configures DL PDR with the MAC  (Protocol)addresses detected on PDU Sessions supporting a 5G VN group, the SMF (Network Function) acts as a central controller which is responsible for setting up the forwarding rules in the UPFs so that it avoids forwarding loops. The SMF (Network Function) becomes aware of the MAC  (Protocol)addresses in use within a 5G VN group by the UPF (Network Function)'s reporting of the MAC  (Protocol)addresses. The SMF (Network Function) is responsible to react to topology changes in the Ethernet network. Local switching without SMF (Network Function) involvement is not specified for a 5G-VN when different PDU Sessions related with this 5G VN group may be served by different PSA (Network Function)(s) connected over N19 (Service-based Interface).
NOTE:	The mechanisms described above implies signalling on N4 (Service-based Interface) Sessions related with a VN group each time a new MAC  (Protocol)address is detected as used (or no more used) within a PDU Session related with this 5G VN group. Hence the usage of the solution with SMF (Network Function) explicitly configuring DL PDR with the MAC  (Protocol)addresses defined in this release can raise signalling scalability issues for large VN groups with lots of devices (MAC addresses) served by PDU sessions related with this VN group.
To enable unicast traffic forwarding in a UPF (Network Function), the following applies:
-	The SMF (Network Function) provides for each 5G VN group member's N4 (Service-based Interface) Session (i.e. N4 (Service-based Interface) Session corresponding to PDU Session) the following N4 (Service-based Interface) rules that enable the processing of packets received from this UE (Network Function).
-	in order to detect the traffic, a PDR containing Source Interface set to "access side", and CN Tunnel Information set to PDU Session tunnel header (i.e. N3 (Non-service-based Interface) (Service-based Interface) or N9 (Service-based Interface) GTP-U (Protocol) F-TEID); and
-	in order to forward the traffic, a FAR containing Destination Interface set to "5G VN internal".
-	The SMF (Network Function) provides for each 5G VN group member's N4 (Service-based Interface) Session (i.e. N4 (Service-based Interface) session corresponding to PDU Session) the following N4 (Service-based Interface) rules that enable the processing of packets towards this UE (Network Function).
-	in order to detect the traffic, a PDR containing Source Interface set to "5G VN internal", and Destination Address set to the IP/MAC address (es) of this 5G VN group member; and
-	in order to forward the traffic, a FAR containing Outer Header Creation indicating the N3 (Non-service-based Interface) (Service-based Interface)/N9 (Service-based Interface) tunnel information, and Destination Interface set "access side".
-	If N19 (Service-based Interface)-based forwarding is applied, the SMF (Network Function) configures the group-level N4 (Service-based Interface) Session for processing packets received from a N19 (Service-based Interface) tunnel with the following N4 (Service-based Interface) rules for each N19 (Service-based Interface) tunnel.
-	in order to detect the traffic, a PDR containing Source Interface set to "core side", and CN Tunnel Information set to N19 (Service-based Interface) tunnel header (i.e. N19 (Service-based Interface) GTP-U (Protocol) F-TEID); and
-	in order to forward the traffic, a FAR containing Destination Interface set to "5G VN internal".
-	If N19 (Service-based Interface)-based forwarding is applied, the SMF (Network Function) configures the group-level N4 (Service-based Interface) Session for processing packets towards 5G VN group members anchored at other UPFs with the following N4 (Service-based Interface) rules for each N19 (Service-based Interface) tunnel.
-	in order to detect the traffic, a PDR containing Source Interface set to "5G VN internal", and Destination Address set to the IP/MAC address (es) of UEs anchored at the peer UPF (Network Function) of this N19 (Service-based Interface) tunnel (e.g. based on the IP  (Protocol)address range supported by the peer UPF (Network Function)); and
-	in order to forward the traffic to a 5G VN group member anchored at another UPF (Network Function) via the N19 (Service-based Interface) tunnel, a FAR containing Outer Header Creation indicating the N19 (Service-based Interface) tunnel information, Destination Interface set to "core side".
-	The SMF (Network Function) configures the group-level N4 (Service-based Interface) Session for processing packets received from a 5G VN group member connected via N6 (Non-service-based Interface) (Service-based Interface) with the following N4 (Service-based Interface) rules.
-	in order to detect the traffic, a PDR containing Source Interface set to "core side", and Source Address set to the IP/MAC address (es) of this 5G VN group member; and
-	in order to forward the traffic, a FAR containing Destination Interface set to "5G VN internal".
-	The SMF (Network Function) configures the group-level N4 (Service-based Interface) Session for processing packets towards a 5G VN group member connected via N6 (Non-service-based Interface) (Service-based Interface) or packets towards a device residing in DN (Network Function) with the following N4 (Service-based Interface) rules.
-	in order to detect the traffic, a PDR containing Source Interface set to "5G VN internal", and Destination Address set to the IP/MAC address (es) of this 5G VN group member; and
-	in order to forward the traffic to the 5G VN group member or device via N6 (Non-service-based Interface) (Service-based Interface), a FAR containing Destination Interface set to "core side".
-	The SMF (Network Function) shall update N4 (Service-based Interface) rules for group-level N4 (Service-based Interface) Session to enable correct forwarding of packets towards UE (Network Function) who's PSA (Network Function) UPF (Network Function) has been reallocated and address is unchanged.
-	The SMF (Network Function) may also configure the following N4 (Service-based Interface) rules for the group-level N4 (Service-based Interface) Session to process packets with an unknown destination address:
-	in order to detect the traffic, a PDR containing Source Interface set to "5G VN internal", a match-all Packet Filter, and a Precedence set to the lowest precedence value; and
-	in order to process the traffic, a FAR containing Destination Interface set to "core side" to route the traffic via N6 (Non-service-based Interface) (Service-based Interface) by default, or in the case of local SMF (Network Function) configuration that N6 (Non-service-based Interface) (Service-based Interface)-based forwarding is not applied a FAR instructing the UPF (Network Function) to drop the traffic.
To enable the service continuity when the PSA (Network Function) UPF (Network Function) serving the UE (Network Function) changed, the following applies:
-	Keep the UE (Network Function) address unchanged if N6 (Non-service-based Interface) (Service-based Interface)-based forwarding is not used.
-	Configure the UE (Network Function)'s N4 (Service-based Interface) Session with N4 (Service-based Interface) rules (PDR, FAR) to detect and forward the traffic to this UE (Network Function) via its PDU Session tunnel(i.e. N3 (Non-service-based Interface) (Service-based Interface) tunnel) on the target PSA (Network Function) UPF (Network Function).
-	If N19 (Service-based Interface)-based forwarding is applied: To switch the traffic towards this UE (Network Function) from the source PSA (Network Function) UPF (Network Function) to the target PSA (Network Function) UPF (Network Function) for N19 (Service-based Interface)-based forwarding, the SMF (Network Function) deletes the N4 (Service-based Interface) rule (PDR) that detects the traffic towards this UE (Network Function) in the group-level N4 (Service-based Interface) Session at UPFs involved in the 5G VN group (except the source PSA (Network Function) UPF (Network Function)), then adds or updates the PDR that detects the traffic towards this UE (Network Function) with the FAR containing the N19 (Service-based Interface) tunnel information of the target PSA (Network Function) UPF (Network Function) in the group-level N4 (Service-based Interface) Session at UPFs involved in the 5G VN group (except the target PSA (Network Function) UPF (Network Function)).
For Ethernet PDU Sessions, the SMF (Network Function) may instruct the UPF (Network Function) to route traffic to be replicated as described in clause 5.8.2.5.
For IP  (Protocol)PDU Session types, the SMF (Network Function) may instruct the UPF (Network Function) to manage IP  (Protocol)multicast traffic as described in clauses 4.6.6 and 7.7.1 of TS 23.316 [84]. The UPF (Network Function) replicates the IP  (Protocol)multicast traffic received from PDU Sessions or N6 (Non-service-based Interface) (Service-based Interface) interface and sends the packets over other PDU Sessions and other N6 (Non-service-based Interface) (Service-based Interface) interface subscribed to the IP  (Protocol)Multicast groups.
Mechanisms described in clauses 4.6.6 and 7.7.1 of TS 23.316 [84] apply to support 5G VN group communication with following clarifications:
-	These mechanisms are not limited to Wireline access and can apply on any access,
-	IP  (Protocol)Multicast traffic allowed for a PDU Session is not meant for IPTV services reachable over N6 (Non-service-based Interface) (Service-based Interface),
-	IGMP /MLD signalling does not relate with STB or 5G-RG: Clauses 4.6.6 and 7.7.1 of TS 23.316 [84], apply to UE (Network Function) members of a 5G VN group instead of 5G-RG, and
-	Clauses 7.7.1.1.2 and 7.7.1.1.4 of TS 23.316 [84] are not applicable to 5G VN groups: members of the 5G VN groups may receive any multicast traffic associated with the (DNN, S-NSSAI) of the 5G VN group.
-	UPF (Network Function) exchange of signalling such as PIM (Protocol-Independent Multicast) may apply as defined in TS 23.316, with following clarification:
-	PIM signalling is generally exchanged over N6 (Non-service-based Interface) (Service-based Interface) but may be sent towards the PDU Session supporting the source address of multicast traffic identified by IGMP / MLD signalling for Source Specific Multicast. In the case of IGMP / MLD signalling not related with Source Specific Multicast no PIM signalling is sent towards any PDU Session
Alternatively, for IP  (Protocol)or Ethernet type data communication, the SMF (Network Function) instructs the UPF (Network Function) via PDRs and FARs how to replicate user plane traffic.
The mechanism is supported in the following conditions:
-	When N19 (Service-based Interface) is used, there is a full mesh of N19 (Service-based Interface) tunnels between UPFs controlled by each SMF (Network Function) Set serving the 5G VN group;
-	There is no support for forwarding a broadcast/multicast packet with source address not known to SMF (Network Function)/UPF (Network Function).
-	Each UPF (Network Function) supports one N6 (Non-service-based Interface) (Service-based Interface) interface instance towards the data network, or only supports N19 (Service-based Interface)-based forwarding without N6 (Non-service-based Interface) (Service-based Interface);
-	Multicast group formation of selected members of a 5G VN for Ethernet type data communication is not described in this release of the specification.
In this case, when the UPF (Network Function) receives a broadcast packet of a 5G VN group from N19 (Service-based Interface) or N6 (Non-service-based Interface) (Service-based Interface), it shall distribute it to all 5G VN group members connected to this UPF (Network Function). When the UPF (Network Function) receives a broadcast packet from a UE (Network Function) (source UE (Network Function)) via PDU Session associated with a 5G VN group, it shall distribute it to:
-	All 5G VN group members (except the source UE (Network Function)) connected to this UPF (Network Function) via local switch; and
-	All 5G VN group members connected to other UPFs via N19 (Service-based Interface)-based forwarding or N6 (Non-service-based Interface) (Service-based Interface)-based forwarding; and
-	The devices on the DN (Network Function) via N6 (Non-service-based Interface) (Service-based Interface)-based forwarding.
To enable broadcast traffic forwarding of a 5G VN group in a UPF (Network Function), the following applies:
-	The SMF (Network Function) provides group-level N4 (Service-based Interface) Session and each 5G VN group member' N4 (Service-based Interface) Session with the PDR that detect the broadcast packet sent via "internal interface". When UPF (Network Function) receives the broadcast packets sent via "internal interface", it matches the broadcast packet against all PDRs installed at the "internal interface". A successful matching with a PDR that detect the broadcast packet instructs the UPF (Network Function) to continue the lookup of the other PDRs. A matching PDR that detects the broadcast packet shall instruct the UPF (Network Function) to duplicate the broadcast packet and perform processing (using associated FAR, URR, QER) on the copy instead of the original packet if the broadcast packet does not satisfy the packet replication skip information, otherwise the PDR instructs the UPF (Network Function) to skip the processing of the broadcast packet.
-	The broadcast packets received from N19 (Service-based Interface) or N6 (Non-service-based Interface) (Service-based Interface) are forwarded to the UPF (Network Function) internal interface together with a N19 (Service-based Interface) or N6 (Non-service-based Interface) (Service-based Interface) indication.
-	The SMF (Network Function) provides for each 5G VN group member' N4 (Service-based Interface) Session (i.e. N4 (Service-based Interface) session corresponding to PDU Session) the following N4 (Service-based Interface) rules that enable the processing of broadcast packets towards this UE (Network Function).
-	in order to detect the traffic, a PDR containing Source Interface set to "5G VN internal", Destination Address set to the broadcast address, the Packet replication skip information set to the IP/MAC address (es) of this 5G VN group member, and the indication to carry on matching; and
-	in order to forward the traffic, a FAR containing Outer Header Creation indicating the PDU Session tunnel information, and Destination Interface set "access side".
-	The SMF (Network Function) configures the group-level N4 (Service-based Interface) Session for processing packets received from a N19 (Service-based Interface) tunnel with the following N4 (Service-based Interface) rules for each N19 (Service-based Interface) tunnel.
-	in order to detect the traffic, a PDR containing Source Interface set to "core side", Destination Address set to the broadcast address, and CN Tunnel Information set to N19 (Service-based Interface) tunnel header (i.e. N19 (Service-based Interface) GTP-U (Protocol) TEID); and
-	in order to forward the traffic, a FAR containing Destination Interface set to "5G VN internal", Outer Header Creation with the N19 (Service-based Interface) indication.
-	The SMF (Network Function) provides for the group-level N4 (Service-based Interface) Session the following N4 (Service-based Interface) rules that enable the processing of broadcast packets towards the other UPFs.
-	in order to detect the traffic, a PDR containing Source Interface set to "5G VN internal", Destination Address set to the broadcast address, the Packet replication skip information set to the N19 (Service-based Interface) indication, and the indication to carry on matching; and
-	in order to forward the traffic to each involved UPF (Network Function) via the corresponding N19 (Service-based Interface) tunnel, a FAR containing "Duplication" instruction, Outer Header Creation indicating the N19 (Service-based Interface) tunnel information, Destination Interface set to "core side".
-	The SMF (Network Function) configures the group-level N4 (Service-based Interface) Session for processing packets received from N6 (Non-service-based Interface) (Service-based Interface) with the following N4 (Service-based Interface) rules.
-	in order to detect the traffic, a PDR containing Source Interface set to "core side", and Destination Address set to the broadcast address; and
-	in order to forward the traffic, a FAR containing Destination Interface set to "5G VN internal", Outer Header Creation with the N6 (Non-service-based Interface) (Service-based Interface) indication.
-	The SMF (Network Function) provides for the group-level N4 (Service-based Interface) Session the following N4 (Service-based Interface) rules that enable the processing of broadcast packets towards N6 (Non-service-based Interface) (Service-based Interface).
-	in order to detect the traffic, a PDR containing Source Interface set to "5G VN internal" and Destination Address set to the broadcast address and the Packet replication skip information set to the N6 (Non-service-based Interface) (Service-based Interface) indication; and
-	in order to forward the traffic to N6 (Non-service-based Interface) (Service-based Interface), a FAR containing Destination Interface set to "core side".
In this case, to enable multicast traffic forwarding of a 5G VN group in a UPF (Network Function), broadcast traffic forwarding of a 5G VN applies to multicast traffic forwarding of a 5G VN with the following modifications:
-	The SMF (Network Function) installs PDRs for the multicast address instead of the broadcast address.
-	The PDRs and FARs are installed for PDU Sessions corresponding to the members of the multicast group.
-	In addition, the SMF (Network Function) installs the PDR identifying IGMP/MLD signalling for each 5G VN group member' N4 (Service-based Interface) Session and a URR with a Reporting Trigger set to "IGMP reporting" for IGMP or set to "MLD reporting" for MLD. Based on the IP  (Protocol)Multicast address in "IP  (Protocol)multicast join" or "IP  (Protocol)multicast leave" reports received from UPF (Network Function), the SMF (Network Function) manipulates (delete or add) the PDR identifying the multicast traffic for the reported IP  (Protocol)Multicast address at the corresponding 5G VN group member' N4 (Service-based Interface) Session, and if required at the group-level N4 (Service-based Interface) Session at the UPF (Network Function)(s) of the 5G VN group.
Operators can deploy UPF (Network Function)(s) supporting the Inter PLMN User Plane Security (IPUPS) functionality at the border of their network to protect their networks from invalid inter PLMN N9 (Service-based Interface) traffic.
The IPUPS functionality forwards GTP-U (Protocol) packets (received via the N9 (Service-based Interface) interface) only if they belong to an active PDU Session and are not malformed, as described in TS 33.501 [29].
The SMF (Network Function) can activate the IPUPS functionality together with other UP functionality in the same UPF (Network Function), or insert a separate UPF (Network Function) in the UP path for the IPUPS functionality. In both cases the UPF (Network Function) with IPUPS functionality is controlled by the SMF (Network Function) via the N4 (Service-based Interface) interface.

If requested by the SMF (Network Function) during N4 (Service-based Interface) Session Establishment, the UPF (Network Function) (PSA (Network Function)) may setup L2TP towards an L2TP network server (LNS) in the DN (Network Function) and tunnel the PDU Session user plane traffic in this L2TP tunnel. In this case the UPF (Network Function) acts as a L2TP access concentrator (LAC).
To enable this, the SMF (Network Function) may provide L2TP information to the UPF (Network Function), such as LNS IP  (Protocol)address and/or LNS host name, as described in TS 29.244 [65]. This L2TP information may be configured on the SMF (Network Function) as part of the DNN configuration or received from the DN (Network Function)-AAA Server during secondary authentication/authorization, as described in clause 5.6.6. Alternatively, the L2TP tunnel parameters may be configured in the UPF (Network Function) Function. The L2TP tunnel parameters include necessary parameters for setting up L2TP tunnel towards the LNS (e.g. LNS address, tunnel password, etc.).
In addition, the SMF (Network Function) may provide PAP/CHAP authentication information to the UPF (Network Function), for use in L2TP session establishment, in case it was received from the UE (Network Function) in the PDU Session Establishment Request.
When L2TP is to be used for a PDU Session, the SMF (Network Function) may select a UPF (Network Function) based upon support of this feature. The SMF (Network Function) determines whether the UPF (Network Function) supports this feature via N4 (Service-based Interface) capability negotiation during N4 (Service-based Interface) Association Setup or via NRF (Network Function) discovery.
If SMF (Network Function) requests the UPF (Network Function) to allocate UE (Network Function) IP  (Protocol)address, as described in clause 5.8.2.2.1, the UPF (Network Function) (LAC) may retrieve this IP  (Protocol)address from the LNS. In addition, if the SMF (Network Function) requests the UPF (Network Function) to provide DNS address(es), the UPF (Network Function) (LAC) may request the LNS to provide DNS address(es) and report such DNS address(es) to the SMF (Network Function).
The UPF (Network Function) may expose information by means of UPF (Network Function) event exposure service as described in TS 23.502 [3] clause 5.2.26.2, via a service-based interface directly. The NF (Network Function) consumer, which may receive UPF (Network Function) event notifications, are AF (Network Function)/NEF (Network Function), TSNAF/TSCTSF (Network Function) and NWDAF (Network Function)/DCCF (Network Function)/MFAF (Network Function).
When the UPF (Network Function) supports the data exposure via the SBI interface, it may register its NF (Network Function) profile to the NRF (Network Function) including the UPF (Network Function) Event Exposure service. For the UPF (Network Function) Event Exposure service, the NF (Network Function) profile includes the related event ID(s).
For data collection from UPF (Network Function) (see clause 4.15.4.5 of TS 23.502 [3]), NF (Network Function) consumer do the subscription to the UPF (Network Function) directly or indirectly via SMF (Network Function). A consumer may subscribe to the UPF (Network Function) event exposure service directly only for data collected for "any UE (Network Function)" e.g. to collect user data usage information for NWDAF (Network Function) NF (Network Function) Load analytic (see clause 6.5 of TS 23.288 [86]), and if the subscription is not including any of the following parameters: AoI, traffic filtering, BSSID/SSID, Application (Protocol) ID.
UPF (Network Function) selection is further described in clause 6.3.3.1.
To minimize the impact of event notification to UPF (Network Function) data processing, the event subscription may include Reporting suggestion information. The Reporting suggestion information includes Report urgency and Reporting window information. Reporting urgency information represents whether this event report can be delay tolerant, i.e. the event report can be delayed. If the Reporting urgency information indicates "delay tolerant", the Reporting time is also provided, which defines the last valid reporting time, and UPF (Network Function) shall report the detected event before the last valid time. Per Reporting suggestion information UPF (Network Function) can concatenate several notification messages to the same notification endpoint in one notification message.
An UPF (Network Function) which is deployed with NAT (Network Address Translation) functionality may support to provide the 5GC UE (Network Function) IP  (Protocol)address to NEF (Network Function) based on NEF (Network Function) request containing public IP  (Protocol)address and port number using the Nupf_GetPrivateUEIPaddr service as described in clause 4.15.10 of TS 23.502 [3] for AF (Network Function) specific UE (Network Function) ID retrieval.
The SMF (Network Function) may configure the UPF (Network Function) to perform QoS monitoring for a QoS Flow and to report the monitoring results with the help of the following parameters provided in the Session Reporting Rule (SRR) described in clause 5.8.5.11:
-	QoS parameter(s) to be measured indicating the subject of the QoS monitoring as defined in clause 5.45;
-	Reporting period indicating the time interval in which a new measurement result and a potential report has to be available. If no measurement result is available to the UPF (Network Function) within the Reporting period, the UPF (Network Function) shall report a measurement failure;
-	Reporting frequency indicating the type of the reporting as "periodic" or "event triggered":
-	If the Reporting frequency indicates "periodic", the UPF (Network Function) shall send a report each time the reporting period is over.
-	If the Reporting frequency indicates "event triggered", a Reporting threshold for each parameter in the QoS parameter(s) to be measured and a Minimum waiting time are provided as well. The UPF (Network Function) shall send a report when the measurement result matches or exceeds the indicated Reporting threshold. Subsequent reports shall not be sent by the UPF (Network Function) during the Minimum waiting time. If measurement results are received during the Minimum waiting time, the UPF (Network Function) shall report the minimum and the maximum measurement result when the Minimum waiting time is over.
-	(Optional) Target of the reporting and Indication of direct event notification indicating that the UPF (Network Function) shall send the reports to a different NF (Network Function) than the SMF (Network Function) (i.e. to the Local NEF (Network Function) or the AF (Network Function)). The NF (Network Function) is described by a Notification Target Address and a Notification Correlation ID. The SMF (Network Function) can also indicate that the UPF (Network Function) shall send the reports to both, the NF (Network Function) indicated by the Target of reporting and to the SMF (Network Function). If so, the UPF (Network Function) shall send the reports to the SMF (Network Function) as well. If the Indication of direct event notification is not provided, the UPF (Network Function) shall send the reports to the SMF (Network Function).
-	(Optional) Reporting suggestion information as defined in clause 5.8.2.17 applicable to Target of the reporting to reduce the UPF (Network Function) performance impacts.
The UPF (Network Function) sends reports to the SMF (Network Function) in the form of QoS Monitoring Report as described in clause 5.8.5.12 and reports to the Local NEF (Network Function) or the AF (Network Function) via the Nupf_EventExposure_Notify service operation described in clause 7.2.29.
5GC supports buffering of UE (Network Function)'s downlink packets for deactivated PDU Sessions.
Support for buffering in the UPF (Network Function) is mandatory and optional in the SMF (Network Function).
When the UP connection of a PDU Session is deactivated, buffering in UPF (Network Function) can be activated by the SMF (Network Function). If the SMF (Network Function) supports buffering capability, the SMF (Network Function) can decide to activate buffering in SMF (Network Function) instead of buffering in UPF (Network Function).
When the SMF (Network Function) decided to activate buffering in UPF (Network Function), the SMF (Network Function) shall inform the UPF (Network Function) to start buffering packets for this PDU Session.
The SMF (Network Function) provides instructions to the UPF (Network Function) for at least the following behaviour:
-	buffer downlink packets with the following additional options:
-	reporting the arrival of first downlink packet (for a QoS Flow or a service data flow), and/or
-	reporting the first discarded downlink packet (for a service data flow), or
-	drop downlink packets with the following additional options:
-	reporting the first discarded downlink packet (for a service data flow).
-	buffer uplink packets.
When the SMF (Network Function) instructs the UPF (Network Function) for a service data flow to buffer downlink packets and to report the first discarded downlink packet, the SMF (Network Function) shall also instruct the UPF (Network Function) to report the arrival of the first downlink packet for this service data flow to enable the SMF (Network Function) check if this is also the first report for the QoS Flow (as described below).
Buffering in the UPF (Network Function) may be configured based on timers or the amount of downlink data to be buffered. The SMF (Network Function) decides whether buffering timers or amount of downlink data are handled by the UPF (Network Function) or SMF (Network Function).
After starting buffering, when the first downlink packet (of a QoS Flow or a service data flow) arrives, UPF (Network Function) shall inform the SMF (Network Function) if it is setup to report. UPF (Network Function) sends a Downlink Data Report to the SMF (Network Function) via N4 (Service-based Interface) unless specified otherwise and indicates the PDR by which the downlink packet was received. If the SMF (Network Function) receives a Downlink Data Report for a service data flow, the SMF (Network Function) shall also check if this is the first report for the QoS Flow corresponding to the PDR. If so, the SMF (Network Function) shall also proceed as described in clause 5.4.3.1.
After starting buffering, when the first downlink packet (of a service data flow) in a configured period of time that has been buffered is discarded by the UPF (Network Function) because the configured buffering time or amount of downlink data to be buffered is exceeded, the UPF (Network Function) shall inform the SMF (Network Function) if it is setup to report. UPF (Network Function) sends a Downlink Data Report to the SMF (Network Function) via N4 (Service-based Interface) and indicates the PDR by which the discarded downlink packet was received.
A new report is sent if the SMF (Network Function) terminates and subsequently re-activates the buffering action at the UPF (Network Function) and the UPF (Network Function) again receives downlink packets.
NOTE:	For the notification about the downlink data delivery status "buffered" or "discarded" related to packets from a particular AF (Network Function) as part of the Nsmf_EventExposure service, it is expected that a PDR with a traffic filter identifying that AF (Network Function) as source and a Forwarding Action rule with action "buffer" is installed.
When the UP connection of the PDU Session is activated, the SMF (Network Function) updates the UPF (Network Function) of the change in buffering state. The buffered downlink packets, if any, are then forwarded to the (R)AN by the UPF (Network Function).
If the UP connection of the PDU Session has been deactivated for a long time, the SMF (Network Function) may indicate the UPF (Network Function) to stop buffering for this PDU Session.
The SMF (Network Function) may indicate to the UPF (Network Function) to start or stop the buffering of uplink packets of an application associated to the PCC rule as described in clause 6.3.5 of TS 23.548 [130]. When the buffering of uplink packets is stopped the UPF (Network Function) shall forward all buffered uplink packets before it forwards any new uplink packets.
When the SMF (Network Function) supports buffering capability and the SMF (Network Function) decided to activate buffering in SMF (Network Function) for the PDU Session, the SMF (Network Function) shall inform the UPF (Network Function) to start forwarding the downlink packets towards the SMF (Network Function).
When the UP connection of the PDU Session is activated, if there are buffered downlink packets available and their buffering duration has not expired, the SMF (Network Function) shall forward those packets to the UPF (Network Function) to relay them to the UE (Network Function). These packets are then forwarded by the UPF (Network Function) to the (R)AN.
The SMF (Network Function) Pause of Charging functionality is supported with the purpose that the charging and usage monitoring data in the core network more accurately reflects the downlink traffic actually sent to the (R)AN. When the amount of downlink data incoming at the UPF (Network Function) for a PDU Session that is in deactivated state goes above a pre-configured threshold, the pause of charging functionality ensures that data that dropped in the core network is not included in charging and usage monitoring records.
The procedures for SMF (Network Function) Pause of Charging are described in TS 23.502 [3].
The Explicit Buffer Management is described in clause 5.8.2.19.
The SMF (Network Function) Pause of Charging is described in clause 5.8.2.20.
These parameters are used by SMF (Network Function) to control the functionality of the UPF (Network Function) as well as to inform SMF (Network Function) about events occurring at the UPF (Network Function).
The N4 (Service-based Interface) session management procedures defined in clause 4.4.1 of TS 23.502 [3] will use the relevant parameters in the same way for all N4 (Service-based Interface) reference points: the N4 (Service-based Interface) Session Establishment procedure as well as the N4 (Service-based Interface) Session Modification procedure provide the control parameters to the UPF (Network Function), the N4 (Service-based Interface) Session Release procedure removes all control parameters related to an N4 (Service-based Interface) session, and the N4 (Service-based Interface) Session Level Reporting procedure informs the SMF (Network Function) about events related to the PDU Session that are detected by the UPF (Network Function).
The parameters over N4 (Service-based Interface) reference point provided from SMF (Network Function) to UPF (Network Function) comprises an N4 (Service-based Interface) Session ID and may also contain:
-	Packet Detection Rules (PDR) that contain information to classify traffic (PDU(s)) arriving at the UPF (Network Function);
-	Forwarding Action Rules (FAR) that contain information on whether forwarding, dropping or buffering is to be applied to a traffic identified by PDR(s);
-	Multi-Access Rules (MAR) that contain information on how to handle traffic steering, switching and splitting for a MA PDU Session;
-	Usage Reporting Rules (URR) contains information that defines how traffic identified by PDR(s) shall be accounted as well as how a certain measurement shall be reported;
-	QoS Enforcement Rules (QER), that contain information related to QoS enforcement of traffic identified by PDR(s);
-	Session Reporting Rules (SRR) that contain information to request the UP function to detect and report events for a PDU session that are not related to specific PDRs of the PDU session or that are not related to traffic usage measurement.
-	Trace Requirements;
-	Port Management Information Container in 5GS;
-	Bridge/Router Information.
The N4 (Service-based Interface) Session ID is assigned by the SMF (Network Function) and uniquely identifies an N4 (Service-based Interface) session.
If the UPF (Network Function) indicated support of Trace, the SMF (Network Function) may activate a trace session during a N4 (Service-based Interface) Session Establishment or a N4 (Service-based Interface) Session Modification procedure. In that case it provides Trace Requirements to the UPF (Network Function). The SMF (Network Function) may deactivate an on-going trace session using a N4 (Service-based Interface) Session Modification procedure. There shall be at most one trace session activated per N4 (Service-based Interface) Session at a time.
For the MA PDU Session, the SMF (Network Function) may add an additional access tunnel information during an N4 (Service-based Interface) Session Modification procedure by updating MAR with addition of an FAR ID which refers to an FAR containing the additional access tunnel information for the MA PDU session for traffic steering in the UPF (Network Function). For the MA PDU Session, the SMF (Network Function) may request Access Availability report per N4 (Service-based Interface) Session, during N4 (Service-based Interface) Session Establishment procedure or N4 (Service-based Interface) Session Modification procedure.
A N4 (Service-based Interface) Session may be used to control both UPF (Network Function) and NW-TT behaviour in the UPF (Network Function). A N4 (Service-based Interface) session support and enable exchange of bridge/router configuration between the SMF (Network Function) and the UPF (Network Function):
-	Information that the SMF (Network Function) needs for bridge/router management (clause 5.8.5.9);
-	Information that 5GS transparently relays between the TSN AF (Network Function) or TSCTSF (Network Function) and the NW-TT: transparent Port Management Information Container along with the associated NW-TT port number.
-	Information that 5GS transparently relays between the TSN AF (Network Function) or TSCTSF (Network Function) and the NW-TT: transparent user plane node Management Information Container (clause 5.8.5.14).
When a N4 (Service-based Interface) Session related with bridge/router management is established, the UPF (Network Function) allocates a dedicated port number for the device side of the PDU Session. The UPF (Network Function) then provides to the SMF (Network Function) following configuration parameters for the N4 (Service-based Interface) Session:
-	port number.
-	user-plane node ID.
To support TSN, the user-plane node ID is Bridge ID. The User Plane Node ID/Bridge ID may be pre-configured in the UPF (Network Function) based on deployment.
After the N4 (Service-based Interface) session has been established, the SMF (Network Function) and UPF (Network Function) may at any time exchange transparent user plane node and Port Management Information Container over a N4 (Service-based Interface) session.
N4 (Service-based Interface) Session Context is identified by an N4 (Service-based Interface) Session ID. An N4 (Service-based Interface) Session Context is generated by SMF (Network Function) and UPF (Network Function) respectively to store the parameters related to an N4 (Service-based Interface) session, including the N4 (Service-based Interface) session ID and following information (see TS 29.244 [65] for an exhaustive list):
1)	general session related parameters such as S-NSSAI, PDU Session Type, Trace Information, APN/DNN, ATSSS Control Information;
2)	the PDRs, URRs, QERs, BAR(s), FARs, MARs used for this N4 (Service-based Interface) session;
3)	parameters sent to support UPF (Network Function) statistics.
The UPF (Network Function) may use parameters listed above in bullets 1) (e.g. S-NSSAI) and 2) (e.g. Network Instance in PDR/FAR(s)) for determining internal UPF (Network Function) resources.
The following table describes the Packet Detection Rule (PDR) containing information required to classify a packet arriving at the UPF (Network Function). Every PDR is used to detect packets in a certain transmission direction, e.g. UL direction or DL direction.
Table 5.8.5.3-1: Attributes within Packet Detection Rule

The following table describes the QoS Enforcement Rule (QER) that defines how a packet shall be treated in terms of bit rate limitation and packet marking for QoS purposes. All Packet Detection Rules that refer to the same QER share the same QoS resources, e.g. MFBR.
Table 5.8.5.4-1: Attributes within QoS Enforcement Rule

The following table describes the Usage Reporting Rule (URR) that defines how a packet shall be accounted as well as when and how to report the measurements.
Table 5.8.5.5-1: Attributes within Usage Reporting Rule

The following table describes the Forwarding Action Rule (FAR) that defines how a packet shall be buffered, dropped or forwarded, including packet encapsulation/decapsulation and forwarding destination.
Table 5.8.5.6-1: Attributes within Forwarding Action Rule

The UPF (Network Function) sends the Usage Report to inform the SMF (Network Function) about the measurement of an active URR or about the detection of application traffic of an active Packet Detection Rule. For each URR, the Usage Report may be generated repeatedly, i.e. as long as any one of the valid event triggers applies. A final Usage Report is sent for a URR when it is no longer active, i.e. either the URR is removed or all the references to this URR in any of the Packet Detection Rules belonging to the N4 (Service-based Interface) session.
The following attributes can be included:
Table 5.8.5.7-1: Attributes within Usage Report

The following table describes the Multi-Access Rule (MAR) that includes the association to the two FARs for both 3GPP access and non-3GPP access in the case of supporting ATSSS.
Table 5.8.5.8-1: Attributes within Multi-Access Rule

The following table describes the User plane node Information (UI) that includes the information required to configure a 5GS logical bridge/router for TSC or Deterministic Networking PDU Sessions.
Table 5.8.5.9-1: User plane node Information


The following table describes the Session Reporting Rule (SRR) that defines the detection and reporting events that the UPF (Network Function) shall report, that are not related to specific PDRs of the PDU Session, as follows:
-	Per QoS Flow per UE (Network Function) QoS Monitoring Report, as specified in clause 5.33.3.2.
-	Change of 3GPP or non-3GPP access availability, for an MA PDU session.
-	Per QoS Flow N6 (Non-service-based Interface) (Service-based Interface) Traffic Parameter Measurement Report.
Table 5.8.5.11-1: Attributes within Session Reporting Rule

The UPF (Network Function) sends the session report to inform the SMF (Network Function) the detected events for a PDU Session that are related to an SRR. The UPF (Network Function) may support notification to the AF (Network Function) possibly via local NEF (Network Function) as described in clause 6.4 of TS 23.548 [130].
Table 5.8.5.12-1: Attributes within Session Reporting


The following table describes the TSC Management Information Container (TSC MIC) that includes UMIC, PMIC and the associated NW-TT port number.
The SMF (Network Function) may include the notification target address for PMIC/UMIC UPF (Network Function) event provided by the PCF (Network Function) in the TSC Management Information sent to UPF (Network Function) if the UPF (Network Function) supports the related redirect reporting via Nupf. If the notification target address for PMIC/UMIC UPF (Network Function) event is provided by the SMF (Network Function), the UPF (Network Function) may directly report TSC management information to the TSNAF or TSCTSF (Network Function) using Nupf_EventExposure_Notify service operation described in clause 7.2.29.
Table 5.8.5.14-1: TSC Management Information Container

The UPF (Network Function) sends the Downlink Data Report to inform the SMF (Network Function) about the events related to receiving or discarding of downlink packets. The SMF (Network Function) controls this type of UPF (Network Function) report by providing instructions in the Buffer Action Rule of a FAR.
Following attributes can be included:
Table 5.8.5.15-1: Attributes within Downlink Data Report

Each subscriber in the 5G System shall be allocated one 5G Subscription Permanent Identifier (SUPI) for use within the 3GPP system. The 5G System supports identification of subscriptions independently of identification of the user equipment. Each UE (Network Function) accessing the 5G System shall be assigned a Permanent Equipment Identifier (PEI).
The 5G System supports allocation of a temporary identifier (5G-GUTI) in order to support user confidentiality protection.
A globally unique 5G Subscription Permanent Identifier (SUPI) shall be allocated to each subscriber in the 5G System and provisioned in the UDM (Network Function)/UDR (Network Function). The SUPI is used only inside 3GPP system, and its privacy is specified in TS 33.501 [29].
The SUPI may contain:
-	an IMSI as defined in TS 23.003 [19], or
-	a network-specific identifier, used for private networks as defined in TS 22.261 [2].
-	a GLI and an operator identifier of the 5GC operator, used for supporting FN-BRGs, as further described in TS 23.316 [84].
-	a GCI and an operator identifier of the 5GC operator, used for supporting FN-CRGs and 5G-CRG, as further described in TS 23.316 [84].
A SUPI containing a network-specific identifier shall take the form of a Network Access Identifier (NAI) using the NAI RFC 7542 [20] based user identification as defined in TS 23.003 [19].
When UE (Network Function) needs to indicate its SUPI to the network (e.g. as part of the Registration procedure), the UE (Network Function) provides the SUPI in concealed form as defined in TS 23.003 [19].
In order to enable roaming scenarios, the SUPI shall contain the address of the home network (e.g. the MCC and MNC in the case of an IMSI based SUPI).
For interworking with the EPC, the SUPI allocated to the 3GPP UE (Network Function) shall always be based on an IMSI to enable the UE (Network Function) to present an IMSI to the EPC.
The usage of SUPI for W-5GAN is further specified in TS 23.316 [84].
5.9.2a	Subscription Concealed Identifier
The Subscription Concealed Identifier (SUCI) is a privacy preserving identifier containing the concealed SUPI. It is specified in TS 33.501 [29].
The usage of SUCI for W-5GAN access is further specified in TS 23.316 [84].
A Permanent Equipment Identifier (PEI) is defined for the 3GPP UE (Network Function) accessing the 5G System.
The PEI can assume different formats for different UE (Network Function) types and use cases. The UE (Network Function) shall present the PEI to the network together with an indication of the PEI format being used.
If the UE (Network Function) supports at least one 3GPP access technology (i.e. NG-RAN (Network Function), E-UTRAN, UTRAN or GERAN), the UE (Network Function) must be allocated a PEI in the IMEI or IMEISV format.
If a UE (Network Function) has registered with a network by using a network subscription and a PEI of the UE (Network Function), then the UE (Network Function) shall keep the PEI to be used with the network subscription and shall not use that PEI with another network subscription while the UE (Network Function) is in registered state in the network.
In the scope of this release, the PEI may be one of the following:
-	for UEs that support at least one 3GPP access technology, an IMEI or IMEISV, as defined in TS 23.003 [19];
-	PEI used in the case of W-5GAN access as further specified in TS 23.316 [84].
-	for UEs not supporting any 3GPP access technologies, the IEEE Extended Unique Identifier EUI-64 [113] of the access technology the UE (Network Function) uses to connect to the 5GC.
The AMF (Network Function) shall allocate a 5G Globally Unique Temporary Identifier (5G-GUTI) to the UE (Network Function) that is common to both 3GPP and non-3GPP access. It shall be possible to use the same 5G-GUTI for accessing 3GPP access and non-3GPP access security context within the AMF (Network Function) for the given UE (Network Function). An AMF (Network Function) may re-assign a new 5G-GUTI to the UE (Network Function) at any time. The AMF (Network Function) provides a new 5G-GUTI to the UE (Network Function) under the conditions specified in clause 6.12.3 of TS 33.501 [29]. When the UE (Network Function) is in CM-IDLE, the AMF (Network Function) may delay providing the UE (Network Function) with a new 5G-GUTI until the next NAS (Protocol) transaction.
The 5G-GUTI shall be structured as:
	<5G-GUTI> := <GUAMI> <5G-TMSI>
	where GUAMI identifies one or more AMF (Network Function)(s).
When the GUAMI identifies only one AMF (Network Function), the 5G-TMSI identifies the UE (Network Function) uniquely within the AMF (Network Function). However, when AMF (Network Function) assigns a 5G-GUTI to the UE (Network Function) with a GUAMI value used by more than one AMF (Network Function), the AMF (Network Function) shall ensure that the 5G-TMSI value used within the assigned 5G-GUTI is not already in use by the other AMF (Network Function)(s) sharing that GUAMI value.
The Globally Unique AMF (Network Function) ID (GUAMI) shall be structured as:
	<GUAMI> := <MCC> <MNC> <AMF (Network Function) Region ID> <AMF (Network Function) Set ID> <AMF (Network Function) Pointer>
	where AMF (Network Function) Region ID identifies the region, AMF (Network Function) Set ID uniquely identifies the AMF (Network Function) Set within the AMF (Network Function) Region and AMF (Network Function) Pointer identifies one or more AMFs within the AMF (Network Function) Set.
NOTE 1:	The AMF (Network Function) Region ID addresses the case that there are more AMFs in the network than the number of AMFs that can be supported by AMF (Network Function) Set ID and AMF (Network Function) Pointer by enabling operators to re-use the same AMF (Network Function) Set IDs and AMF (Network Function) Pointers in different regions.
NOTE 2:	In the case of SNPNs, the PLMN IDs may be shared among SNPNs such that the constructed GUAMIs are not globally unique. However, PLMN ID and NID are provided together, separate from the GUAMI, to uniquely identify selected or supported SNPN in RRC (Protocol) and N2 (Non-service-based Interface) (Service-based Interface).
NOTE 3: See TS 23.003 [19] for details on the structure of the fields of GUAMI.
The 5G-S-TMSI is the shortened form of the GUTI to enable more efficient radio signalling procedures (e.g. during Paging and Service Request) and is defined as:
	<5G-S-TMSI> := <AMF (Network Function) Set ID> <AMF (Network Function) Pointer> <5G-TMSI>
As specified in TS 38.304 [50] and TS 36.304 [52] for 3GPP access, the NG-RAN (Network Function) uses the 10 Least Significant Bits of the 5G-TMSI in the determination of the time at which different UEs are paged. Hence, the AMF (Network Function) shall ensure that the 10 Least Significant Bits of the 5G-TMSI are evenly distributed.
As specified in TS 38.331 [28] and TS 36.331 [51] for 3GPP access, the NG-RAN (Network Function)'s RRC (Protocol) Connection Establishment's contention resolution process assumes that there is a low probability of the same 5G-TMSI being allocated by different AMFs to different UEs. The AMFs' process for allocating the 5G-TMSI should take this account.
NOTE 4:	To achieve this, the AMF (Network Function) could, for example, use a random seed number for any process it uses when choosing the UE (Network Function)'s 5G-TMSI.
An AMF (Network Function) is identified by an AMF (Network Function) Name. AMF (Network Function) Name is a globally unique FQDN, the structure of AMF (Network Function) Name FQDN is defined in TS 23.003 [19]. An AMF (Network Function) can be configured with one or more GUAMIs. At a given time, GUAMI with distinct AMF (Network Function) Pointer value is associated to one AMF (Network Function) name only.
A DNN is equivalent to an APN as defined in TS 23.003 [19]. Both identifiers have an equivalent meaning and carry the same information.
The DNN may be used e.g. to:
-	Select a SMF (Network Function) and UPF (Network Function)(s) for a PDU Session.
-	Select N6 (Non-service-based Interface) (Service-based Interface) interface(s) for a PDU Session.
-	Determine policies to apply to this PDU Session.
The wildcard DNN is a value that can be used for the DNN field of Subscribed DNN list of Session Management Subscription data defined in clause 5.2.3.3 of TS 23.502 [3].
The wildcard DNN can be used with an S-NSSAI for operator to allow the subscriber to access any Data Network supported within the Network Slice associated with the S-NSSAI.
The subscription data for an UE (Network Function) in UDR (Network Function) may associate the subscriber with groups. A group is identified by an Internal-Group Identifier.
NOTE 1:	A UE (Network Function) can belong to a limited number of groups, the exact number is defined in stage 3 specifications.
NOTE 2:	In this Release of the specification, the support of groups is only defined in non-roaming case.
The Internal-Group Identifier(s) corresponding to an UE (Network Function) are provided by the UDM (Network Function) to the SMF (Network Function) as part Session Management Subscription data and (when PCC applies to a PDU Session) by the SMF (Network Function) to the PCF (Network Function). The SMF (Network Function) may use this information to apply local policies and to store this information in CDR. The PCF (Network Function) may use this information to enforce AF (Network Function) requests as described in clause 5.6.7.
The Internal-Group Identifier(s) corresponding to an UE (Network Function) are provided by the UDM (Network Function) to the AMF (Network Function) as part of Access and Mobility Subscription data. The AMF (Network Function) may use this information to apply local policies (such as Group specific NAS (Protocol) level congestion control defined in clause 5.19.7.5).
Generic Public Subscription Identifier (GPSI) is needed for addressing a 3GPP subscription in different data networks outside of the 3GPP system. The 3GPP system stores within the subscription data the association between the GPSI and the corresponding SUPI.
GPSIs are public identifiers used both inside and outside of the 3GPP system.
The GPSI is either an MSISDN or an External Identifier, see TS 23.003 [19]. If MSISDN is included in the subscription data, it shall be possible that the same MSISDN value is supported in both 5GS and EPS.
NOTE:	There is no implied 1-to-1 relationship between GPSI and SUPI.
An AMF (Network Function) UE (Network Function) NGAP ID is an identifier used to identify the UE (Network Function) in AMF (Network Function) on N2 (Non-service-based Interface) (Service-based Interface) reference point. AMF (Network Function) allocates the AMF (Network Function) UE (Network Function) NGAP ID and send it to the 5G-AN. For the following N2 (Non-service-based Interface) (Service-based Interface) signalling interaction sent from 5G-AN to AMF (Network Function), AMF (Network Function) UE (Network Function) NGAP ID is used to identify the UE (Network Function) at the AMF (Network Function). AMF (Network Function) UE (Network Function) NGAP ID is unique per AMF (Network Function) set. AMF (Network Function) UE (Network Function) NGAP ID may be updated without AMF (Network Function) change, or with AMF (Network Function) change as specified at clause 5.21.2.2.
The UE (Network Function) Radio Capability ID is a short pointer with format defined in TS 23.003 [19] that is used to uniquely identify a set of UE (Network Function) Radio Capabilities (excluding UTRAN and NB-IoT capabilities). The UE (Network Function) Radio Capability ID is assigned either by the serving PLMN or by the UE (Network Function) manufacturer, as follows:
-	UE (Network Function) manufacturer-assigned: The UE (Network Function) Radio Capability ID may be assigned by the UE (Network Function) manufacturer in which case it includes a UE (Network Function) manufacturer identification (i.e. a Vendor ID). In this case, the UE (Network Function) Radio Capability ID uniquely identifies a set of UE (Network Function) radio capabilities and the UE (Network Function) Radio Capability for Paging for a UE (Network Function) by this manufacturer in any PLMN.
-	PLMN-assigned: If a UE (Network Function) manufacturer-assigned UE (Network Function) Radio Capability ID is not used by the UE (Network Function) or the serving network, or it is not recognised by the serving PLMN UCMF (Network Function), the UCMF (Network Function) may allocate UE (Network Function) Radio Capability IDs for the UE (Network Function) corresponding to each different set of UE (Network Function) radio capabilities the PLMN may receive from the UE (Network Function) at different times. In this case, the UE (Network Function) Radio Capability IDs the UE (Network Function) receives are applicable to the serving PLMN and uniquely identify the corresponding sets of UE (Network Function) radio capabilities and and the UE (Network Function) Radio Capability for Paging(s) in this PLMN. The PLMN assigned UE (Network Function) Radio Capability ID includes a Version ID in its format. The value of the Version ID is the one configured in the UCMF (Network Function), at time the UE (Network Function) Radio Capability ID value is assigned. The Version ID value makes it possible to detect whether a UE (Network Function) Radio Capability ID is current or outdated.
NOTE:	For the case the PLMN is configured to store PLMN assigned IDs in the UE (Network Function) manufacturer-assigned operation requested list defined in clause 5.4.4.1a, then the algorithm for assignment of PLMN-assigned UE (Network Function) Radio Capability ID shall assign different UE (Network Function) Radio Capability IDs for UEs with different TAC value.
The type of UE (Network Function) Radio Capability ID (UE (Network Function) manufacturer-assigned or PLMN-assigned) is distinguished when a UE (Network Function) Radio Capability ID is signalled.
The security features in the 5G System include:
-	Authentication of the UE (Network Function) by the network and vice versa (mutual authentication between UE (Network Function) and network).
-	Security context generation and distribution.
-	User Plane data confidentiality and integrity protection.
-	Control Plane signalling confidentiality and integrity protection.
-	User identity confidentiality.
-	Support of LI requirements as specified in TS 33.126 [35] subject to regional/national regulatory requirements, including protection of LI data (e.g. target list) that may be stored or transferred by an NF (Network Function).
Detailed security related network functions for 5G are described in TS 33.501 [29].
When a UE (Network Function) is connected via a NG-RAN (Network Function) and via a standalone non-3GPP accesses, the multiple N1 (Non-service-based Interface) (Service-based Interface) instances are secured using independent NAS (Protocol) security contexts, each created based on the security context in the corresponding SEAF (e.g. in the common AMF (Network Function) when the UE (Network Function) is served by the same AMF (Network Function)) derived from the UE (Network Function) authentication.
The User Plane Security Enforcement information provides the NG-RAN (Network Function) with User Plane security policies for a PDU session. It indicates:
-	whether UP integrity protection is:
-	Required: for all the traffic on the PDU Session UP integrity protection shall apply.
-	Preferred: for all the traffic on the PDU Session UP integrity protection should apply.
-	Not Needed: UP integrity protection shall not apply on the PDU Session.
-	whether UP confidentiality protection is:
-	Required: for all the traffic on the PDU Session UP confidentiality protection shall apply.
-	Preferred: for all the traffic on the PDU Session UP confidentiality protection should apply.
-	Not Needed: UP confidentiality shall not apply on the PDU Session.
User Plane Security Enforcement information applies only over 3GPP access. Once determined at the establishment of the PDU Session the User Plane Security Enforcement information applies for the life time of the PDU Session.
NOTE 1:	Applicability of UP integrity protection of UP Security Enforcement is defined in TS 33.501 [29] and TS 38.300 [27].
The SMF (Network Function) determines at PDU session establishment a User Plane Security Enforcement information for the user plane of a PDU session based on:
-	subscribed User Plane Security Policy which is part of SM subscription information received from UDM (Network Function); and
-	User Plane Security Policy locally configured per (DNN, S-NSSAI) in the SMF (Network Function) that is used when the UDM (Network Function) does not provide User Plane Security Policy information.
-	The maximum supported data rate per UE (Network Function) for integrity protection for the DRBs, provided by the UE (Network Function) in the Integrity protection maximum data rate IE during PDU Session Establishment. The UE (Network Function) supporting NR as primary RAT, i.e. NG-RAN (Network Function) access via Standalone NR, shall set the Integrity protection maximum data rate IE for Uplink and Downlink to full rate at PDU Session Establishment as defined in TS 24.501 [47]. A UE (Network Function) not supporting NR as primary RAT and supporting E-UTRA connected to 5GC, shall set the Integrity protection maximum data rate IE for Uplink and Downlink to NULL at PDU Session Establishment as defined in TS 24.501 [47].
The User Plane Security Enforcement information provides the MME with User Plane integrity protection policies for the PDU session (PDN Connection). The information indicates whether UP integrity protection is:
-	Required: for all the traffic on the PDU Session (PDN Connection) UP integrity protection shall apply.
-	Preferred: for all the traffic on the PDU Session (PDN Connection) UP integrity protection should apply.
-	Not Needed: UP integrity protection shall not apply on the PDU Session (PDN Connection).
In turn, the MME provides per EPS bearer User Plane Security Enforcement information to the E-UTRAN. All the bearers within a PDN Connection share the same User Plane integrity protection policies.
The UE (Network Function) capability to support user plane integrity protection with EPS is indicated to AMF (Network Function) in the S1 UE (Network Function) network capability information. If the UE (Network Function) supports user plane integrity protection with EPS, and the AMF (Network Function) supports the associated functionality, the AMF (Network Function) indicates this to SMF (Network Function) at PDU Session Establishment using NG-RAN (Network Function). If the UE (Network Function) and AMF (Network Function) support user plane integrity protection with EPS, for PDU Sessions with UP integrity protection of UP Security Enforcement Information set to Required, the SMF (Network Function) may perform the EPS bearer ID allocation procedure as described in TS 23.502 [3] clause 4.11.1.4. If the UE (Network Function) does not support user plane integrity protection with EPS or the AMF (Network Function) does not support the associated functionality, the SMF (Network Function) shall not trigger the EPS bearer ID allocation procedure in clause 4.11.1.4 of TS 23.502 [3].
Unless the UE (Network Function), the serving eNB and the MME support user plane integrity protection with EPS, the SMF (Network Function)+PGW-C shall reject a PDN Connection Establishment using EPS if the UP Security Enforcement Information has UP integrity protection set to Required.
The SMF (Network Function)+PGW-C shall (e.g. based on the received RAT Type) reject a PDN Connection Establishment using GERAN/UTRAN if the UP Security Enforcement Information has UP integrity protection set to Required.
NOTE 2:	This assumes that the optional user plane integrity protection for GPRS specified in Release 13 has not been deployed.
The SMF (Network Function) may, based on local configuration, reject the PDU Session Establishment request depending on the value of the maximum supported data rate per UE (Network Function) for integrity protection.
NOTE 3:	Reasons to reject a PDU Session Establishment request can e.g. be that the UP Integrity Protection is determined to be "Required" while the maximum supported data rate per UE (Network Function) for integrity protection is less than the expected required data rate for the DN (Network Function).
NOTE 4:	The operator can take care to reduce the risk of such rejections when configuring the subscribed User Plane Security Policy for a DNN. For example, the operator may apply integrity protection "Required" only in scenarios where it can be assumed that the UE (Network Function) maximum supported data rate per UE (Network Function) for integrity protection is likely to be adequate for the DN (Network Function).
The User Plane Security Policy provide the same level of information than User Plane Security Enforcement information.
User Plane Security Policy from UDM (Network Function) takes precedence over locally configured User Plane Security Policy.
The User Plane Security Enforcement information may include the maximum supported data rate for integrity protection provided by the UE (Network Function), is communicated from SMF (Network Function) to the NG-RAN (Network Function) for enforcement as part of PDU session related information. If the UP Integrity Protection is determined to be "Required" or "Preferred", the SMF (Network Function) also provides the maximum supported data rate per UE (Network Function) for integrity protection as received in the Integrity protection maximum data rate IE. This takes place at establishment of a PDU Session or at activation of the user plane of a PDU Session. The NG-RAN (Network Function) rejects the establishment of UP resources for the PDU Session when it cannot fulfil User Plane Security Enforcement information with a value of Required. The NG-RAN (Network Function) may also take the maximum supported data rate per UE (Network Function) for integrity protection into account in its decision on whether to accept or reject the establishment of UP resources. In this case the SMF (Network Function) releases the PDU Session. The NG-RAN (Network Function) notifies the SMF (Network Function) when it cannot fulfil a User Plane Security Enforcement with a value of Preferred.
NOTE 5:	For example, the NG-RAN (Network Function) cannot fulfil requirements in User Plane Security Enforcement information with UP integrity protection set to "Required" when it cannot negotiate UP integrity protection with the UE (Network Function).
It is responsibility of the NG-RAN (Network Function) to enforce that the maximum UP integrity protection data rate delivered to the UE (Network Function) in downlink is not exceeding the maximum supported data rate for integrity protection.
It is expected that generally the UP integrity protection data rate applied by the UE (Network Function) in uplink will not exceed the indicated maximum supported data rate, but the UE (Network Function) is not required to perform strict rate enforcement.
User Plane Security Enforcement information and the maximum supported data rate per UE (Network Function) for integrity protection is communicated from source to target NG-RAN (Network Function) node at handover. If the target RAN (Network Function) node cannot support requirements in User Plane Security Enforcement information, the target RAN (Network Function) node rejects the request to set up resources for the PDU Session. In this case the PDU Session is not handed over to the target RAN (Network Function) node and the PDU Session is released.
If the UE (Network Function) or the new eNB or the MME does not indicate support of user plane integrity protection with EPS, PDU Sessions with UP integrity protection of the User Plane Security Enforcement information set to Required are not transferred to EPS as follows:
-	In the case of mobility without N26 (Service-based Interface), the SMF (Network Function)+PGW-C shall reject a PDN connectivity request in EPS with handover indication if the UP integrity protection of the User Plane Security Enforcement is set to Required.
NOTE 6:	As described in clause 5.17.2.3.3, the UE (Network Function) does not know before trying to move a given PDU Session to EPC, whether that PDU session can be transferred to EPC.
-	In the case of idle mode and connected mode mobility with N26 (Service-based Interface) to EPS, or mobility without N26 (Service-based Interface), the SMF (Network Function)+PGW-C ensures that the PDU session is released.
If the UE (Network Function), target eNB and the target MME indicate support of User Plane Integrity Protection with EPS, PDU Sessions with UP integrity protection of the User Plane Security Enforcement information set to Required are transferred from 5GS to EPS according to existing procedures.
For the bearers of PDN Connections with UP integrity protection set to Required, at (both idle mode and connected mode) mobility (including intra-TA mobility) to an eNB that does not support User Plane Integrity Protection with EPS, the MME shall inform the SMF (Network Function)+PGW-C and the SMF (Network Function)+PGW-C ensures that the PDU session is released.
At connected mode mobility from EPS to GERAN/UTRAN or to a part of the EPS that does not support User Plane Integrity Protection, the source E-UTRAN shall ensure that EPS bearers with UP integrity protection of the User Plane Security Enforcement information set to Required are not handed over.
In the case of idle mode mobility from an MME that supports User Plane Integrity Protection, to an MME that does not support User Plane Integrity Protection, the (home) SMF (Network Function)+PGW-C shall trigger (e.g. based on the lack of MME UPIP capability information) the release of the bearers of PDN Connections with UP integrity protection set to Required.
At any (e.g. idle mode) mobility from EPS to GERAN/UTRAN, the (home) SMF (Network Function)+PGW-C shall trigger (e.g. based on the received RAT Type) the release of the bearers of PDN Connections with UP integrity protection set to Required.
PDU Sessions with UP confidentiality protection of the User Plane Security Enforcement information set to Required and UP integrity protection of the User Plane Security Enforcement information not set to Required, are allowed to be handed over to EPS regardless of how UP confidentiality protection applies in EPS.
In the case of dual connectivity, the Integrity Protection is set to "Preferred", the Master NG-RAN (Network Function) node may notify the SMF (Network Function) when it cannot fulfil a User Plane Security Enforcement with a value of Preferred. The SMF (Network Function) handling of the PDU session with respect to the Integrity Protection status is up to SMF (Network Function) implementation decision.
Dual Connectivity involves two radio network nodes in providing radio resources to a given UE (Network Function) (with active radio bearers), while a single N2 (Non-service-based Interface) (Service-based Interface) termination point exists for the UE (Network Function) between an AMF (Network Function) and the RAN (Network Function). The RAN (Network Function) architecture and related functions to support Dual Connectivity is further described in RAN (Network Function) specifications (e.g. TS 37.340 [31]).
In this Release of the specification, the Dual Connectivity function does not apply to the NR RedCap UE (Network Function).
The RAN (Network Function) node at which the N2 (Non-service-based Interface) (Service-based Interface) terminates, performs all necessary N2 (Non-service-based Interface) (Service-based Interface) related functions such as mobility management, relaying of NAS (Protocol) signalling, etc. and manages the handling of user plane connection (e.g. transfer over N3 (Non-service-based Interface) (Service-based Interface)). It is called the Master RAN (Network Function) Node. It may use resources of another RAN (Network Function) node, the Secondary RAN (Network Function) node, to exchange User Plane traffic of an UE (Network Function). Master RAN (Network Function) node takes into account the RSN and/or PDU Session Pair ID to determine if dual connectivity shall be set up and ensure appropriate PDU session handling ensures fully redundant user plane path as described in clause 5.33.2.1.
If the UE (Network Function) has Mobility Restriction (either signalled from the UDM (Network Function), or, locally generated by the Serving PLMN policy in the AMF (Network Function)) the AMF (Network Function) signals these restrictions to the Master RAN (Network Function) Node as Mobility Restriction List; This may prevent the Master RAN (Network Function) node from setting up a Dual Connectivity for an UE (Network Function).
NOTE 1:	Subject to policies in the NG-RAN (Network Function), configuration of Dual Connectivity for a Data Radio Bearer can also be based on the Network Slice that the PDU Session belongs to.
Dual Connectivity provides the possibility for the Master node RAN (Network Function) to request SMF (Network Function):
-	For some or all PDU Sessions of an UE (Network Function): Direct all the DL User Plane traffic of the PDU Session to the either the Master RAN (Network Function) Node or to the Secondary RAN (Network Function) Node. In this case, there is a single N3 (Non-service-based Interface) (Service-based Interface) tunnel termination at the RAN (Network Function) for such PDU Session.
NOTE 2:	The terminating RAN (Network Function) Node, can decide to keep traffic for specific QFI(s) in a PDU Session for a UE (Network Function) on a single RAT, or split them across the two RATs.
-	For some other PDU Sessions of an UE (Network Function): Direct the DL User Plane traffic of some QoS Flows of the PDU Session to the Secondary (respectively Master) RAN (Network Function) Node while the remaining QoS Flows of the PDU Session are directed to the Master (respectively Secondary) RAN (Network Function) Node. In this case there are, irrespective of the number of QoS Flows, two N3 (Non-service-based Interface) (Service-based Interface) tunnel terminations at the RAN (Network Function) for such PDU Session.
The Master RAN (Network Function) may create and change this assignment for the user plane of a PDU Session at any time during the life time of the PDU Session;
In both cases, a single PDU Session Id is used to identify the PDU Session.
Additional functional characteristics are:
-	User location information is based on the identity of the cell that is serving the UE (Network Function) in the Master RAN (Network Function) node. The cell identity of the Primary cell in the secondary RAN (Network Function) node may also be included. NG-RAN (Network Function) includes the user location information in NGAP messages where the contents of the user location information may change during the corresponding procedure.
-	Path update signalling related with Dual Connectivity and UPF (Network Function) re-allocation cannot occur at the same time.
5GC supports interactions towards CHF (Network Function) for network resource usage, as defined in TS 32.240 [41]. The CHF (Network Function) and the Nchf service are defined in TS 32.290 [67].
The SMF (Network Function) supports the interactions towards the CHF (Network Function), as defined in TS 32.255 [68]. The UPF (Network Function) supports functionality to collect and report usage data to SMF (Network Function). The N4 (Service-based Interface) reference point supports the SMF (Network Function) control of the UPF (Network Function) collection and reporting of usage data.
The AMF (Network Function) supports interactions towards the CHF (Network Function), as defined in TS 32.256 [114].
The SMSF (Network Function) supports interactions towards the CHF (Network Function), as defined in TS 32.274 [118].
The NEF (Network Function) supports interactions towards the CHF (Network Function), as defined in TS 32.254 [123].
When NG-RAN (Network Function) is deployed in dual connectivity configuration, the HPLMN or VPLMN operator may wish to record the data volume sent and received on the Secondary RAT.
In order to reduce the complexity of this procedure, the following principles are used in this release:
a)	The PLMN locally activates the Secondary RAT Usage Data Reporting by NG-RAN (Network Function) OAM. The activation is based on configuration in NG-RAN (Network Function) and NG-RAN (Network Function) determines whether the data volume report will contain data volumes consumed for the whole PDU Session or for selected QoS Flows or both as described in TS 38.413 [34].
	The activation can happen separately for Data Volume Reporting of NR in licensed or unlicensed spectrum and E-UTRA in licensed or unlicensed spectrum. If the PLMN uses this feature, it should ensure that this functionality is supported by all NG-RAN (Network Function) nodes that support NR or E-UTRA as a Secondary RAT.
b)	Depending on its configuration the NG-RAN (Network Function) reports uplink and downlink data volumes to the 5GC for the Secondary RAT (including the using of unlicensed spectrum for NR or E-UTRA) for the PDU Session or for selected QoS Flows or both and per time interval.
c)	During Xn handover and N2 (Non-service-based Interface) (Service-based Interface) handover, the source NG-RAN (Network Function) node reports the data volume to the 5GC. The reported data volume excludes data forwarded to the target RAN (Network Function) node.
d)	At the time of NG connection release, Secondary Node change/release, deactivation of UP connection for a PDU Session, the NG-RAN (Network Function) node reports the data volumes to the 5GC.
e)	To assist "partial CDR" generation, NG-RAN (Network Function) OAM can instruct the NG-RAN (Network Function) to also make periodic reports (as described in clause 5.12.3) if no event has triggered a report before the period expires.
NOTE 2:	The timing of these periodic NG-RAN (Network Function) reports is not expected to align with the timing of partial CDR generation. Hence the frequency of NG-RAN (Network Function) reports might be greater than that of partial CDR generation.
NOTE 3:	RAN (Network Function) needs to be able to partition the measurements in a report to indicate usage that occurred before and after an absolute time. An example of the absolute time is that RAN (Network Function) is configured to partition data usage reports that occurred before and after midnight.
Periodic reporting of the Secondary RAT usage data is an optional function. When NG-RAN (Network Function), as defined in bullet e) of clause 5.12.12, is configured with a "time interval for Secondary RAT usage data reporting", the NG-RAN (Network Function) shall send a RAN (Network Function) Usage Data Report message for periodic reporting purposes to the SMF (Network Function) only when the timer expires for a UE (Network Function) for which Secondary RAT usage data reporting is ongoing. The timer runs from the last usage reporting for the UE (Network Function).
Edge computing enables operator and 3rd party services to be hosted close to the UE (Network Function)'s access point of attachment, so as to achieve an efficient service delivery through the reduced end-to-end latency and load on the transport network. Edge Computing support by 5GC is specified in this specification and in TS 23.548 [130].
NOTE: Edge Computing typically applies to non-roaming and LBO roaming scenarios. For HR roaming scenarios, Edge Computing applies only for "Home Routed with Session Breakout in VPLMN (HR-SBO)" which is described in clause 6.7 of TS 23.548 [130].
The 5G Core Network selects a UPF (Network Function) close to the UE (Network Function) and forwards traffic to enable the local access to the DN (Network Function) via a N6 (Non-service-based Interface) (Service-based Interface) interface according to the provided traffic steering rules to the UPF (Network Function). This may be based on the UE (Network Function)'s subscription data, UE (Network Function) location, the information from Application (Protocol) Function (AF (Network Function)) as defined in clause 5.6.7, the EAS information reported from EASDF (Network Function) (as defined in TS 23.548 [130]), policy or other related traffic rules.
Due to user or Application (Protocol) Function mobility, the service or session continuity may be required based on the requirements of the service or the 5G network.
The 5G Core Network may expose network information and capabilities to an Edge Computing Application (Protocol) Function.
NOTE:	Depending on the operator deployment, certain Application (Protocol) Functions can be allowed to interact directly with the Control Plane Network Functions with which they need to interact, while the other Application (Protocol) Functions need to use the external exposure framework via the NEF (Network Function) (see clause 6.2.10 for details).
Edge computing can be supported by one or a combination of the following enablers:
-	User plane (re)selection: the 5G Core Network (re)selects UPF (Network Function) to route the user traffic to the local part of the DN (Network Function) as described in clause 6.3.3;
-	Local Routing and Traffic Steering: the 5G Core Network selects the traffic to be routed to the applications in the local part of the DN (Network Function);
-	this includes the use of a single PDU Session with multiple PDU Session Anchor(s) (UL CL / IP  (Protocol)v6 multi-homing) as described in clause 5.6.4 and the use of a PDU Session with Distributed Anchor Point using SSC mode 2/3.
-	Session and service continuity to enable UE (Network Function) and application mobility as described in clause 5.6.9;
-	An Application (Protocol) Function may influence UPF (Network Function) (re)selection and traffic routing via PCF (Network Function) or NEF (Network Function) as described in clause 5.6.7;
-	Network capability exposure: 5G Core Network and Application (Protocol) Function to provide information to each other via NEF (Network Function) as described in clause 5.20 or directly as described in clause 4.15 of TS 23.502 [3] or from the UPF (Network Function) as described in clause 6.4 of TS 23.548 [130];
-	QoS and Charging: PCF (Network Function) provides rules for QoS Control and Charging for the traffic routed to the local part of the DN (Network Function);
-	Support of Local Area Data Network: 5G Core Network provides support to connect to the LADN in a certain area where the applications are deployed as described in clause 5.6.5.
-	Discovery and re-discovery of Edge Applications Servers as described in TS 23.548 [130].
-	Support of Edge Relocation as described in TS 23.548 [130] and the case of involving AF (Network Function) change as described in clauses 4.3.6.2, 4.3.6.3 and 4.3.6.4 of TS 23.502 [3]. Support of 5GC triggered Edge relocation within the same hosting PLMN's EHEs.
-	Support of (I-)SMF (Network Function) (re)selection based on DNAI as described in clauses 4.3.5.1, 4.3.5.2 and 4.23.5.1 of TS 23.502 [3].
-	Support of finer sets of UEs.
-	Support of common EAS discovery and common DNAI determination for set of UEs as described in clause 6.2 of TS 23.548 [130].
-	Support of mapping information between EAS IP/IP  (Protocol)range and DNAI as described in clause 6.8 of TS 23.548 [130].
-	Support of AF (Network Function) request for DNAI as described in clause 6.8 of TS 23.548 [130].
The policy and charging control framework for the 5G System is defined in TS 23.503 [45].
A Network Slice instance is defined within a PLMN or within an SNPN and shall include:
-	the Core Network Control Plane and User Plane Network Functions, as described in clause 4.2,
and, in the serving PLMN, at least one of the following:
-	the NG-RAN (Network Function) described in TS 38.300 [27];
-	the N3IWF (Network Function) or TNGF (Network Function) functions to the non-3GPP Access Network described in clause 4.2.8.2 or the TWIF (Network Function) functions to the trusted WLAN in the case of support of N5CW devices described in clause 4.2.8.5;
-	the W-AGF (Network Function) function to the Wireline Access Network described in clause 4.2.8.4.
The 5G System deployed in a PLMN shall always support the procedures, information and configurations specified to support Network Slice instance selection in the present document, TS 23.502 [3] and TS 23.503 [45].
NOTE 1:	Management of network slices are described in TS 28.530 [175], the procedures for provisioning of networks and network slices are described in TS 28.531 [176] and TS 28.541 [149] describes the resource model for managing the resources.
Network slicing support for roaming is described in clause 5.15.6.
Network slices may differ for supported features and network functions optimisations, in which case such Network Slices may have e.g. different S-NSSAIs with different Slice/Service Types (see clause 5.15.2.1). The operator can deploy multiple Network Slices delivering exactly the same features but for different groups of UEs, e.g. as they deliver a different committed service and/or because they are dedicated to a customer, in which case such Network Slices may have e.g. different S-NSSAIs with the same Slice/Service Type but different Slice Differentiators (see clause 5.15.2.1).
The network may serve a single UE (Network Function) with one or more Network Slice instances simultaneously via a 5G-AN regardless of the access type(s) over which the UE (Network Function) is registered (i.e. 3GPP Access and/or N3GPP Access). The AMF (Network Function) instance serving the UE (Network Function) logically belongs to each of the Network Slice instances serving the UE (Network Function), i.e. this AMF (Network Function) instance is common to the Network Slice instances serving a UE (Network Function).
NOTE 2:	Number of simultaneous connection of Network Slice instances per UE (Network Function) is limited by the number of S-NSSAIs in the Requested/Allowed NSSAI as described in clause 5.15.2.1.
NOTE 3:	In this Release of the specification it is assumed that in any (home or visited) PLMN it is always possible to select an AMF (Network Function) that can serve any combination of S-NSSAIs that will be provided as an Allowed NSSAI.
The selection of the set of Network Slice instances for a UE (Network Function) is triggered by the first contacted AMF (Network Function) in a Registration procedure normally by interacting with the NSSF (Network Function), and can lead to a change of AMF (Network Function). This is further described in clause 5.15.5.
A PDU Session belongs to one and only one specific Network Slice instance per PLMN. Different Network Slice instances do not share a PDU Session, though different Network Slice instances may have slice-specific PDU Sessions using the same DNN.
During the Handover procedure the source AMF (Network Function) selects a target AMF (Network Function) by interacting with the NRF (Network Function) as specified in clause 6.3.5.
Network Slice-Specific Authentication and Authorization (NSSAA) enables Network Slice specific authentication as described in clause 5.15.10.
Network Slice Admission Control (NSAC) controls the number of registered UEs per network slice, the number of UEs with at least one PDU Session/PDN Connection per network slice in the case of EPC interworking and the number of PDU Sessions per network slice as described in clause 5.15.11.
Support of subscription-based restrictions to simultaneous registration of network slices uses Network Slice Simultaneous Registration Group (NSSRG) information to enable control of which Network Slices that can be registered simultaneously by a UE (Network Function) as described in clause 5.15.12.
Support of data rate limitation per Network Slice for a UE (Network Function) enables enforcement of Maximum Bit Rate per Network Slice for a UE (Network Function) as described in clause 5.15.13.
The selection of N3IWF (Network Function)/TNGF (Network Function) supporting a set of slice(s) is described in clause 6.3.6 and clause 6.3.12 respectively.
The support of Network Slice usage control is described in clause 5.15.15.
Support of Optimized handling of temporarily available network slices is described in clause 5.15.16. It also covers aspects related to graceful release of network slices connectivity during slice decommissioning.
The Partial Network Slice support in a Registration Area is described in clause 5.15.17.
Support for Network Slices with Network Slice Area of Service not matching deployed Tracking Areas is described in clause 5.15.18.
Support of Network Slice Replacement is described in clause 5.15.19.
An S-NSSAI identifies a Network Slice.
An S-NSSAI is comprised of:
-	A Slice/Service type (SST), which refers to the expected Network Slice behaviour in terms of features and services;
-	A Slice Differentiator (SD), which is optional information that complements the Slice/Service type(s) to differentiate amongst multiple Network Slices of the same Slice/Service type.
An S-NSSAI can have standard values (i.e. such S-NSSAI is only comprised of an SST with a standardised SST value, see clause 5.15.2.2, and no SD) or non-standard values (i.e. such S-NSSAI is comprised of either both an SST and an SD or only an SST without a standardised SST value and no SD). An S-NSSAI with a non-standard value identifies a single Network Slice within the PLMN with which it is associated. An S-NSSAI with a non-standard value shall not be used by the UE (Network Function) in access stratum procedures in any PLMN other than the one to which the S-NSSAI is associated.
The S-NSSAIs in the NSSP of the URSP rules (see clause 6.6.2 of TS 23.503 [45]) and in the Subscribed S-NSSAIs (see clause 5.15.3) contain only HPLMN S-NSSAI values.
The S-NSSAIs in the Configured NSSAI, the Allowed NSSAI (see clause 5.15.4.1), the Requested NSSAI (see clause 5.15.5.2.1), the Rejected S-NSSAIs contain only values from the Serving PLMN. The Serving PLMN can be the HPLMN or a VPLMN.
The S-NSSAI(s) in the PDU Session Establishment contain one Serving PLMN S-NSSAI value and in addition may contain a corresponding HPLMN S-NSSAI value to which this first value is mapped (see clause 5.15.5.3). Further information for slice replacement is described in clause 5.15.19.
The optional mapping of Serving PLMN S-NSSAIs to HPLMN S-NSSAIs contains Serving PLMN S-NSSAI values and corresponding mapped HPLMN S-NSSAI values.
The NSSAI is a collection of S-NSSAIs. An NSSAI may be a Configured NSSAI, a Requested NSSAI, Allowed NSSAI or a Partially Allowed NSSAI. There can be at most eight S-NSSAIs in Allowed NSSAI and Requested NSSAI sent in signalling messages between the UE (Network Function) and the Network. There can be at most seven S-NSSAIs in the Partially Allowed NSSAI and at most seven S-NSSAIs rejected partially in the RA, and the sum of S-NSSAIs in the Allowed NSSAI, and the Partially Allowed NSSAI shall be at most eight. The Requested NSSAI signalled by the UE (Network Function) to the network allows the network to select the Serving AMF (Network Function), Network Slice(s) and Network Slice instance(s) for this UE (Network Function), as specified in clause 5.15.5.
NOTE 1:	There can be at most a maximum of seven S-NSSAIs in the Partially Allowed NSSAI since there will always be an Allowed NSSAI allocated.
Based on the operator's operational or deployment needs, a Network Slice instance can be associated with one or more S-NSSAIs, and an S-NSSAI can be associated with one or more Network Slice instances. Multiple Network Slice instances associated with the same S-NSSAI may be deployed in the same or in different Tracking Areas. When multiple Network Slice instances associated with the same S-NSSAI are deployed in the same Tracking Areas, the AMF (Network Function) instance serving the UE (Network Function) may logically belong to (i.e. be common to) more than one Network Slice instance associated with this S-NSSAI.
In a PLMN, when an S-NSSAI is associated with more than one Network Slice instance, one of these Network Slice instances, as a result of the Network Slice instance selection procedure defined in clause 5.15.5, serves a UE (Network Function) that is allowed to use this S-NSSAI. For any S-NSSAI, the network may at any one time serve the UE (Network Function) with only one Network Slice instance associated with this S-NSSAI until cases occur where e.g. this Network Slice instance is no longer valid in a given Registration Area, or a change in UE (Network Function)'s Allowed NSSAI occurs, etc. In such cases, procedures mentioned in clause 5.15.5.2.2 or clause 5.15.5.2.3 apply.
Based on the Requested NSSAI (if any) and the Subscription Information, the 5GC is responsible for selection of a Network Slice instance(s) to serve a UE (Network Function) including the 5GC Control Plane and User Plane Network Functions corresponding to this Network Slice instance(s). The Subscription Information may contain restrictions to the simultaneous registration of network slices. This is provided to the serving AMF (Network Function) as part of the UE (Network Function) subscription, in the form of Network Slice Simultaneous Registration Group (NSSRG) information (see clause 5.15.12).
The (R)AN may use Requested NSSAI in access stratum signalling to handle the UE (Network Function) Control Plane connection before the 5GC informs the (R)AN of the Allowed NSSAI. The Requested NSSAI is used by the RAN (Network Function) for AMF (Network Function) selection, as described in clause 6.3.5. The UE (Network Function) shall not include the Requested NSSAI in the RRC (Protocol) Resume when the UE (Network Function) asks to resume the RRC (Protocol) connection and is CM-CONNECTED with RRC_INACTIVE state.
When a UE (Network Function) is successfully registered over an Access Type, the CN informs the (R)AN by providing the Allowed NSSAI for the corresponding Access Type.
NOTE 2:	The details of how the RAN (Network Function) uses NSSAI information are described in TS 38.300 [27].
Standardized SST values provide a way for establishing global interoperability for slicing so that PLMNs can support the roaming use case more efficiently for the most commonly used Slice/Service Types.
The SSTs which are standardised are in the following Table 5.15.2.2-1.
Table 5.15.2.2-1: Standardised SST values

NOTE 1:	The support of all standardised SST values is not required in a PLMN. Services indicated in this table for each SST value can also be supported by means of other SSTs.
NOTE 2:	A mapping of GSMA defined Network Slice Types (NEST) to standard SST values is defined in GSMA NG.116 [137].
The Subscription Information shall contain one or more S-NSSAIs i.e. Subscribed S-NSSAIs. The subscription information shall include at least one default S-NSSAI. The UDM (Network Function) sends at the most 16 Subscribed S-NSSAIs to AMF (Network Function), i.e. the number that can fit in a Configured NSSAI. The subscription information the UDM (Network Function) sends to the AMF (Network Function) shall include at least one default S-NSSAI.
If an S-NSSAI is marked as default, then the network is expected to serve the UE (Network Function) with a related applicable Network Slice instance when the UE (Network Function) does not send any permitted S-NSSAI to the network in a Registration Request message as part of the Requested NSSAI.
The Subscription Information for each S-NSSAI may contain:
-	a Subscribed DNN list and one default DNN; and
-	the indication whether the S-NSSAI is marked as default Subscribed S-NSSAI; and
-	the indication whether the S-NSSAI is subject to Network Slice-Specific Authentication and Authorization; and
-	Network Slice Simultaneous Usage Group (NSSRG) information (see clause 5.15.12).
The network verifies the Requested NSSAI the UE (Network Function) provides in the Registration Request against the Subscription Information. For the S-NSSAIs subject to Network Slice-Specific Authentication and Authorization the clause 5.15.10 applies.
NOTE 1:	It is recommended that at least one of the Subscribed S-NSSAIs marked as default S-NSSAI is not subject to Network Slice-specific Authentication and Authorization, in order to ensure access to services even when Network Slice-specific Authentication and Authorization fails.
NOTE 2:	It is recommended to minimize the number of Subscribed S-NSSAIs in subscriptions for NB-IoT or NR RedCap capable UEs to minimize overhead for signalling a large number of S-NSSAIs in Requested NSSAI in RRC (Protocol) and NAS (Protocol) via NB-IoT or NR RedCap.
In roaming case, the UDM (Network Function) shall provide to the VPLMN only the S-NSSAIs from the Subscribed S-NSSAIs the HPLMN allows for the UE (Network Function) in the VPLMN. If the UE (Network Function) is subject to restrictions of simultaneous registration of network slices (i.e. if the Subscription Information for the S-NSSAIs contains NSSRG information), the UDM (Network Function) provides to the VPLMN a subscribed S-NSSAIs and, if applicable, NSSRG information, as described in clause 5.15.12.
NOTE 3:	Network slice instances supporting an S-NSSAI subject to Network Slice-Specific Authentication and Authorization need to be deployed with AMFs supporting Network Slice-Specific Authentication and Authorization, otherwise S-NSSAIs requiring Network Slice-Specific Authentication and Authorization would be incorrectly allowed without execution of Network Slice-Specific Authentication and Authorization.
NOTE 4:	Network slice instances supporting an S-NSSAI subject to Network Slice Admission Control (NSAC) for number of registered UE (Network Function) per network slice need to be deployed with AMFs supporting NSAC, otherwise S-NSSAIs requiring NSAC would be incorrectly allowed without execution of NSAC.
When the UDM (Network Function) updates the Subscribed S-NSSAI(s) to the serving AMF (Network Function), based on configuration in this AMF (Network Function), the AMF (Network Function) itself or the NSSF (Network Function) determines the mapping of the Configured NSSAI for the Serving PLMN and/or Allowed NSSAI to the Subscribed S-NSSAI(s). The serving AMF (Network Function) then updates the UE (Network Function) with the above information as described in clause 5.15.4.
The Network Slice configuration information contains one or more Configured NSSAI(s). A Configured NSSAI may either be configured by a Serving PLMN and apply to the Serving PLMN, or may be a Default Configured NSSAI configured by the HPLMN and that applies to any PLMNs for which no specific Configured NSSAI has been provided to the UE (Network Function). There is at most one Configured NSSAI per PLMN.
NOTE 1:	The value(s) used in the Default Configured NSSAI are expected to be commonly decided by all roaming partners, e.g. by the use of values standardized by 3GPP or other bodies.
The Default Configured NSSAI, if it is configured in the UE (Network Function), is used by the UE (Network Function) in a Serving PLMN only if the UE (Network Function) has no Configured NSSAI for the Serving PLMN.
The Configured NSSAI of a PLMN may include S-NSSAIs that have standard values or PLMN-specific values.
The Configured NSSAI for the Serving PLMN includes the S-NSSAI values which can be used in the Serving PLMN and may be associated with mapping of each S-NSSAI of the Configured NSSAI to one or more corresponding HPLMN S-NSSAI values. In the non-roaming case, the network shall not provide any mapped S-NSSAI to the UE (Network Function) with the Configured NSSAI. In the roaming case, the AMF (Network Function) shall provide to the UE (Network Function) the mapping of each S-NSSAI of the Configured NSSAI for the Serving PLMN to the corresponding S-NSSAI values of the HPLMN when providing NSSAI information, as described in TS 24.501 [47].
A UE (Network Function) subscription may contain Network Slice Simultaneous Registration Group (NSSRG) information. If so, the UE (Network Function) configuration is performed as described in clause 5.15.12.2.
The UE (Network Function) may be pre-configured with the Default Configured NSSAI. The UE (Network Function) may be provisioned/updated with the Default Configured NSSAI, determined by the UDM (Network Function) in the HPLMN, using the UE (Network Function) Parameters Update via UDM (Network Function) Control Plane procedure defined in clause 4.20 of TS 23.502 [3]. Each S-NSSAI in the Default Configured NSSAI may have a corresponding S-NSSAI as part of the Subscribed S-NSSAI(s). Consequently, if the Subscribed S-NSSAI(s) which are also present in the Default Configured NSSAI are updated the UDM (Network Function) should update the Default Configured NSSAI in the UE (Network Function).
In the HPLMN, the S-NSSAIs in the Configured NSSAI provided as described in clause 5.15.4.2, at the time when they are provided to the UE (Network Function), shall match the Subscribed S-NSSAIs for the UE (Network Function).
When the Subscribed S-NSSAI(s) are updated (i.e. some existing S-NSSAIs are removed and/or some new S-NSSAIs are added) and one or more are applicable to the Serving PLMN the UE (Network Function) is registered in, as described in clause 5.15.3, or when the associated mapping is updated the AMF (Network Function) shall update the UE (Network Function) with the Configured NSSAI for the Serving PLMN and/or Allowed NSSAI and Partially Allowed NSSAI and/or the associated mapping to HPLMN S-NSSAIs (see clause 5.15.4.2). When there is the need to update the Allowed NSSAI or Partially Allowed NSSAI, the AMF (Network Function) shall provide the UE (Network Function) with the new Allowed NSSAI or Partially Allowed NSSAI and the associated mapping to HPLMN S-NSSAIs, unless the AMF (Network Function) cannot determine the new Allowed NSSAI (e.g. all S-NSSAIs in the old Allowed NSSAI have been removed from the Subscribed S-NSSAIs), in which case the AMF (Network Function) shall not send any Allowed NSSAI to the UE (Network Function) but indicate to the UE (Network Function) to perform a Registration procedure. If the UE (Network Function) is in a CM-IDLE state, the AMF (Network Function) may trigger Network Triggered Service Request or wait until the UE (Network Function) is in a CM-CONNECTED state as described in clause 4.2.4.2, TS 23.502 [3].
When providing a Requested NSSAI to the network upon registration, the UE (Network Function) in a given PLMN only includes and uses S-NSSAIs applying to this PLMN. The mapping of S-NSSAIs of the Requested NSSAI to HPLMN S-NSSAIs may also be provided (see clause 5.15.4.1.2 for when this is needed). The S-NSSAIs in the Requested NSSAI are part of the Configured and/or Allowed NSSAIs applicable for this PLMN, when they are available. If the UE (Network Function) has received NSSRG information together with the Configured NSSAI, it only includes in the Requested NSSAI S-NSSAIs that all share a common NSSRG. If the UE (Network Function) has stored Pending NSSAI and the UE (Network Function) is still interested in the Pending NSSAI then all the S-NSSAIs in the Requested NSSAI and the Pending S-NSSAI shall share a common NSSRG. If no Configured NSSAI and Allowed NSSAI for the PLMN are available, the S-NSSAIs in the Requested NSSAI correspond to the Default Configured NSSAI, if configured in the UE (Network Function). Upon successful completion of a UE (Network Function)'s Registration procedure over an Access Type, the UE (Network Function) obtains from the AMF (Network Function) an Allowed NSSAI or Partially Allowed NSSAI for this Access Type, which includes one or more S-NSSAIs and, if needed (see clause 5.15.4.1.2 for when this is needed), their mapping to the HPLMN S-NSSAIs. These S-NSSAIs are valid for the current Registration Area and Access Type provided by the AMF (Network Function) the UE (Network Function) has registered with and can be used simultaneously by the UE (Network Function) (up to the maximum number of simultaneous Network Slice instances or PDU Sessions).
The UE (Network Function) might also obtain from the AMF (Network Function), one or more rejected S-NSSAIs with cause and validity of rejection. An S-NSSAI may be rejected:
-	for the entire PLMN;
-	for the current Registration Area; or
-	partially in the current Registration Area. Such S-NSSAI rejected partially in the current Registration area is associated with a list of TAs where the S-NSSAI is supported.
The AMF (Network Function) may also reject the use of an S-NSSAI due to congestion as described in clause 5.19.7.4.
While the UE (Network Function) remains RM-REGISTERED in the PLMN and regardless of the Access Type, the UE (Network Function) shall not re-attempt to register to an S-NSSAI rejected for the entire PLMN until this rejected S-NSSAI is deleted as specified below.
While the UE (Network Function) remains RM-REGISTERED in the PLMN, the UE (Network Function) shall not re-attempt to register to an S-NSSAI rejected in the current Registration Area until it moves out of the current Registration Area.
While the UE (Network Function) remains RM-REGISTERED in the PLMN, the UE (Network Function) shall not re-attempt to register to an S-NSSAI rejected partially in the RA until the UE (Network Function) moves into a TA which is in the list of TAs where the S-NSSAI is supported.
NOTE 2:	The details and more cases of S-NSSAI rejection are described in TS 24.501 [47].
S-NSSAIs that the UE (Network Function) provides in the Requested NSSAI which are neither in the Allowed NSSAI nor in the Partially Allowed NSSAI, nor provided as a rejected S-NSSAI, shall, by the UE (Network Function), not be regarded as rejected, i.e. the UE (Network Function) may request to register these S-NSSAIs again next time the UE (Network Function) sends a Requested NSSAI.
The UE (Network Function) stores (S-)NSSAIs as follows:
-	When provisioned with a Configured NSSAI for a PLMN and/or a mapping of Configured NSSAI to HPLMN S-NSSAIs and possibly NSSRG information for each S-NSSAI in the Configured NSSAI (if applicable and supported by the UE (Network Function)), or when requested to remove the configuration due to network slicing subscription change, the UE (Network Function) shall:
-	replace any stored (old) Configured NSSAI for this PLMN with the new Configured NSSAI for this PLMN (if applicable); and
-	delete any stored associated mapping of this old Configured NSSAI for this PLMN to HPLMN S-NSSAIs and, if present and applicable, store the mapping of Configured NSSAI to HPLMN S-NSSAIs; and
-	delete any stored associated NSSRG information for each S-NSSAI of the Configured NSSAI and, if present, store the associated NSSRG information for each S-NSSAI of the Configured NSSAI; and
-	delete any stored rejected S-NSSAI for this PLMN;
-	keep the received Configured NSSAI for a PLMN (if applicable) and associated mapping to HPLMN S-NSSAIs (if applicable) and associated NSSRG information for each S-NSSAI of the Configured NSSAI (if applicable and supported by the UE (Network Function)) stored in the UE (Network Function), even when registering in another PLMN, until a new Configured NSSAI for this PLMN and/or associated mapping are provisioned in the UE (Network Function), or until the network slicing subscription changes, as described in clause 5.15.4.2. The number of Configured NSSAIs and associated mapping to be kept stored in the UE (Network Function) for PLMNs other than the HPLMN is up to UE (Network Function) implementation. A UE (Network Function) shall at least be capable of storing a Configured NSSAI for the serving PLMN including any necessary mapping of the Configured NSSAI for the Serving PLMN to HPLMN S-NSSAIs and the Default Configured NSSAI.
-	The Allowed NSSAI received in a Registration Accept message or a UE (Network Function) Configuration Update Command applies to a PLMN when at least a TAI of this PLMN is included in the RA/TAI list included in this Registration Accept message or UE (Network Function) Configuration Update Command. If the UE (Network Function) Configuration Update Command contains an Allowed NSSAI but not a TAI List, then the last received RA/TAI list applies for the decision on which PLMN(s) the Allowed NSSAI is applicable. If received, the Allowed NSSAI for a PLMN and Access Type and any associated mapping of this Allowed NSSAI to HPLMN S-NSSAIs shall be stored in the UE (Network Function). The UE (Network Function) should store this Allowed NSSAI and any associated mapping of this Allowed NSSAI to HPLMN S-NSSAIs also when the UE (Network Function) is turned off, or until the network slicing subscription changes, as described in clause 5.15.4.2:
NOTE 3:	Whether the UE (Network Function) stores the Allowed NSSAI and any associated mapping of the Allowed NSSAI to HPLMN S-NSSAIs also when the UE (Network Function) is turned off is left to UE (Network Function) implementation.
-	When a new Allowed NSSAI for a PLMN and any associated mapping of the Allowed NSSAI to HPLMN S-NSSAIs are received over an Access Type, the UE (Network Function) shall:
-	replace any stored (old) Allowed NSSAI and any associated mapping for these PLMN and Access Type with this new Allowed NSSAI; and
-	delete any stored associated mapping of this old Allowed NSSAI for this PLMN to HPLMN S-NSSAIs and, if present, store the associated mapping of this new Allowed NSSAI to HPLMN S-NSSAIs;
-	If received, a Partially Allowed NSSAI received in a Registration Accept message or a UE (Network Function) Configuration Update Command message applies to the current Registration Area. The UE (Network Function) stores the Partially Allowed NSSAI in the same way as described for the Allowed NSSAI (see also clause 5.15.17).
-	If received, an S-NSSAI rejected for the entire PLMN shall be stored in the UE (Network Function) while RM-REGISTERED in this PLMN regardless of the Access Type or until it is deleted.
-	If received, an S-NSSAI rejected for the current Registration Area shall be stored in the UE (Network Function) while RM-REGISTERED until the UE (Network Function) moves out of the current Registration Area or until the S-NSSAI is deleted.
-	If received, an S-NSSAI rejected partially in the RA shall be stored in the UE (Network Function) while RM-REGISTERED until the UE (Network Function) moves out of the current Registration Area or until the S-NSSAI is deleted (see also clause 5.15.17).
NOTE 4:	The storage aspects of rejected S-NSSAIs are described in TS 24.501 [47].
-	If received, the Pending NSSAI shall be stored in the UE (Network Function) as described in TS 24.501 [47].
-	If received, the S-NSSAI validity time information shall be stored in the UE (Network Function) in the UE (Network Function) as described in TS 24.501 [47].
-	If received, the S-NSSAI location availability information shall be stored in the UE (Network Function) as described in TS 24.501 [47].
-	If received, the mapping of old S-NSSAI to the Alternative S-NSSAI shall be stored in the UE (Network Function) as described in TS 24.501 [47].
UE (Network Function) configuration to guide UE (Network Function) selection of a N3IWF (Network Function)/TNGF (Network Function) that supports the S-NSSAIs needed by the UE (Network Function) is defined in clause 6.3.6 and clause 6.3.12 respectively.
For the roaming case, one or more S-NSSAIs in an Allowed NSSAI provided to the UE (Network Function) can have values which are not part of the UE (Network Function)'s current Network Slice configuration information for the Serving PLMN. In this case, the network provides the Allowed NSSAI together with the mapping of each S-NSSAI of the Allowed NSSAI to the corresponding S-NSSAI of the HPLMN. This mapping information allows the UE (Network Function) to associate Applications to S-NSSAIs of the HPLMN as per NSSP of the URSP rules or as per the UE (Network Function) Local Configuration, as defined in clause 6.1.2.2.1 of TS 23.503 [45] and to the corresponding S-NSSAI from the Allowed NSSAI.
In the non-roaming case, the network shall not provide any mapped S-NSSAI to the UE (Network Function) with the Allowed NSSAI.
In roaming case, the UE (Network Function) shall provide in the Requested NSSAI the mapping of S-NSSAIs of the Serving PLMN values to the corresponding S-NSSAI values of the HPLMN, for each S-NSSAI in the Requested NSSAI for which a mapping is available. These values are found in the mapping previously received from the Serving PLMN of the S-NSSAIs of the Configured NSSAI for the Serving PLMN or of the S-NSSAIs of the Allowed NSSAI for the Serving PLMN and Access Type to the corresponding S-NSSAIs values used in the HPLMN.
If the AMF (Network Function) provides Partially Allowed NSSAI to the UE (Network Function), in roaming case the AMF (Network Function) may provide the mapping information of each S-NSSAI of the Partially Allowed NSSAI to the corresponding HPLMN S-NSSAI as described in clause 5.15.17.
At any time, the AMF (Network Function) may provide the UE (Network Function) with a new Configured NSSAI for the Serving PLMN, associated with mapping of the Configured NSSAI to HPLMN S-NSSAIs as specified in clause 5.15.4.1. The Configured NSSAI for the Serving PLMN and the mapping information is either determined in the AMF (Network Function) (if based on configuration, the AMF (Network Function) is allowed to determine the Network Slice configuration for the whole PLMN) or by the NSSF (Network Function). The AMF (Network Function) provides an updated Configured NSSAI as specified in clause 4.2.4 of TS 23.502 [3], UE (Network Function) Configuration Update procedure.
If an S-NSSAI is to be stopped to be used, e.g. due to the network slice is to be deleted as described in TS 28.541 [149], the AMFs may reject UE (Network Function) requests for the S-NSSAI based on the OAM state before the network slice becomes unavailable. The AMF (Network Function) may based on operator policies (e.g. when there is no timing information related to the termination or the AMF (Network Function) or UE (Network Function) does not support the timing information as described in in clause 5.15.16), release PDU Sessions associated with the S-NSSAI, and remove the S-NSSAI from e.g. the Allowed NSSAI and the Configured NSSAI before the Network Slice becomes unavailable. The AMF (Network Function) may use the timing information as described in clause 5.15.16 if it supports this feature and set validity time of the S-NSSAI accordingly.
The AMF (Network Function) shall provide the UE (Network Function) with NSSRG information alongside the Configured NSSAI if NSSRG information is included in the subscription information received from the UDM (Network Function) and if the UE (Network Function) has indicated support for the feature as part of the registration request, see clause 5.15.12.
The AMF (Network Function) may provide the UE (Network Function) with the mapping of old S-NSSAI to the Alternative S-NSSAI if the UE (Network Function) has indicated support for the feature as part of the registration request, see clause 5.15.19.
If the HPLMN performs the configuration update of a UE (Network Function) registered in the HPLMN (e.g. due to a change in the Subscribed S-NSSAI(s) or due to a change of NSSRG information), this results in updates to the Configured NSSAI for the HPLMN and, if applicable, NSSRG information for each S-NSSAI of the Configured NSSAI. Updates to the Allowed NSSAI and/or, if present, to the associated mapping of the Allowed NSSAI to HPLMN S-NSSAIs are also possible if the configuration update affects S-NSSAI(s) in the current Allowed NSSAI.
If the VPLMN performs the configuration update of a UE (Network Function) registered in the VPLMN (e.g. due to a change in the Subscribed S-NSSAI(s), the associated mapping is updated, or due to a change of NSSRG information), this results in updates to the Configured NSSAI for the Serving PLMN and/or to the associated mapping of the Configured NSSAI for the Serving PLMN to HPLMN S-NSSAIs and, if applicable, NSSRG information for each S-NSSAI of the Configured NSSAI. Updates to the Allowed NSSAI and/or to the associated mapping of the Allowed NSSAI to HPLMN S-NSSAIs are also possible if the configuration update affects S-NSSAI(s) in the current Allowed NSSAI.
A UE (Network Function) for which the Configured NSSAI for the Serving PLMN has been updated as described in clause 5.15.4.1 and has been requested to perform a Registration procedure, shall initiate a Registration procedure to receive a new valid Allowed NSSAI (see clause 5.15.5.2.2).
When the subscribed S-NSSAIs change, a UDR (Network Function) flag is set in the HPLMN to make sure the current PLMN (or, if the UE (Network Function) was not reachable, the next serving PLMN) is informed by the UDM (Network Function) that the subscription data for network slicing has changed. The AMF (Network Function), when it receives the indication from the UDM (Network Function) subscription has changed, indicates the UE (Network Function) that subscription has changed and uses any updated subscription information from the UDM (Network Function) to update the UE (Network Function). Once the AMF (Network Function) updates the UE (Network Function) and obtains an acknowledgment from the UE (Network Function), the AMF (Network Function) informs the UDM (Network Function) that the configuration update was successful and the UDM (Network Function) clears the flag in the UDR (Network Function). If the UE (Network Function) is in a CM-IDLE state, the AMF (Network Function) may trigger Network Triggered Service Request or wait until the UE (Network Function) is in a CM-CONNECTED state as described in clause 4.2.4.2, TS 23.502 [3].
If the UE (Network Function) receives indication from the AMF (Network Function) that Network Slicing subscription has changed, the UE (Network Function) locally deletes the network slicing information it has for all PLMNs, except the Default Configured NSSAI (if present). It also updates the current PLMN network slicing configuration information with any received values from the AMF (Network Function).
The update of URSP rules (which include the NSSP), if necessary at any time, is described in TS 23.503 [45].
The establishment of User Plane connectivity to a Data Network via a Network Slice instance(s) comprises two steps:
-	performing a RM procedure to select an AMF (Network Function) that supports the required Network Slices.
-	establishing one or more PDU Session to the required Data network via the Network Slice instance(s).
When a UE (Network Function) registers over an Access Type with a PLMN, if the UE (Network Function) has either or both of:
-	a Configured NSSAI for this PLMN;
-	an Allowed NSSAI for this PLMN and Access Type;
the UE (Network Function) shall provide to the network, in AS layer under the conditions described in clause 5.15.9 and in NAS (Protocol) layer, a Requested NSSAI containing the S-NSSAI(s) corresponding to the Network Slice(s) to which the UE (Network Function) wishes to register, unless they are stored in the UE (Network Function) in the Pending NSSAI.
The Requested NSSAI shall be one of:
-	the Default Configured NSSAI, i.e. if the UE (Network Function) has no Configured NSSAI nor an Allowed NSSAI for the serving PLMN;
-	the Configured-NSSAI, or a subset thereof as described below, e.g. if the UE (Network Function) has no Allowed NSSAI for the Access Type for the serving PLMN;
-	the Allowed-NSSAI for the Access Type over which the Requested NSSAI is sent, or a subset thereof; or
-	the Allowed-NSSAI for the Access Type over which the Requested NSSAI is sent, or a subset thereof, plus one or more S-NSSAIs from the Configured-NSSAI not yet in the Allowed NSSAI for the Access Type as described below.
NOTE 1:	If the UE (Network Function) wishes to register only a subset of the S-NSSAIs from the Configured NSSAI or the Allowed NSSAI, to be able to register with some Network Slices e.g. to establish PDU Sessions for some application(s), and the UE (Network Function) uses the URSP rules (which includes the NSSP) or the UE (Network Function) Local Configuration as defined in clause 6.1.2.2.1 of TS 23.503 [45], then the UE (Network Function) uses applicable the URSP rules or the UE (Network Function) Local Configuration to ensure that the S-NSSAIs included in the Requested NSSAI are not in conflict with the URSP rules or with the UE (Network Function) Local Configuration.
The subset of S-NSSAIs in the Configured-NSSAI provided in the Requested NSSAI consists of one or more S-NSSAI(s) in the Configured NSSAI applicable to this PLMN, if one is present, and for which no corresponding S-NSSAI is already present in the Allowed NSSAI for the access type for this PLMN. The UE (Network Function) shall not include in the Requested NSSAI any S-NSSAI that is currently rejected by the network (i.e. rejected in the current registration area or rejected in the PLMN). For the registration to a PLMN for which neither a Configured NSSAI applicable to this PLMN or an Allowed NSSAI are present, the S-NSSAIs provided in the Requested NSSAI correspond to the S-NSSAI(s) in the Default Configured NSSAI unless the UE (Network Function) has HPLMN S-NSSAI for established PDU Session(s) in which case the HPLMN S-NSSAI(s) shall be provided in the mapping of Requested NSSAI in the NAS (Protocol) Registration Request message, with no corresponding VPLMN S-NSSAI in the Requested NSSAI. If the UE (Network Function) has been provided with NSSRG information together with the Configured NSSAI, the UE (Network Function) only includes in the Requested NSSAI S-NSSAIs that share a common NSSRG, see clause 5.15.12.2. If the UE (Network Function) has stored Pending NSSAI and the UE (Network Function) is still interested in the Pending NSSAI then all the S-NSSAIs in the Requested NSSAI and the Pending S-NSSAI shall share a common NSSRG.
When a UE (Network Function) registers over an Access Type with a PLMN, the UE (Network Function) shall also indicate in the Registration Request message when the Requested NSSAI is based on the Default Configured NSSAI.
The UE (Network Function) shall include the Requested NSSAI in the RRC (Protocol) Connection Establishment and in the establishment of the connection to the N3IWF (Network Function)/TNGF (Network Function) (as applicable) and in the NAS (Protocol) Registration procedure messages subject to conditions set out in clause 5.15.9. However, the UE (Network Function) shall not indicate any NSSAI in RRC (Protocol) Connection Establishment or Initial NAS (Protocol) message unless it has either a Configured NSSAI for the corresponding PLMN, an Allowed NSSAI for the corresponding PLMN and Access Type, or the Default Configured NSSAI. If the UE (Network Function) has HPLMN S-NSSAI(s) for established PDU Session(s), the HPLMN S-NSSAI(s) shall be provided in the mapping of Requested NSSAI in the NAS (Protocol) Registration Request message, independent of whether the UE (Network Function) has the corresponding VPLMN S-NSSAI. The (R)AN shall route the NAS (Protocol) signalling between this UE (Network Function) and an AMF (Network Function) selected using the Requested NSSAI obtained during RRC (Protocol) Connection Establishment or connection to N3IWF (Network Function)/TNGF (Network Function) respectively. If the (R)AN is unable to select an AMF (Network Function) based on the Requested NSSAI, it routes the NAS (Protocol) signalling to an AMF (Network Function) from a set of default AMFs. In the NAS (Protocol) signalling, if the UE (Network Function) is roaming, the UE (Network Function) provides the mapping of each S-NSSAI of the Requested NSSAI to a corresponding HPLMN S-NSSAI.
When a UE (Network Function) registers with a PLMN, if for this PLMN the UE (Network Function) has not included a Requested NSSAI nor a GUAMI while establishing the connection to the (R)AN, the (R)AN shall route all NAS (Protocol) signalling from/to this UE (Network Function) to/from a default AMF (Network Function). When receiving from the UE (Network Function) a Requested NSSAI and a 5G-S-TMSI or a GUAMI in RRC (Protocol) Connection Establishment or in the establishment of connection to N3IWF (Network Function)/TNGF (Network Function), if the 5G-AN can reach an AMF (Network Function) corresponding to the 5G-S-TMSI or GUAMI, then 5G-AN forwards the request to this AMF (Network Function). Otherwise, the 5G-AN selects a suitable AMF (Network Function) based on the Requested NSSAI provided by the UE (Network Function) and forwards the request to the selected AMF (Network Function). If the 5G-AN is not able to select an AMF (Network Function) based on the Requested NSSAI, then the request is sent to a default AMF (Network Function).
When the AMF (Network Function) selected by the AN during Registration Procedure receives the UE (Network Function) Registration request, or after an AMF (Network Function) selection by MME (i.e. during EPS to 5GS handover) the AMF (Network Function) receives S-NSSAI(s) from SMF (Network Function)+PGW-C in 5GC:
-	As part of the Registration procedure described in clause 4.2.2.2.2 of TS 23.502 [3], or as part of the EPS to 5GS handover using N26 (Service-based Interface) interface procedure described in clause 4.11.1.2.2 of TS 23.502 [3], the AMF (Network Function) may query the UDM (Network Function) to retrieve UE (Network Function) subscription information including the Subscribed S-NSSAIs.
-	The AMF (Network Function) verifies whether the S-NSSAI(s) in the Requested NSSAI or the S-NSSAI(s) received from SMF (Network Function)+PGW-C are permitted based on the Subscribed S-NSSAIs (to identify the Subscribed S-NSSAIs the AMF (Network Function) may use the mapping to HPLMN S-NSSAIs provided by the UE (Network Function), in the NAS (Protocol) message, for each S-NSSAI of the Requested NSSAI).
-	When the UE (Network Function) context in the AMF (Network Function) does not yet include an Allowed NSSAI for the corresponding Access Type, the AMF (Network Function) queries the NSSF (Network Function) (see (B) below for subsequent handling), except in the case when, based on configuration in this AMF (Network Function), the AMF (Network Function) is allowed to determine whether it can serve the UE (Network Function) (see (A) below for subsequent handling). The IP  (Protocol)address or FQDN of the NSSF (Network Function) is locally configured in the AMF (Network Function).
NOTE 2:	The configuration in the AMF (Network Function) depends on operator's policy.
-	When the UE (Network Function) context in the AMF (Network Function) already includes an Allowed NSSAI for the corresponding Access Type, based on the configuration for this AMF (Network Function), the AMF (Network Function) may be allowed to determine whether it can serve the UE (Network Function) (see (A) below for subsequent handling).
-	AMF (Network Function) or NSSF (Network Function) may have previously subscribed to slice load level and/or Observed Service Experience and/or Dispersion Analytics related network data analytics for a Network Slice from NWDAF (Network Function), optionally for an Area of Interest composed of one or several TAIs. If AMF (Network Function) subscribes to analytics, AMF (Network Function) may determine that it cannot serve the UE (Network Function) based on received analytics (see (A) below). If AMF (Network Function) subscribes to notifications on changes on the Network Slice or Network Slice instance availability information from NSSF (Network Function) optionally indicating a list of supported TAIs, it may determine that it cannot serve the UE (Network Function) after the restriction notification is received (see (A) below). If AMF (Network Function) does not subscribe to notifications on changes on the availability information from NSSF (Network Function), NSSF (Network Function) may take the analytics information into account when AMF (Network Function) queries NSSF (Network Function) (see (B) below).
NOTE 3:	The configuration in the AMF (Network Function) depends on the operator's policy.
(A) Depending on fulfilling the configuration as described above, the AMF (Network Function) may be allowed to determine whether it can serve the UE (Network Function), and the following is performed:
-	For the mobility from EPS to 5GS, the AMF (Network Function) first derives the serving PLMN value(s) of S-NSSAI(s) based on the HPLMN S-NSSAI(s) in the mapping of Requested NSSAI (in CM-IDLE state) or the HPLMN S-NSSAI(s) received from SMF (Network Function)+PGW-C (in CM-CONNECTED state). After that the AMF (Network Function) regards the derived value(s) as the Requested NSSAI.
-	For the inter PLMN within 5GC mobility, the new AMF (Network Function) derives the serving PLMN value(s) of S-NSSAI(s) based on the HPLMN S-NSSAI(s) in the mapping of Requested NSSAI. After that the AMF (Network Function) regards the derived value(s) as the Requested NSSAI.
-	AMF (Network Function) checks whether it can serve all the S-NSSAI(s) from the Requested NSSAI present in the Subscribed S-NSSAIs (potentially using configuration for mapping S-NSSAI values between HPLMN and Serving PLMN), or all the S-NSSAI(s) marked as default in the Subscribed S-NSSAIs in the case that no Requested NSSAI was provided or none of the S-NSSAIs in the Requested NSSAI are permitted, i.e. do not match any of the Subscribed S-NSSAIs or not available at the current UE (Network Function)'s Tracking Area (see clause 5.15.3).
-	If AMF (Network Function) has subscribed to slice load level and/or Observed Service Experience and/or Dispersion Analytics related network data analytics for a Network Slice from NWDAF (Network Function), or if AMF (Network Function) had received a Network Slice restriction from NSSF (Network Function) that applies to the list of TAIs supported by the AMF (Network Function), it may use that information to determine whether the AMF (Network Function) can serve the UE (Network Function) on the S-NSSAI(s) in the Requested NSSAI.
-	If the AMF (Network Function) can serve the S-NSSAIs in the Requested NSSAI, the AMF (Network Function) remains the serving AMF (Network Function) for the UE (Network Function). The Allowed NSSAI is then composed of the list of S-NSSAI(s) in the Requested NSSAI permitted based on the Subscribed S-NSSAIs and/or the list of S-NSSAI(s) for the Serving PLMN which are mapped to the HPLMN S-NSSAI(s) provided in the mapping of Requested NSSAI permitted based on the Subscribed S-NSSAIs, or, if neither Requested NSSAI nor the mapping of Requested NSSAI was provided or none of the S-NSSAIs in the Requested NSSAI are permitted, all the S-NSSAI(s) marked as default in the Subscribed S-NSSAIs and taking also into account the availability of the Network Slice instances as described in clause 5.15.8 that are able to serve the S-NSSAI(s) in the Allowed NSSAI in the current UE (Network Function)'s Tracking Areas in addition to any Network Slice instance restriction for the S-NSSAI(s) in the Allowed NSSAI provided by the NSSF (Network Function). If the AMF (Network Function) has received NSSRG Information for the Subscribed S-NSSAIs as part of the UE (Network Function) subscription information, it shall only include in the Allowed NSSAI S-NSSAIs that all share a common NSSRG (see clause 5.15.12). If at least one S-NSSAI in the Requested NSSAI is not available in the current UE (Network Function)'s Tracking Area, then either the AMF (Network Function) may determine a Target NSSAI or step (B) is executed. The AMF (Network Function) also determines the mapping if the S-NSSAI(s) included in the Allowed NSSAI needs to be mapped to Subscribed S-NSSAI(s) values. If no Requested NSSAI is provided, or the mapping of the S-NSSAIs in Requested NSSAI to HPLMN S-NSSAIs is incorrect, or the Requested NSSAI includes an S-NSSAI that is not valid in the Serving PLMN, or the UE (Network Function) indicated that the Requested NSSAI is based on the Default Configured NSSAI, the AMF (Network Function), based on the Subscribed S-NSSAI(s) and operator's configuration, may also determine the Configured NSSAI for the Serving PLMN and, if applicable, the associated mapping of the Configured NSSAI to HPLMN S-NSSAIs, so these can be configured in the UE (Network Function). Then Step (C) is executed.
-	Else, the AMF (Network Function) queries the NSSF (Network Function) (see (B) below).
(B) When required as described above, the AMF (Network Function) needs to query the NSSF (Network Function), and the following is performed:
-	The AMF (Network Function) queries the NSSF (Network Function), with Requested NSSAI, Default Configured NSSAI Indication, mapping of Requested NSSAI to HPLMN S-NSSAIs, the Subscribed S-NSSAIs (with an indication if marked as default S-NSSAI), NSSRG Information (if provided by the UDM (Network Function), see clause 5.15.12), any Allowed NSSAI it might have for the other Access Type (including its mapping to HPLMN S-NSSAIs), PLMN ID of the SUPI and UE (Network Function)'s current Tracking Area. If the AMF (Network Function) has pending NSSAI for the UE (Network Function) then the AMF (Network Function) includes pending NSSAI in the Requested NSSAI.
-	Based on this information, local configuration, and other locally available information including RAN (Network Function) capabilities in the current Tracking Area for the UE (Network Function) or load level information for a Network Slice instance provided by the NWDAF (Network Function), the NSSF (Network Function) does the following:
-	It verifies which S-NSSAI(s) in the Requested NSSAI are permitted based on comparing the Subscribed S-NSSAIs with the S-NSSAIs in the mapping of Requested NSSAI to HPLMN S-NSSAIs. It considers the S-NSSAI(s) marked as default in the Subscribed S-NSSAIs in the case that no Requested NSSAI was provided or no S-NSSAI from the Requested NSSAI are permitted i.e. are not present in the Subscribed S-NSSAIs or not available e.g. at the current UE (Network Function)'s Tracking Area. If NSSRG information is provided, the NSSF (Network Function) only selects S-NSSAIs that share a common NSSRG (see clause 5.15.12).
-	If AMF (Network Function) has not subscribed to notifications on changes on the Network Slice or Network Slice instance availability information from NSSF (Network Function) and NSSF (Network Function) has subscribed to slice load level and/or Observed Service Experience and/or Dispersion Analytics related network data analytics for a Network Slice from NWDAF (Network Function), NSSF (Network Function) may use the analytics information for the determination of the (Network Slice instance(s) and the) list of S-NSSAI(s) in the Allowed NSSAI(s) to serve the UE (Network Function).
-	It selects the Network Slice instance(s) to serve the UE (Network Function). When multiple Network Slice instances in the UE (Network Function)'s Tracking Area are able to serve a given S-NSSAI, based on operator's configuration, the NSSF (Network Function) may select one of them to serve the UE (Network Function), or the NSSF (Network Function) may defer the selection of the Network Slice instance until a NF (Network Function)/service within the Network Slice instance needs to be selected.
-	It determines the target AMF (Network Function) Set to be used to serve the UE (Network Function), or, based on configuration, the list of candidate AMF (Network Function)(s), possibly after querying the NRF (Network Function).
NOTE 4:	If the target AMF (Network Function)(s) returned from the NSSF (Network Function) is the list of candidate AMF (Network Function)(s), the Registration Request message can only be redirected via the direct signalling between the initial AMF (Network Function) and the selected target AMF (Network Function) as described in clause 5.15.5.2.3. The NSSF (Network Function) does not provide the target AMF (Network Function)(s), when it provides a Target NSSAI in order to redirect or handover the UE (Network Function) to a cell of another TA as described in clause 5.3.4.3.3.
-	It determines the Allowed NSSAI(s) for the applicable Access Type, composed of the list of S-NSSAI(s) in the Requested NSSAI permitted based on the Subscribed S-NSSAIs and/or the list of S-NSSAI(s) for the Serving PLMN which are mapped to the HPLMN S-NSSAIs provided in the mapping of Requested NSSAI permitted based on the Subscribed S-NSSAIs, or, if neither Requested NSSAI nor the mapping of Requested NSSAI was provided or none of the S-NSSAIs in the Requested NSSAI are permitted, all the S-NSSAI(s) marked as default in the Subscribed S-NSSAIs, and taking also into account the availability of the Network Slice instances as described in clause 5.15.8 that are able to serve the S-NSSAI(s) in the Allowed NSSAI in the current UE (Network Function)'s Tracking Areas. If NSSRG information applies, the NSSF (Network Function) only selects S-NSSAIs that share a common NSSRG (see clause 5.15.12).
-	It also determines the mapping of each S-NSSAI of the Allowed NSSAI(s) to the Subscribed S-NSSAIs if necessary.
-	Based on operator configuration, the NSSF (Network Function) may determine the NRF (Network Function)(s) to be used to select NFs/services within the selected Network Slice instance(s).
-	Additional processing to determine the Allowed NSSAI(s) in roaming scenarios and the mapping to the Subscribed S-NSSAIs, as described in clause 5.15.6.
-	If no Requested NSSAI is provided or the Requested NSSAI includes an S-NSSAI that is not valid in the Serving PLMN, or the mapping of the S-NSSAIs in Requested NSSAI to HPLMN S-NSSAIs is incorrect, or the Default Configured NSSAI Indication is received from AMF (Network Function), the NSSF (Network Function) based on the Subscribed S-NSSAI(s) and operator configuration may also determine the Configured NSSAI for the Serving PLMN and, if applicable, the associated mapping of the Configured NSSAI to HPLMN S-NSSAIs, so these can be configured in the UE (Network Function).
-	If at least one S-NSSAI in the Requested NSSAI is not available in the current UE (Network Function)'s Tracking Area, the NSSF (Network Function) may provide a Target NSSAI for the purpose of allowing the NG-RAN (Network Function) to redirect the UE (Network Function) to a cell of a TA in another frequency band supporting network slices not available in the current TA as described in clause 5.3.4.3.3.
-	The NSSF (Network Function) returns to the current AMF (Network Function) the Allowed NSSAI for the applicable Access Type, the mapping of each S-NSSAI of the Allowed NSSAI to the Subscribed S-NSSAIs if determined and the target AMF (Network Function) Set, or, based on configuration, the list of candidate AMF (Network Function)(s). The NSSF (Network Function) may return the NRF (Network Function)(s) to be used to select NFs/services within the selected Network Slice instance(s), and the NRF (Network Function) to be used to determine the list of candidate AMF (Network Function)(s) from the AMF (Network Function) Set. The NSSF (Network Function) may return NSI ID(s) to be associated to the Network Slice instance(s) corresponding to certain S-NSSAIs. NSSF (Network Function) may return the rejected S-NSSAI(s) as described in clause 5.15.4.1. The NSSF (Network Function) may return the Configured NSSAI for the Serving PLMN and the associated mapping of the Configured NSSAI to HPLMN S-NSSAIs. The NSSF (Network Function) may return Target NSSAI as described in clause 5.3.4.3.3.
-	Depending on the available information and based on configuration, the AMF (Network Function) may query the appropriate NRF (Network Function) (e.g. locally pre-configured or provided by the NSSF (Network Function)) with the target AMF (Network Function) Set. The NRF (Network Function) returns a list of candidate AMFs.
-	If AMF (Network Function) Re-allocation is necessary, the current AMF (Network Function) reroutes the Registration Request or forwards the UE (Network Function) context to a target serving AMF (Network Function) as described in clause 5.15.5.2.3.
-	Step (C) is executed.
(C) The serving AMF (Network Function) shall determine a Registration Area such that all S-NSSAIs of the Allowed NSSAI for this Registration Area are available in all Tracking Areas of the Registration Area (and also considering other aspects as described in clause 5.3.2.3 and clause 5.3.4.3.3) and then return to the UE (Network Function) this Allowed NSSAI and the mapping of the Allowed NSSAI to the Subscribed S-NSSAIs if provided. The AMF (Network Function) may return the rejected S-NSSAI(s) as described in clause 5.15.4.1.
NOTE 5:	The S-NSSAIs in the Allowed NSSAI for Non-3GPP access are available homogeneously "in the PLMN" for the N3IWF (Network Function) case since a N3IWF (Network Function) providing access to a 5GC can be reached from any IP  (Protocol)location. For other types of Non-3GPP access the S-NSSAIs in the Allowed NSSAI for Non-3GPP access can be not available homogeneously, for example different W-AGFs/TNGF (Network Function)(s) can be deployed in different locations and support different TAIs that support different network slices.
When either no Requested NSSAI was included, or the mapping of the S-NSSAIs in Requested NSSAI to HPLMN S-NSSAIs is incorrect, or a Requested NSSAI is not considered valid in the PLMN and as such at least one S-NSSAI in the Requested NSSAI was rejected as not usable by the UE (Network Function) in the PLMN, or the UE (Network Function) indicated that the Requested NSSAI is based on the Default Configured NSSAI, the AMF (Network Function) may update the UE (Network Function) slice configuration information for the PLMN as described in clause 5.15.4.2.
If the Requested NSSAI does not include S-NSSAIs which map to S-NSSAIs of the HPLMN subject to Network Slice-Specific Authentication and Authorization and the AMF (Network Function) determines that no S-NSSAI can be provided in the Allowed NSSAI for the UE (Network Function) in the current UE (Network Function)'s Tracking Area and if no default S-NSSAI(s) could be added as described in step (A), the AMF (Network Function) shall reject the UE (Network Function) Registration and shall include in the rejection message the list of Rejected S-NSSAIs, each of them with the appropriate rejection cause value.
If the Requested NSSAI includes S-NSSAIs which map to S-NSSAIs of the HPLMN subject to Network Slice-Specific Authentication and Authorization, the AMF (Network Function) shall include in the Registration Accept message an Allowed NSSAI containing only those S-NSSAIs that are not to be subject to Network Slice-Specific Authentication and Authorization and, based on the UE (Network Function) Context in AMF (Network Function), those S-NSSAIs for which Network Slice-Specific Authentication and Authorization for at least one of the corresponding HPLMN S-NSSAIs succeeded previously regardless the Access Type, if any.
The AMF (Network Function) shall also provide the list of Rejected S-NSSAIs, each of them with the appropriate rejection cause value.
If the AMF (Network Function) determined the Target NSSAI or received a Target NSSAI from the NSSF (Network Function), the AMF (Network Function) should provide the Target NSSAI to the PCF (Network Function) for retrieving a corresponding RFSP as described in clause 5.3.4.3.1 or, if the PCF (Network Function) is not deployed, the AMF (Network Function) should determine a corresponding RFSP based on local configuration. Then the AMF (Network Function) provides the Target NSSAI and the corresponding RFSP to the NG-RAN (Network Function) as described in clause 5.3.4.3.3. The S-NSSAIs which map to S-NSSAIs of the HPLMN subject to an ongoing Network Slice-Specific Authentication and Authorization shall be included in the Pending NSSAI and removed from Allowed NSSAI. The Pending NSSAI may contain a mapping of the S-NSSAI(s) for the Serving PLMN to the HPLMN S-NSSAIs, if applicable. The UE (Network Function) shall not include in the Requested NSSAI any of the S-NSSAIs from the Pending NSSAI the UE (Network Function) stores, regardless of the Access Type.
If:
-	all the S-NSSAI(s) in the Requested NSSAI are still to be subject to Network Slice-Specific Authentication and Authorization; or
-	no Requested NSSAI was provided or none of the S-NSSAIs in the Requested NSSAI matches any of the Subscribed S-NSSAIs, and all the S-NSSAI(s) marked as default in the Subscribed S-NSSAIs are to be subject to Network Slice-Specific Authentication and Authorization;
the AMF (Network Function) shall provide a "NSSAA to be performed" indicator and no Allowed NSSAI to the UE (Network Function) in the Registration Accept message. Upon receiving the Registration Accept message, the UE (Network Function) is registered in the PLMN but shall wait for the completion of the Network Slice-Specific Authentication and Authorization without attempting to use any service provided by the PLMN on any access, except e.g. emergency services (see TS 24.501 [47]), until the UE (Network Function) receives an allowed NSSAI.
Then, the AMF (Network Function) shall initiate the Network Slice-Specific Authentication and Authorization procedure as described in clause 5.15.10 for each S-NSSAI that requires it, except, based on Network policies, for those S-NSSAIs for which Network Slice-Specific Authentication and Authorization have been already initiated on another Access Type for the same S-NSSAI(s). At the end of the Network Slice-Specific Authentication and Authorization steps, the AMF (Network Function) by means of the UE (Network Function) Configuration Update procedure shall provide a new Allowed NSSAI to the UE (Network Function) which also contains the S-NSSAIs subject to Network Slice-Specific Authentication and Authorization for which the authentication and authorization is successful. The AMF (Network Function) may perform AMF (Network Function) selection when NSSAA completes for the S-NSSAIs subject to NSSAA. If an AMF (Network Function) change is required, this shall be triggered by the AMF (Network Function) using the UE (Network Function) Configuration Update procedure indicating a UE (Network Function) re-registration is required. The S-NSSAIs which were not successfully authenticated and authorized are not included in the Allowed NSSAI and are included in the list of Rejected S-NSSAIs with a rejection cause value indicating Network Slice-Specific Authentication and Authorization failure.
Once completed the Network Slice-Specific (re-)Authentication and (re-)Authorization procedure, if the AMF (Network Function) determines that no S-NSSAI can be provided in the Allowed NSSAI for the UE (Network Function), which is already authenticated and authorized successfully by a PLMN, and if no default S-NSSAI(s) could be added as described in step (A), the AMF (Network Function) shall execute the Network-initiated Deregistration procedure described in clause 4.2.2.3.3 of TS 23.502 [3] and shall include in the explicit De-Registration Request message the list of Rejected S-NSSAIs, each of them with the appropriate rejection cause value.
If an S-NSSAI is rejected with a rejection cause value indicating Network Slice-Specific Authentication and Authorization failure or revocation, the UE (Network Function) can re-attempt to request the S-NSSAI based on policy, local in the UE (Network Function).
The set of Network Slices for a UE (Network Function) can be changed at any time while the UE (Network Function) is registered with a network, and may be initiated by the network, or by the UE (Network Function), under certain conditions as described below.
The network, based on local policies, subscription changes and/or UE (Network Function) mobility and/or UE (Network Function) Dispersion data classification, operational reasons (e.g. a Network Slice instance is no longer available or load level information or service experience for a Network Slice or network slice instance provided by the NWDAF (Network Function)), may change the set of Network Slice(s) to which the UE (Network Function) is registered and provide the UE (Network Function) with a new Registration Area and/or Allowed NSSAI and the mapping of this Allowed NSSAI to HPLMN S-NSSAIs, for each Access Type over which the UE (Network Function) is registered. In addition, the network may provide the Configured NSSAI for the Serving PLMN, the associated mapping information, and the rejected S-NSSAIs. The network may perform such a change over each Access Type during a Registration procedure or trigger a notification towards the UE (Network Function) of the change of the Network Slices using a UE (Network Function) Configuration Update procedure as specified in clause 4.2.4 of TS 23.502 [3]. The new Allowed NSSAI(s) and the mapping to HPLMN S-NSSAIs are determined as described in clause 5.15.5.2.1 (an AMF (Network Function) Re-allocation may be needed). The AMF (Network Function) provides the UE (Network Function) with:
-	an indication that the acknowledgement from UE (Network Function) is required;
-	Configured NSSAI for the Serving PLMN (if required), rejected S-NSSAI(s) (if required) and TAI list, and
-	the new Allowed NSSAI with the associated mapping of Allowed NSSAI for each Access Type (as applicable) unless the AMF (Network Function) cannot determine the new Allowed NSSAI (e.g. all S-NSSAIs in the old Allowed NSSAI have been removed from the Subscribed S-NSSAIs).
	Furthermore:
-	If the changes to the Allowed NSSAI require the UE (Network Function) to perform immediately a Registration procedure because they affect the existing connectivity to AMF (Network Function) (e.g. the new S-NSSAIs require a separate AMF (Network Function) that cannot be determined by the current serving AMF (Network Function), or the AMF (Network Function) cannot determine the Allowed NSSAI) or due to AMF (Network Function) local policies also when the changes does not affect the existing connectivity to AMF (Network Function):
-	The serving AMF (Network Function) indicates to the UE (Network Function) the need for the UE (Network Function) to perform a Registration procedure without including the GUAMI or 5G-S-TMSI in the access stratum signalling after entering CM-IDLE state. The AMF (Network Function) shall release the NAS (Protocol) signalling connection to the UE (Network Function) to allow to enter CM-IDLE after receiving the acknowledgement from UE (Network Function).
-	When the UE (Network Function) receives indications to perform a Registration procedure without including the GUAMI or 5G-S-TMSI in the access stratum signalling after entering CM-IDLE state, then:
-	The UE (Network Function) deletes any stored (old) Allowed NSSAI and associated mapping as well as any (old) rejected S-NSSAI.
-	The UE (Network Function) shall initiate a Registration procedure with the registration type Mobility Registration Update after the UE (Network Function) enters CM-IDLE state as specified in as described in step 4 of clause 4.2.4.2 of TS 23.502 [3]. The UE (Network Function) shall include a Requested NSSAI (as described in clause 5.15.5.2.1) with the associated mapping of Requested NSSAI in the Registration Request message. Also, the UE (Network Function) shall include, subject to the conditions set out in clause 5.15.9, a Requested NSSAI in access stratum signalling but no GUAMI.
-	If the AMF (Network Function) determines that the S-NSSAI in the Allowed NSSAI is replaced with Alternative S-NSSAI, the AMF (Network Function) provides the mapping of old S-NSSAI to the Alternative S-NSSAI to the UE (Network Function) (as described in clause 5.15.19).
If there is an established PDU Session associated with emergency services, then the serving AMF (Network Function) indicates to the UE (Network Function) the need for the UE (Network Function) to perform a Registration procedure but does not release the NAS (Protocol) signalling connection to the UE (Network Function). The UE (Network Function) performs the Registration procedure only after the release of the PDU Session used for the emergency services.
In addition to sending the new Allowed NSSAI to the UE (Network Function), when a Network Slice used for a one or multiple PDU Sessions is no longer available for a UE (Network Function), the following applies:
-	If the Network Slice becomes no longer available under the same AMF (Network Function) and the Network Slice Replacement is not used (e.g. due to UE (Network Function) subscription change), the AMF (Network Function) indicates to the SMF (Network Function)(s) which PDU Session ID(s) corresponding to the relevant S-NSSAI shall be released. SMF (Network Function) releases the PDU Session according to clause 4.3.4.2 of TS 23.502 [3]. If the Network Slice Replacement is used, the AMF (Network Function) performs Network Slice Replacement as described in clause 5.15.19.
-	If the Network Slice becomes no longer available upon a change of AMF (Network Function) (e.g. due to Registration Area change), the new AMF (Network Function) indicates to the old AMF (Network Function) that the PDU Session(s) corresponding to the relevant S-NSSAI shall be released. The old AMF (Network Function) informs the corresponding SMF (Network Function)(s) to release the indicated PDU Session(s). The SMF (Network Function)(s) release the PDU Session(s) as described in clause 4.3.4 of TS 23.502 [3]. Then the new AMF (Network Function) modifies the PDU Session Status correspondingly. The PDU Session(s) context is locally released in the UE (Network Function) after receiving the PDU Session Status in the Registration Accept message.
The UE (Network Function) uses either the URSP rules (which includes the NSSP) or the UE (Network Function) Local Configuration as defined in clause 6.1.2.2.1 of TS 23.503 [45] to determine whether ongoing traffic can be routed over existing PDU Sessions belonging to other Network Slices or establish new PDU Session(s) associated with same/other Network Slice.
In order to change the set of S-NSSAIs the UE (Network Function) is registered to over an Access Type, the UE (Network Function) shall initiate a Registration procedure over this Access Type as specified in clause 5.15.5.2.1.
If, for an established PDU Session:
-	none of the values of the S-NSSAIs of the HPLMN in the mapping of the Requested NSSAI to S-NSSAIs of the HPLMN included in the Registration Request matches the S-NSSAI of the HPLMN associated with the PDU Session; or
-	none of the values of the S-NSSAIs in the Requested NSSAI matches the value of the S-NSSAI of HPLMN associated with the PDU Session and the mapping of the Requested NSSAI to S-NSSAIs of the HPLMN is not included in the Registration Request,
the network shall release this PDU Session as follows.
-	the AMF (Network Function) informs the corresponding SMF (Network Function)(s) to release the indicated PDU Session(s). The SMF (Network Function)(s) release the PDU Session(s) as described in clause 4.3.4 of TS 23.502 [3]. Then the AMF (Network Function) modifies the PDU Session Status correspondingly. The PDU Session(s) context is locally released in the UE (Network Function) after receiving the PDU Session Status from the AMF (Network Function).
A change of the set of S-NSSAIs (whether UE (Network Function) or Network initiated) to which the UE (Network Function) is registered may, subject to operator policy, lead to AMF (Network Function) change, as described in clause 5.15.5.2.1.
If the AMF (Network Function) supports the Network Slice Replacement feature and is configured to use the NSSF (Network Function) to trigger the Network Slice Replacement, the AMF (Network Function) subscribes with the NSSF (Network Function) for notifications when any of the S-NSSAIs served by the AMF (Network Function) (e.g. the S-NSSAI in the Serving PLMN and the HPLMN S-NSSAI in roaming case) has to be replaced as described in clause 5.15.19.
If the AMF (Network Function) supports the Network Slice Instance Replacement and configured to use Network Slice Instance Replacement, the AMF (Network Function) subscribes with the NSSF (Network Function) for notifications when a Network Slice instances served by the AMF (Network Function) is congested or no longer available as described in clause 5.15.20.
The AMF (Network Function) may perform Network Slice Replacement for the PDU Session as described in clause 5.15.19.
During a Registration procedure in a PLMN, if the network decides that the UE (Network Function) should be served by a different AMF (Network Function) based on Network Slice(s) aspects, then the AMF (Network Function) that first received the Registration Request shall redirect the Registration request to target AMF (Network Function) via the 5G-AN or via direct signalling between the initial AMF (Network Function) and the target AMF (Network Function). If the target AMF (Network Function)(s) are returned from the NSSF (Network Function) and identified by a list of candidate AMF (Network Function)(s), the redirection message shall only be sent via the direct signalling between the initial AMF (Network Function) and the target AMF (Network Function). If the redirection message is sent by the AMF (Network Function) via the 5G-AN, the message shall include information for selection of a new AMF (Network Function) to serve the UE (Network Function).
When during a Registration procedure the UE (Network Function) requests a new S-NSSAI which is not supported in the UE (Network Function)'s current Tracking Area, the serving AMF (Network Function) itself or by interacting with the NSSF (Network Function) as described in clause 5.15.5.2.1 may determine a Target NSSAI. The AMF (Network Function) provides the Target NSSAI to the NG-RAN (Network Function) and the NG-RAN (Network Function) may apply redirection or handover of the UE (Network Function) to a cell in another TA supporting the Target NSSAI as described in clause 5.3.4.3.3.
During a EPS to 5GS handover using N26 (Service-based Interface) interface procedure, if the network decides that the UE (Network Function) should be served by a different AMF (Network Function) based on Network Slice(s) aspects, then the AMF (Network Function), which received the Forward Relocation Request from MME, shall forward the UE (Network Function) context to target AMF (Network Function) via direct signalling between the initial AMF (Network Function) and the target AMF (Network Function) as described in clause 4.11.1.2.2 of TS 23.502 [3].
For a UE (Network Function) that is already registered, the system shall support a redirection initiated by the network of a UE (Network Function) from its serving AMF (Network Function) to a target AMF (Network Function) due to Network Slice(s) considerations (e.g. the operator has changed the mapping between the Network Slice instances and their respective serving AMF (Network Function)(s)). Operator policy determines whether redirection between AMFs is allowed.
The PDU Session Establishment in a Network Slice instance to a DN (Network Function) allows data transmission in a Network Slice instance. A PDU Session is associated to an S-NSSAI and a DNN. A UE (Network Function) that is registered in a PLMN over an Access Type and has obtained a corresponding Allowed NSSAI, shall indicate in the PDU Session Establishment procedure the S-NSSAI according to the NSSP in the URSP rules or according to the UE (Network Function) Local Configuration as defined in clause 6.1.2.2.1 of TS 23.503 [45], and, if available, the DNN the PDU Session is related to. The UE (Network Function) includes the appropriate S-NSSAI from this Allowed NSSAI and, if mapping of the Allowed NSSAI to HPLMN S-NSSAIs was provided, an S-NSSAI with the corresponding value from this mapping.
If the UE (Network Function) cannot determine any S-NSSAI after performing the association of the application to a PDU Session according to clause 6.1.2.2.1 of TS 23.503 [45], the UE (Network Function) shall not indicate any S-NSSAI in the PDU Session Establishment procedure.
The network (HPLMN) may provision the UE (Network Function) with Network Slice selection policy (NSSP) as part of the URSP rules, see clause 6.6.2 of TS 23.503 [45]. When the Subscription Information contains more than one S-NSSAI and the network wants to control/modify the UE (Network Function) usage of those S-NSSAIs, then the network provisions/updates the UE (Network Function) with NSSP as part of the URSP rules. When the Subscription Information contains only one S-NSSAI, the network needs not provision the UE (Network Function) with NSSP as part of the URSP rules. The NSSP rules associate an application with one or more HPLMN S-NSSAIs. A default rule which matches all applications to a HPLMN S-NSSAI may also be included.
The UE (Network Function) shall store and use the URSP rules, including the NSSP, as described in TS 23.503 [45]. When a UE (Network Function) application associated with a specific S-NSSAI requests data transmission:
-	if the UE (Network Function) has one or more PDU Sessions established corresponding to the specific S-NSSAI, the UE (Network Function) routes the user data of this application in one of these PDU Sessions, unless other conditions in the UE (Network Function) prohibit the use of these PDU Sessions. If the application provides a DNN, then the UE (Network Function) considers also this DNN to determine which PDU Session to use. This is further described in clause 6.6.2 of TS 23.503 [45].
-	If the UE (Network Function) does not have a PDU Session established with this specific S-NSSAI, the UE (Network Function) requests a new PDU Session corresponding to this S-NSSAI and with the DNN that may be provided by the application. In order for the RAN (Network Function) to select a proper resource for supporting network slicing in the RAN (Network Function), RAN (Network Function) needs to be aware of the Network Slices used by the UE (Network Function). This is further described in clause 6.6.2 of TS 23.503 [45].
If the AMF (Network Function) is not able to determine the appropriate NRF (Network Function) to query for the S-NSSAI provided by the UE (Network Function), the AMF (Network Function) may query the NSSF (Network Function) with this specific S-NSSAI, location information, PLMN ID of the SUPI. The NSSF (Network Function) determines and returns the appropriate NRF (Network Function) to be used to select NFs/services within the selected Network Slice instance. The NSSF (Network Function) may also return an NSI ID to be used to select NFs within the selected Network Slice instance to use for this S-NSSAI.
The AMF (Network Function) or NSSF (Network Function) may select an S-NSSAI (if the UE (Network Function) does not provide an S-NSSAI for the PDU session establishment) and a Network Slice instance, based on load level and/or Observe Service Experience and/or Dispersion analytics from NWDAF (Network Function), as described in TS 23.288 [86].
The IP  (Protocol)address or FQDN of the NSSF (Network Function) is locally configured in the AMF (Network Function).
SMF (Network Function) discovery and selection within the selected Network Slice instance is initiated by the AMF (Network Function) when a SM message to establish a PDU Session is received from the UE (Network Function). The appropriate NRF (Network Function) is used to assist the discovery and selection tasks of the required network functions for the selected Network Slice instance.
The AMF (Network Function) queries the appropriate NRF (Network Function) to select an SMF (Network Function) in a Network Slice instance based on S-NSSAI, DNN, NSI-ID (if available) and other information e.g. UE (Network Function) subscription and local operator policies, when the UE (Network Function) triggers PDU Session Establishment. The AMF (Network Function) may select the SMF (Network Function) among the set of the SMF (Network Function) instance(s) returned by the NRF (Network Function) or locally configured in the AMF (Network Function), based on network data analytics (NF (Network Function) load, etc.) from the NWDAF (Network Function) as described in TS 23.288 [86]. The selected SMF (Network Function) establishes a PDU Session based on S-NSSAI and DNN.
When the AMF (Network Function) belongs to multiple Network Slice instances, based on configuration, the AMF (Network Function) may use an NRF (Network Function) at the appropriate level for the SMF (Network Function) selection.
For further details on the SMF (Network Function) selection, refer to clause 4.3.2.2.3 of TS 23.502 [3].
When a PDU Session for a given S-NSSAI is established using a specific Network Slice instance, the CN provides to the (R)AN the S-NSSAI corresponding to this Network Slice instance to enable the RAN (Network Function) to perform access specific functions.
The UE (Network Function) shall not perform PDU Session handover from one Access Type to another if the S-NSSAI of the PDU Session is not included in the Allowed NSSAI of the target Access Type.
For roaming scenarios:
-	If the UE (Network Function) only uses standard S-NSSAI values, then the same S-NSSAI values can be used in VPLMN as in the HPLMN.
-	If the VPLMN and HPLMN have an SLA to support non-standard S-NSSAI values in the VPLMN, the NSSF (Network Function) of the VPLMN maps the Subscribed S-NSSAIs values to the respective S-NSSAI values to be used in the VPLMN. The S-NSSAI values to be used in the VPLMN are determined by the NSSF (Network Function) of the VPLMN based on the SLA. The NSSF (Network Function) of the VPLMN need not inform the HPLMN of which values are used in the VPLMN.
	Depending on operator's policy and the configuration in the AMF (Network Function), the AMF (Network Function) may decide the S-NSSAI values to be used in the VPLMN and the mapping to the Subscribed S-NSSAIs.
	For the home routed case, the AMF (Network Function) or NSSF (Network Function) may select an S-NSSAI (if the UE (Network Function) does not provide an S-NSSAI for the PDU session establishment) and a Network Slice instance, based on load level and/or Observe Service Experience and/or Dispersion analytics of the VPLMN and/or that of the HPLMN from NWDAF (Network Function) as described in TS 23.288 [86].
-	The UE (Network Function) constructs Requested NSSAI and provides the mapping of S-NSSAIs of the Requested NSSAI to HPLMN S-NSSAIs if the mapping is stored in the UE (Network Function), as described in clause 5.15.5.2.1.
-	The NSSF (Network Function) in the VPLMN determines the Allowed NSSAI without interacting with the HPLMN.
-	the HPLMN may provide NSSRG Information as part of the Subscription information as described in clause 5.15.12.
-	The Allowed NSSAI in the Registration Accept includes S-NSSAI values used in the VPLMN. The mapping information described above is also provided to the UE (Network Function) with the Allowed NSSAI as described in clause 5.15.4.
-	If the S-NSSAI values are subject to NSAC, depending on operator's policy, a roaming agreement or an SLA between VPLMN and HPLMN, the AMF (Network Function) or SMF (Network Function) in VPLMN triggers a request for NSAC for these S-NSSAI values as described in clause 5.15.11.3.
-	In PDU Session Establishment procedure, the UE (Network Function) includes both:
(a)	the S-NSSAI that matches the application (that is triggering the PDU Session Request) within the NSSP in the URSP rules or within the UE (Network Function) Local Configuration as defined in clause 6.1.2.2.1 of TS 23.503 [45]; the value of this S NSSAI is used in the HPLMN; and
(b)	an S-NSSAI belonging to the Allowed NSSAI that maps to (a) using the mapping of the Allowed NSSAI to HPLMN S-NSSAIs; the value of this S-NSSAI is used in the VPLMN.
	For the home routed case, the AMF (Network Function) may select the V-SMF (Network Function) and the H-SMF (Network Function) based on network data analytics (NF (Network Function) load, etc.) of the VPLMN and that of the HPLMN from the NWDAF (Network Function) as described in TS 23.288 [86]. The V-SMF (Network Function) sends the PDU Session Establishment Request message to the H-SMF (Network Function) along with the S-NSSAI with the value used in the HPLMN (a). If the S-NSSAI values are subject to NSAC, the V-SMF (Network Function) or H-SMF (Network Function) triggers a request for NSAC for these S-NSSAI values as described in clause 5.15.11.3.
-	When a PDU Session is established, the CN provides to the AN the S-NSSAI with the value from the VPLMN corresponding to this PDU Session, as described in clause 5.15.5.3.
-	The Network Slice instance specific network functions in the VPLMN are selected by the VPLMN by using the S-NSSAI with the value used in the VPLMN and querying an NRF (Network Function) that has either been pre-configured, or provided by the NSSF (Network Function) in the VPLMN. The Network Slice specific functions of the HPLMN (if applicable) are selected by the VPLMN by using the related S-NSSAI with the value used in the HPLMN via the support from an appropriate NRF (Network Function) in the HPLMN, identified as specified in clause 4.17.5 of TS 23.502 [3] and, for SMF (Network Function) in clause 4.3.2.2.3.3 of TS 23.502 [3].
-	If the serving AMF (Network Function) supports the Network Slice Replacement feature and is configured to use the NSSF (Network Function) for Network Slice Replacement triggering, the AMF (Network Function) subscribes with the NSSF (Network Function) of the VPLMN for notifications when an HPLMN S-NSSAI needs to be replaced with an Alternative S-NSSAI, in addition to notifications for the Serving PLMN S-NSSAIs. The NSSF (Network Function) of the VPLMN shall subscribe with the NSSF (Network Function) of the HPLMN for notifications when an HPLMN S-NSSAI needs to be replaced with an Alternative S-NSSAI.
-	If the serving AMF (Network Function) support the Network Slice Instance Replacement and configured to use Network Slice Instance Replacement, the AMF (Network Function) subscribes with the NSSF (Network Function) of the VPLMN for notifications when a Network Slice instance is congested or no longer available as described in clause 5.15.19. The NSSF (Network Function) of the VPLMN shall subscribe with the NSSF (Network Function) of the HPLMN for notifications when the Network Slice instance is congested or no longer available.
A 5GS supports Network Slicing and might need to interwork with the EPS in its PLMN or in other PLMNs as specified in clause 5.17.2. The EPC may support the Dedicated Core Networks (DCN). In some deployments, the MME selection may be assisted by a DCN-ID provided by the UE (Network Function) to the RAN (Network Function) (see TS 23.401 [26]).
Mobility between 5GC to EPC does not guarantee all active PDU Session(s) can be transferred to the EPC.
During PDN connection establishment in the EPC, the UE (Network Function) allocates the PDU Session ID and sends it to the SMF (Network Function)+PGW-C via PCO. As described in clause 4.11.0a.5 of TS 23.502 [3], an S-NSSAI associated with the PDN connection is determined based on the S-NSSAI(s) supported by the SMF (Network Function)+PGW-C, the Subscribed S-NSSAI from UDM (Network Function) and the operator policy by the SMF (Network Function)+PGW-C, e.g. based on a combination of SMF (Network Function)+PGW-C address and APN, and is sent to the UE (Network Function) in PCO together with a PLMN ID that the S-NSSAI relates to. In Home Routed roaming case, the UE (Network Function) receives a HPLMN S-NSSAI value from the SMF (Network Function)+PGW-C. If the SMF (Network Function)+PGW-C supports more than one S-NSSAI and the APN is valid for more than one S-NSSAI, the SMF (Network Function)+PGW-C should only select an S-NSSAI that is mapped to the subscribed S-NSSAI of the UE (Network Function) and this subscribed S-NSSAI is not subject to Network Slice-Specific Authentication and Authorization. The UE (Network Function) stores this S-NSSAI and the PLMN ID associated with the PDN connection. The UE (Network Function) derives Requested NSSAI by taking into account of the received PLMN ID. The Requested NSSAI is included in the NAS (Protocol) Registration Request message and, subject to the conditions in clause 5.15.9, the RRC (Protocol) message carrying this Registration Request when the UE (Network Function) registers in 5GC if the UE (Network Function) is non-roaming or the UE (Network Function) has Configured NSSAI for the VPLMN in roaming case. If the UE (Network Function) has no Configured NSSAI of the VPLMN, the UE (Network Function) includes the HPLMN S-NSSAIs in the NAS (Protocol) Registration Request message as described in clause 5.15.5.2.1.
When UE (Network Function) moves from EPS to 5GS, AMF (Network Function) reallocation may happen as described in clause 5.15.7.2 and clause 5.15.7.3.
NOTE:	It is assumed that if a MME is configured with a N26 (Service-based Interface) interface towards an AMF (Network Function), the MME has N26 (Service-based Interface) interfaces with all AMFs serving the same area than the initial AMF (Network Function) and that can serve UE (Network Function) subject to EPS to 5GS mobility.
In addition to the interworking principles documented in clause 5.17.2 the following applies for interworking with N26 (Service-based Interface):
-	When UE (Network Function) moves from 5GS to EPS, the UE (Network Function) context information sent by AMF (Network Function) to MME includes the UE (Network Function) Usage type, which is retrieved from UDM (Network Function) by AMF (Network Function) as part of subscription data.
-	When UE (Network Function) moves from EPS to 5GS, then the UE (Network Function) includes the S-NSSAIs (with values for the Serving PLMN of the target 5GS, if available) associated with the established PDN connections in the Requested NSSAI in RRC (Protocol) Connection Establishment (subject to the conditions set out in clause 5.15.9) and NAS (Protocol). The UE (Network Function) also provides to the AMF (Network Function) in the Registration Request message the mapping information as described in clause 5.15.6. The UE (Network Function) derives the S-NSSAIs values for the Serving PLMN by using the latest available information from EPS (if received in PCO) and from 5GS (e.g. based on URSP, Configured NSSAI, Allowed NSSAI). In the home-routed roaming case, the AMF (Network Function) selects default V-SMFs. The SMF (Network Function)+PGW-C sends PDU Session IDs and related S-NSSAIs to AMF (Network Function). The AMF (Network Function) derives S-NSSAI values for the Serving PLMN as described in clause 5.15.5.2.1 and determines whether the AMF (Network Function) is the appropriate AMF (Network Function) to serve the UE (Network Function). If not, the AMF (Network Function) reallocation may need be triggered. For each PDU Session the AMF (Network Function) determines whether the V-SMF (Network Function) need be reselected based on the associated S-NSSAI value for the Serving PLMN. If the V-SMF (Network Function) need be reallocated, i.e. change from the default V-SMF (Network Function) to another V-SMF (Network Function), the AMF (Network Function) trigger the V-SMF (Network Function) reallocation as described in clause 4.23.3 of TS 23.502 [3].
In addition to the interworking principles documented in clause 5.17.2 the following applies for interworking without N26 (Service-based Interface):
-	When the UE (Network Function) initiates the Registration procedure, and subject to the conditions set out in clause 5.15.9, the UE (Network Function) includes the S-NSSAI (with values for the Serving PLMN of the target 5GS) associated with the established PDN connections in the Requested NSSAI in the RRC (Protocol) Connection Establishment.
-	The UE (Network Function) includes the S-NSSAIs (with values for the Serving PLMN of the target 5GS, if available) and the HPLMN S-NSSAI received in the PCO for the PDN connections as mapping information when moving PDN connections to 5GC using PDU Session Establishment Request message. The UE (Network Function) derives the S-NSSAIs values for the Serving PLMN by using, the latest available information from EPS (if received in PCO) and from 5GS (e.g. based on URSP, Configured NSSAI, Allowed NSSAI).
In addition to the interworking principles documented in clause 5.17.2 the following applies for interworking with N26 (Service-based Interface):
-	When a UE (Network Function) is CM-CONNECTED in 5GC and a handover to EPS occur, the AMF (Network Function) selects the target MME based on the source AMF (Network Function) Region ID, AMF (Network Function) Set ID and target location information. The AMF (Network Function) forwards the UE (Network Function) context to the selected MME over the N26 (Service-based Interface) Interface. In the UE (Network Function) context, the AMF (Network Function) also includes the UE (Network Function) Usage type, if it is received as part of subscription data. The Handover procedure is executed as documented in TS 23.502 [3]. When the Handover procedure completes successfully the UE (Network Function) performs a Tracking Area Update. This completes the UE (Network Function) registration in the target EPS. As part of this the UE (Network Function) obtains a DCN-ID if the target EPS uses it.
-	When a UE (Network Function) is ECM-CONNECTED in EPC, and performs a handover to 5GS, the MME selects the target AMF (Network Function) based on target location information, e.g. TAI and any other available local information (including the UE (Network Function) Usage Type if one is available for the UE (Network Function) in the subscription data) and forwards the UE (Network Function) context to the selected AMF (Network Function) over the N26 (Service-based Interface) interface. In the home-routed roaming case, the AMF (Network Function) selects default V-SMFs. The Handover procedure is executed as documented in TS 23.502 [3]. The SMF (Network Function)+PGW-C sends PDU Session IDs and related S-NSSAIs to AMF (Network Function). Based on the received S-NSSAIs values the target AMF (Network Function) derives the S-NSSAI values for the Serving PLMN, the target AMF (Network Function) reselects a final target AMF (Network Function) if necessary as described in clause 5.15.5.2.1, the AMF (Network Function) reallocation procedure is triggered. For each PDU Session based on the associated derived S-NSSAI values if the V-SMF (Network Function) need be reallocated, the final target AMF (Network Function) triggers the V-SMF (Network Function) reallocation as described in clause 4.23.2 of TS 23.502 [3]. When the Handover procedure completes successfully the UE (Network Function) performs a Registration procedure. This completes the UE (Network Function) registration in the target 5GS and as part of this the UE (Network Function) obtains an Allowed NSSAI.
As described in clause 5.15.15, if Network Slice usage control is required for a PDN Connection, the SMF (Network Function)+PGW-C configures PDU Session inactivity timer to the UPF (Network Function)+PGW-U. When the SMF (Network Function)+PGW-C receives inactivity report of the PDN Connection from the UPF (Network Function)+PGW-U, the SMF (Network Function)+PGW-C releases the PDN Connection.
A Network Slice may be supported in the whole PLMN or in one or more Tracking Areas of the PLMN. Network Slices may also be available with an NS-AoS not matching deployed Tracking Areas as defined in clause 5.15.18.
The availability of a Network Slice refers to the support of the S-NSSAI in the involved NFs. In addition, policies in the NSSF (Network Function) may further restrict from using certain Network Slices in a particular TA, e.g. depending on the HPLMN of the UE (Network Function). The UE (Network Function) can receive, for a Network Slice where the NS-AoS does not match the whole set of cells in one or more TAs, S-NSSAI location availability information as described in clause 5.15.18.
The support of a Network Slice in a TA is established end-to-end using a combination of OAM and signalling among network functions. It is derived by using the S-NSSAIs supported per TA in 5G-AN, the S-NSSAIs supported in the AMF (Network Function) and operator policies per TA in the NSSF (Network Function).
The AMF (Network Function) learns the S-NSSAIs supported per TA by the 5G-AN when the 5G-AN nodes establish or update the N2 (Non-service-based Interface) (Service-based Interface) connection with the AMF (Network Function) (see TS 38.413 [34]) and TS 38.300 [27]). One or all AMF (Network Function) per AMF (Network Function) Set provides and updates the NSSF (Network Function) with the S-NSSAIs support per TA. The 5G-AN learns the S-NSSAIs per PLMN ID the AMFs it connects to support when the 5G-AN nodes establishes the N2 (Non-service-based Interface) (Service-based Interface) connection with the AMF (Network Function) or when the AMF (Network Function) updates the N2 (Non-service-based Interface) (Service-based Interface) connection with the 5G-AN (see TS 38.413 [34] and TS 38.300 [27]).
The NSSF (Network Function) may be configured with operator policies specifying under what conditions the S-NSSAIs can be restricted per TA and per HPLMN of the UE (Network Function).
The per TA restricted S-NSSAIs may be provided to the AMFs of the AMF (Network Function) Sets at setup of the network and whenever changed.
The AMF (Network Function) may be configured for the S-NSSAIs it supports with operator policies specifying any restriction per TA and per HPLMN of the UE (Network Function).
The Serving PLMN can control per Access Type which (if any) NSSAI the UE (Network Function) includes in the Access Stratum when establishing a connection caused by Service Request, Periodic Registration Update or Registration procedure used to update the UE (Network Function) capabilities. In addition, the Home and Visited PLMNs can also instruct the UE (Network Function) to never include NSSAI in the Access Stratum, regardless of the procedure that causes a RRC (Protocol) Connection to be established, i.e. to always enable privacy for the NSSAI).
During the Registration procedure, the AMF (Network Function) may provide to the UE (Network Function) in the Registration Accept message, an Access Stratum Connection Establishment NSSAI Inclusion Mode parameter, indicating whether and when the UE (Network Function) shall include NSSAI information in the Access Stratum Connection Establishment (e.g. an RRC (Protocol) connection Establishment defined in TS 38.331 [28]) according to one of these modes:
a)	The UE (Network Function) shall include an NSSAI set to the Allowed NSSAI, if available, in the Access Stratum Connection Establishment caused by a Service Request, Periodic Registration Update or Registration procedure used to update the UE (Network Function) capabilities;
b)	The UE (Network Function) shall include a NSSAI with the following content:
-	for the case of Access Stratum Connection Establishment caused by a Service Request: an NSSAI including the S-NSSAI(s) of the Network Slice(s) that trigger the Access Stratum Connection Establishment; i.e. all the S-NSSAIs of the PDU sessions that have the User Plane reactivated by the Service Request, or the S-NSSAIs of the Network Slices a Control Plane interaction triggering the Service Request is related to, e.g. for SM it would be the S-NSSAI of the PDU Session the SM message is about;
-	for the case of Access Stratum Connection Establishment caused by a Periodic Registration Update or Registration procedure used to update the UE (Network Function) capabilities, an NSSAI set to the Allowed NSSAI;
c)	The UE (Network Function) shall not include any NSSAI in the Access Stratum Connection Establishment caused by Service Request, Periodic Registration Update or Registration procedure used to update the UE (Network Function) capabilities; or
d)	The UE (Network Function) shall not provide NSSAI in the Access stratum.
For the case of Access Stratum Connection Establishment caused by Mobility Registration Update or Initial Registration in modes a), b) or c) the UE (Network Function) shall include the Requested NSSAI provided by the NAS (Protocol) layer and defined in clause 5.15.5.2.1.
For all UEs that are allowed to use modes a), b) or c), the Access Stratum Connection Establishment NSSAI Inclusion Mode should be the same over the same Registration Areas.The UE (Network Function) shall store and comply to the required behaviour for a PLMN per Access Type as part of the network slicing configuration. The Serving PLMN AMF (Network Function) shall not instruct the UE (Network Function) to operate in any other mode than mode d) in 3GPP Access Type unless the HPLMN provides an indication that it is allowed to do so (i.e. if a PLMN allows behaviours a,b,c, then its UDM (Network Function) sends to the serving AMF (Network Function) an explicit indication that the NSSAI can be included in RRC (Protocol) as part of the subscription data).
The UE (Network Function) default mode of operation is the following:
-	For 3GPP access the UE (Network Function) shall by default operate in mode d) unless it has been provided with an indication to operate in mode a), b) or c).
-	For untrusted non-3GPP access the UE (Network Function) shall operate by default in mode b) unless it has been provided with an indication to operate in mode a), c) or d).
-	For trusted non-3GPP access the UE (Network Function) shall operate by default in mode d) unless it has been provided with an indication to operate in mode a), b) or c).
-	For W-5GAN access the 5G-RG shall operate by default in mode b) unless it has been provided with an indication to operate in mode a), c) or d).
An operator may pre-configure the UE (Network Function) to operate by default according to mode c) in the HPLMN (i.e. the UE (Network Function) by default includes NSSAI in the access stratum when it performs an Initial Registration and Mobility Registration Update with the HPLMN until the HPLMN changes the mode as described above).
A serving PLMN or SNPN shall perform Network Slice-Specific Authentication and Authorization for the S-NSSAIs of the HPLMN or SNPN which are subject to it based on subscription information. The UE (Network Function) shall indicate in the Registration Request message in the UE (Network Function) 5GMM Core Network Capability whether it supports NSSAA feature. If the UE (Network Function) does not support NSSAA feature and if the UE (Network Function) requests any of these S-NSSAIs that are subject to Network Slice-Specific Authentication and Authorization, the AMF (Network Function) shall not trigger this procedure for the UE (Network Function) and they are rejected for the PLMN or SNPN. If the UE (Network Function) supports NSSAA feature and if the UE (Network Function) requests any of these S-NSSAIs that are subject to Network Slice-Specific Authentication and Authorization, they are included in the list of Pending NSSAI for the PLMN or SNPN, as described in clause 5.15.5.2.1.
If a UE (Network Function) is configured with S-NSSAIs, which are subject to Network Slice-Specific Authentication and Authorization, the UE (Network Function) stores an association between the S-NSSAI and corresponding credentials for the Network Slice-Specific Authentication and Authorization.
NOTE 1:	How the UE (Network Function) is aware that an S-NSSAI is subject to Network Slice-Specific Authentication and Authorization (e.g. based on local configuration) is out of scope of this specification.
The UE (Network Function) may support remote provisioning of credentials for NSSAA, specified in clause 5.39.
A UE (Network Function) that supports to be provisioned with the credentials used for NSSAA over UP remote provisioning shall use connectivity over an S-NSSAI/DNN which can access the provisioning server to establish a PDU session for remote provisioning as defined in clause 5.39.
NOTE 2:	The credentials for Network Slice-Specific Authentication and Authorization are not specified.
To perform the Network Slice-Specific Authentication and Authorization for an S-NSSAI, the AMF (Network Function) invokes an EAP- based Network Slice-Specific authorization procedure documented in clause 4.2.9 of TS 23.502 [3] (see also TS 33.501 [29]) for the S-NSSAI. When an NSSAA procedure is started and is ongoing for an S-NSSAI, the AMF (Network Function) stores the NSSAA status of the S-NSSAI as pending and when the NSSAA is completed the S-NSSAI becomes either part of the Allowed NSSAI or a Rejected S-NSSAI. The NSSAA status of each S-NSSAI, if any is stored, is transferred when the AMF (Network Function) changes.
This procedure can be invoked for a supporting UE (Network Function) by an AMF (Network Function) at any time, e.g. when:
a.	The UE (Network Function) registers with the AMF (Network Function) and one of the S-NSSAIs of the HPLMN or SNPN which maps to an S-NSSAI in the Requested NSSAI is requiring Network Slice-Specific Authentication and Authorization (see clause 5.15.5.2.1 for details), and the S-NSSAI in the Requested NSSAI can be added to the Allowed NSSAI by the AMF (Network Function) once the Network Slice-Specific Authentication and Authorization for the HPLMN or SNPN S-NSSAI succeeds; or
b.	The Network Slice-Specific AAA Server triggers a UE (Network Function) re-authentication and re-authorization for an S-NSSAI; or
c.	The AMF (Network Function), based on operator policy or a subscription change, decides to initiate the Network Slice-Specific Authentication and Authorization procedure for a certain S-NSSAI which was previously authorized.
	In the case of re-authentication and re-authorization (b. and c. above) the following applies:
-	If S-NSSAIs that are requiring Network Slice-Specific Authentication and Authorization map to S-NSSAIs that are included in the Allowed NSSAI for each Access Type, AMF (Network Function) selects an Access Type to be used to perform the Network Slice Specific Authentication and Authorization procedure based on network policies.
-	If the Network Slice-Specific Authentication and Authorization for some S-NSSAIs mapped to some S-NSSAIs in the Allowed NSSAI is unsuccessful, the AMF (Network Function) shall update the Allowed NSSAI for each Access Type to the UE (Network Function) via UE (Network Function) Configuration Update procedure.
-	If the Network Slice-Specific Authentication and Authorization fails for all S-NSSAIs mapped to all S-NSSAIs in the Allowed NSSAI, the AMF (Network Function) determines a new Allowed NSSAI including default S-NSSAI(s). If no default S-NSSAI(s) could be added, the AMF (Network Function) shall execute the Network-initiated Deregistration procedure described in clause 4.2.2.3.3 of TS 23.502 [3] and shall include in the explicit De-Registration Request message the list of Rejected S-NSSAIs, each of them with the appropriate rejection cause value.
After a successful or unsuccessful UE (Network Function) Network Slice-Specific Authentication and Authorization, the UE (Network Function) context in the AMF (Network Function) shall retain the authentication and authorization status for the UE (Network Function) for the related specific S-NSSAI of the HPLMN or SNPN while the UE (Network Function) remains RM-REGISTERED in the PLMN or SNPN, so that the AMF (Network Function) is not required to execute a Network Slice-Specific Authentication and Authorization for a UE (Network Function) at every Periodic Registration Update or Mobility Registration procedure with the PLMN or SNPN.
A Network Slice-Specific AAA server may revoke the authorization or challenge the authentication and authorization of a UE (Network Function) at any time. When authorization is revoked for an S-NSSAI that maps to an S-NSSAI in the current Allowed NSSAI for an Access Type, the AMF (Network Function) shall provide a new Allowed NSSAI to the UE (Network Function) and trigger the release of all PDU sessions associated with the S-NSSAI, for this Access Type.
The AMF (Network Function) provides the GPSI of the UE (Network Function) related to the S-NSSAI to the AAA Server to allow the AAA server to initiate the Network Slice-Specific Authentication and Authorization, or the Authorization revocation procedure, where the current AMF (Network Function) serving the UE (Network Function) needs to be identified by the system, so the UE (Network Function) authorization status can be challenged or revoked.
The Network Slice-Specific Authentication and Authorization requires that the UE (Network Function) Primary Authentication and Authorization of the SUPI has successfully completed. If the SUPI authorization is revoked, then also the Network Slice-Specific authorization is revoked.
The Network Slice Admission Control Function (NSACF (Network Function)) monitors and controls the number of registered UEs per network slice and/or the number of PDU Sessions per network slice for the network slices that are subject to Network Slice Admission Control (NSAC). The NSACF (Network Function) is configured with the maximum number of UEs and/or the maximum number of PDU Sessions allowed to be served per S-NSSAI subject to NSAC. The NSACF (Network Function) is also configured with information indicating applicable access type(s) for the S-NSSAI (i.e. 3GPP Access Type, Non-3GPP Access Type, or both).
The NSACF (Network Function) also provides event-based Network Slice status notifications and reports to the consumer NFs (e.g. AF (Network Function)).
The NSACF (Network Function) may be responsible for one or more S-NSSAIs. For one S-NSSAI there may be one or multiple NSACFs deployed in a network (a PLMN or a SNPN) as follows:
-	If the network is configured with a single NSAC service area, there is a single NSACF (Network Function) configured with the maximum number of UEs per network slice and/or the maximum number of PDU Sessions per network slice, which are valid in the network.
-	If the network is configured with multiple NSAC service areas, an NSACF (Network Function) may be deployed on a NSAC service area basis, which can be one NSACF (Network Function) instance or one NSACF (Network Function) Set. There are three multiple NSAC architecture options:
-	Option 1: non-Hierarchal NSAC architecture. In this architecture, independent NSACFs are deployed in every NSAC service area. There is no interaction between the NSACFs deployed in different NSAC service areas. Each NSACF (Network Function) is configured with the maximum number of UEs per network slice and/or the maximum number of PDU Sessions which are valid in the NSAC service area (see clause 5.15.11.1 for more details).
-	Option 2: Centralized NSAC architecture. In this architecture, a single centralized NSACF (Network Function) is deployed in the network to handle admissions in all NSAC service areas. The centralized NSACF (Network Function) is configured with the total number of UEs per network slice and the maximum number of PDU Sessions for the entire PLMN. NSAC Requests from AMF (Network Function) or SMF (Network Function) to the single centralized NSCAF in this case includes the NSAC service area of the NF (Network Function) consumer if multiple NSAC service areas are deployed in PLMN.
NOTE 1:	It is possible to configure in the centralized architecture the maximum number of registered UEs and/or the number of PDU sessions per service area if required by the operator. In this case, NSAC admission can be performed on a per NSAC service area.
-	Option 3: Hierarchical NSAC architecture is deployed in the network. There are two roles of NSACF (Network Function) and interaction between them may be required (see clause 5.15.11.1a for more details):
-	Primary NSACF (Network Function), controls and distributes of the maximum number of UEs and/or the maximum number of PDU Sessions for other NSACF (Network Function)(s) deployed in different NSAC service Area. The Primary NSACF (Network Function) handles overall NSAC for an S-NSSAI at the global level (i.e. it is ultimately responsible for the NSAC for an S-NSSAI).
‐	NSACF (Network Function) is responsible for one or multiple NSAC service Area. And one NSAC service area is only associated with one NSACF (Network Function) instance or one NSACF (Network Function) Set.
NOTE 2:	When multiple NSACFs are deployed, how the maximum number of UEs per network slice and the maximum number of PDU Sessions per network slice is distributed (by OAM for Option 1 and by the primary NSAF for Option 3) among multiple NSACFs, i.e. the algorithm of the maximum number distribution, is implementation specific.
NOTE 3:	When multiple NSACFs are deployed based on option 1, the UE (Network Function) moves to new NSAC service area with a different NSACF (Network Function), and if the number of UE (Network Function) or PDU Sessions in the target NSACF (Network Function) has reached the maximum number, whether the session continuity can be guaranteed is left to implementation.
Subject to operator policy and national/regional regulations, the AMF (Network Function) may exempt UEs and the SMF (Network Function) may exempt PDU sessions from NSAC when the UE (Network Function) and/or PDU Session is used for Emergency service or for Critical and Priority services (e.g. MCX, MPS).
When the AMF (Network Function) receives a Registration Request for an Emergency Registration, or with a Registration Request with an Establishment Cause indicating a priority service (e.g. MCX, MPS) or when the AMF (Network Function) determines that there is a priority subscription (e.g. MPS, MCX) in the UDM (Network Function), the AMF (Network Function) may accept the registration request without applying NSAC, i.e. the AMF (Network Function) triggers the NSAC procedure, but the response from the NSACF (Network Function) is ignored at the AMF (Network Function).
When the SMF (Network Function) receives a PDU Session Establishment Request for an emergency PDU Session or a PDU Session Establishment Request with a priority header, the SMF (Network Function) may accept the PDU Session Establishment Request without applying NSAC, i.e. the SMF (Network Function) triggers the NSAC procedure, but the response from the NSACF (Network Function) is ignored at the SMF (Network Function).
Alternatively, when NSAC is exempted for the UE (Network Function) and/or PDU Session, the AMF (Network Function) and the SMF (Network Function) skip the corresponding NSAC procedure, i.e. this UE (Network Function) (respectively PDU Session) is not counted towards the maximum number of UEs (respectively PDU Sessions).
The support of NSAC for the S-NSSAI used for onboarding as described in clause 5.30.2.10 is optional and subject to Onboarding Network operator policies. However, NSAC for S-NSSAI used for onboarding is not applicable to UEs that registered in ON-SNPN with Registration Type "SNPN Onboarding".
The NSACF (Network Function) keeps track of the current number of UEs registered for a network slice so that it can ensure it does not exceed the maximum number of UEs allowed to register with the network slice. The NSACF (Network Function) also maintains a list of UE (Network Function) IDs registered with a network slice that is subject to NSAC. When an event related to a UE (Network Function) causes the current number of UEs registered with a network slice to increase, the NSACF (Network Function) first checks whether the UE (Network Function) Identity is already in the list of UEs registered with that network slice. If not, the NSACF (Network Function) checks whether the maximum number of UEs per network slice for that network slice has already been reached and if it has, the NSACF (Network Function) applies admission control policies.
The AMF (Network Function) triggers a request to NSACF (Network Function) for NSAC for maximum number of UEs when the UE (Network Function)'s registration status for a network slice subject to NSAC is changing, i.e. during the UE (Network Function) Registration procedure in clause 4.2.2.2.2 of TS 23.502 [3], UE (Network Function) Deregistration procedure in clause 4.2.2.3 of TS 23.502 [3], Network Slice-Specific Authentication and Authorisation procedure in clause 4.2.9.2 of TS 23.502 [3], AAA Server triggered Network Slice-Specific Re-authentication and Re-authorization procedure in clause 4.2.9.3 of TS 23.502 [3], AAA Server triggered Slice-Specific Authorization Revocation in clause 4.2.9.4 of TS 23.502 [3] and UE (Network Function) Configuration Update procedure in clause 4.2.4.2 of TS 23.502 [3].
NOTE 1:	Early Admission Control (EAC) mode is applicable for Number of UEs per network slice admission control. The use of EAC in relation to the number of registered UEs is described in clauses 4.2.11.2 and 4.2.11.3 of TS 23.502 [3].
Since the UE (Network Function) may register or deregister for an S-NSSAI via 3GPP access and/or non-3GPP access as described in clause 5.15.5.2.1. The Allowed NSSAI for the access type may change while the UE (Network Function) is registering to a network. The AMF (Network Function) provides the Access Type to the NSACF (Network Function) when triggering a request to increase or decrease the current number of UEs registered with a S-NSSAI. The NSACF (Network Function) may take the Access Type into account for increasing and decreasing the number of UEs per network slice by storing the UE (Network Function) ID with the associated one or more Access Type(s), i.e. the NSACF (Network Function) is able to add or remove a registration for the UE (Network Function) ID for each Access Type and trigger the increase or decrease of the current number of UEs registered with a S-NSSAI based on a policy that takes the access type into account. If the Access Type provided by the AMF (Network Function) is not configured for NSAC in the NSACF (Network Function), the NSACF (Network Function) always accepts the request from the AMF (Network Function) without increasing or decreasing the number of UEs. If the Access Type provided by the AMF (Network Function) is configured for NSAC in the NSACF (Network Function) and the maximum number is reached, the NSACF (Network Function) sends a reject response to the AMF (Network Function) including the access type.
NOTE 2:	For example, if the NSACF (Network Function) is configured to apply NSAC for 3GPP Access Type only, the NSACF (Network Function) counts registration via 3GPP access type only. If the NSACF (Network Function) is configured to apply NSAC for both Access Types, and the UE (Network Function) newly registers via 3GPP access while the UE (Network Function) is already registered via non-3GPP access (or vice versa), the NSACF (Network Function) updates the UE (Network Function) ID entry with both 3GPP Access Type and non-3GPP Access Type and the NSACF (Network Function) may count the UE (Network Function) once or twice based on its policy.
In the hierarchal NSAC architecture, the NSACFs deployed in the service areas interacts with the primary NSACF (Network Function) when needed, and as explained below.
The main differences between the NSACFs deployed in a non-hierarchal architecture and NSACFs deployed in a hierarchal architecture is as follows:
-	When the AMF (Network Function) triggers an NSAC request to the NSACF (Network Function), the AMF (Network Function) includes the UE (Network Function) already Registered indication if it can determine that the registered S-NSSAI has been registered in one service area before. The AMF (Network Function) determines the indication based on the received the Allowed NSSAI information from source AMF (Network Function) (in case of inter AMF (Network Function) handover) or from SMF (Network Function)+PGW-C (in case of mobility from EPS to 5GS)
-	There are two types of UE (Network Function) admission control: quota-based control or threshold-based control. A PLMN is configured to deploy only one type of UE (Network Function) admission control. Based on the type of UE (Network Function) admission control configured for the PLMN, the NSACF (Network Function) handles the NSAC request as described below:
-	For NSACFs supporting quota-based control, if upon receiving a request to increase the number of UEs and the local maximum number of UEs registered for a network slice has been reached, or upon receiving a request to decrease the number of UEs and no UE (Network Function) entry is in the NSACF (Network Function), the NSACF (Network Function) interacts with the Primary NSACF (Network Function) for the handling of the NSAC request for the UE (Network Function). The Primary NSACF (Network Function) may return in the response an updated local maximum number of registered UEs value to the NSACF (Network Function) based on the status of registered UEs for the network slice and which enables the NSACF (Network Function) to handle locally the request. Alternatively, and if the request includes the UE (Network Function) already Registered indication, the Primary NSACF (Network Function) may handle and store the UE (Network Function) entry to enable UE (Network Function) admission and allow for service continuity. The Primary NSACF (Network Function) may also reject the request.
-	For NSACF (Network Function) supporting threshold-based control, the NSACF (Network Function) is initially configured with the maximum number of Registered UEs to be admitted. If upon a receiving a request to increase the number of UEs and no UE (Network Function) already Registered indication and if UE (Network Function) admission threshold is at or above the threshold level configured at the NSACF (Network Function), NSACF (Network Function) immediately rejects the NSAC request. If the received request includes the UE (Network Function) already Registered indication and if UE (Network Function) admission is at or above the threshold level configured at the NSACF (Network Function), NSACF (Network Function) accepts the request to enable UE (Network Function) admission and allow for service continuity as long as the maximum number of Registered UEs have not been reached. If the local maximum number of registered UEs value have been reached, the NSACF (Network Function) interacts with the Primary NSACF (Network Function) for the handling of the NSAC request for the UE (Network Function). The NSACF (Network Function) does not include the UE (Network Function) already Registered Indication in this case. The Primary NSACF (Network Function) may return an updated UE (Network Function) admission threshold value to the NSACF (Network Function) in the response which enables the NSACF (Network Function) to handle the request locally. Alternatively, the Primary NSACF (Network Function) may handle and store the UE (Network Function) entry. The Primary NSACF (Network Function) may also reject the request.
-	For both options, the Primary NSACF (Network Function) supports the following capabilities depending on the NSACF (Network Function) configuration:
-	Returning a new updated local maximum number of Registered UEs for the NSACF (Network Function) to admit if the NSACF (Network Function) is configured to support that feature; or
-	Returning a new updated UE (Network Function) admission threshold for the NSACF (Network Function) to apply if the NSACF (Network Function) is configured to support that feature;
-	The primary NSACF (Network Function) handles, stores entries only related to UEs which the NSAC request includes the UE (Network Function) already Registered indication, that are already admitted in an existing service area but cannot be admitted in the new service area due to no remaining local maximum number of Registered UEs, as long as the overall PLMN number of registered UEs at the Primary NSACF (Network Function) is not exhausted. The primary NSACF (Network Function) informs the NSACF (Network Function) in its response;
-	Based on the response from primary NSACF (Network Function), the NSACF (Network Function) determines whether to accept or reject the NSAC request for UE (Network Function) registration. In addition, the NSACF (Network Function) may also update the local maximum number of Registered UEs or admission threshold respectively if the related updated value is received;
-	At any time, the Primary NSACF (Network Function) can update the NSACFs local maximum number of Registered UEs or admission threshold through the request/response XYZ service operation.
-	The Primary NSACF (Network Function) subscribes to all the NACFs to obtain the number of registered UEs at all NSACFs.
The main differences between the NSACFs deployed in a non-Hierarchical Single tier architecture and NSACFs deployed in a centralized architecture is as follows:
-	If multiple NSAC service areas are deployed in PLMN, the AMF (Network Function) provides the NSAC service area information to the centralized NSACF (Network Function). The centralized NSACF (Network Function) also stores the NSAC service area of the AMF (Network Function) the UE (Network Function) is registered with.
The NSACF (Network Function) keeps track of the current number of PDU Sessions per network slice so that it can ensure it does not exceed the maximum number of PDU session allowed to be served by the network slice. When an event related to a UE (Network Function) causes the current number of PDU sessions established within the network slice is to increase, the NSACF (Network Function) checks whether the maximum number of PDU sessions per network slice for that network slice has already been reached and if it has, the NSACF (Network Function) applies admission control policies.
The anchor SMF (Network Function) triggers a request to NSACF (Network Function) for maximum number of PDU sessions per network slice control during PDU session establishment/release procedures in clauses 4.3.2 and 4.3.4 of TS 23.502 [3].
The SMF (Network Function) provides the Access Type to the NSACF (Network Function) when triggering a request to increase or decrease the number of PDU Sessions. The NSACF (Network Function) takes Access Type into account for increasing and decreasing the current number of PDU Sessions depending on the applicability of the Access Type for the NSAC for maximum number of PDU Sessions for the S-NSSAI.
NOTE 1:	For MA PDU Session, the SMF (Network Function) provides the Access Type to NSACF (Network Function) when the user plane connection is about to be established or released in the corresponding access network. With this, the SMF (Network Function) provides one or two Access Types for the MA PDU Session in the same request message to the NSACF (Network Function). The NSACF (Network Function) can reject a single or both Access Types depending on the applicability of the Access Type for the NSAC.
NOTE 2:	I-SMF (Network Function) does not interact with NSCAF.
The main differences between the NSACFs deployed in a non-hierarchal architecture and NSACFs deployed in a hierarchal architecture is as follows:
-	The NSCAF is enhanced to support PDU session admission quota-based control.
-	When the local maximum number of PDU sessions is reached, the NSACF (Network Function) interacts with the primary NSACF (Network Function) to handle the request. The Primary NSACF (Network Function) either return an increased local maximum number to the NSACF (Network Function), or reject the local maximum number value update request if all the global maximum number are consumed based on the status of established PDU sessions to the network slice.
-	Based on the response from primary NSACF (Network Function), the NSACF (Network Function) updates the local maximum number if updated value is received from the primary NSACF (Network Function). The NSACF (Network Function) updates local maximum number value (if received) and determines whether to accept or reject the NSAC request for PDU session establishment based on the local maximum number value.
-	The update of local maximum number value by the Primary NSACF (Network Function) can also happen at any time through the request/response service XYZ operation.
-	The Primary NSACF (Network Function) subscribes to all the NACFs to obtain the number of established PDU sessions at all NSACFs.
The main differences between the NSACFs deployed in a non-Hierarchical architecture and NSACFs deployed in a centralized architecture is as follows
-	If multiple NSAC service areas are deployed in PLMN, the SMF (Network Function) provides the NSAC service area information to the centralized NSACF (Network Function). The centralized NSACF (Network Function) also stores the NSAC service area of the SMF (Network Function) the PDU session is established on.
In the case of roaming, depending on operator's policy, a roaming agreement or an SLA between the VPLMN and the HPLMN, NSAC of roaming UEs is performed by one of the following modes of NSAC admission:
-	VPLMN NSAC Admission; or
-	VPLMN with HPLMN assistance NSAC Admission; or
-	HPLMN NSAC Admission.
The VPLMN (AMF (Network Function) and SMF (Network Function)) identifies the mode to apply from the AMF (Network Function) subscription data at UE (Network Function) registration, and from the SMF (Network Function) subscription data at PDU session establishment.
For all the above modes, for NSAC of roaming UEs for maximum number of UEs per network slice and/or maximum number of PDU Sessions per network slice managed by the VPLMN, each S-NSSAI of the HPLMN that is subject to NSAC is mapped to a corresponding S-NSSAI of the VPLMN subject to NSAC.
For both VPLMN NSAC Admission and VPLMN with HPLMN assistance NSAC Admission modes, each configured S-NSSAI that is subject to NSAC and that is mapped from the HPLMN S-NSSAI, the SMF (Network Function) performs NSAC for home routed PDU sessions according to the principles described in clause 5.15.11.2.
For NSAC of roaming UEs for maximum number of UEs per network slice and/or maximum number of PDU Sessions per network slice managed by the VPLMN, the following principles shall be used:
-	For NSAC for the maximum number of UEs for S-NSSAI of the HPLMN, a NSACF (Network Function) in the VPLMN can be configured with the maximum number of allowed roaming UEs per mapped S-NSSAI of the HPLMN for a S-NSSAI of the HPLMN that is subject to NSAC. In such a case, the AMFs trigger a request to a NSACF (Network Function) of the VPLMN.
-	For NSAC for the maximum number of PDU Sessions for S-NSSAI of the HPLMN, a NSACF (Network Function) in the VPLMN can be configured with the maximum number of allowed PDU Sessions in LBO mode per mapped S-NSSAI of the HPLMN for a S-NSSAI of the HPLMN that is subject to NSAC. In such a case, the anchor SMF (Network Function) in the VPLMN triggers a request to a NSACF (Network Function) of the VPLMN.
-	For NSAC for the maximum number of UEs for S-NSSAI of the VPLMN, AMFs trigger a request to a NSACF (Network Function) of the VPLMN to perform NSAC based on the S-NSSAI of the VPLMN subject to NSAC. The NSACF (Network Function) of the HPLMN is not involved.
-	For NSAC for the maximum number of PDU Sessions for S-NSSAI of the VPLMN in the LBO roaming case, the SMF (Network Function) triggers a request to a NSACF (Network Function) of the VPLMN to perform NSAC based on the S-NSSAI of the VPLMN subject to NSAC. The NSACF (Network Function) of the HPLMN is not involved.
‐	The AMF (Network Function) or SMF (Network Function) (in LBO roaming case) in the VPLMN provides both the S-NSSAI in the VPLMN and the corresponding mapped S-NSSAI in the HPLMN to the NSACF (Network Function) in the VPLMN. The NSACF (Network Function) in the VPLMN performs NSAC for both S-NSSAI of the VPLMN and the corresponding mapped S-NSSAI of the HPLMN based on the SLA between the VPLMN and the HPLMN.
In addition to configuring the VPLMN NFs with the maximum number of allowed roaming UEs per mapped S-NSSAI of the HPLMN subject to NSAC, and the maximum number of allowed PDU Sessions in LBO mode per mapped S-NSSAI of the HPLMN subject to NSAC, the VPLMN can optionally fetch this information from the HPLMN primary NSACF (Network Function) in a hierarchal architecture or centralized NSACF (Network Function) in a centralized architecture. If the NSACF (Network Function) in VPLMN does not have quota configured but can receive quota from the HPLMN, the NSACF (Network Function) in VPLMN may interact with the HPLMN for retrieving the quota before processing any incoming request. The VPLMN is either configured or discovers the NSACF (Network Function) in the HPLMN for quota retrieval. However, in this case, the VPLMN rejects any additional requests exceeding the received information.
In this admission mode HPLMN delegates NSAC for S-NSSAIs subject to NSAC to the VPLMN, both for number of registered UEs and the number of LBO PDU sessions.
Every NSACF (Network Function) performing admission in the VPLMN for each S-NSSAI of the HPLMN that is subject to NSAC and mapped to a corresponding S-NSSAI of the VPLMN, fetches from the VPLMN primary NSACF (Network Function) in a hierarchal architecture the maximum number of registered UEs to be admitted and/or the maximum number of LBO PDU sessions to be allowed. The VPLMN primary or central NSACF (Network Function), in turn, acquires the information from the HPLMN central or primary NSACF (Network Function) depending on the deployed architecture. The VPLMN is either configured or discovers the NSACF (Network Function) in the HPLMN for quota retrieval.
If re-distribution of quota is required in the VPLMN in a hierarchal architecture, amongst multiple NSACFs than this is handled by the primary NSACF (Network Function) in VPLMN with no involvement from the HPLMN. The VPLMN NSACF (Network Function) discovers the HPLMN primary or central NSACF (Network Function) or be configured with the needed information.
For any request(s) received in any NSACF (Network Function) in the VPLMN exceeding the received maximum number information, the NSACF (Network Function) interacts with the VPLMN primary NSACF (Network Function) which in turn interacts with HPLMN primary or central NSACF (Network Function) to receive an updated roaming quota for the corresponding mapped S-NSSAI, which is used to determine whether admission request is accepted or rejected, unless forbidden by the SLA. If an admission request is accepted, the UE (Network Function) entry is stored in the NSACF (Network Function) performing admission in the VPLMN. This applies to the number of registered UEs as well as the number of LBO PDU sessions. The primary NSACF (Network Function) in VPLMN may re-distribute the received updated roaming quota to the NSACFs in VPLMN to perform NSAC for Roaming UEs according to the principles described in clauses 5.15.11.1 and 5.15.11.2.
In this admission mode the AMF (Network Function) or SMF (Network Function) in VPLMN interacts with HPLMN for admission, both for number of registered UEs or the number of LBO PDU sessions respectively.
For each S-NSSAI of the HPLMN that is subject to NSAC and mapped to a corresponding S-NSSAI of the VPLMN, AMF (Network Function) performs NSAC admission for the number of registered UEs with the HPLMN central or primary NSACF (Network Function) for all inbound roamers from that HPLMN when they register in this VPLMN. The AMF (Network Function) discovers the HPLMN primary or central NSACF (Network Function) or be configured with the needed information.
For each S-NSSAI of the HPLMN that is subject to NSAC and mapped to a corresponding S-NSSAI of the VPLMN, every SMF (Network Function) in this VPLMN performs NSAC admission for the number of LBO PDU sessions with the HPLMN central or primary NSACF (Network Function) for all inbound roamers from that HPLMN when they initiate an LBO PDU session. The SMFs discover the HPLMN primary or central NSACF (Network Function) or be configured with the needed information. For each S-NSSAI of the HPLMN that is subject to NSAC, the SMF (Network Function) performs NSAC according to the principles described in clause 5.15.11.2 for home routed PDU sessions.
In the HPLMN NSAC admission mode, the primary NSACF (Network Function) or central NSACF (Network Function) in HPLMN determines whether the NSAC admission request for a roaming UE (Network Function) is accepted or rejected.
A consumer NF (Network Function) (e.g. AF (Network Function), Primary NSACF (Network Function)) can subscribe with the NSACF (Network Function) for Network Slice status notifications and reports. Upon such subscription, the corresponding NSACF (Network Function) in different NSAC architecture as defined in clause 5.15.11.0 can provide event based notifications and reports to the consumer NF (Network Function) (e.g. to AF (Network Function) via NEF (Network Function)) related to the current number of UEs registered for a network slice or the current number of UEs with at least one PDU Session/PDN Connection in the case of EPC interworking or the current number of PDU Sessions established on a network slice.
NOTE:	The Primary NSACF (Network Function) subscribes Network Slice status from all the NSACF (Network Function)(s) it contacts with for the update of the maximum number of UE (Network Function) or PDU session configured at the NSACF (Network Function).
This clause describes the NSAC for maximum number of registered UEs and for maximum number of PDU Sessions for network slice subjected to EPS interworking. The NSAC for maximum number of UE (Network Function) with at least one PDU Session/PDN Connection is described in clause 5.15.11.5a. A network slice subject to both NSAC and EPS counting shall be configured with only one of the options:
-	Maximum number of registered UEs and/or maximum number of PDU Session; or
-	Maximum number of UEs with at least one PDU Session/PDN Connection and/or maximum number of PDU Session.
If EPS counting is required for a network slice, the NSAC for maximum number of UEs and/or for maximum number of PDU Sessions per network slice is performed at the time of PDN connection establishment in case of EPC interworking. To support the NSAC for maximum number of UEs and/or for maximum number of PDU Sessions per network slice in EPC, the SMF (Network Function)+PGW-C is configured with the information indicating which network slice is subject to NSAC. During PDN connection establishment in EPC, the SMF (Network Function)+PGW-C selects an S-NSSAI associated with the PDN connection as described in clause 5.15.7.1. If the selected S-NSSAI by the SMF (Network Function)+PGW-C is subject to the NSAC, the SMF (Network Function)+PGW-C triggers interaction with NSACF (Network Function) to check the availability of the network slice by invoking separate NSAC procedures for number of UE (Network Function) and number of PDU Session (as described in clause 4.11.5.9 of TS 23.502 [3]), before the SMF (Network Function)+PGW-C provides the selected S-NSSAI to the UE (Network Function). If the network slice is available, the SMF (Network Function)+PGW-C continues to proceed with the PDN connection establishment procedure.
The NSACF (Network Function) performs the following for checking network slice availability prior to returning a response to the SMF (Network Function)+PGW-C:
-	For NSAC for number of UEs, if the UE (Network Function) identity is already included in the list of UE (Network Function) IDs registered with a network slice, or the UE (Network Function) identity is not included in the list of UE (Network Function) IDs registered with a network slice and the current number of UE (Network Function) registration did not reach the maximum number, the NSACF (Network Function) responds to the SMF (Network Function)+PGW-C with the information that the network slice is available. The NSACF (Network Function) includes the UE (Network Function) identity in the list of UE (Network Function) IDs if not already on the list and increases the current number of UE (Network Function) registration. Otherwise, the NSACF (Network Function) returns a response indicating that the maximum number with the network slice has been reached.
	If hierarchical NSAC architecture is deployed, when the local maximum number or local threshold is reached the NSAC may interact with the Primary NSACF (Network Function) before it returns the response back to the SMF (Network Function)+PGW-C. For more details on handling at the NSACF (Network Function) and Primary NSACF (Network Function) see clause 5.15.11.1.2.
-	For NSAC for number of PDU Sessions, if the current number of PDU sessions is below the maximum number, the NSACF (Network Function) responds to the SMF (Network Function)+PGW-C with the information that the network slice is available. The NSACF (Network Function) increases the current number of PDU sessions. Otherwise, the NSACF (Network Function) returns the response indicating that the maximum number with the network slice has been reached.
	If hierarchical NSAC architecture is deployed, when the local maximum number is reached the NSAC may interact with the Primary NSACF (Network Function) before it returns the response back to the SMF (Network Function)+PGW-C. For more details on handling at the NSACF (Network Function) and Primary NSACF (Network Function) see clause 5.15.11.2.2.
If the maximum number of UEs and/or the maximum number of PDU sessions has already been reached, unless operator policy implements a different action, the SMF (Network Function)+PGW-C rejects the PDN connection.
NOTE 1:	As an implementation option, if the APN is mapped to more than one S-NSSAI and the first selected S-NSSAI is not available (e.g. either current number of UE (Network Function) registration reached maximum or current number of PDU sessions reached maximum), then based on the operator policy the PGW-C+SMF (Network Function) can try another mapped S-NSSAI for the PDN connection establishment procedure.
If the establishment of a new PDN Connections is with a different SMF (Network Function)+PGW-C from the SMF (Network Function)+PGW-C used for already existing PDN connection associated with the same S-NSSAI, each SMF (Network Function)+PGW-C will send a request for update (e.g. increase or decrease) to the NSACF (Network Function). The NSACF (Network Function) may maintain a registration entry per SMF (Network Function)+PGW-C for the same UE (Network Function) ID.
The SMF (Network Function)+PGW-C provides the Access Type to the NSACF (Network Function) when triggering a request to increase or decrease the number of UEs and/or the number of PDU Sessions for an S-NSSAI.
NOTE 2:	The SMF (Network Function)+PGW-C determines the Access Type based on the RAT type parameter in the PMIP or GTP message received from the ePDG; or alternatively it can internally determine the Access Type based on the source node (e.g. SGW) sending the request for the PDN Connection establishment.
When the UE (Network Function) with ongoing PDN connection(s) moves from EPC to 5GC, the SMF (Network Function)+PGW-C triggers a request to decrease the number of the UE (Network Function) registration in NSACF (Network Function) and the AMF (Network Function) triggers a request to increase the number of the UE (Network Function) registration in NSACF (Network Function) when the UE (Network Function) is registered in the new AMF (Network Function). If there are more than one PDN connections associated with the S-NSSAI, the NSACF (Network Function) may receive multiple requests for the same S-NSSAI from different SMF (Network Function)+PGW-Cs. When the UE (Network Function) with ongoing PDU session(s) moves from 5GC to EPC, the SMF (Network Function)+PGW-C triggers a request to increase the number of the UE (Network Function) registration in NSACF (Network Function) and the old AMF (Network Function) triggers a request to decrease the number of the UE (Network Function) registration in NSACF (Network Function) when the UE (Network Function) is deregistered in old AMF (Network Function). If there are more than one PDU sessions associated with the S-NSSAI, the NSACF (Network Function) may receive multiple requests for the same S-NSSAI from different SMF (Network Function)+PGW-Cs. The NSACF (Network Function) maintains a list of UE (Network Function) IDs based on the requests from SMF (Network Function)+PGW-C(s) and AMF (Network Function), and adjusts the current number of registrations accordingly.
When EPS counting is performed for a network slice, and the UE (Network Function) with ongoing PDN connection(s) moves from EPC to 5GC, session continuity is guaranteed from NSAC standpoint, as the admission was granted at the time of PDN connection establishment, i.e. the number of PDU session is not counted again in 5GC. Similarly, when the UE (Network Function) with ongoing PDU session(s) moves from 5GC to EPC, session continuity is guaranteed from NSAC standpoint as the admission of the PDN Connection(s) to the network slice was already granted at the time of PDU Session establishment in 5GC.
If the PDN connection associated with S-NSSAI is released in EPC, the SMF (Network Function)+PGW-C triggers a request (i.e. decrease) to NSACF (Network Function) for maximum number of UEs and/or maximum number of PDU sessions per network slice control. The NSACF (Network Function) decreases the current number of registrations and removes the UE (Network Function) identity from the list of UE (Network Function) IDs if the PDN connection(s) associated with the S-NSSAI are all released in EPC.
NOTE 3:	NSAC in EPC is not performed for the attachment without PDN connectivity.
If EPS counting is not required for a network slice, the NSAC for maximum number of UEs and/or for maximum number of PDU Sessions per network slice is performed when the UE (Network Function) moves from EPC to 5GC, i.e. when the UE (Network Function) performs mobility Registration procedure from EPC to 5GC (NSAC for maximum number of UEs per network slice) and/or when the PDN connections are handed over from EPC to 5GC (NSAC for maximum number of PDU Sessions per network slice). The SMF (Network Function)+PGW-C is configured with the information indicating the network slice is subject to NSAC only in 5GS. The PDN connection interworking procedure is performed as described in clause 5.15.7.1. Mobility from EPC to 5GC does not guarantee all active PDU Session(s) can be transferred to the 5GC in certain circumstances when either the current number of UE (Network Function) registration or the current number of PDU sessions would exceed the maximum number when the UE (Network Function) moves from EPC to 5GC. When the UE (Network Function) with ongoing PDU session(s) moves from 5GC to EPC, the SMF (Network Function)+PGW-C triggers a request to decrease the number of PDU Session to NSACF (Network Function). If there are more than one PDU sessions associated with the S-NSSAI, the NSACF (Network Function) may receive multiple requests for the same S-NSSAI from different SMF (Network Function)+PGW-Cs and NSACF (Network Function) removes the PDU Session ID(s) while decreasing the number of PDU Session(s).
NOTE 4:	Given that session continuity is not guaranteed when EPS counting is not required, it is recommended for services which require the session continuity to support EPS counting.
NOTE 5:	When multiple NSACFs are deployed and if the number of UE (Network Function) in target NSACF (Network Function) has reached the maximum number, whether session continuity can be guaranteed is left to implementation.
NOTE 6:	When a centralized architecture is deployed, UE (Network Function) admission is guaranteed at inter-system and inter-AMF (Network Function) mobility if the same NSACF (Network Function) is selected. This is the case for non-roaming scenarios and for roaming scenarios with HPLMN NSAC Admission Mode described in clause 5.15.11.3.
5.15.11.5a	Support of Network Slice Admission Control in 5GS for maximum number of UEs with at least one PDU Session/PDN Connection
When EPS counting is required for a network slice and NSACF (Network Function) is configured with maximum number of UEs with at least one PDU Session/PDN Connection, the NSACF (Network Function) keeps track of the current number of UEs with at least one PDU session/PDN connection established on a network slice to ensure it does not exceed the maximum configured number.
To support the NSAC for maximum number of UEs with at least one PDU Session/PDN Connection, the SMF (Network Function)+PGW-C may be configured with one of the following options:
-	Option 1: Triggering an Nnsacf_NSAC_NumOfUEsUpdate_Request to NSACF (Network Function) for NSAC for maximum number of UEs when the UE (Network Function) establishes first PDU Session/PDN connection associated with the network slice in the SMF (Network Function)+PGW-C, or when the last PDU Session/PDN connection associated with the network slice is released. The NSACF (Network Function) performs admission control as described in clause 5.15.11.5 and the number of registered UE (Network Function) is replaced with number of UE (Network Function) with at least one PDU session/PDN connection. The AMF (Network Function) is not configured for this S-NSSAI to be subject to NSAC; or
-	Option 2: Triggering an Nnsacf_NSAC_NumOfPDUsUpdate_Request as described in clause 5.15.11.5 to NSACF (Network Function) and the NSACF (Network Function) performs admission control for the number of UEs with at least one PDU Session/PDN connection as follows:
-	The NSACF (Network Function) supports handling both for the number of UEs with at least one PDU Session/PDN Connection and number of PDU session for the S-NSSAI that is subject to EPC interworking and NSAC. In this case the AMF (Network Function) is not configured for this S-NSSAI to be subject to NSAC. As an optimization option, the SMF (Network Function)+PGW-C can be configured not to trigger the Nnsacf_NSAC_NumOfUEsUpdate_Request to NSACF (Network Function).
-	When the NSACF (Network Function) receives request to increase the current number of PDU Session/PDN Connection established for the network slice, the NSACF (Network Function) checks whether this is the first PDU Session/PDN Connection associated with the network slice. If this is the first PDU Session/PDN Connection associated with the network slice the NSACF (Network Function) checks whether the maximum number of UEs with at least one PDU Session/PDN Connection has been reached. If the maximum number has not been reached then the NSACF (Network Function) increases the number of UE (Network Function) with at least one PDU session/PDN connection and add an entry for UE (Network Function) ID. If the maximum number of UEs has already been reached, unless operator policy implements a different action, the SMF (Network Function)+PGW-C rejects the PDU Session/PDN connection indicating the cause being the number of UEs in the network slice has been exceeded.
-	When the NSACF (Network Function) receives request to decrease the current number of PDU Session/PDN Connection established for the network slice, the NSACF (Network Function) locates the UE (Network Function) entry, checks whether this is the last PDU Session/PDN Connection associated with the network slice for the UE (Network Function). If it is the last PDU Session/PDN Connection the NSACF (Network Function) decreases the number of UE (Network Function) with at least one PDU session/PDN connection and remove the associated UE (Network Function) entry.
NOTE 1:	A PLMN can deploy one of the above two options for a slice when EPS counting is required for a network slice and NSACF (Network Function) is configured with maximum number of UEs with at least one PDU Session/PDN Connection.
In both options, the SMF (Network Function)+PGW-C provides the Access Type to the NSACF (Network Function) when triggering a request to increase or decrease or update the number of UEs with at least one PDU Session/PDN Connection and/or the number of PDU Sessions for an S-NSSAI.
In the case of roaming, same mechanisms in clause 5.15.11.3 are used and number of registered UE (Network Function) is replaced with number of UE (Network Function) with at least one PDU Session/PDN Connection. For home routed PDU Session/PDN Connection only HPLMN admission mode can be used in this case.
If hierarchical NSAC architecture is deployed, when the local maximum number or local threshold is reached the NSAC may interact with the Primary NSACF (Network Function) before it returns the response back to the SMF (Network Function)+PGW-C. For more details on handling at the NSACF (Network Function) and Primary NSACF (Network Function) see clause 5.15.11.1.2.
NOTE 2:	When NSAC for number of UEs with at least one PDU session or one PDN connection is used, the session continuity is guaranteed at inter-system mobility as the admission is granted during the establishment of the PDU Session/PDN Connection.
The subscription information for a UE (Network Function) may include for each S-NSSAI Network Slice Simultaneous Registration Group (NSSRG) information constraining which S-NSSAIs can be simultaneously provided to the UE (Network Function) in the Allowed NSSAI.
When S-NSSAIs have associated NSSRG information, then the S-NSSAIs in the Allowed NSSAI shall share at least one NSSRG.
The NSSRG information, defining the association of S-NSSAIs to NSSRG, is provided as an additional and separate information.
 If the optional NSSRG information is not present for the S-NSSAIs of a subscription, and other restrictions do not apply e.g. availability at a specific location, then it is assumed that all the S-NSSAIs in the subscription information can be simultaneously provided to the UE (Network Function) in the Allowed NSSAI. However, if NSSRG information is present in the subscription information, at least one NSSRG shall be associated with each of the S-NSSAIs in the subscription information. At any time, if the AMF (Network Function) has received subscription information for a UE (Network Function) that includes NSSRG information, the Allowed NSSAI for the UE (Network Function) can only include S-NSSAIs which share a common NSSRG.
NOTE 1:	The AMF (Network Function) enforces NSSRG only for the access(es) the UE (Network Function) registered to the AMF (Network Function). When the UE (Network Function) is registered to different PLMNs over 3GPP access and non-3GPP access, the AMF (Network Function) in one access cannot enforce a common NSSRG over both accesses.
The default S-NSSAIs, if more than one is present, are associated with the same NSSRGs, i.e. the UE (Network Function) is always allowed to be registered with all the default S-NSSAIs simultaneously. The HPLMN only sends S-NSSAIs sharing all the NSSRGs of the Default S-NSSAIs to a non-supporting VPLMN as part of the subscription information, i.e. in addition to the default S-NSSAI(s), the HPLMN may send any other subscribed S-NSSAI which shares at least all the NSSRG defined for the default S-NSSAI(s), and the HPLMN sends no NSSRG information to the VPLMN. A subscription information that includes NSSRG information shall include at least one default S-NSSAI.
A supporting AMF (Network Function)/NSSF (Network Function), when it receives a Requested NSSAI, evaluates the S-NSSAIs of the HPLMN (in the mapping information of the Requested NSSAI, when a mapping information is applicable) based on any received NSSRG information for these S-NSSAIs, to determines whether they can be provided together in the Allowed NSSAI.
NOTE 2:	An HPLMN enabling support of subscription-based restrictions to simultaneous registration of network slices for a Subscriber, can set the subscribed S-NSSAI(s) already in the subscription information before the NSSRG information was added to the subscription information, to have the same NSSRGs defined for the default S-NSSAI(s) if it has to continue to support the same service behaviour for these S-NSSAIs.
A UE (Network Function) may support the subscription-based restrictions to simultaneous registration of network slices feature. In this case, the UE (Network Function) indicates its support in the Registration Request message in the Initial Registration and the Mobility Registration Update as part of the UE (Network Function) 5GMM Core Network Capability.
When the serving AMF (Network Function) provides the Configured NSSAI to the UE (Network Function), and the UE (Network Function) has indicated it supports the subscription-based restrictions to simultaneous registration of network slices feature, the AMF (Network Function) also provides the UE (Network Function) with the NSSRG information related to the S-NSSAIs of the HPLMN which are in the mapping information of the Configured NSSAI. A UE (Network Function) which receives the NSSRG values in the network slicing configuration information shall only include in the Requested NSSAI S-NSSAIs that share a common NSSRG as per the received information. If the UE (Network Function) has stored Pending NSSAI and the UE (Network Function) is still interested in the Pending NSSAI then all the S-NSSAIs in the Requested NSSAI and the Pending S-NSSAI shall share a common NSSRG. If the HPLMN changes NSSRG information in the subscription information for a UE (Network Function), the UDM (Network Function) updates the supporting AMF (Network Function) serving the UE (Network Function) with the new NSSRG information and the AMF (Network Function), possibly after interaction with the NSSF (Network Function) (see clause 5.2.16.2.1 of TS 23.502 [3]), updates the UE (Network Function) as necessary with network slicing configuration by means of the UE (Network Function) Configuration Update procedure (this may include changes in the Configured NSSAI (and related mapping information) and changes in the Allowed NSSAI as applicable). The UE (Network Function) acknowledges this UE (Network Function) Configuration Update according to clause 4.2.4.2 of TS 23.502 [3].
At any time, a UE (Network Function) supporting subscription-based restrictions to simultaneous registration of network slices feature and that has received NSSRG information together with the Configured NSSAI shall only request S-NSSAIs, across all Access Type(s) regardless of whether the same PLMN or different PLMNs are used, that share one or more common NSSRG.
NOTE:	In Requested NSSAI across all Access Type(s), the UE (Network Function) needs to include S-NSSAIs that share at least one common NSSRG.
An AMF (Network Function) which supports the subscription-based restrictions to simultaneous registration of network slice feature configures a non-supporting UE (Network Function) with a Configured NSSAI including only the S-NSSAIs sharing all the NSSRG values of the default S-NSSAI(s), except if it has been instructed otherwise by the UDM (Network Function). In addition to the default S-NSSAI(s), the AMF (Network Function) sends to the UE (Network Function) in the Configured NSSAI any other subscribed S-NSSAI whose NSSRG match at least those defined for the default S-NSSAI(s).
The UDM (Network Function) in a supporting HPLMN may optionally keep a record of the PEIs or Type Allocation Codes values regarding UE (Network Function) ability to handle network slices that cannot be provided simultaneously in Allowed NSSAI.
The UDM (Network Function) may, based on configuration or the optional PEI records, indicate the AMF (Network Function) to provide the non-supporting UEs with the full set of subscribed S-NSSAIs even if they do not share a common NSSRG. The UDM (Network Function) instructs the supporting AMFs of a PLMN to do so by indicating that the UE (Network Function) can be given a Configured NSSAI with all the S-NSSAIs in the subscription information. If this indication is received from the UDM (Network Function) by the AMF (Network Function), this is included in the UE (Network Function) context.
Based on its policy (including configuration or optionally checking the specific PEI or Type Allocation Code used by the UE (Network Function), and subject to roaming agreement) the UDM (Network Function) may also provide the serving AMF (Network Function) in a non-supporting VPLMN with all the S-NSSAI in the subscription information. In this case the AMF (Network Function) provides the UE (Network Function) with a Configured NSSAI including all the S-NSSAIs in the subscription information the AMF (Network Function) receives.
The AMF (Network Function) provides no NSSRG information to a non-supporting UE (Network Function).
When an AMF (Network Function) which supports the subscription-based restrictions to simultaneous registration of network slice feature, receives from a UE (Network Function) a Requested NSSAI including S-NSSAIs that are supported in the Tracking Area but do not share a common NSSRG, or the AMF (Network Function) has pending NSSAI stored for the UE (Network Function), and the S-NSSAI(s) of the requested NSSAI and the pending NSSAI do not share a common NSSRG, the AMF (Network Function) assumes the UE (Network Function) configuration is not up-to-date, and provides the following:
-	a supporting UE (Network Function) with an updated configuration including the up-to-date NSSRG information for the S-NSSAIs in the Configured NSSAI as described above.
-	a non-supporting UE (Network Function) with an updated Configured NSSAI including only the S-NSSAIs sharing all the NSSRG values of the default S-NSSAI(s), only for the case where the UE (Network Function) context does not include an indication to provide all the subscribed S-NSSAIs in the subscription information in the Configured NSSAI for the UE (Network Function).
A UE (Network Function) subscription information may include an optional Slice Maximum Bit Rate for the UE (Network Function) (Subscribed UE (Network Function)-Slice-MBR) for an S-NSSAI, which applies for 3GPP access type only. The Subscribed UE (Network Function)-Slice-MBR includes a UL and a DL value. If a Subscribed UE (Network Function)-Slice-MBR is associated to an S-NSSAI in the subscription information, it is provided by the AMF (Network Function) to the NG-RAN (Network Function) when the AMF (Network Function) provides the Allowed NSSAI for the UE (Network Function) to the NG-RAN (Network Function) as UE (Network Function)-Slice-MBR QoS parameter. The UE (Network Function)-Slice-MBR QoS parameter is defined in clause 5.7.2.6. If the Subscribed UE (Network Function)-Slice-MBR for a UE (Network Function) changes, the AMF (Network Function) updates UE (Network Function)-Slice-MBR in the NG-RAN (Network Function) accordingly.
In roaming case, the UE (Network Function)-Slice-MBR is provided for the S-NSSAI of the VPLMN which maps to the S-NSSAI of the HPLMN and the AMF (Network Function) may first interact with the PCF (Network Function) for authorization of the Subscribed UE (Network Function)-Slice-MBR. If the AMF (Network Function) interacts with the PCF (Network Function), the PCF (Network Function) may provide the Authorized UE (Network Function)-Slice-MBR that is used as UE (Network Function)-Slice-MBR by the AMF (Network Function) as described in clause 6.1.2.1 of TS 23.503 [45].
For a roaming UE (Network Function), the S-NSSAI of the VPLMN maps to only one S-NSSAI of the HPLMN for which an UE (Network Function)-Slice-MBR is applied.
The enforcement of the UE (Network Function)-Slice-MBR value, if present in the UE (Network Function) context in the NG-RAN (Network Function) for an S-NSSAI, is described in clause 5.7.1.10.
NOTE:	The PCF (Network Function) for the PDU Session may in addition be configured to monitor the data rate per Network Slice for a UE (Network Function) and to strengthen or relax the traffic restrictions for individual PDU Sessions or PCC rules accordingly, as described in TS 23.503 [45] clause 6.2.1.9.
The NG-RAN (Network Function) may support Network Slice AS Groups (NSAGs) which are used as specified in TS 38.300 [27], TS 38.331 [28], TS 38.321 [143] and TS 38.304 [50]. A Network Slice AS Group is an identifier of a group of network slices which are associated with it. A Network Slice AS Group association with a group of network slices may be valid in one or more Tracking Areas. An S-NSSAI can be associated with at most one NSAG values for Random Access and at most one NSAG value for Cell Reselection within a Tracking Area. An S-NSSAI can be associated with different NSAG values in different Tracking Areas.
The NG-RAN (Network Function) provides (and updates) the AMF (Network Function) with the values of the NSAG(s) an S-NSSAI is associated with in a TA using the NG Set Up and RAN (Network Function) Configuration Update procedures (see TS 38.413 [34]). The AMF (Network Function) in turn provides this information to the NSSF (Network Function). In deployments where the total number of groups does not exceed the number of groups associated with the NSAG size limit defined in TS 38.331 [28]), all the NSAGs configured in the NG-RAN (Network Function) may be unique per PLMN or SNPN. If the UE (Network Function) has indicated that the UE (Network Function) supports NSAG in the 5GMM Core Network Capability (see clause 5.4.4a), the AMF (Network Function) may, with or without NSSF (Network Function) assistance, configure the UE (Network Function) with NSAG Information for one or more S-NSSAIs in the Configured NSSAI, by including this NSAG Information in the Registration Accept message or the UE (Network Function) Configuration Command message. The UE (Network Function) uses the NSAG Information as defined in clause 5.3.4.3.1. The AMF (Network Function) shall indicate in the NSAG Information in which TA a specific NSAG association to S-NSSAI(s) is valid if the AMF (Network Function) provides in the UE (Network Function) configuration a NSAG value which is used in different TAs with a different association with NSSAIs. The configuration the AMF (Network Function) provides includes at least the NSAGs for the UE (Network Function) for the TAs of the Registration Area. If the AMF (Network Function) does not include the list of TAIs in association with an NSAG in the NSAG Information, the NSAG is valid in the Registered PLMN and equivalent PLMNs, or SNPN.
NOTE:	If the NSAGs for the PLMN and equivalent PLMNs have different associations to S-NSSAIs, then the AMF (Network Function) includes the list of TAIs in the NSAG information.
The UE (Network Function) shall store and consider the received NSAG Information, valid for the Registered PLMN and equivalent PLMNs, or SNPN until:
-	the UE (Network Function) receives new NSAG information in a Registration Accept message or UE (Network Function) Configuration Command message in this PLMN or SNPN; or
-	the UE (Network Function) receives a Configured NSSAI without any NSAG information in this PLMN or SNPN.
The UE (Network Function) shall store the currently valid NSAG information received in the Registered PLMN or SNPN when registered in this PLMN or SNPN and:
-	The UE (Network Function) should be able to store the NSAG information for at least the Registered-PLMN and equivalent PLMNs, or the Registered-SNPN and equivalent SNPNs.
-	The Registered-PLMN can provide NSAG information to the UE (Network Function) for the PLMN and the equivalent PLMNs, and the Registered-SNPN can provide NSAG information to the UE (Network Function) for the SNPN.
-	There can be at most 32 NSAGs configured in the UE (Network Function) at a time for a PLMN or SNPN.
-	At most 4 NSAGs can have an optional TAI associated with it.
The NSAG information is not required to be stored after power off or after the UE (Network Function) becomes Deregistered as it is not used for cell selection.
Network Slice usage control is achieved as follows:
1)	Configuring network-controlled Slice Usage Policy to supporting UEs (see clause 5.15.15.2).
2)	Configuring PDU Sessions inactivity timers, and Network Slice deregistration inactivity timers (see clause 5.15.15.3).
NOTE:	Roaming is not supported in this Release of the specification.
The UE (Network Function) during the Registration procedure may indicate in UE (Network Function) MM Core Network Capability that it supports UE (Network Function) configuration of network-controlled Slice Usage Policy. If so, the AMF (Network Function) determines Slice Usage Policy for a Network Slice for the UE (Network Function) and may configure the UE (Network Function) with this information together with Configured NSSAI to control the usage of this Network Slice. The AMF (Network Function) may be locally configured with network Slice Usage Policy, or receive the policy from the (AM-)PCF (Network Function), or per the information received from UDM (Network Function) for AF (Network Function) managed timer values (see clause 5.15.15.3 for more details).
The network-controlled Slice Usage Policy is provided to the UE (Network Function) in the Registration Accept or the UE (Network Function) Configuration Update Command and may include:
-	An indication, for one or more of S-NSSAI(s) of the HPLMN in the Configured NSSAI, whether the UE (Network Function) only registers with the Network Slice with the network when applications in the UE (Network Function) require data transmission in the Network Slice (i.e. the UE (Network Function) can only register the Network Slice only on demand and consider the Network Slice as on demand S-NSSAI).
NOTE:	All Other Network Slices in the Configured NSSAI are handled by the UE (Network Function) using UE (Network Function) specific policies (e.g. they may be registered irrespective of applications need).
-	For all on demand S-NSSAI(s) of the HPLMN in the Configured NSSAI, a deregistration inactivity timer that causes the UE (Network Function) to deregister the Network Slice after the last PDU Session associated with the S-NSSAI is released. This deregistration inactivity timer is started at the UE (Network Function) and AMF (Network Function) per access type when the last PDU Session associated with the S-NSSAI is released, or the Network Slice is included in the Allowed NSSAI and no PDU session is established. The deregistration inactivity timer is stopped and reset when the first PDU session is established or the S-NSSAI is removed from the Allowed NSSAI. The AMF (Network Function) and UE (Network Function) may locally remove the S-NSSAI from the Allowed NSSAI when the timer expires. The AMF (Network Function) may also send a UE (Network Function) Configuration Update Command to remove the slice from the Allowed NSSAI.
	If the UE (Network Function) and network state became misaligned, the UE (Network Function) may, for example, request connectivity in a Network Slice which is no longer allowed. In this case, the AMF (Network Function) shall provide the updated Allowed NSSAI in a UE (Network Function) Configuration Update Command after rejecting the PDU Session establishment. The UE (Network Function) may then re-register with the Network Slice if needed.
The AMF (Network Function) receives deregistration inactivity timer values as described in clause 5.15.15.3.
The 5GC performs Network Slice usage monitoring to be able to enforce the release of inactive PDU Sessions, and deregistering of UEs from Network Slices with no PDU Sessions on them according to its own policies. In order to support usage monitoring for a Network Slice:
-	the AMF (Network Function) runs a slice deregistration inactivity timer per S-NSSAI and access type to deregister the Network Slice which is started when the Network Slice is not used by any PDU Session over the corresponding access type. The slice deregistration inactivity timer is stopped and reset when at least a PDU Session associated with the Network Slice is successfully established or the Network Slice is removed form the Allowed NSSAI. When the slice deregistration inactivity timer for a Network Slice over an access type expires, the AMF (Network Function) removes the Network Slice from the Allowed NSSAI over the access type by sending the UE (Network Function) Configuration Update Command to impacted UE (Network Function)(s).
-	the SMFs provide to UPFs that handle the PDU sessions in the Network Slice a PDU Session inactivity timer. The PDU Session inactivity timer is started after no data packet is transmitted or received and runs until the next data packet is transmitted or received which restarts the timer again. If the PDU Session inactivity timer expires before any packet is received or transmitted, the UPF (Network Function) reports this PDU Session inactivity event to the SMF (Network Function) to cause the SMF (Network Function) to release the PDU Session. While releasing the PDU session the SMF (Network Function) may indicate the release cause because of slice inactivity. When the AMF (Network Function) receives the notification of PDU Session release and it includes the release cause of slice inactivity and if the Network Slice of the released PDU Session is not used by other PDU Sessions (i.e. the last PDU Session using the Network Slice is released) over the corresponding access type, the AMF (Network Function) may trigger the UE (Network Function) Configuration Update procedure to remove the Network Slice from the Allowed NSSAI over that corresponding access type or start slice deregistration inactivity timer for the Network Slice.
If an S-NSSAI is dedicated for a single AF (Network Function), and if authorized by operator policy to provide deregistration inactivity/PDU Session inactivity timer values for the S-NSSAI, the AF (Network Function) uses external parameter provisioning procedure to provide deregistration inactivity and PDU session inactivity timer values as described in clause 4.15.6.2 of TS 23.502 [3]. In this case, the AF (Network Function) provided timer values are stored in the UDM (Network Function) and provided to the AMF (Network Function)/SMF (Network Function) as part of subscription data for the corresponding S-NSSAI. If no AF (Network Function) is authorized to provide deregistration inactivity/PDU Session inactivity timer values for the S-NSSAI, the slice deregistration inactivity timer value and PDU Session inactivity timer value are either pre-configured in the AMF (Network Function)/SMF (Network Function) or received by the AMF (Network Function)/SMF (Network Function) during the AM Policy Association / SM Policy Association procedure respectively.
To enable a serving network to direct UEs to a preferred Network Slice, the AMF (Network Function) may request the UE (Network Function) to transfer a PDU Session from one S-NSSAI to another S-NSSAI as described in clause 5.15.19.
A network slice may be available for all UEs or a limited number of UEs only for a limited time that is known at the network in advance e.g. by OAM or subscription. The limited time duration may be due to, for example, the fact that network slice is only temporarily or periodically active in the deployment (e.g. for a limited time to serve an event or a UE (Network Function) may be only authorized to access the network slice for a limited time known in advance), or the network slice is being decommissioned at a known future time. This feature is enabled by S-NSSAI validity time that the network and the UE (Network Function) can handle to reduce the signalling load associated to the transitions in RM and SM states for the network slice.
The UE (Network Function) may indicate its support for temporarily available network slices in the UE (Network Function) MM Core Network Capability (see clause 5.4.4a) in the Registration Request. The AMF (Network Function), based on OAM configuration or information received from the UDM (Network Function) or NSSF (Network Function), may indicate to a supporting UE (Network Function) the validity time for one or more S-NSSAIs in the Configured NSSAI in the Registration Accept message or via the UE (Network Function) Configuration Update procedure. In roaming case, the AMF (Network Function) my include the validity time for an S-NSSAI in the Configured NSSAI either because of limited availability of the VPLMN S-NSSAI or the mapped S-NSSAI of the HPLMN.
NOTE 1:	When the validity time changes or a validity time is determined for a S-NSSAI in the configured NSSAI, the PLMN provides the new validity time for the S-NSSAIs in the Configured NSSAI to a supporting UE (Network Function).
If a supporting UE (Network Function) is configured with validity time for an S-NSSAI:
a)	If the validity time indicates the S-NSSAI is available, the UE (Network Function) may request the S-NSSAI in a Requested NSSAI in a Registration request and, if the S-NSSAI is included in the Allowed NSSAI or in the Partially Allowed NSSAI, the UE (Network Function) may establish PDU sessions associated with the S-NSSAI.
b)	If the validity time indicates the S-NSSAI is not available
-	The UE (Network Function) shall not include the S-NSSAI in the Requested NSSAI;
-	If the S-NSSAI is already part of the Allowed NSSAI or Partially Allowed NSSAI, the UE (Network Function) shall remove the S-NSSAI from the locally stored Allowed NSSAI or Partially Allowed NSSAI and the UE (Network Function) shall also locally release any PDU sessions associated with the S-NSSAI.
-	If the validity time indicates the S-NSSAI will not be available again, the UE (Network Function) shall remove the S-NSSAI from the locally stored Configured NSSAI.
NOTE 2:	Subject to implementation decisions outside 3GPP scope, the UE (Network Function) may also use the validity time information to e.g. attempt to use another PDU sessions to continue supporting the connectivity with another connectivity option if possible according to the URSP rules, or, if not possible, e.g. provide implementation-dependent information on the availability of connectivity for specific applications affected by an impending connectivity loss, so the UE (Network Function) can let the end user prepare for the loss of connectivity.
For a supporting UE (Network Function), if validity time applies to an S-NSSAI, an AMF (Network Function) supporting temporarily available network slices shall:
-	If the S-NSSAI is provided in a Requested NSSAI in a Registration Request by the UE (Network Function) and the validity time indicates the S-NSSAI is not available, but it is going to become available again (i.e. the UE (Network Function) is detected as not having up to date validity time), then the AMF (Network Function) sends the Configured NSSAI to the UE (Network Function) including the validity time for the S-NSSAI in the Registration Accept message. If the validity time indicates the S-NSSAI is not available and will not become available again, then the AMF (Network Function) sends the Configured NSSAI to the UE (Network Function), excluding the S-NSSAI from the Configured NSSAI.
-	If the S-NSSAI is in the Allowed NSSAI or the Partially Allowed NSSAI for the UE (Network Function) and the validity time indicates that the S-NSSAI is not available, then locally remove (i.e. without sending any signalling to the UE (Network Function)) the S-NSSAI from the Allowed NSSAI or Partially Allowed NSSAI. If there is any PDU session established for the S-NSSAI, the AMF (Network Function) requests the SMF (Network Function) to release the PDU session:
-	If the UE (Network Function) is in CM-CONNECTED state, the AMF (Network Function) releases the PDU session for the S-NSSAI by sending to the SMF (Network Function), as per step 1f in clause 4.3.4.2 of TS 23.502 [3], a Nsmf_PDUSession_UpdateSMContext Request with a release indication to request the release of the PDU Session and then the AMF (Network Function) forwards the N2 (Non-service-based Interface) (Service-based Interface) SM request to release the AN resources associated with the PDU session
-	If the UE (Network Function) is in CM-IDLE state, the AMF (Network Function) locally releases the PDU session without paging the UE (Network Function) and causes the SMF (Network Function) to locally release the SM context for the UE (Network Function) by a Nsmf_PDUSession_ReleaseSMContext, as in step 1c in clause 4.3.4.2 of TS 23.502 [3]. The PDU Session status is synchronized at next time when the UE (Network Function) connects to the network.
For a non-supporting UE (Network Function), if validity time applies to an S-NSSAI, an AMF (Network Function) supporting temporarily available network slices shall:
-	If the validity time indicates the S-NSSAI is available, allow or partially allow the network slice when requested, establish PDU sessions when requested.
-	If the S-NSSAI is provided in a Requested NSSAI in a Registration Request by the UE (Network Function) and the validity time indicates the S-NSSAI is not available, reject the registration and remove the S-NSSAI from the Configured NSSAI by providing an updated Configured NSSAI in the Registration Accept message.
-	If the S-NSSAI is in the UE (Network Function) in the Allowed NSSAI or Partially Allowed NSSAI and the validity time indicates the S-NSSAI is not available, remove the S-NSSAI from the Configured NSSAI and the Allowed NSSAI or Partially Allowed NSSAI by a UE (Network Function) Configuration Update procedure. If there is any PDU session established for the S-NSSAI, the AMF (Network Function) requests the SMF (Network Function) to release the PDU session in the network:
-	If the UE (Network Function) is in CM-CONNECTED state, the AMF (Network Function) releases the PDU session for the S-NSSAI by sending to the SMF (Network Function), as in step 1f in clause 4.3.4.2 of TS 23.502 [3], a Nsmf_PDUSession_UpdateSMContext Request with a release indication to request the release of the PDU Session and then the AMF (Network Function) forwards the N2 (Non-service-based Interface) (Service-based Interface) SM request to release the AN resources associated with the PDU session
-	If the UE (Network Function) is in CM-IDLE, the AMF (Network Function) locally releases the PDU session without paging the UE (Network Function) and causes the SMF (Network Function) to locally release the SM context for the UE (Network Function) by a Nsmf_PDUSession_ReleaseSMContext, as in step 1c in clause 4.3.4.2 of TS 23.502 [3]. The PDU Session status is synchronized at next time when the UE (Network Function) connects to the network
NOTE 3:	If the network slice becomes unavailable, and a large number of UEs are impacted, the AMF (Network Function) can send the updates to the non-supporting UEs in a manner that avoids surge in signalling (e.g. next time the UE (Network Function) becomes connected).
-	If the AMF (Network Function) detects from the validity time of a S-NSSAI that it is available again, then update the Configured NSSAI to include the S-NSSAI via a UE (Network Function) Configuration Update procedure.
NOTE 4:	The AMF (Network Function), for the case of UE (Network Function) not performing any actions despite the validity timing information provided by the network, can terminate PDU Session(s) associated with S-NSSAI subject to be terminated according to the validity time by explicitly releasing the PDU Sessions associated with the S-NSSAI.
A Network Slice may be supported in one or more TAs in a PLMN/SNPN. The Partial Network Slice support in a Registration Area for a UE (Network Function) includes configuring the UE (Network Function) with a Partially Allowed NSSAI and/or S-NSSAI(s) rejected partially in the RA.
When creating a Registration Area for UEs registering over the 3GPP access and supporting the Partial Network Slice support in a Registration Area, the AMF (Network Function) may consider the trade-off between signalling for paging in TAs where the S-NSSAI is not supported versus the signalling for Mobility Registration Updates to register with the S-NSSAI in the TA(s) where the S-NSSAI is supported, so that the AMF (Network Function) may create a Registration Area including the TA(s) where a requested S-NSSAI is not supported. For supporting UEs, whether the AMF (Network Function) uses the Partially Allowed NSSAI or rejects the S-NSSAIs partially in the RA, or whether the AMF (Network Function) rejects the S-NSSAI for the current RA, is a per S-NSSAI decision which is based on AMF (Network Function) local policy. If supported and allowed by local policy, the Partially Allowed NSSAI and S-NSSAIs rejected partially in the RA may be applied simultaneously for one UE (Network Function) for different S-NSSAIs.
For such S-NSSAI:
-	If requested by the UE (Network Function) from a TA where the S-NSSAI is not supported,
-	the S-NSSAI is included either in the Partially Allowed NSSAI or the AMF (Network Function) rejects the S-NSSAI partially in the RA; or
-	if the S-NSSAI is subject to NSAC for maximum number of UEs, then the AMF (Network Function) should send this S-NSSAI as rejected partially in the RA, in the Registration Accept message.
-	If the S-NSSAI is subject to NSSAA and successful NSSAA status for the S-NSSAI is not present in the AMF (Network Function), then the AMF (Network Function) either sends this S-NSSAI as rejected partially in the RA in the Registration Accept message, or the AMF (Network Function) starts executing NSSAA and includes the S-NSSAI in the Pending NSSAI in the Registration Accept message. If the S-NSSAI is subject to NSSAA and successful NSSAA status for the S-NSSAI is present, then the AMF (Network Function) may include the S-NSSAI either in the Partially Allowed NSSAI or the AMF (Network Function) rejects the S-NSSAI partially in the RA.
NOTE 1:	In roaming case the NSSAA requirement is based on the mapped S-NSSAI of the HPLMN.
-	if the slice deregistration inactivity timer is configured for the S-NSSAI (see clause 5.15.15.3), then AMF (Network Function) should send this S-NSSAI as rejected partially in the RA.
-	If requested by the UE (Network Function) from a TA where the S-NSSAI is supported,
-	the S-NSSAI is included in the Partially Allowed NSSAI; or
-	if the S-NSSAI is subjected to NSAC for maximum number of UEs, then the AMF (Network Function) should restrict the RA so that the S-NSSAI is supported in all the TAs of the RA and includes the S-NSSAI in the Allowed NSSAI.
-	If the S-NSSAI is subject to NSSAA, then the AMF (Network Function) starts executing NSSAA and sends this S-NSSAI in the Pending NSSAI in the Registration Accept message, unless successful NSSAA status is present in the AMF (Network Function) for this S-NSSAI (in which case it can be sent in the Partially Allowed NSSAI).
NOTE 2:	In roaming case the NSSAA requirement is based on the mapped S-NSSAI of the HPLMN.
-	if the S-NSSAI is included in neither the Partially Allowed NSSAI nor the Allowed NSSAI, the AMF (Network Function) may reject the S-NSSAI as described in clause 5.15.4.1.1.
While the S-NSSAIs of the Allowed NSSAI are supported in all the TAs of the Registration Area, the S-NSSAIs of the Partially Allowed NSSAI are supported only in the TAs corresponding to the list of TAs (which are subset of the list of TAIs forming the Registration Area) associated with the S-NSSAI.
If the UE (Network Function) supports Partial Network Slice support in a Registration Area, the AMF (Network Function) may create a Registration Area for the UE (Network Function) considering the support of the S-NSSAIs of the Requested NSSAI in the current TA and in the neighbouring TAs and provides to the UE (Network Function) in the Registration Accept message or in the UE (Network Function) Configuration Update Command message the Partially Allowed NSSAI or the S-NSSAIs rejected partially in the RA as follows:
-	If one or more of the requested S-NSSAI(s) are supported in a subset of the TAs of the (potential) Registration Area, the AMF (Network Function) may include such S-NSSAI(s) in the Partially Allowed NSSAI and corresponding mapping information of the S-NSSAI(s) of the Partially Allowed NSSAI to the HPLMN S-NSSAI(s). For each S-NSSAI of the Partially Allowed NSSAI the AMF (Network Function) provides a list of TAs where the S-NSSAI is supported. The UE (Network Function) is considered registered with the S-NSSAI in the whole Registration area. The AMF (Network Function) also provides the Partially Allowed NSSAI (without indication of the TA list where the partially allowed S-NSSAIs are supported) to the NG-RAN (Network Function) together with the UE (Network Function)'s context.
-	Alternatively, the AMF (Network Function) may reject the S-NSSAI(s) with reject cause indicating "partially in the RA". For each S-NSSAI of the S-NSSAIs rejected partially in the RA the AMF (Network Function) provides a list of TAs for which the S-NSSAI is supported or not supported.
NOTE 3:	If the UE (Network Function) requests an S-NSSAI in a cell of a TA where the NS-AoS of the S-NSSAI does not match deployed Tracking Areas (see clause 5.15.18), the AMF (Network Function) includes the S-NSSAI in the Allowed NSSAI or Partially Allowed NSSAI.
When the UE (Network Function) stores Partially Allowed NSSAI the following applies:
-	the UE (Network Function) is considered registered with an S-NSSAI of the Partially Allowed NSSAI in the whole Registration area. The UE (Network Function) does not trigger registration when moving between the TAs of support and non-support for the S-NSSAI within the RA.
-	The UE (Network Function) is allowed to initiate PDU Session establishment for the S-NSSAI only when the UE (Network Function) is in a TA where the S-NSSAI is supported.
-	When the UE (Network Function) has already established a PDU Session with an S-NSSAI part of the Partially Allowed NSSAI, the UE (Network Function) is allowed to activate the User Plane Resources of the PDU Session only when the UE (Network Function) is in a TA part of the list of TAs associated with each S-NSSAI.
-	When the User Plane Resources are activated for a PDU Session of an S-NSSAI part of the Partially Allowed NSSAI and the UE (Network Function) moves to a TA which is not part of the list of TAs associated with the S-NSSAI, the User Plane Resources for the PDU Session shall be deactivated, but the PDU Session context in UE (Network Function) and SMF (Network Function) is not released. The User Plane Resources for the PDU Session shall not be activated as long as the UE (Network Function) is located in a TA which is not part of the list of TAs associated with the S-NSSAI of the Partially Allowed NSSAI. The UE (Network Function) and SMF (Network Function) shall not exchange user data as payload of a NAS (Protocol) message in both uplink and downlink directions.
When the UE (Network Function) stores a S-NSSAI rejected partially in the RA with the associated list of TAs, the UE (Network Function) is allowed to initiate a Mobility Registration Update procedure to request registration with the S-NSSAI only when the UE (Network Function) is in a TA supporting this S-NSSAI.
The network support for a Network Slice is defined on a per Tracking Area granularity. It may be beneficial to deploy some Network Slices such that the Network Slice have a limited geographical availability that is not matching existing Tracking Area boundaries.
The operator can in this case decide to change the topology of the Tracking Areas so they match the boundaries of the Network Slice, or the operator may configure resources for the Network Slices in the cells of TAs where the Network Slices are to be available, and in areas of the TAs where the network slice is defined to be not available the cells are configured with zero resources.
The AMF (Network Function) receives from the OAM the information on availability of a network slice when the granularity is smaller than TA, i.e. if the NS-AoS includes TAs where the network slice is not available in some cells of the TA.
In order to optimize the end-to-end behaviour, the AMF (Network Function) can, based on NS-AoS information received from OAM, configure supporting UEs with S-NSSAI location availability information, and the network may need to monitor the S-NSSAI usage and enforce the NS-AoS e.g. if the UE (Network Function) does not support the S-NSSAI location availability information.
S-NSSAI location availability information defines additional restrictions to the usage of an S-NSSAI in TAs where the Network Slice availability does not match the TA boundaries. The AMF (Network Function) is configured per S-NSSAI whether to send the S-NSSAI location availability information to supporting UEs.
The S-NSSAI location availability information sent to the UE (Network Function) includes, for each applicable S-NSSAI of the Configured NSSAI, Location information indicating the cells of TAs in the RA where the related S-NSSAI is available if the S-NSSAI is not available in all the cells of the TA.
If the UE (Network Function) has indicated that the UE (Network Function) supports S-NSSAI location availability information in the 5GMM Core Network Capability (see clause 5.4.4a), the AMF (Network Function) may, based on OAM configuration, configure the UE (Network Function) with S-NSSAI location availability information for one or more S-NSSAIs when the AMF (Network Function) allocates an RA where the Network Slice availability does not match whole TAs, by including the S-NSSAI location availability information in the Registration Accept message or the UE (Network Function) Configuration Command message. A UE (Network Function) that receives S-NSSAI location availability information applies the information as follows.
1.	If the S-NSSAI is rejected in the RA or rejected partially in the RA or rejected with a cause code that allows attempting to register the S-NSSAI again, the UE (Network Function) can request the S-NSSAI only if the S-NSSAI location availability information indicates that the S-NSSAI is available at the cell where the UE (Network Function) is camping.
2.	If the S-NSSAI is in the Partially Allowed NSSAI or in the Allowed NSSAI, the UE (Network Function) shall not activate User Plane for any already established PDU Session with that S-NSSAI if the UE (Network Function) is in a cell within the RA but outside the Location information of the S-NSSAI. The UE (Network Function) and SMF (Network Function) shall not exchange user data as payload of a NAS (Protocol) message in both uplink and downlink directions.
3.	If the S-NSSAI is in the Partially Allowed NSSAI or in the Allowed NSSAI, and the UE (Network Function) in CM-IDLE mode is moved to a cell outside the Location information of the S-NSSAI, and the UE (Network Function) has an established PDU Session with that S-NSSAI, the PDU Session is kept.
NOTE 1:	By Radio Resource Management and existing mechanisms in NG-RAN (Network Function), handover can be used to keep the UE (Network Function) in the NS-AoS or steer the UE (Network Function) to enter the NS-AoS as long as radio conditions allow it.
NOTE 2:	Since the S-NSSAI location availability information is not a used as a trigger for the UE (Network Function) to perform MRU due to mobility, i.e. the UE (Network Function) performs MRU due to mobility upon changing to a new TA outside the UE (Network Function)'s Registration Area, the S-NSSAI remains registered and is included in the Allowed NSSAI when the UE (Network Function) exits the NS-AoS. If the S-NSSAI is subject for NSAC, the S-NSSAI is counted towards NSAC as described in clause 5.15.11 also when the UE (Network Function) is outside the NS-AoS.
OAM may configure RRM policies for S-NSSAIs on a per cell basis as defined in TS 28.541 [149], i.e. cells outside the Network Slice Area of Service while in a TA supporting the S-NSSAI are allocated with no RRM resources for the S-NSSAI.
The network may enforce the NS-AoS for an S-NSSAI as follows:
1.	The network may monitor the validity of the S-NSSAI for UE (Network Function) in CM-CONNECTED state, i.e. the AMF (Network Function) subscribes to the AoI using the Location information of the S-NSSAI location availability information as described in TS 38.413 [34].
2.	If the non-supporting UE (Network Function) makes a PDU Session establishment request with an S-NSSAI that is not valid as per the S-NSSAI location availability information, the AMF (Network Function) may reject the NAS (Protocol) Transport message with a back-off timer using S-NSSAI based congestion control as described in clause 5.19.7.4.
3.	If the AMF (Network Function) determines that the UE (Network Function) in CM-CONNECTED has moved outside the NS-AoS, the AMF (Network Function) performs the following logic:
a)	If the non-supporting UE (Network Function) has other S-NSSAI(s) in the Allowed NSSAI, then the AMF (Network Function) may update the UE (Network Function) with a UE (Network Function) Configuration Update by removing the S-NSSAI from the Allowed NSSAI (which causes the UE (Network Function) to locally release the PDU Sessions) and optionally removing the S-NSSAI from the Configured NSSAI and then, the AMF (Network Function) requests the SMF (Network Function) to locally release in the network any PDU Sessions with that S-NSSAI as per step 1f in clause 4.2.3.4 in TS 23.502 [3]. Alternatively, the AMF (Network Function) requests the SMF (Network Function) to release PDU Sessions with that S-NSSAI.
b)	If the non-supporting UE (Network Function) does not have any other S-NSSAI in the Allowed NSSAI, then the AMF (Network Function) may update the UE (Network Function) with a UE (Network Function) Configuration Update by removing the S-NSSAI from the Allowed NSSAI (which causes the UE (Network Function) to locally release the PDU Sessions) and optionally removing the S-NSSAI from the Configured NSSAI, and adding a default S-NSSAI to the Allowed NSSAI and then, the AMF (Network Function) requests the SMF (Network Function) to locally release in the network any PDU Sessions with the removed S-NSSAI as per step 1f in clause 4.2.3.4 in TS 23.502 [3]. Alternatively, the AMF (Network Function) requests the SMF (Network Function) to release PDU Sessions with that S-NSSAI.
NOTE:	Whether the AMF (Network Function) removes the S-NSSAI from Allowed NSSAI and Configured NSSAI or only releases the associated PDU Sessions when the AMF (Network Function) enforces the NS-AoS is up to AMF (Network Function) configuration.
c)	For a non-supporting UE (Network Function) that does not have any other S-NSSAI in the Allowed NSSAI nor in the Configured NSSAI, then the AMF (Network Function) indicates to the SMF (Network Function) to release the PDU Session.
4.	If the AMF (Network Function) determines that the S-NSSAI becomes valid e.g. the UE (Network Function) has moved into the NS-AoS, the AMF (Network Function) may update the UE (Network Function) with a UCU e.g. including the S-NSSAI in the Configured NSSAI.
The Network Slice Replacement feature is used to replace an S-NSSAI with an Alternative S-NSSAI when an S-NSSAI becomes unavailable or congested. The Network Slice Replacement may be triggered in the following cases:
-	If the NSSF (Network Function) detects that an S-NSSAI becomes unavailable or congested (e.g. based on OAM or NWDAF (Network Function) analytics output), it sends network slice availability notification for the S-NSSAI to the AMF (Network Function). The notification may include an Alternative S-NSSAI which can be used by the AMF (Network Function) to replace the S-NSSAI. The NSSF (Network Function) notifies the AMF (Network Function) when the S-NSSAI is available again.
-	If the PCF (Network Function) detects that an S-NSSAI becomes unavailable or congested for a UE (Network Function) (e.g. based on OAM or NWDAF (Network Function) analytics output), it sends access and mobility related policy notification to the AMF (Network Function). The notification may include an Alternative S-NSSAI which can be used by the AMF (Network Function) to replace the S-NSSAI. The PCF (Network Function) notifies the AMF (Network Function) when the S-NSSAI is available again for the UE (Network Function).
-	The OAM sends notification to AMF (Network Function) when an S-NSSAI becomes unavailable or congested (and also when this S-NSSAI becomes available again) and provides the Alternative S-NSSAI to AMF (Network Function).
Based on the notification above from NSSF (Network Function) or PCF (Network Function) or OAM, the AMF (Network Function) may determine that an S-NSSAI is to be replaced with Alternative S-NSSAI. For roaming case, the AMF (Network Function) may receive network slice availability notification of the HPLMN S-NSSAI from NSSF (Network Function) in the HPLMN via NSSF (Network Function) in VPLMN, to trigger the Network Slice Replacement of the HPLMN S-NSSAI as described in clause 5.15.6.
NOTE 1:	It is recommended that, the operator configures to use only one mechanism when triggering the Network Slice Replacement for S-NSSAI.
The AMF (Network Function) determines the Alternative S-NSSAI for a UE (Network Function) registered with the S-NSSAI based on the notification from NSSF (Network Function) or PCF (Network Function), or based on local configuration if the NSSF (Network Function) or PCF (Network Function) do not provide an alternative S-NSSAI. The Alternative S-NSSAI shall be supported in the UE (Network Function) Registration Area. If AMF (Network Function) cannot determine the Alternative S-NSSAI for the S-NSSAI, e.g. PCF (Network Function) or NSSF (Network Function) doesn't provide Alternative S-NSSAI, the AMF (Network Function) may further interact with the PCF (Network Function) to determine the Alternative S-NSSAI. The event trigger in AMF (Network Function) for interacting with PCF (Network Function) is described in clause 6.1.2.5 of TS 23.503 [45].
The UE (Network Function) indicates the support of Network Slice Replacement feature during the UE (Network Function) Registration procedure. For supporting UE (Network Function) in CM-CONNECTED state and if there is a PDU Sessions in the UE (Network Function) context associated with the S-NSSAI that needs to be replaced, the AMF (Network Function) provides the Alternative S-NSSAI for this S-NSSAI in the Allowed NSSAI and in the Configured NSSAI, if not included yet, and the mapping between S-NSSAI(s) to Alternative S-NSSAI(s) to the UE (Network Function) in UE (Network Function) Configuration Update message as follows:
-	for non-roaming UEs, the AMF (Network Function) provides the mapping of the S-NSSAI to the Alternative S-NSSAI to the UE (Network Function).
-	for roaming UEs when the VPLMN S-NSSAI has to be replaced by a VPLMN Alternative S-NSSAI, the AMF (Network Function) provides the mapping of the VPLMN S-NSSAI to the Alternative VPLMN S-NSSAI to the UE (Network Function).
-	for roaming UEs when the HPLMN S-NSSAI has to be replaced by an Alternative HPLMN S-NSSAI, the AMF (Network Function) provides the mapping of the HPLMN S-NSSAI to the Alternative HPLMN S-NSSAI to the UE (Network Function).
NOTE 2:	The Alternative S-NSSAI or Alternative HPLMN S-NSSAI does not have to be part of the Subscribed S-NSSAI as long as they can be mapped to a HPLMN S-NSSAI that is part of the Subscribed S-NSSAIs.
For the supporting UE (Network Function) in CM-IDLE state, when the UE (Network Function) establishes a NAS (Protocol) signalling connection, e.g. through a Service Request procedure or through a UE (Network Function) registration procedure, if the AMF (Network Function) determines that the S-NSSAI is to be replaced and there is a PDU Session associated with the S-NSSAI in the UE (Network Function) context, the AMF (Network Function) sends the mapping of the S-NSSAI to the Alternative S-NSSAI to the UE (Network Function) in the UE (Network Function) Configuration Update message or in the Registration Accept message.
NOTE 3:	It is left to AMF (Network Function) local policy whether to send the mapping of the S-NSSAI to the Alternative S-NSSAI to the UE (Network Function) when there is no PDU session associated with the S-NSSAI or wait and send the mapping of the S-NSSAI to the Alternative S-NSSAI to the UE (Network Function) when the UE (Network Function) establishes a PDU Session associated with the S-NSSAI.
During a new PDU Session establishment procedure towards an S-NSSAI,
-	if the UE (Network Function) is provided with the mapping of the S-NSSAI to an Alternative S-NSSAI, the UE (Network Function) provides both the Alternative S-NSSAI and the S-NSSAI in the PDU Session Establishment message. When the AMF (Network Function) receives the Alternative S-NSSAI and the S-NSSAI in the PDU Session Establishment message, or when the AMF (Network Function) receives only the S-NSSAI in PDU Session Establishment message the AMF (Network Function) determines that the S-NSSAI is to be replaced with the Alternative S-NSSAI, the AMF (Network Function) includes both the Alternative S-NSSAI and the S-NSSAI to the SMF (Network Function).
-	if the UE (Network Function) is not provided with the mapping of the S-NSSAI to the Alternative S-NSSAI, the UE (Network Function) provides the S-NSSAI in the PDU Session Establishment message. When the AMF (Network Function) determines that the requested S-NSSAI is to be replaced with the Alternative S-NSSAI and if the UE (Network Function) supports Network Slice Replacement, the AMF (Network Function) performs UE (Network Function) Configuration Update procedure to reconfigure the UE (Network Function) with the Alternative S-NSSAI. The AMF (Network Function) continues the PDU Session establishment procedure with the Alternative S-NSSAI and provides both the Alternative S-NSSAI and the S-NSSAI to the SMF (Network Function).
The SMF (Network Function) proceeds with the PDU Session establishment using the Alternative S-NSSAI. The SMF (Network Function) sends the Alternative S-NSSAI to NG-RAN (Network Function) in N2 (Non-service-based Interface) (Service-based Interface) SM information and to UE (Network Function) in PDU Session Establishment Accept message.
For existing PDU Session associated with an S-NSSAI that is replaced with the Alternative S-NSSAI, after the AMF (Network Function) sends mapping of the S-NSSAI to the Alternative S-NSSAI to the supporting UE (Network Function) in UE (Network Function) Configuration Update message, the AMF (Network Function) sends updates to the SMF (Network Function) of the PDU Session, e.g. triggering Nsmf_PDUSession_UpdateSMContext service operation, that the PDU Session is to be transferred to Alternative S-NSSAI and includes the Alternative S-NSSAI as follows (see details in clause 4.3.3 of TS 23.502 [3]):
-	If the SMF (Network Function) determines that the PDU Session needs to be retained (e.g. if the anchor UPF (Network Function) can be reused with the alternative S-NSSAI and SSC mode 1), the SMF (Network Function) sends the Alternative S-NSSAI to the UPF (Network Function) in the N4 (Service-based Interface) message, to the NG-RAN (Network Function) in N2 (Non-service-based Interface) (Service-based Interface) message and to the supporting UE (Network Function) in PDU Session Modification Command message.
-	If the SMF (Network Function) determines that the PDU Session needs to be re-established, the SMF (Network Function) sends the Alternative S-NSSAI to the supporting UE (Network Function) either in PDU Session Modification Command if the PDU Session is of SSC mode 3, or in PDU Session Release if the PDU Session is of SSC mode 2 or SSC mode 1, to trigger the re-establishment of the PDU Session. The UE (Network Function) includes both, the S-NSSAI and the Alternative S-NSSAI in the PDU Session Establishment message.
Editor's note:	How to use the existing NG-RAN (Network Function) resource of the replaced S-NSSAI is for FFS.
When the AMF (Network Function) is notified that the S-NSSAI is available again or the congestion of the S-NSSAI has been mitigated, if the AMF (Network Function) has configured the supporting UE (Network Function) with the Alternative S-NSSAI, and the AMF (Network Function) determines for the UE (Network Function) to use the S-NSSAI again, the AMF (Network Function) reconfigures the supporting UE (Network Function) (e.g. by using UE (Network Function) Configuration Update message) to use the S-NSSAI. If there is an existing PDU Session associated with the Alternative S-NSSAI, the AMF (Network Function) sends updates to the SMF (Network Function) of the PDU Session, e.g. triggering Nsmf_PDUSession_UpdateSMContext service operation, that the PDU Session is to be transferred to the S-NSSAI.
During a handover procedure, if an S-NSSAI has to be replaced with an Alternative S-NSSAI, the handover procedure (including any PDU session associated with the S-NSSAI to be replaced) shall continue unaffected by the Network Slice Replacement. Any Network Slice Replacement for the S-NSSAI shall not take place during the handover.
The Network Slice Instance Replacement is used when a PDU Session for a given S-NSSAI is established using a selected Network Slice instance and the S-NSSAI corresponding to this Network Slice instance is associated with multiple Network Slice instances. In this case, the network may change the Network Slice instance for the S-NSSAI if the selected Network Slice instance is no longer available (e.g. due to overload). The AMF (Network Function) may subscribe with the NSSF (Network Function) for notifications when any of the Network Slice instances served by the AMF (Network Function) is congested or no longer available. In case of roaming, the NSSF (Network Function) of VPLMN subscribes with the NSSF (Network Function) of the HPLMN for notifications. When the NSSF (Network Function) notifies the AMF (Network Function) that a Network Slice instance is congested or no longer available, for some of PDU Sessions associated with the Network Slice instance that is no longer available, the AMF (Network Function) may delete old NSI ID corresponding to the Network Slice instance that is no longer available and the SMF (Network Function) of the PDU Session(s) selected by using such old NSI ID is informed by the AMF (Network Function) to release the PDU Session(s). Subsequently, the SMF (Network Function) triggers the impacted UE (Network Function)(s) to establish new PDU session(s) associated with the same S-NSSAI as described in clause 5.6.9.2 for PDU Session(s) of SSC Mode 2 and SSC Mode 3. The AMF (Network Function) selects a new Network Slice instance for the given S-NSSAI during PDU Session Establishment.
The functional description for supporting Public Warning System for 5G System can be found in TS 23.041 [46].
This clause includes feature description for supporting SMS over NAS (Protocol) in 5G System. Support for SMS incurs the following functionality:
-	Support for SMS over NAS (Protocol) transport between UE (Network Function) and AMF (Network Function). This applies to both 3GPP and Non 3GPP accesses.
-	Support for AMF (Network Function) determining the SMSF (Network Function) for a given UE (Network Function).
-	Support for subscription checking and actual transmission of MO/MT-SMS transfer by the SMSF (Network Function).
-	Support for MO/MT-SMS transmission for both roaming and non-roaming scenarios.
-	Support for selecting proper domains for MT SMS message delivery including initial delivery and re-attempting in other domains.
5G System supports SMS over NAS (Protocol) via both 3GPP access and non-3GPP access.
During Registration procedure, a UE (Network Function) that wants to use SMS provides an "SMS supported" indication over NAS (Protocol) signalling indicating the UE (Network Function)'s capability for SMS over NAS (Protocol) transport. "SMS supported" indication indicates whether UE (Network Function) can support SMS delivery over NAS (Protocol). If the core network supports SMS functionality, the AMF (Network Function) includes "SMS allowed" indication to the UE (Network Function), and whether SMS delivery over NAS (Protocol) is accepted by the network.
SMS is transported via NAS (Protocol) transport message, which can carry SMS messages as payload.
IP-Connectivity Access Network specific concepts when using 5GS to access IMS can be found in TS 23.228 [15].
5GS supports IMS with the following functionality:
-	Indication toward the UE (Network Function) if IMS voice over PS session is supported.
-	Capability to transport the P-CSCF address(es) to UE (Network Function).
-	Paging Policy Differentiation for IMS as defined in TS 23.228 [15].
-	IMS emergency service as defined in TS 23.167 [18].
-	Domain selection for UE (Network Function) originating sessions.
-	Terminating domain selection for IMS voice.
-	Support of P-CSCF restoration procedure (clause 5.16.3.9).
-	NRF (Network Function) based P-CSCF discovery (clause 5.16.3.11).
NOTE:	The NRF (Network Function) based P-CSCF discovery has no impact on the UE (Network Function), i.e. the UE (Network Function) does not need to know how P-CSCF IP  (Protocol)address(es) is discovered in the network.
-	NRF (Network Function) based HSS discovery (clause 5.16.3.12).
The serving PLMN AMF (Network Function) shall send an indication toward the UE (Network Function) during the Registration procedure over 3GPP access to indicate if an IMS voice over PS session is supported or not supported in 3GPP access and non-3GPP access. A UE (Network Function) with "IMS voice over PS" voice capability over 3GPP access should take this indication into account when performing voice domain selection, as described in clause 5.16.3.5.
The serving PLMN AMF (Network Function) may only indicate IMS voice over PS session supported over 3GPP access in one of the following cases:
-	If the network and the UE (Network Function) are able to support IMS voice over PS session in the current Registration Area with a 5G QoS Flow that supports voice as specified in clause 5.7.
-	If the network or the UE (Network Function) are not able to support IMS voice over PS session over NR connected to 5GC, but is able for one of the following:
-	If the network and the UE (Network Function) are able to support IMS voice over PS session over E-UTRA connected to 5GC, and the NG-RAN (Network Function) supports a handover or redirection to E-UTRA connected to 5GC for this UE (Network Function) at QoS Flow establishment for IMS voice;
-	If the UE (Network Function) supports handover to EPS, the EPS supports IMS voice, and the NG-RAN (Network Function) supports a handover to EPS for this UE (Network Function) at QoS Flow establishment for IMS voice; or
-	If the UE (Network Function) supports redirection to EPS, the EPS supports IMS voice, and the NG-RAN (Network Function) supports redirection to EPS for this UE (Network Function) at QoS Flow establishment for IMS voice.
-	If the network is not able to provide a successful IMS voice over PS session over E-UTRA connected to 5GC, but is able for one of the following:
-	If the UE (Network Function) supports handover to EPS, the EPS supports IMS voice, and the NG-RAN (Network Function) supports a handover to EPS for this UE (Network Function) at QoS Flow establishment for IMS voice; or
-	If the UE (Network Function) supports redirection to EPS, the EPS supports IMS voice, and the NG-RAN (Network Function) supports redirection to EPS for this UE (Network Function) at QoS Flow establishment for IMS voice.
The serving PLMN provides this indication based e.g. on local policy, UE (Network Function) capabilities, HPLMN, whether IP  (Protocol)address preservation is possible, whether NG-RAN (Network Function) to UTRAN SRVCC is supported and how extended NG-RAN (Network Function) coverage is, and the Voice Support Match Indicator from the NG-RAN (Network Function) (see clause 4.2.8a of TS 23.502 [3]).
NOTE 1:	The terms "UE (Network Function) supports handover to EPS" or "UE (Network Function) supports redirection to EPS" used above also consider the case that the UE (Network Function) has signalled that S1 mode is enabled. In case the UE (Network Function) has signalled that S1 mode is disabled for a network that only supports IMS voice via EPS Fallback, the AMF (Network Function) will not indicate that IMS voice over PS session is supported over 3GPP access. A voice centric UE (Network Function) ensures its voice service as described in clauses 5.16.3.5 and 5.16.3.6.
The AMF (Network Function) in serving PLMN shall indicate that IMS voice over PS is supported only if the serving PLMN has a roaming agreement that covers support of IMS voice with the HPLMN. This indication is per Registration Area.
NOTE 2:	If the network supports EPS fallback for voice the 5GC can be configured not to perform the Voice Support Match Indicator procedure in order to set the IMS voice over PS session Supported Indication.
The serving SNPN provides the IMS voice over PS indication based e.g. on local policy, UE (Network Function) capabilities, whether IP  (Protocol)address preservation is possible, and how extended NR coverage is. This indication is per Registration Area.
NOTE 3:	Since over 3GPP access, in SNPN access mode there is only support for NR and the "voice centric" UE (Network Function) cannot reselect to another RAT in the same registered SNPN if the first Registration Area that the UE (Network Function) tries to register from cannot support IMS voice, it is recommended that support for IMS voice is provided homogeneously in the whole SNPN if at all.
5.16.3.2a	IMS voice over PS Session Supported Indication over non-3GPP access
The serving PLMN AMF (Network Function) shall send an indication toward the UE (Network Function) during the Registration procedure over non-3GPP access to indicate whether an IMS voice over PS session is supported or not supported via non-3GPP access. A UE (Network Function) with "IMS voice over PS" voice capability over non-3GPP access should take this indication (received in the Registration procedure performed over either 3GPP access or Non-3GPP access) into account when performing the selection between N3IWF (Network Function)/TNGF (Network Function) and ePDG described in clause 6.3.6.
The serving PLMN AMF (Network Function) may only indicate IMS voice over PS session supported over non-3GPP access if the network is able to provide a successful IMS voice over PS session over N3IWF (Network Function)/TNGF (Network Function) connected to 5GC with a 5G QoS Flow that supports voice as specified in clause 5.7.
5GC shall support the usage of "Homogeneous Support of IMS Voice over PS Sessions" indication between AMF (Network Function) and UDM (Network Function).
When the AMF (Network Function) initiates Nudm_UECM_Registration operation to the UDM (Network Function), it shall:
-	if "IMS Voice over PS Sessions" is supported homogeneously in all TAs in the serving AMF (Network Function) for the UE (Network Function), include the "Homogeneous Support of IMS Voice over PS Sessions" indication set to "Supported";
-	if none of the TAs of the serving AMF (Network Function) supports "IMS Voice over PS Sessions" for the UE (Network Function), include the "Homogeneous Support of IMS Voice over PS Sessions" indication set to "Not supported";
-	if "IMS Voice over PS Sessions" support is either non-homogeneous or unknown, not include the "Homogeneous Support of IMS Voice over PS Sessions" indication.
The AMF (Network Function) shall be able to provide the "Homogeneous Support of IMS Voice over PS Sessions" indication as described above to the UDM (Network Function) using Nudm_UECM_Update operation as specified in clause 4.2.2.2.2 of TS 23.502 [3].
The UDM (Network Function) shall take this indication into account when doing Terminating Access Domain Selection (T-ADS) procedure for IMS voice.
NOTE:	A TA supports "IMS Voice over PS Sessions" if the serving AMF (Network Function) indicates IMS voice over PS Session Supported Indication over 3GPP access to the UE (Network Function), as described in clause 5.16.3.2. In order to support routing of incoming IMS voice calls to the correct domain, the network-based T-ADS (see TS 23.292 [63] and TS 23.221 [23]) requires that the "Homogeneous Support of IMS Voice over PS Sessions" indication is set to "Supported" for all registered TAs of the UE (Network Function) or "Not supported" for all registered TAs of the UE (Network Function).
At PDU Session Establishment procedure related to IMS, SMF (Network Function) shall support the capability to send the P-CSCF address(es) to UE (Network Function). The SMF (Network Function) is located in VPLMN if LBO is used. This is sent by visited SMF (Network Function) if LBO is used. For Home routed, this information is sent by the SMF (Network Function) in HPLMN. P-CSCF address(es) shall be sent transparently through AMF (Network Function), and in the case of Home Routed also through the SMF (Network Function) in VPLMN. The P-CSCF IP  (Protocol)address(es) may be locally configured in the SMF (Network Function), or discovered using NRF (Network Function) as described in clause 5.16.3.11.
NOTE 1:	Other options to provide P-CSCF to the UE (Network Function) as defined in TS 23.228 [15] is not excluded.
NOTE 2:	PDU Session for IMS is identified by "APN" or "DNN".
In the case of SNPN access the SMF (Network Function) is always located in the serving SNPN (no support for Home Routed traffic); therefore, the serving SMF (Network Function) sends the P-CSCF address(es) to the UE (Network Function).
For UE (Network Function) originating calls, the 5GC capable UE (Network Function) performs access domain selection. The UE (Network Function) shall be able to take following factors into account for access domain selection decision:
-	The state of the UE (Network Function) in the IMS. The state information shall include: Registered, Unregistered.
-	The "IMS voice over PS session supported indication" as defined in clause 5.16.3.2.
-	Whether the UE (Network Function) is expected to behave in a "voice centric" or "data centric" way for 5GS.
-	UE (Network Function) capability of supporting IMS PS voice.
-	UE (Network Function) capability for operating in dual-registration mode with selective PDU Session transfer as defined in clause 5.17.2.3.3.
-	Whether 3GPP PS Data Off is active or not and whether IMS voice is included in 3GPP PS Data Off Exempt Services or not as defined in clause 5.24.
NOTE 1:	In this release of the specification, the exact logic of which PDU sessions are kept in which system for Dual Registration UE (Network Function) with selective transfer of certain PDU Sessions as defined in clause 5.17.2.3.3, is left up to UE (Network Function) implementation. The voice centric UE (Network Function) will keep the PDU Session used for IMS services to a system that supports voice over IMS. The voice centric UE (Network Function) can re-register with the IMS (if needed) when the IMS PDU session is transferred between 5GS and EPS.
To allow for appropriate domain selection for originating voice calls, the UE (Network Function) shall attempt Initial Registration in 5GC. If the UE (Network Function) fails to use IMS for voice, e.g. due to "IMS voice over PS session supported indication" indicates voice is not supported in 5G System, the UE (Network Function) behaves as described below for "voice centric" for 5GS or "data centric" for 5GS:
-	A UE (Network Function) set to "voice centric" for 5GS shall always try to ensure that Voice service is possible. A voice centric 5GC capable and EPC capable UE (Network Function) unable to obtain voice service in 5GS shall not select a cell connected only to 5GC. By disabling capabilities to access 5GS, the UE (Network Function) re-selects to E-UTRAN connected to EPC first (if available). When the UE (Network Function) selects E-UTRAN connected to EPC, the UE (Network Function) performs Voice Domain Selection procedures as defined in TS 23.221 [23].
-	A UE (Network Function) set to "data centric" for 5GS does not need to perform any reselection if voice services cannot be obtained.
NOTE 2:	The related radio capabilities in order for the voice centric UE (Network Function) to not reselect to NR or E-UTRA cell connected to 5GC (i.e. avoid ping pong) will be defined by RAN (Network Function) WGs.
When requested by IMS, the UDM (Network Function)/HSS shall be able to query the serving AMF (Network Function) for T-ADS related information. T-ADS is a functionality located in the IMS and is performed as specified in TS 23.221 [23].
The AMF (Network Function) shall respond to the query with the following information unless the UE (Network Function) is detached:
-	whether or not IMS voice over PS Session is supported in the registration area (s) where the UE (Network Function) is currently registered;
-	whether or not IMS voice over PS Session Supported Indication over non-3GPP access is supported in the WLAN where the UE (Network Function) is currently registered;
-	the time of the last radio contact with the UE (Network Function); and
-	the current Access Type and RAT type.
If the UE (Network Function) is configured to support IMS voice, the UE (Network Function) shall include the information element "UE (Network Function)'s usage setting" in Registration Request messages. The UE (Network Function)'s usage setting indicates whether the UE (Network Function) behaves in a "voice centric" or "data centric" way (as defined in clause 5.16.3.5).
A UE (Network Function) supporting IMS voice over 3GPP access connected to 5GC and that is EPS capable shall also support IMS voice over E-UTRA connected to EPC.
NOTE:	Depending on operator's configuration, the UE (Network Function)'s usage setting can be used by the network to choose the RFSP Index in use (see clause 5.3.4.3). As an example, this enables the enforcement of selective idle mode camping over E-UTRA for voice centric UEs.
To allow for appropriate domain selection for SMS delivery, it should be possible to provision UEs with the following HPLMN operator preferences on how an IMS enabled UE (Network Function) is supposed to handle SMS services:
-	SMS is not to be invoked over IP  (Protocol)networks: the UE (Network Function) does not attempt to deliver SMS over IP  (Protocol)networks. The UE (Network Function) attempts to deliver SMS over NAS (Protocol) signalling.
-	SMS is preferred to be invoked over IP  (Protocol)networks: the UE (Network Function) attempts to deliver SMS over IP  (Protocol)networks. If delivery of SMS over IP  (Protocol)networks is not available, the UE (Network Function) attempts to deliver SMS over NAS (Protocol) signalling.
It should be possible to provision UEs with the HPLMN SMS over NAS (Protocol) operator preferences on access selection for delivering SMS over NAS (Protocol) signalling.
Based on the SMS over NAS (Protocol) preference:
-	SMS is preferred to be invoked over 3GPP access for NAS (Protocol) transport: the UE (Network Function) attempts to deliver MO SMS over NAS (Protocol) via 3GPP access if the UE (Network Function) is both registered in 3GPP access and non-3GPP access.
-	SMS is preferred to be invoked over non-3GPP access for NAS (Protocol) transport: the UE (Network Function) attempts to deliver MO SMS over NAS (Protocol) via non-3GPP access if the UE (Network Function) is both registered in 3GPP access and non-3GPP access. If delivery of SMS over NAS (Protocol) via non-3GPP access is not available, the UE (Network Function) attempts to deliver SMS over NAS (Protocol) via 3GPP access.
For the support of P-CSCF restoration the SMF (Network Function) behaves as described in TS 23.380 [61].
In order to support various deployment scenarios for obtaining IMS voice service, the UE (Network Function) and NG-RAN (Network Function) may support the mechanism to direct or redirect the UE (Network Function) from NG-RAN (Network Function) either towards E-UTRA connected to 5GC (RAT fallback) or towards EPS (E-UTRAN connected to EPC System fallback).
Following principles apply for IMS Voice Service:
-	The serving AMF (Network Function) indicates toward the UE (Network Function) during the Registration procedure that IMS voice over PS session is supported.
-	If a request for establishing the QoS Flow for IMS voice reaches the NG-RAN (Network Function), the NG-RAN (Network Function) responds indicating rejection of the establishment request and the NG-RAN (Network Function) may trigger one of the following procedures depending on UE (Network Function) capabilities, N26 (Service-based Interface) availability, network configuration and radio conditions:
-	Redirection to EPS;
-	Handover procedure to EPS;
-	Redirection to E-UTRA connected to 5GC; or
-	Handover to E-UTRA connected to 5GC.
-	If needed, Network Provided Location Information is provided as described in clauses 4.13.6.1 and 4.13.6.2 of TS 23.502 [3].
-	The ongoing IMS voice session is not impacted by a change of the IMS voice over PS session indicator from supported to unsupported (e.g. the UE (Network Function) receives during RAT Fallback or EPS Fallback the IMS voice over PS session indicator indicating that IMS voice over PS sessions are not supported).
NOTE:	Any change in IMS voice over PS session indicator applies to new IMS sessions initiated only after the ongoing IMS voice session is terminated.
During any release of RRC (Protocol) connection including after EPS/RAT fallback is performed, the eNB or NG-RAN (Network Function) node may provide to the UE (Network Function) dedicated idle mode priorities for NR as defined in TS 36.331 [51] taking into account RFSP, PLMNs contained in Handover Restriction List and local operator policy. If the UE (Network Function) remains ECM/CM-CONNECTED after the voice call has ended, the eNB or NG-RAN (Network Function) node may trigger handover to NR connected to 5GC, if configured to do so, taking into account local operator policy and Handover Restriction List.
P-CSCF selection functionality may be used by the SMF (Network Function) to select the P-CSCF for an IMS PDU Session of the UE (Network Function).
The SMF (Network Function) can utilize the Network Repository Function to discover the P-CSCF instance(s). The NRF (Network Function) provides the IP  (Protocol)address or the FQDN of P-CSCF instance(s) to the SMF (Network Function). The P-CSCF selection function in the SMF (Network Function) selects the P-CSCF instance(s) based on the available P-CSCF instances obtained from NRF (Network Function) or based on the configured P-CSCF information in the SMF (Network Function). If the SMF (Network Function) receives FQDN(s) from the NRF (Network Function) or is configured with FQDN(s) the SMF (Network Function) shall resolve these to IP  (Protocol)addresses for sending to the UE (Network Function) in the PDU session response.
The following factors may be considered during the P-CSCF discovery and selection:
-	S-NSSAI of the PDU Session.
-	UE (Network Function) location information.
-	Local operator policies.
-	Availability of candidate P-CSCFs.
-	UE (Network Function) IP  (Protocol)address.
-	Access Type.
-	Proximity to location of selected UPF (Network Function).
-	Selected Data Network Name (DNN).
HSS discovery and selection functionality is used by the I-CSCF/S-CSCF/IMS-AS to select an HSS that manages the user's IMS subscriptions and has the ability to serve the IMS services for the UE (Network Function), see clause AA.3.3 of TS 23.228 [15] and clause 6.3.1 for details.
Emergency Services are provided to support IMS emergency sessions. "Emergency Services" refers to functionalities provided by the serving network when the network is configured to support Emergency Services. Emergency Services are provided to normally registered UEs and to Emergency Registered UEs, that can be either normally registered or in limited service state. Depending on local regulation, receiving Emergency Services in limited service state does not require a valid subscription. Depending on local regulation and on operator's policy, the network may allow or reject a registration request for Emergency Services (i.e. Emergency Registration) from UEs that have been identified to be in limited service state. Four different behaviours of Emergency Services as defined in clause 4.3.12.1 of TS 23.401 [26] are supported.
Emergency Services shall not be provided to a UE (Network Function) over 3GPP access and non-3GPP access concurrently, except for the following case:
-	a UE (Network Function) may be Emergency or normally Registered and have an emergency PDU session over non-3GPP access or may be attached with an emergency session to ePDG over untrusted WLAN (as defined in TS 23.402 [43]) when 3GPP access becomes available. In which case the UE (Network Function) may have to register over 3GPP access and check first the support for Emergency Services over the 3GPP RAT it has selected (e.g. based on Emergency Services Support indication, Emergency Services Fallback, AS broadcast indicator). If there is native support for Emergency Services in the selected 3GPP RAT the UE (Network Function) will attempt to transfer the emergency PDU session from non-3GPP access to 3GPP access (see clause 4.9.2 or clause 4.9.3 of TS 23.502 [3]). If there is no native support for Emergency Services in the selected RAT, but Emergency Services Fallback to another RAT in 5GS or to another System where Emergency Services is supported (based on the conditions defined in clause 5.16.4.11), the UE (Network Function) may trigger first Emergency Services Fallback (see clause 4.13.4.2 of TS 23.502 [3]) and then attempt to transfer the emergency PDU session from non-3GPP access to 3GPP access (see clause 4.9.2 of TS 23.502 [3]). In these cases the UE (Network Function) may thus briefly be emergency registered and receive emergency services over both 3GPP access and non-3GPP access concurrently.
NOTE 1:	The conditions upon which the UE (Network Function) determines that 3GPP access becomes available are implementation dependent.
A UE (Network Function) may only attempt to use Emergency Services over non-3GPP access if it is unable to use Emergency Services over 3GPP access as specified in TS 23.167 [18].
The UE (Network Function) is only allowed to have one PDU session for Emergency services at a time. A PDU Session cannot be changed between a PDU Session for Non-Emergency services and a PDU Session for Emergency services. PDU session for emergency services can be transferred from one Access Type to another as specified in clause 5.16.4.9.
To provide Emergency Services, the AMF (Network Function) is configured with Emergency Configuration Data that are applied to Emergency Services that are established by an AMF (Network Function) based on request from the UE (Network Function). The AMF (Network Function) Emergency Configuration Data contains the S-NSSAI and Emergency DNN which is used to derive an SMF (Network Function). In addition, the AMF (Network Function) Emergency Configuration Data contains UE (Network Function)-AMBR and may also contain the statically configured SMF (Network Function) for the Emergency DNN. The SMF (Network Function) may also store Emergency Configuration Data that contains statically configured UPF (Network Function) information for the Emergency DNN.
NOTE 2:	The Network slices associated with emergency services are assumed to be configured consistently in the AMF (Network Function) (i.e. emergency configuration data) and NG-RAN (Network Function) nodes within the corresponding Registration Area where emergency services are to be supported.
When the UE (Network Function) is camped normally in the cell, i.e. not in limited service state, during Registration procedure described in clause 4.2.2.2 of TS 23.502 [3], the serving AMF (Network Function) includes an indication for Emergency Services Support within the Registration Accept to the UE (Network Function). For 3GPP access, the Emergency Services Support indication is valid within the current Registration Area per RAT (i.e. this is to cover cases when the same registration area supports multiple RATs and they have different capability).
The Emergency Services Support is configured in the AMF (Network Function) according to local regulations and network capabilities. AMF (Network Function) includes Emergency Services Support indicator in the Registration Accept message to indicate that the UE (Network Function) can setup emergency PDU Session to obtain emergency services. The AMF (Network Function) may include additional local emergency numbers associated with the serving network for the UE (Network Function), further defined in TS 24.501 [47].
During Registration procedures over 3GPP access in a PLMN, the 5GC includes the Emergency Services Support indicator, valid for the current Registration Area and indicating per RAT that Emergency Services are supported if any of the following conditions is true within the current Registration Area:
-	the Network is able to support Emergency Services natively over 5GS;
-	E-UTRA connected to 5GC supports IMS Emergency Services (e.g. voice), and the NG-RAN (Network Function) is able to trigger handover or redirection from NR to E-UTRA connected to 5GC at QoS Flow establishment for IMS Emergency Services (e.g. voice);
-	NG-RAN (Network Function) is able to trigger handover to EPS at QoS Flow establishment for IMS Emergency Services (e.g. voice);
-	NG-RAN (Network Function) is able to trigger redirection to EPS at QoS Flow establishment for IMS Emergency Services (e.g. voice); or
-	NG-RAN (Network Function) is able to trigger 5G SRVCC handover to UTRAN for IMS Emergency Services (i.e. voice).
During Registration procedures over non-3GPP access, the 5GC indicates that Emergency Services are supported if the Network is able to support Emergency Services natively over 5GS.
In the case of SNPN, during Registration procedures over 3GPP access, the 5GC includes the Emergency Services Support indicator, valid for the current Registration Area indicating that Emergency Services are supported if the following condition is true within the current Registration Area:
-	the Network is able to support Emergency Services natively over 5GS.
The 5GC includes an indication per RAT whether it supports Emergency Services Fallback (as defined in clause 5.16.4.11) to another RAT in 5GS or to another System where Emergency Services are supported natively. The Emergency Services Fallback support indicator is valid within the current Registration Area per RAT.
If a certain RAT is restricted for Emergency Services, AMF (Network Function) signals that the corresponding RAT is restricted for Emergency Services Support to the Master RAN (Network Function) Node. This helps assist the Master RAN (Network Function) node determine whether to set up Dual Connectivity for Emergency Services.
UEs that are in limited service state, as specified in TS 23.122 [17], or that camp normally on a cell but failed to register successfully to the network under conditions specified in TS 24.501 [47], initiate the Registration procedure by indicating that the registration is to receive Emergency Services, referred to as Emergency Registration, and a Follow-on request is included in the Registration Request to initiate PDU Session Establishment procedure with a Request Type indicating "Emergency Request". UEs that had registered for normal services and do not have emergency PDU Session established and that are subject to Mobility Restriction in the present area or RAT (e.g. because of restricted tracking area) shall initiate the UE (Network Function) Requested PDU Session Establishment procedure to receive Emergency Services, i.e. with a Request Type indicating "Emergency Request". Based on local regulation, the network supporting Emergency Services for UEs in limited service state provides Emergency Services to these UE (Network Function), regardless whether the UE (Network Function) can be authenticated, has roaming or Mobility Restrictions or a valid subscription.
For Emergency Services over 3GPP access via PLMN, other than eCall over IMS, the UEs in limited service state that do not operate in SNPN access mode determine that the cell supports Emergency Services over NG-RAN (Network Function) from a broadcast indicator in AS. The cell connected to EPC and 5GC broadcasts separate broadcast indicator for EPC and 5GC to indicate support of emergency services by the EPC and 5GC. If the UE (Network Function) supports SNPN access mode, is in limited service state, is not operating in SNPN access mode, needs to make an emergency call and cannot find an acceptable cell in any PLMN, the UE (Network Function) may activate SNPN access mode and attempt to camp on an acceptable cell of any available SNPN supporting emergency calls (irrespective of SNPN ID or GIN) as defined in TS 23.122 [17]. For Emergency Services over untrusted non-3GPP access, other than eCall over IMS, the UE (Network Function) in limited service state selects any N3IWF (Network Function) as specified in clause 6.3.6. Emergency calls for eCall Over IMS may only be performed if the UE (Network Function) has a USIM.
For Emergency Services over NR via SNPN, other than eCall over IMS, the UEs in limited service state that operate in SNPN access mode determine that the cell supports Emergency Services over NR from a broadcast indicator in AS and indication that the SNPN supports Emergency Services. If the UE (Network Function) operates in SNPN access mode and is in limited service state, the UE (Network Function) shall attempt to camp on an acceptable cell of any available SNPN supporting emergency calls (irrespective of SNPN ID or GIN). If the UE (Network Function) cannot find acceptable cell on any available SNPN, the UE (Network Function) shall deactivate SNPN access mode and camp on any available PLMN cell supporting emergency calls (irrespective of PLMN ID) as defined in TS 23.122 [17].
For NR satellite access, if a UE (Network Function) in limited service state is aware of its location, the UE (Network Function) selects a PLMN that is allowed to operate in the UE (Network Function) location as specified in TS 23.122 [17]. The network may be configured to verify the location of a UE (Network Function) that is registering for emergency services as specified in clause 5.4.11.4.
There is no support for eCall over IMS for SNPNs in this Release.
A serving network shall provide an Access Stratum broadcast indication from NG-RAN (Network Function) (NR or E-UTRA connected to 5GC) to UEs indicating whether eCall Over IMS is supported:
-	When an E-UTRA cell is connected to EPC and 5GC, the cell broadcasts separate Access stratum broadcast indication for 5GC and EPC to indicate support of eCall over IMS by 5GC and EPC.
-	A UE (Network Function) that is not in limited service state determines that the NG-RAN (Network Function) cell supports eCall Over IMS via 5GC using the broadcast indicator for eCall over IMS. Emergency calls for eCall over IMS are not supported over non-3GPP access.
NOTE 3:	The Access Stratum broadcast indicator is determined according to operator policies and minimally indicates that the PLMN, or all of the PLMNs in the case of network sharing, and at least one emergency centre or PSAP to which an eCall Over IMS can be routed, support eCall Over IMS.
-	A UE (Network Function) in limited service state determines that the cell supports eCall Over IMS using both the broadcast indicator for support of Emergency Services over NG-RAN (Network Function) and the broadcast indicator of NG-RAN (Network Function) for eCall over IMS. Emergency calls for eCall Over IMS are not supported over Non-3GPP access and NR via SNPN.
NOTE 4:	The broadcast indicator for eCall Over IMS does not indicate whether UEs in limited service state are supported. So, the broadcast indicator for support of Emergency Services over NG-RAN (Network Function) that indicates limited service state support needs to be applied in addition.
For a UE (Network Function) that is Emergency Registered, if it is unauthenticated the security context is not set up on UE (Network Function).
In order to receive Emergency Services, UEs that camp on a suitable cell in RM-DEREGISTERED state (i.e. without any conditions that result in limited service state), or that decide to access 5GC via non-3GPP access (and not in limited service state over non-3GPP access), initiate the Initial Registration procedure for normal service instead of Emergency Registration. Upon successful registration, such UEs shall initiate the UE (Network Function) Requested PDU Session Establishment procedure with a Request Type indicating "Emergency Request" to receive Emergency Services if the AMF (Network Function) indicated support for Emergency Services in 5GC (for the RAT the UE (Network Function) is currently camped on when UE (Network Function) is camping on 3GPP access). The UEs that camp normally on a cell or that are connected via Non-3GPP access are informed that the PLMN supports Emergency Services over 5G-AN from the Emergency Services Support indicator in the Registration procedure. This applies to both 3GPP and non-3GPP Access Types. There is no support for Emergency Services for SNPN that is accessed via NWu from a PLMN.
NOTE 5:	The Emergency Services Support indicator in the Registration procedures does not indicate support for eCall Over IMS.
For a UE (Network Function) that is Emergency Registered, normal PLMN or SNPN selection principles apply after the end of the IMS emergency session.
NOTE 6:	For Emergency Services, there is no support for inter PLMN mobility thus there is a risk of service disruption due to failed inter PLMN mobility attempts when there is no session continuity (e.g. change of anchor SMF (Network Function)/UPF (Network Function) due to mobility) for the PDU Session and/or based on operator policies.
NOTE 7	Based on operator policies, Inter PLMN mobility with session continuity can be supported for Emergency Services if the anchor SMF (Network Function)/UPF (Network Function) for PDU Session supporting Emergency Services does not change.
The UE (Network Function) shall set the RRC (Protocol) establishment cause to emergency as defined in TS 38.331 [28] when it requests an RRC (Protocol) Connection in relation to an emergency session.
In the case of Limited Service state, UE (Network Function) shall not include any Network Slice related parameters when communicating with the network.
When a PLMN or SNPN supports IMS and Emergency Services:
-	all AMFs in that PLMN or SNPN shall have the capability to support Emergency Services.
-	at least one SMF (Network Function) shall have this capability.
For other emergency scenarios (e.g. UE (Network Function) autonomous selection for initiating Emergency Services), refer to TS 23.167 [18] for domain selection principles.
For emergency service support in Public network integrated NPNs, refer to clause 5.30.3.5.
For emergency support via 5G ProSe UE (Network Function)-to-Network Relaying, refer to TS 23.304 [128].
According to clause 4.2, the non-roaming architectures (Figure 4.2.3-1 and Figure 4.2.3-2) and roaming architecture with the visited operator's application function (Figure 4.2.4-1 and Figure 4.2.4-4) apply for Emergency Services. The other non-roaming and roaming architectures with services provided by the home network do not apply for Emergency Services.
When Emergency Services are supported and local regulation requires IMS Emergency Sessions to be provided regardless of Mobility Restrictions or Access Restrictions, the Mobility Restrictions or Access Restrictions (see clause 5.3.4.1) should not be applied to UEs receiving Emergency Services. Additionally, due to Mobility Restrictions or Access Restrictions (e.g. CAG restrictions) for normally registered UEs, that have established both non-emergency PDU Sessions and emergency PDU Session, the AMF (Network Function) indicates to the SMF (Network Function) to perform a local release of all non-emergency PDU Sessions via PDU Session Release procedure as specified in clause 4.3.4 of TS 23.502 [3]. The UE (Network Function) locally releases non-emergency PDU Sessions. The AMF (Network Function) and the UE (Network Function) behave as if the UE (Network Function) is emergency registered as described in TS 24.501 [47].
When the (R)AN resources for Emergency Services are established, the ARP value for Emergency Services indicates the usage for Emergency Services to the 5G-AN.
During handover, the source NG-RAN (Network Function) and source AMF (Network Function) ignore any UE (Network Function) related restrictions during handover evaluation when there is an active PDU Session associated with emergency service.
During Mobility Registration Update procedures, including a Mobility Registration Update as part of a handover, the target AMF (Network Function) ignores any Mobility Restrictions or access restrictions for UE (Network Function) with emergency services where required by local regulation. Any non-emergency services are not allowed, by the target network when not allowed by the subscription for the target location. To allow the UE (Network Function) in limited service state (either Emergency Registered or registered for normal service) over a given Access Type to get access to normal services over this Access Type after the Emergency Session has ended and when it has moved to a new area that is not stored by the UE (Network Function) as a forbidden area, after allowing a period of time for subsequent Emergency Services, the UE (Network Function) may explicitly deregister and register for normal services over this Access Type without waiting for the emergency PDU Session Release by the SMF (Network Function).
This functionality applies to all mobility procedures.
Over 3GPP access, an Emergency Registered UE (Network Function) when its Periodic Registration Update timer expires shall not initiate a Periodic Registration Update procedure but shall enter the RM-DEREGISTERED state. For such UEs, the AMF (Network Function) runs a mobile reachable timer with a similar value to the UE (Network Function)'s Periodic Registration Update timer. After expiry of this timer the AMF (Network Function) may change the UE (Network Function) RM state for 3GPP Access in the AMF (Network Function) to RM-DEREGISTERED. The AMF (Network Function) assigns the Periodic Registration Update timer value to Emergency Registered UEs. This timer keeps the Emergency Registered UE (Network Function) registered for Emergency Services after change to CM-IDLE state to allow for a subsequent Emergency Service without a need for a new Emergency Registration.
Over non-3GPP access, an Emergency Registered UE (Network Function) is only reachable in CM-CONNECTED state: since the UE (Network Function) may only use Emergency Services over Non-3GPP access when it is not possible over 3GPP access, 3GPP access is assumed to be unavailable for paging the UE (Network Function).
When a SMF (Network Function) is selected for Emergency Services, the SMF (Network Function) selection function described in clause 6.3.2 for normal services is applied to the Emergency DNN or the AMF (Network Function) selects the SMF (Network Function) directly from the AMF (Network Function) Emergency Configuration Data. If the SMF (Network Function) selection function described in clause 6.3.2 is used it shall always derive a SMF (Network Function) in the Serving PLMN or SNPN, which guarantees that the IP  (Protocol)address is also allocated by the Serving PLMN or SNPN. When a UPF (Network Function) is selected for Emergency Services, the UPF (Network Function) selection function described in clause 6.3.3 for normal services is applied to the Emergency DNN or the SMF (Network Function) selects the UPF (Network Function) directly from the SMF (Network Function) Emergency Configuration Data. The information in the AMF (Network Function) Emergency Configuration Data and the SMF (Network Function) Emergency Configuration Data is specified in clause 5.16.4.1.
Local regulation may require supporting emergency calls from an unauthorised UE (Network Function). In such a case, the SMF (Network Function) may not have subscription data. Additionally, the local network may want to provide Emergency Services support differently than what is allowed by a UE (Network Function) subscription. Therefore, the initial QoS parameters used for establishing Emergency Services are configured in the V-SMF (Network Function) (local network) in the SMF (Network Function) Emergency Configuration Data.
This functionality is used by the UE (Network Function) Requested PDU Session Establishment procedure when establishing Emergency Services.
Dynamic PCC is used for UEs establishing emergency service and shall be used to manage IMS emergency sessions when an operator allows IMS emergency sessions. When establishing Emergency Services with a SMF (Network Function), the PCF (Network Function) provides the SMF (Network Function) with the QoS parameters, including an ARP value reserved for the Emergency Services to prioritize the QoS Flows when performing admission control, as defined in TS 23.503 [45].
The PCF (Network Function) rejects an IMS session established via the emergency PDU Session if the AF (Network Function) (i.e. P-CSCF) does not provide an emergency indication to the PCF (Network Function).
Emergency service is provided by the serving PLMN or SNPN. The UE (Network Function) and serving PLMN or SNPN must have compatible IP  (Protocol)address versions in order for the UE (Network Function) to obtain a local emergency PDU Session.
The QoS Flows of a PDU Session associated with the emergency DNN shall be dedicated for IMS emergency sessions and shall not allow any other type of traffic. The emergency contexts shall not be changed to non-emergency contexts and vice versa. The UPF (Network Function) shall block any traffic that is not from or to addresses of network functions (e.g. P-CSCF) providing Emergency Services.
If there is already an emergency PDU Session over a given Access Type (3GPP access or non-3GPP access), the UE (Network Function) shall not request another emergency PDU Session over any Access Type except for handing over the existing emergency PDU Session to the other Access Type.
If the SMF (Network Function) receives a new emergency PDU session establishment request and an emergency PDU Session exists for the same UE (Network Function) over any Access Type, the SMF (Network Function) shall remove the existing SM context locally and clear the associated resources in the network and proceed with the new request.

NOTE:	If the UE (Network Function) releases emergency PDU session locally and requests for establishment of a new one before the SMF (Network Function) has released the emergency PDU session due to PDU session inactivity as specified in clause 4.3.4.2 of TS 23.502 [3], the above duplicate emergency PDU session handling in the network removes the old emergency PDU session as part of establishing a new one. This releases all emergency call back resources related with the old emergency PDU Session.
The ARP reserved for emergency service shall only be assigned to QoS Flows associated with an emergency PDU Session. If the UE (Network Function) is Emergency Registered over a given access, it shall not request a PDU Session to any other DNN over this access.
5.16.4.9a	Handling of PDU Sessions for normal services for Emergency Registered UEs
For an Emergency Registered UE (Network Function) over a given Access Type:
-	the UE (Network Function) shall not initiate the UE (Network Function) Requested PDU Session Establishment procedure for normal service over this Access Type; and
-	the network shall reject any PDU Session Establishment request for normal service from the UE (Network Function) on this Access Type;
-	the UE (Network Function) may attempt to receive normal service over another Access Type if not otherwise prevented by the present document.
For service requirements for eCall only mode, refer to TS 22.101 [33].
A UE (Network Function) configured for eCall Only Mode shall remain in RM-DEREGISTERED state, shall camp on a network cell when available but shall refrain from any Registration Management, Connection Management or other signalling with the network. The UE (Network Function) may instigate Registration Management and Connection Management procedures in order to establish, maintain and release an eCall Over IMS session or a session to any non-emergency MSISDN(s) or URI(s) configured in the USIM for test and/or terminal reconfiguration services. Following the release of either session and after the UE (Network Function) has left RRC_CONNECTED state, the UE (Network Function) starts a timer whose value depends on the type of session (i.e. whether eCall or a session to a non-emergency MSISDN or URI for test/reconfiguration). While the timer is running, the UE (Network Function) shall perform normal RM/CM procedures and is permitted to respond to paging to accept and establish an incoming session (e.g. from an emergency centre, PSAP or HPLMN operator). When the timer expires, once the UE (Network Function) is not in RRC_CONNECTED state, the UE (Network Function) shall perform a UE (Network Function)-initiated Deregistration procedure if still registered and enter RM-DEREGISTERED state.
NOTE 1:	An HPLMN operator can change the eCall Only Mode configuration state of a UE (Network Function) in the USIM. An HPLMN operator can also instead add, modify or remove a non-emergency MSISDN or URI in the USIM for test and/or terminal reconfiguration services. This can occur following a UE (Network Function) call to a non-emergency MSISDN or URI configured for reconfiguration. When the eCall Only Mode configuration is removed, the UE (Network Function) operates as a normal UE (Network Function) that can support eCall over IMS.
NOTE 2:	A test call and a reconfiguration call can be seen as normal (non-emergency) call by a serving PLMN and normal charging rules can apply depending on operator policy.
NOTE 3:	An MSISDN configured in the USIM for test and/or terminal reconfiguration services for eCall Over IMS can differ from an MSISDN configured in the USIM for test services for eCall over the CS domain.
In order to support various deployment scenarios for obtaining Emergency Services, the UE (Network Function) and 5GC may support the mechanism to direct or redirect the UE (Network Function) either towards E-UTRA connected to 5GC (RAT fallback) when only NR does not support Emergency Services or towards EPS (E-UTRAN connected to EPC System fallback) when the 5GC does not support Emergency Services. Emergency Services fallback may be used when the 5GS does not indicate support for Emergency Services (see clause 5.16.4.1) and indicates support for Emergency Services fallback.
Following principles apply for Emergency Services Fallback:
-	If the AMF (Network Function) indicates support for Emergency Services fallback in the Registration Accept message, then in order to initiate Emergency Service, normally registered UE (Network Function) supporting Emergency Services fallback shall initiate a Service Request with Service Type set to Emergency Services fallback as defined in clause 4.13.4.1 of TS 23.502 [3].
-	AMF (Network Function) uses the Service Type Indication within the Service Request to redirect the UE (Network Function) towards the appropriate RAT/System. The 5GS may, for Emergency Services, trigger one of the following procedures:
-	Handover or redirection to EPS.
-	Handover or redirection to E-UTRA connected to 5GC.
-	After receiving the Service Request for Emergency Fallback, the AMF (Network Function) triggers N2 (Non-service-based Interface) (Service-based Interface) procedure resulting in either CONNECTED state mobility (Handover procedure) or IDLE state mobility (redirection) to either E-UTRA/5GC or to E-UTRAN/EPC depending on factors such as N26 (Service-based Interface) availability, network configuration and radio conditions. In the N2 (Non-service-based Interface) (Service-based Interface) procedure, the AMF (Network Function) based on support for Emergency Services in 5GC or EPC may indicate the target CN for the RAN (Network Function) node to know whether inter-RAT fallback or inter-system fallback is to be performed. The target CN indicated in the N2 (Non-service-based Interface) (Service-based Interface) procedure is also conveyed to the UE (Network Function) in order to be able to perform the appropriate NAS (Protocol) procedures (S1 or N1 (Non-service-based Interface) (Service-based Interface) Mode).
-	When the AS re-keying procedure and the Emergency Fallback procedure collides, the AMF (Network Function) gives up the AS re-keying procedure and only initiates the Emergency Fallback procedure.
NOTE 1:	Emergency Services Fallback to EPS can be followed by an onward movement to GERAN or UTRAN via CSFB procedures if the PLMN does not support IMS emergency services.
NOTE 2:	If the UE (Network Function) has signalled that S1 mode is disabled for a network that only supports IMS voice via EPS Fallback, the AMF (Network Function) will not indicate that Emergency Services Fallback is supported over 3GPP access.
Emergency Services fallback is supported only in case of PLMN. Emergency Services Fallback is not supported for SNPN.
TS 22.153 [24] specifies the service requirements for Multimedia Priority Service (MPS). MPS allows Service Users (as per TS 22.153 [24]) priority access to system resources in situations such as during congestion, creating the ability to deliver or complete sessions of a high priority nature. Service Users are government-authorized personnel, emergency management officials and/or other authorized users. MPS supports priority sessions on an "end-to-end" priority basis.
MPS is based on the ability to invoke, modify, maintain and release sessions with priority, and deliver the priority media packets under network congestion conditions. MPS is supported in a roaming environment when roaming agreements are in place and where regulatory requirements apply.
NOTE 1:	If a session terminates on a server in the Internet (e.g. web-based service), then the remote end and the Internet transport are out of scope for this specification.
MPS is supported for Service Users using UEs connecting via 3GPP access. MPS is also supported for Service Users using UEs that support connecting via Trusted or Untrusted non-3GPP access via WLAN for MPS. N3IWF (Network Function) selection is according to clause 6.3.6 for PLMN access.
A Service User may use an MPS-subscribed UE (Network Function) or any other UE (Network Function) to obtain MPS. An MPS-subscribed UE (Network Function) obtains priority access to the Radio Access Network by using the Unified Access Control mechanism according to TS 22.261 [2]. This mechanism provides preferential access to UEs based on its assigned Access Identity. If an MPS-subscribed UE (Network Function) belongs to the special Access Identity as defined in TS 22.261 [2], the UE (Network Function) has preferential access to the network compared to ordinary UEs in periods of congestion.
MPS subscription allows users to receive priority services, if the network supports MPS. The same MPS subscription applies to access via 3GPP access and non-3GPP access via WLAN. MPS subscription entitles a USIM with special Access Identity. MPS subscription includes indication for support of priority PDU connectivity service including MPS for Data Transport Service and IMS priority service support for the end user. Priority Level regarding QoS Flows and IMS are also part of the MPS subscription information. The usage of Priority Level is defined in TS 22.153 [24], TS 23.503 [45] and TS 23.228 [15].
NOTE 2:	The same MPS subscription in the UDM (Network Function) and/or on the USIM is used for priority treatment of 3GPP procedures when the access is WLAN.
NOTE 3:	The term "Priority PDU connectivity services" is used to refer to 5G System functionality that corresponds to the functionality as provided by LTE/EPC Priority EPS bearer services in clause 4.3.18.3 of TS 23.401 [26].
MPS includes signalling priority and media priority. All MPS-subscribed UEs get priority for QoS Flows (e.g. used for IMS signalling) when established to the DN (Network Function) that is configured to have priority for a given Service User by setting MPS-appropriate values in the QoS profile in the UDM (Network Function).
Service Users are treated as On Demand MPS subscribers or not, based on regional/national regulatory requirements. On Demand service is based on Service User invocation/revocation explicitly and applied to the media QoS Flows being established. When not On Demand MPS service does not require invocation, and provides priority treatment for all QoS Flows only to the DN (Network Function) that is configured to have priority for a given Service User after attachment to the 5G network.
MPS for Data Transport Service is an on-demand service that may be invoked/revoked by an authorized Service User using a UE (Network Function) with a subscription for MPS (i.e. according to its MPS profile), or using a UE (Network Function) that does not have a subscription for MPS (using methods not in scope of this specification).
MPS for Data Transport Service requires explicit invocation. The Service User invokes the service by communicating with an AF (Network Function). The authorization of an MPS for Data Transport Service request is done by the AF (Network Function) or the PCF (Network Function) according to clause 6.1.3.11 of TS 23.503 [45]. Upon successful authorization, the PCF (Network Function) performs the necessary actions to achieve appropriate ARP and 5QI settings for the QoS Flows (see clause 6.1.3.11 of TS 23.503 [45]).
MPS for Data Transport Service enables the prioritization of all traffic on the QoS Flow associated with the default QoS rule and other QoS Flows upon AF (Network Function) request. The QoS modification to the QoS Flow associated with the default QoS rule and other QoS Flows is done based on operator policy and regulatory rules by means of local PCF (Network Function) configuration.
NOTE 4:	According to regional/national regulatory requirements and operator policy, On-Demand MPS (including MPS for Data Transport Service) Service Users can be assigned the highest priority.
NOTE 5:	If no configuration is provided, MPS for Data Transport Service applies only to the QoS Flow associated with the default QoS rule.
NOTE 6:	MPS for DTS controls the priority of traffic on QoS Flows independent of the application(s) being used. Other mechanisms (e.g. Priority PDU connectivity service) can be used to control the priority of traffic on other QoS Flows under the control of specific data application(s), based on operator policy.
NOTE 7:	MPS for Data Transport Service can be applied to any DNN other than the well-known DNN for IMS.
For MPS for Data Transport Service, the AF (Network Function) may also create an SDF for priority signalling between the UE (Network Function) and the AF (Network Function) (see clause 6.1.3.11 of TS 23.503 [45]).
Priority treatment is applicable to IMS based multimedia services and Priority PDU connectivity service including MPS for Data Transport Service.
Priority treatment for MPS includes priority message handling, including priority treatment during authentication, security, and Mobility Management procedures.
Priority treatment for MPS session requires appropriate ARP and 5QI (plus 5G QoS characteristics) setting for QoS Flows according to the operator's policy.
NOTE 8:	Use of QoS Flows for MPS with QoS characteristics signalled as part of QoS profile enables the flexible assignment of 5G QoS characteristics (e.g. Priority Level) for MPS.
When an MPS session is requested by a Service User, the following principles apply in the network:
-	QoS Flows employed in an MPS session shall be assigned ARP value settings appropriate for the priority of the Service User.
-	Setting ARP pre-emption capability and vulnerability for MPS QoS Flows, subject to operator policies and depending on national/regional regulatory requirements.
-	Pre-emption of non-Service Users over Service Users during network congestion situation, subject to operator policy and national/regional regulations.
The terminating network identifies the priority of the MPS session and applies priority treatment, including paging with priority, to ensure that the MPS session can be established with priority to the terminating user (either a Service User or normal user).
MPS priority mechanisms can be classified as subscription-related, invocation-related, and those applied to existing QoS Flows. Subscription related mechanisms, as described in clause 5.22.2, are further divided into two groups: those which are always applied and those which are conditionally applied. Invocation-related mechanisms, as described in clause 5.22.3, are further divided into three groups: those that apply for mobile originated SIP call/sessions, those that apply for mobile terminated SIP call/sessions, and those that apply for the Priority PDU connectivity services including MPS for Data Transport Service. Methods applied to existing QoS Flows focus on handover and congestion control and are described in clause 5.22.4.
NOTE 9:	The network can hide its topology from the AF (Network Function) supporting MPS for Data Transport Service. At the same time, the UE (Network Function) needs to provide its locally known IP  (Protocol)address to the AF (Network Function) supporting MPS for Data Transport Service to support interactions with the applicable PCF (Network Function). Thus, there can be no NAT of the UE (Network Function) IP  (Protocol)address between the UPF (Network Function) and the AF (Network Function) supporting MPS for Data Transport Service.
For WLAN access, the UE (Network Function) may notify the TNAN/N3IWF (Network Function) of its MPS subscription before the NAS (Protocol) Registration Request. Based on operator policy, the TNAN/N3IWF (Network Function) may use this indication to provide this UE (Network Function) with priority treatment in the case of congestion/overload before receipt of the NAS (Protocol) Registration Request with an MPS priority establishment cause.
According to TS 22.280 [37], a Mission Critical Service (MCX Service) is a communication service reflecting enabling capabilities Mission Critical Applications and provided to end users from Mission Critical Organizations and mission critical applications for other businesses and organizations (e.g. utilities, railways). An MCX Service is either Mission Critical Push To Talk (MCPTT) as defined in TS 23.379 [38], Mission Critical Video (MCVideo) as defined in TS 23.281 [39], or Mission Critical Data (MCData) as defined in TS 23.282 [40] and represents a shared underlying set of requirements between two or more MCX Service types. MCX Services are not restricted only to the ones defined in this clause and such services can also have priority treatment, if defined via operator's policy and/or local regulation.
MCX Services are based on the ability to invoke, modify, maintain and release sessions with priority, and deliver the priority media packets under network congestion conditions. As specified in clause 6.8 of TS 22.261 [2], MCX Users require 5GS functionality that allows for real-time, dynamic, secure and limited interaction with the QoS and policy framework for modification of the QoS and policy framework by authorized users. The limited interaction is based on operator policy, and provides specific limitations on what aspects of the QoS and policy framework an authorized MCX User can modify. MCX Services are supported in a roaming environment when roaming agreements are in place and where regulatory requirements apply.
An MCX-subscribed UE (Network Function) obtains priority access to the Radio Access Network by using the Unified Access Control mechanism according to TS 22.261 [2]. This mechanism provides preferential access to UEs based on its assigned Access Identity. If an MCX-subscribed UE (Network Function) belongs to the special Access Identity as defined in TS 22.261 [2], the UE (Network Function) has preferential access to the network compared to ordinary UEs in periods of congestion. MCX subscription allows users to receive priority services, if the network supports MCX. MCX subscription entitles a USIM with special Access Identity.
MCX Services leverage the foundation of the 5G QoS Model as defined in clause 5.7, and 5G Policy Control as defined in clause 5.14. It requires that the necessary subscriptions are in place for both the 5G QoS Profile and the necessary Policies. In addition, MCX Services leverage priority mechanism as defined in clause 5.22.
The terminating network identifies the priority of the MCX Service session and applies priority treatment, including paging with priority, to ensure that the MCX Service session can be established with priority to the terminating user (either an MCX User or normal user).
Priority treatment for MCX Service includes priority message handling, including priority treatment during authentication, security, and Mobility Management procedures.
Priority treatment for MCX Service sessions require appropriate ARP and 5QI (plus 5G QoS characteristics) setting for QoS Flows according to the operator's policy.
NOTE:	Use of QoS Flows for MCX Service sessions with non-standardized 5QI values enables the flexible assignment of 5G QoS characteristics (e.g. Priority Level).
When a MCX Service session is requested by an MCX User, the following principles apply in the network:
-	QoS Flows employed in a MCX Service session shall be assigned ARP value settings appropriate for the priority of the MCX User.
-	Setting ARP pre-emption capability and vulnerability of QoS Flows related to a MCX Service session, subject to operator policies and depending on national/regional regulatory requirements.
-	Pre-emption of non-MCX Users over MCX Users during network congestion situations, subject to operator policy and national/regional regulations.
Priority treatment is applicable to IMS based multimedia services and priority PDU connectivity services.
Relative PDU priority decisions for MCX Service sessions are based on real-time data of the state of the network and/or based on modification of the QoS and policy framework by authorized users as described in clause 6.8 of TS 22.261 [2].
Clause 5.17.1 describes the UE (Network Function) and network behaviour for the migration from EPC to 5GC.
Deployments based on different 3GPP architecture options (i.e. EPC based or 5GC based) and UEs with different capabilities (EPC NAS (Protocol) and 5GC NAS (Protocol)) may coexist at the same time within one PLMN.
It is assumed that a UE (Network Function) that is capable of supporting 5GC NAS (Protocol) procedures may also be capable of supporting EPC NAS (Protocol) (i.e. the NAS (Protocol) procedures defined in TS 24.301 [13]) to operate in legacy networks e.g. in the case of roaming.
The UE (Network Function) will use EPC NAS (Protocol) or 5GC NAS (Protocol) procedures depending on the core network by which it is served.
In order to support smooth migration, it is assumed that the EPC and the 5GC have access to a common subscriber database, that is HSS in the case of EPC and the UDM (Network Function) in the case of 5GC, acting as the master data base for a given user as defined in TS 23.002 [21]. The PCF (Network Function) has access to the UDR (Network Function) that acts as a common subscriber database for a given user identified by a SUPI using the Nudr services defined in TS 23.502 [3].

Figure 5.17.1.1-1: Architecture for migration scenario for EPC and 5G CN
A UE (Network Function) that supports only EPC based Dual Connectivity with secondary RAT NR:
-	always performs initial access through E-UTRA (LTE-Uu) but never through NR;
-	performs EPC NAS (Protocol) procedures over E-UTRA (i.e. Mobility Management, Session Management etc) as defined in TS 24.301 [13].
A UE (Network Function) that supports camping on 5G Systems with 5GC NAS (Protocol):
-	performs initial access either through E-UTRAN that connects to 5GC or NR towards 5GC;
-	performs initial access through E-UTRAN towards EPC, if supported and needed;
-	performs EPC NAS (Protocol) or 5GC NAS (Protocol) procedures over E-UTRAN or NR respectively (i.e. Mobility Management, Session Management etc) depending on whether the UE (Network Function) requests 5GC access or EPC access, if the UE (Network Function) also supports EPC NAS (Protocol).
When camping on an E-UTRA cell connected to both EPC and 5GC, a UE (Network Function) supporting EPC NAS (Protocol) and 5GC NAS (Protocol) shall select a core network type (EPC or 5GC) and initiate the corresponding NAS (Protocol) procedure as specified in TS 23.122 [17].
In order to support different UEs with different capabilities in the same network, i.e. both UEs that are capable of only EPC NAS (Protocol) (possibly including EPC based Dual Connectivity with secondary NR) and UEs that support 5GC NAS (Protocol) procedures in the same network:
-	eNB that supports access to 5GC shall broadcast that it can connect to 5GC. Based on that, the UE (Network Function) AS layer indicates "E-UTRA connected to 5GC" capability to the UE (Network Function) NAS (Protocol) layer. In addition the eNB broadcasts the supported CIoT 5GS Optimisations that the UE (Network Function) uses for selecting a core network type.
-	It is also expected that the UE (Network Function) AS layer is made aware by the UE (Network Function) NAS (Protocol) layer whether a NAS (Protocol) signalling connection is to be initiated to the 5GC. Based on that, UE (Network Function) AS layer indicates to the RAN (Network Function) whether it is requesting 5GC access (i.e. "5GC requested" indication). The RAN (Network Function) uses this indication to determine whether a UE (Network Function) is requesting 5GC access or an EPC access. RAN (Network Function) routes NAS (Protocol) signalling to the applicable AMF (Network Function) or MME accordingly.
NOTE:	The UE (Network Function) that supports EPC based Dual Connectivity with secondary RAT only does not provide this "5GC requested" indication at Access Stratum when it performs initial access and therefore eNB uses the "default" CN selection mechanism to direct this UE (Network Function) to an MME
The 5GC network may steer the UE (Network Function) from 5GC based on:
-	Core Network type restriction (e.g. due to lack of roaming agreements) described in clause 5.3.4.1.1;
-	Availability of EPC connectivity;
-	UE (Network Function) indication of EPC Preferred Network Behaviour; and
-	Supported Network Behaviour.
The UE (Network Function) that wants to use one or more of these functionalities not supported by 5G System, when in CM-IDLE may disable all the related radio capabilities that allow the UE (Network Function) to access 5G System. The triggers to disable and re-enable the 5GS capabilities to access 5G System in this case are left up to UE (Network Function) implementation.
In order to support the interworking with EPC, the SMF (Network Function)+PGW-C provides information over N4 (Service-based Interface) to the UPF (Network Function)+PGW-U related to the handling of traffic over S5-U. Functionality defined in TS 23.503 [45] for traffic steering control on SGi-LAN/N6 (Non-service-based Interface) (Service-based Interface) can be activated in UPF (Network Function)+PGW-U under consideration of whether the UE (Network Function) is connected to EPC or 5GC.
When the UE (Network Function) is connected to EPC and establishes/releases PDN connections, the following differences apply to N4 (Service-based Interface) compared to when the UE (Network Function) is connected to 5GC:
-	The CN Tunnel Info is allocated for each EPS Bearer.
-	In addition to the Service Data Flow related information, the SMF (Network Function)+PGW-C shall be able to provide the GBR and MBR values for each GBR bearer of the PDN connection to the UPF (Network Function)+PGW-U.
If the UE (Network Function) does not have preconfigured rules for associating an application to a PDN connection (i.e. the UE (Network Function) does not have rules in UE (Network Function) local configuration and is not provisioned with ANDSF rules), the UE (Network Function) should use a matching URSP rule as defined in TS 23.503 [45], if available, to derive the parameters, e.g. APN, for the PDN connection establishment and associating an application to the PDN connection.
NOTE:	The mapping between the parameters in the URSP rules and the parameters used for PDN connection establishment is defined in TS 24.526 [110].
During mobility from EPS to 5GS, the handling of QoS constraints in V-SMF (Network Function) is specified in clauses 4.11.1.2.2 and 4.11.1.3.3 of TS 23.502 [3] and follows the same principle as described in clause 5.7.1.11.
Interworking with EPC in this clause refers to mobility procedures between 5GC and EPC/E-UTRAN, except for clause 5.17.2.4. Network slicing aspects for EPS Interworking are specified in clause 5.15.7
In order to interwork with EPC, the UE (Network Function) that supports both 5GC and EPC NAS (Protocol) can operate in single-registration mode or dual-registration mode:
-	In single-registration mode, UE (Network Function) has only one active MM state (either RM state in 5GC or EMM state in EPC) and it is either in 5GC NAS (Protocol) mode or in EPC NAS (Protocol) mode (when connected to 5GC or EPC, respectively). UE (Network Function) maintains a single coordinated registration for 5GC and EPC. Accordingly, the UE (Network Function) maps the EPS-GUTI to 5G GUTI during mobility between EPC and 5GC and vice versa following the mapping rules in Annex B. To enable re-use of a previously established 5G security context when returning to 5GC, the UE (Network Function) also keeps the native 5G-GUTI and the native 5G security context when moving from 5GC to EPC.
-	In dual-registration mode, UE (Network Function) handles independent registrations for 5GC and EPC using separate RRC (Protocol) connections. In this mode, UE (Network Function) maintains 5G-GUTI and EPS-GUTI independently. In this mode, UE (Network Function) provides native 5G-GUTI, if previously allocated by 5GC, for registrations towards 5GC and it provides native EPS-GUTI, if previously allocated by EPC, for Attach/TAU towards EPC. In this mode, the UE (Network Function) may be registered to 5GC only, EPC only, or to both 5GC and EPC.
	Dual-registration mode is intended for interworking between EPS/E-UTRAN and 5GS/NR. A dual-registered UE (Network Function) should not send its E-UTRA connected to 5GC and E-UTRAN radio capabilities to NR access when connected to 5GS/NR to avoid being handed over to 5GC-connected E-UTRA or to E-UTRAN.
NOTE 1:	This is to prevent the dual registered UE (Network Function) from being connected to the same E-UTRA cell either connected to EPC or 5GC simultaneously using separate RRC (Protocol) connections via single RAN (Network Function) node as a result of handover. If a dual- registered UE (Network Function) implementation chooses to send its E-UTRA capability when connected to 5GS/NR, the UE (Network Function) and the network behaviour when UE (Network Function) enters a 5GC-connected E-UTRA is not further specified. If however the UE (Network Function) is registered with 5GS/NR only, the UE (Network Function) can send its E-UTRA capability in order to allow inter-RAT handover to E-UTRA/5GC and Dual Connectivity with multiple RATs.
	If a dual-registered UE (Network Function) had not sent its E-UTRA connected to 5GC and E-UTRAN radio capabilities to 5GS and the UE (Network Function) needs to initiate emergency services, it shall locally re-enable its E-UTRA connected to 5GC and E-UTRAN radio capabilities in order to perform domain selection for emergency services as defined in TS 23.167 [18].
NOTE 2:	However even in this case, the UE (Network Function) is still not expected to connect to E-UTRAN/EPC and E-UTRA/5GC simultaneously using separate RRC (Protocol) connection via single RAN (Network Function) node as a result of the domain selection for emergency services.
The support of single registration mode is mandatory for UEs that support both 5GC and EPC NAS (Protocol).
During E-UTRAN Initial Attach, UE (Network Function) supporting both 5GC and EPC NAS (Protocol) shall indicate its support of 5G NAS (Protocol) in UE (Network Function) Network Capability described in clause 4.11.1.5.2 of TS 23.502 [3].
During registration to 5GC, UE (Network Function) supporting both 5GC and EPC NAS (Protocol) shall indicate its support of EPC NAS (Protocol).
NOTE 3:	This indication may be used to give the priority towards selection of SMF (Network Function)+PGW-C for UEs that support both EPC and 5GC NAS (Protocol).
If the UE (Network Function) supports 5GC NAS (Protocol), at PDN connection establishment in EPC, the UE (Network Function) may allocate a PDU Session ID and sends it via PCO, regardless of N1 (Non-service-based Interface) (Service-based Interface) mode status (i.e. enabled or disabled) in the UE (Network Function).
NOTE 4:	UE (Network Function) providing a PDU Session ID at PDN connection establishment even when N1 (Non-service-based Interface) (Service-based Interface) mode is disabled allows for IP  (Protocol)address preservation during EPC to 5GC mobility once the UE (Network Function) re-enables N1 (Non-service-based Interface) (Service-based Interface) mode.
NOTE 5:	For the case the MME has selected a standalone PGW for a PDN connection, if the UE (Network Function) re-enables N1 (Non-service-based Interface) (Service-based Interface) mode and reports the change in UE (Network Function) Network Capability, the MME can initiate PDN disconnection with reactivation required as described in clause 4.11.0a.8 of TS 23.502 [3] to allow selection of SMF (Network Function)+PGW-C thus session continuity at EPC to 5GC mobility.
If the EPC supports "Ethernet" PDU Session Type, and the 5GSM Capabilities indicate that the UE (Network Function) supports Ethernet PDN type in EPC, then PDU Session type "Ethernet" is transferred to EPC as "Ethernet". Otherwise, PDU Session types "Ethernet" and "Unstructured" are transferred to EPC as "non-IP" PDN type (when supported by UE (Network Function) and network). If the UE (Network Function) or EPC does not support Ethernet PDN type in EPC, the UE (Network Function) sets the PDN type to non-IP  (Protocol)when it moves from 5GS to EPS and after the transfer to EPS, and the UE (Network Function) and the SMF (Network Function) shall maintain information about the PDU Session type used in 5GS, i.e. information indicating that the PDN Connection with "non-IP" PDN type corresponds to PDU Session type Ethernet or Unstructured respectively. This is done to ensure that the appropriate PDU Session type will be used if the UE (Network Function) transfers to 5GS.
PDN type "non-IP" is transferred to 5GS as "Unstructured" PDU Session type if it is successfully transferred.
It is assumed that if a UE (Network Function) supports Ethernet PDU Session type and/or Unstructured PDU Session type in 5GS it will also support non-IP  (Protocol)PDN type in EPS. If this is not the case, the UE (Network Function) shall locally delete any EBI(s) corresponding to the Ethernet/Unstructured PDU Session(s) to avoid that the Ethernet/Unstructured PDU Session(s) are transferred to EPS.
MTU size consideration for PDU Sessions and PDN Connections towards a SMF (Network Function)+PGW-C follows the requirements in clause 5.6.10.4.
Networks that support interworking with EPC, may support interworking procedures that use the N26 (Service-based Interface) interface or interworking procedures that do not use the N26 (Service-based Interface) interface. Interworking procedures with N26 (Service-based Interface) support provides IP  (Protocol)address continuity on inter-system mobility to UEs that support 5GC NAS (Protocol) and EPC NAS (Protocol) and that operate in single registration mode. Networks that support interworking procedures without N26 (Service-based Interface) shall support procedures to provide IP  (Protocol)address continuity on inter-system mobility to UEs operating in both single-registration mode and dual-registration mode. In such networks, AMF (Network Function) shall provide the indication that interworking without N26 (Service-based Interface) is supported to UEs during initial Registration in 5GC or MME may optionally provide the indication that interworking without N26 (Service-based Interface) is supported in the Attach procedure in EPC as defined in TS 23.401 [26].
If the network does not support interworking with EPC, network shall not indicate support for "interworking without N26 (Service-based Interface)" to the UE (Network Function).
When the HSS+UDM (Network Function) is required to provide the subscription data to the MME, for each APN, only one SMF (Network Function)+PGW-C FQDN and associated APN is provided to the MME according to TS 23.401 [26].
For interworking without N26 (Service-based Interface) interface:
-	if the PDU session supports interworking, the SMF (Network Function)+PGW-C stores the SMF (Network Function)+PGW-C FQDN to SMF (Network Function) context in HSS+UDM (Network Function) when the SMF (Network Function) is registered to HSS+UDM (Network Function).
-	For an APN, the HSS+UDM (Network Function) selects one of the stored SMF (Network Function)+PGW-C FQDN based on operator's policy.
For interworking with N26 (Service-based Interface) interface:
-	For a DNN, AMF (Network Function) determines PDU session(s) associated with 3GPP access in only one SMF (Network Function)+PGW-C supporting EPS interworking via EBI allocation procedure as described in clause 4.11.1.4.1 of TS 23.502 [3].
-	If the network supports EPS interworking of non-3GPP access connected to 5GC, the AMF (Network Function) serving 3GPP access notifies the UDM (Network Function) to store the association between DNN and SMF (Network Function)+PGW-C FQDN which supports EPS interworking as Intersystem continuity context, to avoid MME receiving inconsistent SMF (Network Function)+PGW-C FQDN from AMF (Network Function) and HSS+UDM (Network Function).
-	The AMF (Network Function) updates Intersystem continuity context if the SMF (Network Function)+PGW-C and DNN association is changed due to the AMF (Network Function) selecting another SMF (Network Function)+PGW-C for EPS interworking for the same DNN.
-	If the SMF (Network Function)+PGW-C FQDN and associated DNN exists in Intersystem continuity context, the HSS+UDM (Network Function) provides MME with SMF (Network Function)+PGW-C FQDN and associated APN.
It does not assume that the HSS+UDM (Network Function) is aware of whether N26 (Service-based Interface) is deployed in the serving network. The HSS+UDM (Network Function) check the Intersystem continuity context first. If no SMF (Network Function)+PGW-C FQDN associated with an DNN exists in Intersystem continuity context, the HSS+UDM (Network Function) selects one of the SMF (Network Function)+PGW-C FQDN for the APN from SMF (Network Function) context based on operator's policy.
In entire clause 5.17.2 the terms "initial attach", "handover attach" and "TAU" for the UE (Network Function) procedures in EPC can alternatively be combined EPS/IMSI Attach and combined TA/LA depending on the UE (Network Function) configuration defined in TS 23.221 [23].
If a UE (Network Function) in MICO mode moves to E-UTRAN connected to EPC and any of the triggers defined in clause 5.4.1.3 occur, then the UE (Network Function) shall locally disable MICO mode and perform the TAU or Attach procedure as defined in clause 5.17.2. The UE (Network Function) can renegotiate MICO when it returns to 5GS during (re-)registration procedure.
IP  (Protocol)address preservation for IP  (Protocol)PDU sessions cannot be ensured on subsequent mobility from EPC/E-UTRAN to GERAN/UTRAN to a UE (Network Function) that had initially registered in 5GS and moved to EPC/E-UTRAN.
NOTE 6:	The SMF (Network Function)+PGW-C might not include the GERAN/UTRAN PDP Context anchor functionality. Also, 5GC does not provide GERAN/UTRAN PDP Context parameters to the UE (Network Function) when QoS Flows of PDU Session are setup or modified in 5GS. Hence, the UE (Network Function) might not be able to activate the PDP contexts when it transitions to GERAN/UTRAN.
IP  (Protocol)address preservation for IP  (Protocol)PDU sessions cannot be ensured on subsequent mobility from EPC/E-UTRAN to 5GS for a 5GS NAS (Protocol) capable UE (Network Function) that had initially established a PDP context via GERAN/UTRAN and moved to EPC/E-UTRAN. IP  (Protocol)address preservation for IP  (Protocol)PDU session mobility between EPC/E-UTRAN and 5GS may be re-ensured as specified in clause 5.17.2.4 when UE (Network Function) moves from GERAN/UTRAN into EPC/E-UTRAN.
NOTE 7:	The PGW acting as a GGSN might not support SMF (Network Function)+PGW-C functionality. GPRS does not support 5GS parameters transfer between UE (Network Function) and SMF (Network Function)+PGW-C (e.g. providing of PDU session ID and 5GS QoS information).
When a PDU session is moved from 5GS to EPS, the SMF (Network Function)+PGW-C keeps the registration and subscription in HSS+UDM (Network Function) until the corresponding PDN connection is released.
The SMF (Network Function)+PGW-C receives notification of subscription update regarding the 5G parameters (e.g. DNNs, S-NSSAIs) which are associated with the established PDN connection(s) connecting via EPS. If the subscription regarding DNN, QoS profile or PDN connection type associated with the PDN connection is updated, then the MME receives the subscription update and triggers corresponding actions according to TS 23.401 [26]. If the SMF (Network Function)+PGW-C receives subscription updates (e.g. change of 5GS Subscribed NSSAI) from the UDM (Network Function) the SMF (Network Function)+PGW-C triggers corresponding actions for the PDN connection. This may include (depending on the modified parameter) to:
-	update the UPF (Network Function) (e.g. for a change of Framed Route information); or
-	release the PDN connection with an appropriate cause (e.g. for change of EPS/5GS interworking support, for subscription removal of S-NSSAI associated with the PDN connection);
-	do nothing about changes to DNN and/or PDU Session type that are handled by the MME.
If header compression is used for Control Plane CIoT EPS/5GS Optimisations and when the UE (Network Function) moves from EPS to 5GS or from 5GS to EPS, the UE (Network Function) may initiate the PDU Session Modification Procedure or UE (Network Function) requested bearer resource modification procedure to renegotiate the header compression configuration and to establish the compression context between the UE (Network Function) and MME/SMF (Network Function), see TS 23.401 [26] and TS 24.501 [47].
If the UE (Network Function) is moving from 5GS to EPS and the RAT type is also moving from a "broadband" RAT (e.g. NR or WB-E-UTRA) to NB-IoT in EMM-IDLE state, the UE (Network Function) should set the mapped EPS bearer context for which the EPS bearer is a dedicated EPS bearer to state BEARER CONTEXT INACTIVE as for NB-IoT UEs in EPS only support the default bearers. In addition, UE (Network Function) shall locally deactivate the related bearers according to the maximum number of supported UP resources and send the latest bearer context status in the TAU Request.
If APN Rate Control is used when the UE (Network Function) moves from EPC to 5GC then the P-GW/SCEF and UE (Network Function) store the current APN Rate Control Status for an APN. If while connected to 5GC the last PDU Session to a DNN that is the same as the APN identified in the APN Rate Control Status is released then the APN Rate Control Status may be stored in the AMF (Network Function) in addition to the Small Data Rate Control Status and the UE (Network Function) discards the APN Rate Control Status. The APN Rate Control Status is stored in the AMF (Network Function) so it can be provided to the MME during mobility to EPC and subsequently applied at establishment of a new first PDN Connection to the same APN, if valid. The APN Rate Control Status is provided to the UPF (Network Function)+PGW-U if a first new PDU Session is established towards the DNN that is the same as the APN identified in the APN Rate Control Status if the UE (Network Function) moves back to EPC, taking into account its validity period.
The UE (Network Function) may be provided with initial APN Rate Control parameters by the SMF (Network Function) when a first new PDU Session is established for a DNN and S-NSSAI that supports interworking with EPS and the DNN matches an APN. The SMF (Network Function) provides the APN Rate Control Status for the APN that matches the DNN, if available at the SMF (Network Function), otherwise the configured APN Rate Control parameters for the APN that matches the DNN are provided as the initially applied parameters. If the initially applied parameters differ from the configured APN Rate Control parameters and the first APN Rate Control validity period expires, the UE (Network Function) is updated with the configured APN Rate Control parameters once the UE (Network Function) has moved to EPC.
NOTE 8:	If the APN Rate Control Status is provided to a UPF (Network Function)+PGW-U it is not used for Small Data Rate Control while the UE (Network Function) is connected to 5GC, it is only used as the APN Rate Control Status if the UE (Network Function) moves to EPC.
NOTE 9:	Encoding of APN and DNN specified in TS 23.003 [19] allows the comparison of EPS APN and 5GS DNN.
If a Service Gap timer is running in the AMF (Network Function) when the UE (Network Function) moves from 5GC to EPC, the AMF (Network Function) stops the running Service Gap timer. If the UE (Network Function) returns to 5GC from EPC the AMF (Network Function) provides the Service Gap Time to the UE (Network Function) as described in clause 5.31.16.
If a Service Gap timer is running in the MME when the UE (Network Function) moves from EPC to 5GC, the MME stops the running Service Gap timer. If the UE (Network Function) returns to E-UTRAN connected to EPC from 5GC the MME provides the Service Gap Time to the UE (Network Function) as described in TS 23.401 [26].
If a Service Gap timer is running in the UE (Network Function) when the UE (Network Function) moves to from 5GC to EPC and if Service Gap Time is received from the MME, the UE (Network Function) stores the received Service Gap Time for later use when the timer needs to be started next time, and the Service Gap timer that was started before the system change is kept running in the UE (Network Function) and applied for EPC. If a Service Gap timer is running in the UE (Network Function) when the UE (Network Function) moves to 5GC and if Service Gap Time is received from the AMF (Network Function), the UE (Network Function) stores the received Service Gap Time for later use when the timer needs to be started next time, and the Service Gap timer that was started before the system change is kept running in the UE (Network Function) and applied in 5GS.
For UE (Network Function) currently served by EPC, a SMF (Network Function)+PGW-C may support L2TP tunnelling on N6 (Non-service-based Interface) (Service-based Interface), as described in clause 5.8.2.16.
Interworking procedures using the N26 (Service-based Interface) interface, enables the exchange of MM and SM states between the source and target network. The N26 (Service-based Interface) interface may be either intra-PLMN or inter-PLMN (e.g. to enable inter-PLMN mobility). When interworking procedures with N26 (Service-based Interface) is used, the UE (Network Function) operates in single-registration mode. For the 3GPP access, the network keeps only one valid MM state for the UE (Network Function), either in the AMF (Network Function) or MME. For the 3GPP access, either the AMF (Network Function) or the MME is registered in the HSS+UDM (Network Function).
The support for N26 (Service-based Interface) interface between AMF (Network Function) in 5GC and MME in EPC is required to enable seamless session continuity (e.g. for voice services) for inter-system change.
The UE (Network Function)'s subscription may include restriction for Core Network Type (EPC) and RAT restriction for E-UTRA. If so, the UDM (Network Function) provides these restrictions to the AMF (Network Function). The AMF (Network Function) includes RAT and Core Network type restrictions in the Handover Restriction List to the NR. The AMF (Network Function) and NR use these restrictions to determine if mobility of the UE (Network Function) to EPS or E-UTRA connected to EPS should be permitted. When the UE (Network Function) moves from 5GS to EPS, the SMF (Network Function) determines which PDU Sessions can be relocated to the target EPS, e.g. based on capability of the deployed EPS, operator policies for which PDU Session, seamless session continuity should be supported etc. The SMF (Network Function) can release the PDU Sessions that cannot be transferred as part of the handover or Idle mode mobility. However, whether the PDU Session is successfully moved to the target network is determined by target EPS.
Similarly, the UE (Network Function)'s subscription may include restriction for Core Network Type (5GC) and RAT restriction for NR. If so, the HSS provides these restrictions to the MME. The MME includes RAT and Core Network type restrictions in the Handover Restriction List to the E-UTRAN. The MME and E-UTRAN use these restrictions to determine if mobility of the UE (Network Function) to 5GS or NR connected to 5GS should be permitted. If the SMF (Network Function)+PGW-C receives the PDU session ID from UE (Network Function) via PCO and know 5GC is not restricted for the PDN connection by user subscription, the SMF (Network Function)+PGW-C sends the mapped QoS parameters to UE (Network Function). When the UE (Network Function) moves from EPS to 5GS, for the case when the MME has selected SMF (Network Function)+PGW-C even for PDN connections that cannot be relocated to the target 5GS, the SMF (Network Function)+PGW-C determines which PDN Connections can be relocated to the target 5GS, e.g. based on capability of the deployed 5GS, subscription and operator policies for which PDN Connection, seamless session continuity should be supported etc. The SMF (Network Function)+PGW-C and NG-RAN (Network Function) can reject the PDN Connections that cannot be transferred as part of the handover or Idle mode mobility.
For the case when the MME has selected standalone P-GW for a PDN connection for which session continuity is not supported and the AMF (Network Function) cannot retrieve the address of the corresponding SMF (Network Function) during EPS to 5GS mobility, the AMF (Network Function) does not move the PDN connection to 5GS.
NOTE 1:	When applying the AMF (Network Function) planned removal procedure or the procedure to handle AMF (Network Function) failures (see clause 5.21.2) implementations are expected to update the DNS configuration to enable MMEs to discover alternative AMFs if the MME tries to retrieve a UE (Network Function) context from an AMF (Network Function) that has been taken out of service or has failed. This addresses the scenario of UEs performing 5GS to EPS Idle mode mobility and presenting a mapped GUTI pointing to an AMF (Network Function) that has been taken out of service or has failed.
In the case of mobility from 5GS to EPS, if the MME lacks certain capability, e.g. MME not supporting 15 EPS bearers, the 5GC shall not transfer the UE (Network Function) EPS bearers and/or EPS PDN connections that are not supported by the EPC network. If the MME does not support 15 EPS bearers, the AMF (Network Function) determines which EBIs cannot be transferred to EPS, and retrieves the EPS bearer contexts from the SMF (Network Function)+PGW-C for the EBIs that can be transferred to EPS.
NOTE 2:	How the AMF (Network Function) determines which EBIs can be transferred to EPS is according to local configuration, e.g. according to DNN, S-NSSAI, ARP associated with an EBI.
In the case of mobility from 5GS to EPS, if the mobility is a result of the PCF (Network Function) modifying the RFSP Index value for the UE (Network Function) to indicate that EPC/E-UTRAN access is prioritized over the 5GS access, the AMF (Network Function) may be sent with a RFSP in Use Validity Time by the PCF (Network Function) as specified in TS 23.503 [45]. If the AMF (Network Function) receives RFSP in Use Validity Time and selects the RFSP Index in use identical to the authorized RFSP Index as specified in clause 5.3.4.3, then the AMF (Network Function) provides the MME with the RFSP Index in use and the RFSP in Use Validity Time, which indicates the time by which the RFSP Index in use will be used in the MME as specified in clause 4.11.1.5.8 of TS 23.502 [3].
NOTE 3:	The RFSP in Use Validity Time is to allow the UE (Network Function) to stay in EPS for a period of time to avoid the potential ping-pong issue (i.e. 5GS keeps sending the UE (Network Function) to EPS based on authorized RFSP Index from PCF (Network Function), and the EPS keeps sending the UE (Network Function) back to 5GS immediately based on the subscribed RFSP Index.
NOTE 4:	The RFSP in Use Validity Time applies only to EPS but not to 5GS, therefore in the case of mobility from EPS to 5GS, the RFSP in Use Validity Time if received from MME is ignored by the AMF (Network Function).
When the UE (Network Function) supports single-registration mode and network supports interworking procedure with the N26 (Service-based Interface) interface:
-	For idle mode mobility from 5GS to EPS, the UE (Network Function) performs either TAU or Attach procedure with EPS GUTI mapped from 5G-GUTI sent as old Native GUTI, as described in clause 4.11.1.3.2.1 of TS 23.502 [3] and indicates that it is moving from 5GC. The UE (Network Function) includes in the RRC (Protocol) message a GUMMEI mapped from the 5G-GUTI and indicates it as a native GUMMEI and should in addition indicate it as "Mapped from 5G-GUTI". The MME retrieves the UE (Network Function)'s MM and SM context from 5GC. For connected mode mobility from 5GS to EPS, either inter-system handover or RRC (Protocol) Connection Release with Redirection to E-UTRAN is performed. At inter-system handover, the AMF (Network Function) selects target MME based on 2 octet TAC format used in the Target ID as specified in TS 38.413 [34]. During the TAU or Attach procedure the HSS+UDM (Network Function) cancels any AMF (Network Function) registration associated with the 3GPP access (but not AMF (Network Function) registration associated with the non-3GPP access): an AMF (Network Function) that was serving the UE (Network Function) over both 3GPP and non-3GPP accesses does not consider the UE (Network Function) as deregistered over non 3GPP access.
-	For the first TAU after 5GC initial Registration, the UE (Network Function) and MME for the handling of UE (Network Function) Radio Capabilities follow the procedures as defined in clause 5.11.2 of TS 23.401 [26] for first TAU after GERAN/UTRAN Attach.
NOTE 1:	MMEs supporting interworking with N26 (Service-based Interface) interface are not required to process the indication from the UE (Network Function) that it is moving from 5GC and will assume that the UE (Network Function) is moving from another MME.
-	For idle mode mobility from EPC to 5GC, the UE (Network Function) performs mobility Registration procedure with the 5G GUTI mapped from EPS GUTI and indicates that it is moving from EPC. The UE (Network Function) derives GUAMI from the native 5G-GUTI and includes GUAMI in the RRC (Protocol) message to enable RAN (Network Function) to route to the corresponding AMF (Network Function) (if available). If the UE (Network Function) holds no native 5G-GUTI, then the UE (Network Function) provides in the RRC (Protocol) message a GUAMI mapped from the EPS GUTI and indicates it as "Mapped from EPS". The AMF (Network Function) and SMF (Network Function) retrieve the UE (Network Function)'s MM and SM context from EPC. For connected mode mobility from EPC to 5GC, either inter-system handover or RRC (Protocol) Connection Release with Redirection to NG-RAN (Network Function) is performed. At inter-system handover, the MME selects target AMF (Network Function) based on TAC used in the Target ID as specified in TS 38.413 [34]. During the Registration procedure, the HSS+UDM (Network Function) cancels any MME registration.
NOTE 2:	During a transition period, the source eNB may be configured via O&M to know that the MME is not upgraded and thus supports only 2 octet TAC. The Target ID for the NG-RAN (Network Function) node is set as "Target eNB ID" in the existing IEs as defined in TS 38.413 [34].
For both idle mode and connected mode mobility from EPC to 5GC:
-	The UE (Network Function) includes the native 5G-GUTI as an additional GUTI in the Registration request; the AMF (Network Function) uses the native 5G-GUTI to retrieve MM context identified by the 5G-GUTI from old AMF (Network Function) or from UDSF (Network Function) (if UDSF (Network Function) is deployed and the old AMF (Network Function) is within the same AMF (Network Function) set).
-	If this is the first mobility event for a PDU Session that was established while being connected to EPC, the UE (Network Function) shall trigger the PDU Session Modification procedure and:
-	should indicate the support of Reflective QoS to the network (i.e. SMF (Network Function)) if the UE (Network Function) supports Reflective QoS functionality. If the UE (Network Function) indicated support of Reflective QoS, the network may provide a Reflective QoS Timer (RQ Timer) value to the UE (Network Function);
-	shall indicate the number of supported packet filters for signalled QoS rules, if the UE (Network Function) supports more than 16 packet filters for the PDU Session. The network shall store this information so that subsequent mobility events do not require another signalling of it.
-	should indicate the support of Multi-homed IPv6 PDU session to the network (i.e. SMF (Network Function)) if the UE (Network Function) supports Multi-homed IPv6 PDU session. If the UE (Network Function) indicated support of Multi-homed IPv6 PDU session, the network shall consider that this PDU session is supported to use multiple IPv6 prefixes.
-	should provide the UE (Network Function) Integrity Protection Maximum Data Rate to the network (i.e. SMF (Network Function)). The network shall consider that the maximum data rate per UE (Network Function) for user-plane integrity protection supported by the UE (Network Function) is valid for the lifetime of the PDU session.
For interworking without the N26 (Service-based Interface) interface, IP  (Protocol)address preservation is provided to the UEs on inter-system mobility by storing and fetching SMF (Network Function)+PGW-C and corresponding APN/DNN information via the HSS+UDM (Network Function). In such networks AMF (Network Function) also provides an indication that interworking without N26 (Service-based Interface) is supported to UEs during Initial Registration in 5GC or MME may optionally provide an indication that interworking without N26 (Service-based Interface) is supported in the Attach procedure in EPC as defined in TS 23.502 [3] and TS 23.401 [26]. The UE (Network Function) provides an indication that it supports Request Type flag "handover" for PDN connectivity request during the attach procedure as described in clause 5.3.2.1 of TS 23.401 [26] and during initial Registration and Mobility Registration Update in 5GC.
NOTE 1:	The UE (Network Function) support of Request Type flag "handover" for PDN connectivity request during the attach procedure is needed for IP  (Protocol)address preservation in the case of interworking without N26 (Service-based Interface).
The indication that interworking without N26 (Service-based Interface) is valid for the entire Registered PLMN and for PLMNs equivalent to the Registered PLMN that are available in the Registration Area. The same indication is provided to all UEs served by the same PLMN. UEs that operate in interworking without N26 (Service-based Interface) may use this indication to decide whether to register early in the target system. UEs that only support single registration mode may use this indication as described in clause 5.17.2.3.2. UE (Network Function) that support dual registration mode uses this indication as described in clause 5.17.2.3.3.
Interworking procedures without N26 (Service-based Interface) interface use the following two features:
1.	When UE (Network Function) performs Initial Attach in EPC (with or without "Handover" indication in PDN CONNECTIVITY Request message) and indicates that it is moving from 5GC, the MME indicates to the HSS+UDM (Network Function) not to cancel the registration of AMF (Network Function), if any.
2.	When UE (Network Function) performs Initial Registration in 5GC and indicates that it is moving from EPC, the AMF (Network Function) indicates to the HSS+UDM (Network Function) not to cancel the registration of MME, if any.
To support mobility both for single and dual registration mode UEs, the following also are supported by the network:
3.	When PDU Session are created in 5GC, the SMF (Network Function)+PGW-C which supports EPS interworking stores the SMF (Network Function)+PGW-C FQDN along with DNN in the HSS+UDM (Network Function).
4.	The HSS+UDM (Network Function) provides the information about dynamically allocated SMF (Network Function)+PGW-C and APN/DNN information to the target CN network. If there are multiple SMF (Network Function)+PGW-C serving the UE (Network Function) for the same DNN which support EPS interworking in 5GS, the HSS+UDM (Network Function) select one of them according to operator's policy and provides together with the associated APN to the MME.
5.	When PDN connections are created in EPC, the MME stores the SMF (Network Function)+PGW-C and APN information in the HSS+UDM (Network Function).
NOTE 2:	Items 3, 4 and 5 are also supported in networks that support interworking with N26 (Service-based Interface) procedures. This enables a VPLMN that does not deploy N26 (Service-based Interface) interface to provide IP  (Protocol)address preservation to roamed-in single-registration mode UEs from a HPLMN that only supports interworking with N26 (Service-based Interface) procedures.
When the network serving the UE (Network Function) supports 5GS-EPS interworking procedures without N26 (Service-based Interface) interface, the SMF (Network Function) shall not provide the UEs with mapped target system parameters of the target system when UE (Network Function) is in the source network.
A UE (Network Function) that operates in dual registration mode ignores any received mapped target system parameters (e.g. QoS parameters, bearer IDs/QFI, PDU Session ID, etc.).
When the UE (Network Function) supports single-registration mode and network supports interworking procedure without N26 (Service-based Interface) interface:
-	For mobility from 5GC to EPC, the UE (Network Function) with at least one PDU Session established in 5GC may either:
-	if supported and if it has received the network indication that interworking without N26 (Service-based Interface) is supported, perform Attach in EPC with a native EPS GUTI, if available, otherwise with IMSI with Request type "Handover" in PDN CONNECTIVITY Request message (clause 5.3.2.1 of TS 23.401 [26]) and indicating that the UE (Network Function) is moving from 5GC and subsequently moves all its other PDU Session using the UE (Network Function) requested PDN connectivity establishment procedure with Request Type "handover" flag (clause 5.10.2 of TS 23.401 [26]), or.
-	perform TAU with 4G-GUTI mapped from 5G-GUTI sent as old Native GUTI (clause 5.3.3 of TS 23.401 [26]) indicating that it is moving from 5GC, in which case the MME instructs the UE (Network Function) to re-attach. IP  (Protocol)address preservation is not provided in this case.
-	for the first TAU after 5GC initial Registration, the UE (Network Function) and MME for the handling of UE (Network Function) Radio Capabilities follow the procedures as defined in clause 5.11.2 TS 23.401 [26] for first TAU after GERAN/UTRAN Attach.
NOTE 1:	The first PDN connection may be established during the E-UTRAN Initial Attach procedure (see TS 23.401 [26]).
NOTE 2:	At inter-PLMN mobility to a PLMN that is not an equivalent PLMN the UE (Network Function) always uses the TAU procedure.
-	For mobility from 5GC to EPC, the UE (Network Function) with no PDU Session established in 5GC
-	performs Attach in EPC (clause 5.3.2.1 of TS 23.401 [26]) indicating that the UE (Network Function) is moving from 5GC.
-	For mobility from EPC to 5GC, the UE (Network Function) performs Mobility Registration Update in 5GC with 5G-GUTI mapped from EPS GUTI and a native 5G-GUTI, if available, as Additional GUTI and indicating that the UE (Network Function) is moving from EPC. In this case, the AMF (Network Function) determines that old node is an MME, but proceeds as if the Registration is of type "initial registration". The UE (Network Function) may either:
-	if supported and if it has received the network indication "interworking without N26 (Service-based Interface) supported", move all its PDN connections from EPC using the UE (Network Function) initiated PDU Session Establishment procedure with "Existing PDU Sessions" flag (clause 4.3.2.2.1 of TS 23.502 [3]), or
-	re-establish PDU Sessions corresponding to the PDN connections that it had in EPS. IP  (Protocol)address preservation is not provided in this case.
NOTE 3:	The additional native 5G-GUTI enables the AMF (Network Function) to find the UE (Network Function)'s 5G security context (if available).
NOTE 4:	When single-registration mode UE (Network Function) uses interworking procedures without N26 (Service-based Interface), the registration states during the transition period (e.g. while UE (Network Function) is transferring all PDU Sessions / PDN Connections on the target side) are defined in Stage 3 specifications.
-	If the network determines that the UE (Network Function) is changing RAT type, if the UE (Network Function) requests to relocate the PDU session from EPC to 5GC or 5GC to EPC, the SMF (Network Function)/MME uses the "PDU session continuity at inter RAT mobility" or "PDN continuity at inter-RAT mobility" information, respectively, in the subscription to determine whether to maintain the PDU session/PDN connection (if being handed over) or reject the PDU session request, with the relevant cause.
-	If the UE (Network Function) requested to move the PDU session and the "PDN continuity at inter RAT mobility" information indicated "disconnect the PDN connection with a reactivation request" the network should provide a suitable cause code to the UE (Network Function) so that it can request a new PDU session.
To support mobility in dual-registration mode, the support of N26 (Service-based Interface) interface between AMF (Network Function) in 5GC and MME in EPC is not required. A UE (Network Function) that supports dual registration mode may operate in this mode when it receives an indication from the network that interworking without N26 (Service-based Interface) is supported.
For UE (Network Function) operating in dual-registration mode the following principles apply for PDU Session transfer from 5GC to EPC:
-	UE (Network Function) operating in Dual Registration mode may register in EPC ahead of any PDU Session transfer using the Attach procedure indicating that the UE (Network Function) is moving from 5GC without establishing a PDN Connection in EPC if the EPC supports EPS Attach without PDN Connectivity as defined in TS 23.401 [26]. Support for EPS Attach without PDN Connectivity is mandatory for UE (Network Function) supporting dual-registration procedures.
NOTE 1:	Before attempting early registration in EPC the UE (Network Function) needs to check whether EPC supports EPS Attach without PDN Connectivity by reading the related SIB in the target cell.
-	UE (Network Function) performs PDU Session transfer from 5GC to EPC using the UE (Network Function) initiated PDN connection establishment procedure with "handover" indication in the PDN Connection Request message (clause 5.10.2 of TS 23.401 [26]).
-	If the UE (Network Function) has not registered with EPC ahead of the PDU Session transfer, the UE (Network Function) can perform Attach in EPC with "handover" indication in the PDN Connection Request message (clause 5.3.2.1 of TS 23.401 [26]).
-	UE (Network Function) may selectively transfer certain PDU Sessions to EPC, while keeping other PDU Sessions in 5GC.
-	UE (Network Function) may maintain the registration up to date in both 5GC and EPC by re-registering periodically in both systems. If the registration in either 5GC or EPC times out (e.g. upon mobile reachable timer expiry), the corresponding network starts an implicit detach timer.
NOTE 2:	Whether UE (Network Function) transfers some or all PDU Sessions on the EPC side and whether it maintains the registration up to date in both EPC and 5GC can depend on UE (Network Function) capabilities that are implementation dependent. The information for determining which PDU Sessions are transferred on EPC side and the triggers can be pre-configured in the UE (Network Function) and are not specified in this Release of the specification. The UE (Network Function) does not know before-hand, i.e. before trying to move a given PDU session to EPC, whether that PDU session can be transferred to EPC.
For UE (Network Function) operating in dual-registration mode the following principles apply for PDN connection transfer from EPC to 5GC:
-	UE (Network Function) operating in Dual Registration mode may register in 5GC ahead of any PDN connection transfer using the Registration procedure indicating that the UE (Network Function) is moving from EPC (clause 4.2.2.2.2 of TS 23.502 [3]).
-	UE (Network Function) performs PDN connection transfer from EPC to 5GC using the UE (Network Function) initiated PDU Session Establishment procedure with "Existing PDU Session" indication (clause 4.3.2.2.1 of TS 23.502 [3]).
-	UE (Network Function) may selectively transfer certain PDN connections to 5GC, while keeping other PDN Connections in EPC.
-	UE (Network Function) may maintain the registration up to date in both EPC and 5GC by re-registering periodically in both systems. If the registration in either EPC or 5GC times out (e.g. upon mobile reachable timer expiry), the corresponding network starts an implicit detach timer.
NOTE 3:	Whether UE (Network Function) transfers some or all PDN connections on the 5GC side and whether it maintains the registration up to date in both 5GC and EPC can depend on UE (Network Function) capabilities that are implementation dependent. The information for determining which PDN connections are transferred on 5GC side and the triggers can be pre-configured in the UE (Network Function) and are not specified in this Release of the specification. The UE (Network Function) does not know before-hand, i.e. before trying to move a given PDN connection to 5GC, whether that PDN connection can be transferred to 5GC.
NOTE 4:	If EPC does not support EPS Attach without PDN Connectivity the MME detaches the UE (Network Function) when the last PDN connection is released by the PGW as described in clause 5.4.4.1 of TS 23.401 [26] (in relation to transfer of the last PDN connection to non-3GPP access).
When sending a control plane request for MT services (e.g. MT SMS) the network routes it via either the EPC or the 5GC. In absence of UE (Network Function) response, the network should attempt routing the control plane request via the other system.
NOTE 5:	The choice of the system through which the network attempts to deliver the control plane request first is left to network configuration.
When the UE (Network Function) supports single-registration mode or dual-registration mode without N26 (Service-based Interface) interface:
-	If the UE (Network Function) is in CM-CONNECTED state in 5GC, the NG-RAN (Network Function) may perform RRC (Protocol) Connection Release with Redirection to E-UTRAN based on certain criteria (e.g. based on local configuration in NG-RAN (Network Function), or triggered by the AMF (Network Function) upon receiving Handover Request message from NG-RAN (Network Function)).
-	If the UE (Network Function) is in ECM-CONNECTED state in EPC, the E-UTRAN may perform RRC (Protocol) Connection release with redirection to NG-RAN (Network Function) based on certain criteria (e.g. based on local configuration in E-UTRAN, or triggered by the MME upon receiving handover request from E-UTRAN).
IP  (Protocol)address preservation upon direct mobility between 5GS and GERAN/UTRAN is not supported.
Upon mobility from 5GS to GERAN/UTRAN (e.g. upon leaving NG-RAN (Network Function) coverage) the UE (Network Function) shall perform the A/Gb mode GPRS Attach procedure or Iu mode GPRS Attach procedure (see TS 23.060 [56]).
As a UE (Network Function) option, to support IP  (Protocol)address preservation at mobility from EPC to 5GS for PDN connections without 5GS related parameters, a 5GS capable UE (Network Function) may:
-	Following mobility from GERAN/UTRAN to EPS, release those PDN connection(s) and re-establish them as specified in clause 4.11.1.5.4.1 of TS 23.502 [3] so that they support interworking to 5GS.
NOTE 1:	It is recommended that a UE (Network Function) using this option does not do this behaviour after every change to EPS in PLMNs that do not support 5GS, nor for APNs that do not support mobility to 5GS; and, that such a UE (Network Function) supports storage of the 5GS related parameters while in GERAN/UTRAN. Whether and how the UE (Network Function) is aware of which PLMNs support 5GS and which APNs do not support mobility to 5GS is out of scope of this specification.
To support mobility from EPC to 5GS to EPC to GERAN/UTRAN for PDN connections established in EPC:
NOTE 2:	For the use of N7 (Service-based Interface) or N40 (Service-based Interface) interfaces while the UE (Network Function) is in GERAN/UTRAN access, the SMF (Network Function)+PGW-C selected by the MME (using the existing selection procedures described in clause 4.11.0a of TS 23.502 [3] and clause 4.3.8 of TS 23.401 [26]) needs to support functionality (e.g. signalling of GERAN/UTRAN cell identification over N7 (Service-based Interface)) specified in Annex L (Service-based Interface).
-	in signalling sent on the N26 (Service-based Interface) interface, the MME should send the TI and BSS Container in the EPS Bearer Context (see Table 7.3.1-3 of TS 29.274 [101]), if there is any, of the EPS bearer to the SMF (Network Function) (V-SMF (Network Function) / I-SMF (Network Function)) via the AMF (Network Function) in the Bearer Context within the PDN Connection IE in the Forward Relocation Request and Context Response messages (TS 29.274 [101]); the SMF (Network Function) (V-SMF (Network Function) / I-SMF (Network Function)) should store the TI and BSS Container and the SMF (Network Function) (V-SMF (Network Function) / I-SMF (Network Function)) should provide the TI and BSS Container to the AMF (Network Function) (as part of a procedure to deliver SM context to AMF (Network Function)) so that the AMF (Network Function) sends the TI and BSS Container of the related EPS bearer in the Bearer Context within the EPS PDN Connection information in any subsequent Forward Relocation Request and Context Response message sent to an MME.
NOTE 3:	At mobility from EPC, the SMF (Network Function)+PGW-C / V-SMF (Network Function) / I-SMF (Network Function) receives the TI and BSS Container as part of the UE (Network Function) EPS PDN Connection information from the AMF (Network Function) and stores the TI. At mobility to EPC, the SMF (Network Function)+PGW-C / V-SMF (Network Function) / I-SMF (Network Function) provides the AMF (Network Function) with the TI and BSS Container as part of the UE (Network Function) EPS PDN Connection information. The SMF (Network Function)+PGW-C / V-SMF (Network Function) / I-SMF (Network Function) is not meant to understand the TI/BSS Container nor to use it for any other purpose than providing it back to AMF (Network Function).
NOTE 4:	GERAN/UTRAN Mobility Management Bearer Synchronisation procedures will release any dedicated QoS Flows established in 5GS.
NOTE 5:	When the UE (Network Function) access the network via GERAN/UTRAN over Gn/Gp interface, Secondary PDP Context Activation Procedure is not supported.
IP  (Protocol)address preservation at mobility from EPC to GERAN/UTRAN for PDU sessions established in 5GS is not supported.
With regard to interworking between 5GS and the Circuit Switched domain when the GERAN or UTRAN network is operating in NMO II (i.e. no Gs interface between MSC and SGSN):
-	upon mobility from 5GS to GERAN/UTRAN, the UE (Network Function) shall either:
-	act as if it is returning after a loss of GERAN/UTRAN coverage (and e.g. only perform a periodic LAU if the periodic LAU timer has expired), or,
-	perform a Location Update to the MSC. If the UE (Network Function) is registered for IMS voice and is configured, using Device Management or initial provisioning, to perform additional mobility management procedures when it has moved from a RAT that supports IMS voice over PS sessions to one that does not (see TS 23.060 [56]), it shall follow this option.
Upon mobility from GERAN/UTRAN to 5GS (e.g. upon selecting an NG-RAN (Network Function) cell) the UE (Network Function) shall perform the Registration procedure of "initial registration" type as described in TS 23.502 [3]. The UE (Network Function) shall indicate a 5G-GUTI as UE (Network Function) identity in the Registration procedure if it has a stored valid native 5G-GUTI (e.g. from an earlier registration in the 5G System). Otherwise the UE (Network Function) shall indicate a SUCI.
If a UE (Network Function) in MICO mode moves to GERAN/UTRAN and any of the triggers defined in clause 5.4.1.3 occur, then the UE (Network Function) shall locally disable MICO mode and perform the A/Gb mode GPRS Attach procedure or Iu mode GPRS Attach procedure (see TS 23.060 [56]). The UE (Network Function) can renegotiate MICO when it returns to 5GS during (re-)registration procedure.
In Single Registration mode, expiry of the periodic RAU timer, or, the periodic LAU timer shall not cause the UE (Network Function) to change RAT.
The 5G SRVCC from NG-RAN (Network Function) to UTRAN is specified in the TS 23.216 [88]. After the 5G SRVCC to UTRAN, all the PDU sessions of the UE (Network Function) are released.
Secondary authentication/authorization by a DN (Network Function)-AAA server during the establishment of a PDN connection over 3GPP access to EPC, is supported based on following principles:
-	It is optional for the UE (Network Function) to support EAP-based secondary authentication and authorization by DN (Network Function)-AAA over EPC,
-	A SMF (Network Function)+PGW-C shall be used to serve DNN(s) requiring secondary authentication/authorization by a DN (Network Function)-AAA server,
-	For secondary authentication/authorization by a DN (Network Function)-AAA server, the SMF (Network Function)+PGW-C runs the same procedures with PCF (Network Function), UDM (Network Function) and DN (Network Function)-AAA and uses the same corresponding interfaces regardless of whether the UE (Network Function) is served by EPS or 5GS,
-	The interface towards the UE (Network Function) is different (usage of NAS (Protocol) for EPS instead of NAS (Protocol) for 5GS) between the EPS and 5GS cases.
This is further specified in Annex H of TS 23.502 [3].
In this Release, EAP based Secondary authentication by a DN (Network Function)-AAA server during the establishment of a PDN connection over non-3GPP access to EPC is not supported.
When a UE (Network Function) is simultaneously connected to the 5GC over a 3GPP access and a non-3GPP access, it may have PDU Sessions associated with 3GPP access and PDU Sessions associated with non-3GPP access. When inter-system handover from 5GS to EPS is performed for PDU Sessions associated with 3GPP access, the PDU Sessions associated with non-3GPP access are kept anchored by the network in 5GC and the UE (Network Function) may either:
-	keep PDU Sessions associated with non-3GPP access in 5GS (5GC+N3IWF (Network Function) or TNGF (Network Function)) (i.e. the UE (Network Function) is then registered both in EPS and, for non-3GPP access, in 5GS); or
-	locally or explicitly release PDU Sessions associated with non-3GPP access; or
-	once in EPS, transfer PDU Sessions associated with non-3GPP access to E-UTRAN by triggering PDN connection establishment with Request Type "Handover", as specified in TS 23.401 [26].
The detailed description for supporting network sharing and interworking between EPS and 5GS is described in clauses 4.11.1.2.1, 4.11.1.2.2, 4.11.1.3.2 and 4.11.1.3.3 of TS 23.502 [3].
Clause 4.3.5 shows the Service Exposure Network Architecture in scenarios where for EPC-5GC Interworking is required.
In scenarios where interworking between 5GS and EPC is possible, the network configuration is expected to associate UEs with SCEF+NEF (Network Function) node(s) for Service Capability Exposure. The SCEF+NEF (Network Function) hides the underlying 3GPP network topology from the AF (Network Function) (e.g. SCS/AS) and hides whether the UE (Network Function) is served by 5GC or EPC.
If the service exposure function that is associated with a given service for a UE (Network Function) is configured in the UE (Network Function)'s subscription information, then an SCEF+NEF (Network Function) identity shall be used to identify the exposure function. For example, if a UE (Network Function) is capable of switching between EPC and 5GC, then the SCEF ID that is associated with any of the UE (Network Function)'s APN configurations should point to an SCEF+NEF (Network Function) node.
For external exposure of services related to specific UE (Network Function)(s), the SCEF+NEF (Network Function) resides in the HPLMN. Depending on operator agreements, the SCEF+NEF (Network Function) in the HPLMN may have interface(s) with NF (Network Function)(s) in the VPLMN.
The SCEF+NEF (Network Function) exposes over N33 (Service-based Interface) the same API as the SCEF supports over T8. If CAPIF (Network Function) is not supported, the AF (Network Function) is locally configured with the API termination points for each service. If CAPIF (Network Function) is supported, the AF (Network Function) obtains the service API information from the CAPIF (Network Function) core function via the Availability of service APIs event notification or Service Discover Response as specified in TS 23.222 [64].
The common state information shall be maintained by the combined SCEF+NEF (Network Function) node in order to meet the external interface requirements of the combined node. The common state information includes at least the following data that needs to be common for the SCEF and NEF (Network Function) roles of SCEF+NEF (Network Function):
-	SCEF+NEF (Network Function) ID (must be the same towards the AF (Network Function)).
-	SCEF+NEF (Network Function) common IP  (Protocol)address and port number.
-	Monitoring state for any ongoing monitoring request.
-	Configured set of APIs supported by SCEF+ NEF (Network Function).
-	PDN Connection/PDU Session State and NIDD Configuration Information, including Reliable Data Service state information.
-	Network Parameter Configuration Information (e.g. Maximum Response Time and Maximum Latency).
The SCEF+NEF (Network Function) need not perform the same procedures for the configuration of monitoring events towards the HSS+UDM (Network Function) twice. For example, if the HSS+UDM (Network Function) is deployed as a combined node, a monitoring event only need to be configured by the SCEF+NEF (Network Function) just once.
The SCEF+NEF (Network Function) may configure monitoring events applicable to both EPC and 5GC using only 5GC procedures towards UDM (Network Function). In this case, the SCEF+NEF (Network Function) shall indicate that the monitoring event is also applicable to EPC (i.e. the event must be reported both by 5GC and EPC) and may include a SCEF address (i.e. if the event needs to be configured in a serving node in the EPC and the corresponding notification needs to be sent directly to the SCEF). If the HSS and UDM (Network Function) are deployed as separate network entities, UDM (Network Function) shall use HSS services to configure the monitoring event in EPC as defined in TS 23.632 [102]. The UDM (Network Function) shall return an indication to SCEF+NEF (Network Function) of whether the configuration of the monitoring event in EPC was successful. In the case that the UDM (Network Function) reports that the configuration of a monitoring event was not possible in EPC, then the SCEF+NEF (Network Function) may configure the monitoring event using EPC procedures via the HSS as defined in TS 23.682 [36].
NOTE 1:	The SCEF+NEF (Network Function) uses only 5GC procedures to configure monitoring events in EPC and 5GC.
NOTE 2:	In terms of the CAPIF (Network Function), the SCEF+NEF (Network Function) is considered a single node.
In addition to the interworking principles documented in clause 5.17.2.2, the following applies for interworking with N26 (Service-based Interface):
-	When UE (Network Function) moves from EPS to 5GS, when the AMF (Network Function) registers in UDM (Network Function), if no event subscription via UDM (Network Function) is available, the AMF (Network Function) indicates the situation to the UDM (Network Function), and in this case the UDM (Network Function) can decide if the event subscriptions should be provisioned, otherwise if the AMF (Network Function) has event subscription information, after the registration procedure is completed, the AMF (Network Function) may inform the UDM (Network Function) of the currently subscribed events, and UDM (Network Function) will do synchronization if needed.
-	When UE (Network Function) moves from 5GS to EPS, the MME gets monitoring event configuration from HSS during as part of mobility procedure as specified in clause 4.11.1.3.2 of TS 23.502 [3].
In addition to the interworking principles documented in clause 5.17.2.3, the additional behaviour at EPS to 5GS mobility in clause 5.17.5.2.1 also applies.
When SCEF+NEF (Network Function) performs the procedure of monitoring via the AMF (Network Function) as described in clause 4.15.3.2.4 ("Exposure with bulk subscription") in TS 23.502 [3], if the AMF (Network Function) determines the interworking without N26 (Service-based Interface) interface is supported, during mobility from 5GS to EPS, the AMF (Network Function) shall subscribe on behalf of SCEF+NEF (Network Function) for UDM (Network Function)+HSS notification of MME ID as described in clause 7.1.2 to trigger the SCEF+NEF (Network Function) to configure the monitoring request to the new MME. For single-registration mode, when UE (Network Function)'s mobility from 5GS to EPS happens and Serving MME sends Update Location Request to the UDM (Network Function)+HSS, the UDM (Network Function)+HSS provides Serving MME ID to the SCEF+NEF (Network Function) which is the notification endpoint based on the subscription request from AMF (Network Function). Then the SCEF+NEF (Network Function) performs the procedure of configuring monitoring via the MME for the same Monitoring Events as described in clause 5.6.2.1 of TS 23.682 [36].
When SCEF+NEF (Network Function) performs the procedure of monitoring via the UDM (Network Function)+HSS as described in clause 4.15.3.2.2 of TS 23.502 [3], when UE (Network Function)'s mobility between 5GS and EPS happens, the UDM (Network Function)+HSS performs the procedure of configuring monitoring at the MME as described in clause 5.6.1.1 of TS 23.682 [36] and at the AMF (Network Function) as described in clause 4.15.3.2.1 of TS 23.502 [3].
A service related with common north-bound API may become unavailable due to UE (Network Function) being served by a CN node not supporting the service. If the availability or expected level of support of a service API associated with a UE (Network Function) changes, for example due to a mobility between 5GC and EPC, the AF (Network Function) shall be made aware of the change.
NOTE 1:	If CAPIF (Network Function) is supported and the service APIs become (un)available for the 5GC or EPC network, the AF (Network Function) obtains such information from the CAPIF (Network Function) core function.
If the SCEF+NEF (Network Function) receives the subscription request from the AF (Network Function) for the availability or expected level of support of a service API, the SCEF+NEF (Network Function) subscribes a CN Type Change event for the UE (Network Function) or Group of UEs to the HSS+UDM (Network Function). If the HSS+UDM (Network Function) receives the subscription for CN Type Change event, the HSS+UDM (Network Function) includes the latest CN type for the UE (Network Function) or Group of UEs in the response for the subscription. If the HSS+UDM (Network Function) detects that the UE (Network Function) switches between being served by the MME and the AMF (Network Function), the CN Type Change event is triggered, and the HSS+UDM (Network Function) notifies the latest CN type for the UE (Network Function) or Group of UEs to the SCEF+NEF (Network Function). Based on the CN type information, the SCEF+NEF (Network Function) can determine the availability or expected level of support of a given service. The AF (Network Function) will be informed of such information via a subscription/notification service operation. The AF (Network Function) can subscribe for the availability or expected level of support of a service API with report type indicating either One-time report or Continuous report. If there is no CN type information for the UE (Network Function) in the SCEF+NEF (Network Function), the SCEF+NEF (Network Function) subscribes monitoring event for a new CN Type Change event for the UE (Network Function) or Group of UEs to the HSS+UDM (Network Function), otherwise, SCEF+NEF (Network Function) determines the CN type locally in the following conditions:
-	If the AF (Network Function) subscribes with report type indicating One-time report, the SCEF+NEF (Network Function) may consider the Freshness Timer of the latest CN type information for the UE (Network Function) or Group of UEs. The Freshness Timer is a parameter that is configured based on local SCEF+NEF (Network Function) policy. When a subscription request with One-time report type is received the SCEF+NEF (Network Function) checks if there is the latest CN type information received from the HSS+UDM (Network Function) for the indicated UE (Network Function) ID or External Group ID. If the elapsed time for the CN type information since the last reception is less than the Freshness Timer, then the SCEF+NEF (Network Function) may respond to the AF (Network Function) with the latest CN type information in order to avoid repeated query to HSS+UDM (Network Function).
-	The SCEF+NEF (Network Function) has established a direct connection with MME or AMF (Network Function) or SMF (Network Function).
When the UE (Network Function) or all members of a Group of UEs are being served by a MME, EPC is determined as CN type. When the UE (Network Function) or all members of a Group of UEs are being served by an AMF (Network Function), 5GC is determined as CN type. When the UE (Network Function) is registered both in EPC and 5GC, or some members of a Group of UEs are registered in EPC while some members are registered in 5GC, 5GC+EPC is determined as CN type.
NOTE 2:	If 5GC+EPC is determined as the CN type serving the UE (Network Function) or the group of UEs, the SCEF+NEF (Network Function) determines that service APIs for both 5GC and EPC are available to the UE (Network Function) or the group of UEs.

The purpose of the Configuration Transfer between NG-RAN (Network Function) and E-UTRAN is to enable the transfer the RAN (Network Function) configuration information between the gNB and eNodeB via MME and AMF (Network Function).
In order to make the information transparent for the MME and AMF (Network Function), the information is included in a transparent container. The source and target RAN (Network Function) node addresses, which allows the Core Network nodes to route the messages. The mechanism depicted in Figure 5.17.7.1-1.

Figure 5.17.7.1-1: Configuration Transfer between gNB and E-UTRAN basic network architecture
The NG-RAN (Network Function) transparent containers are transferred from the source NG-RAN (Network Function) node to the destination E-UTRAN node and vice versa by use of Configuration Transfer messages.
An ENB Configuration Transfer message is used from the E-UTRAN node to the MME over S1 interface as described in TS 36.413 [100], the destination RAN (Network Function) node includes the en-gNB Identifier and may include a TAI associated with the en-gNB. If MME is aware that the en-gNB serves cells which provide access to 5GC, the MME relays the request towards a suitable AMF (Network Function) via inter-system signalling based on a broadcast 5G TAC. An AMF (Network Function) Configuration Transfer message is used from the AMF (Network Function) to the NG-RAN (Network Function) over N2 (Non-service-based Interface) (Service-based Interface) interface.
A Configuration Transfer message is used by the gNB node to the AMF (Network Function) over N2 (Non-service-based Interface) (Service-based Interface) interface for the reply, and a Configuration Transfer Tunnel message is used to tunnel the transparent container from AMF (Network Function) to MME over the N26 (Service-based Interface) interface. MME relays this reply to the target eNB using a MME CONFIGURATION TRANSFER message. Transport of the RAN (Network Function) containers in E-UTRAN is specified in TS 23.401 [26].
Each Configuration Transfer message carrying the transparent container is routed and relayed independently by the core network node(s). Any relation between messages is transparent for the AMF (Network Function) and MME, i.e. a request/response exchange between applications, for example SON applications, is routed and relayed as two independent messages by the AMF (Network Function) and MME.
All the Configuration Transfer messages contain the addresses of the source and destination RAN (Network Function) nodes.
An gNB node is addressed by the Target NG-RAN (Network Function) node identifier as described in TS 38.413 [34].
An eNodeB is addressed by the Target eNodeB identifier as described in TS 36.413 [100].
The source RAN (Network Function) node sends a message to its core network node including the source and destination addresses.
MME uses the destination address to route the message to the correct AMF (Network Function) via N26 (Service-based Interface) interface. AMF (Network Function) uses the destination address to route the message to the correct MME via N26 (Service-based Interface) interface.
The AMF (Network Function) connected to the destination RAN (Network Function) node decides which RAN (Network Function) node to send the message to, based on the destination address.
The MME connected to the destination RAN (Network Function) node decides which RAN (Network Function) node to send the message to, based on the destination address.
The AMF (Network Function) performs relaying between N2 (Non-service-based Interface) (Service-based Interface) and N26 (Service-based Interface) messages as described in TS 38.413 [34] and TS 29.274 [101].
The MME performs relaying between S1 and N26 (Service-based Interface) message as described in TS 36.413 [100] and TS 29.274 [101].
When the UE (Network Function) first registers in 5GS, the UE (Network Function) includes the Indication of URSP Provisioning Support in EPS in the UE (Network Function) Policy Container carried in Registration Request. Only when receiving this indication in the UE (Network Function) Policy Container, the PCF (Network Function) will provision the URSP to UE (Network Function) in EPS.
During Initial Attach with default PDN connection establishment procedure in EPS, the UE (Network Function) provides the Indication of URSP Provisioning Support in EPS PCO in the PDN connectivity request to SMF (Network Function)+PGW-C. If the SMF (Network Function)+PGW-C supports URSP provisioning in EPS, it provides the Indication of URSP Provisioning Support in EPS PCO to UE (Network Function) in the PDN Connectivity Accept message.
NOTE 1:	The ePCO capability negotiation between UE (Network Function) and network is done during Attach procedure as defined in TS 24.301 [13].
When the UE (Network Function) receives the URSP Provisioning Support in EPS PCO and ePCO support indication from EPC, then the UE (Network Function) initiates the UE (Network Function) requested bearer resource modification procedure and includes the UE (Network Function) Policy Container ePCO in the Request Bearer Resource Modification message, the UE (Network Function) Policy Container ePCO will be further forwarded by MME to SMF (Network Function)+PGW-C. When the UE (Network Function) Policy Container ePCO is received by SMF (Network Function)+PGW-C, it forwards transparently the UE (Network Function) Policy Container to PCF (Network Function) for the PDU Session, then the PCF (Network Function) for the PDU Session establishes the UE (Network Function) Policy Association with PCF (Network Function) for the UE (Network Function). The PCF (Network Function) for the UE (Network Function) generates the corresponding URSP rules in a similar way as it is done in 5GS and sends the URSP rules to UE (Network Function) in the UE (Network Function) Policy Container as described in clause 4.11.0a.5 of TS 23.502 [3].
If the UE (Network Function) does not receive the URSP Provisioning Support in EPS PCO and ePCO support indication from EPC, then the UE (Network Function) does not initiate the UE (Network Function) requested bearer resource modification procedure to send the UE (Network Function) Policy Container ePCO to EPC.
The PDN Connection used by UE (Network Function) and SMF (Network Function)/PGW-C to convey UE (Network Function) Policy Container ePCO shall be kept when the UE (Network Function) is in the CONNECTED mode. When the UE (Network Function) is attached to EPS, the PCF (Network Function) for the PDU Session retrieves the PCRTs for UE (Network Function) Policy from PCF (Network Function) for the UE (Network Function) and subscribes to the applicable PCRTs to SMF (Network Function)+PGW-C. The PCF (Network Function) for the PDU Session sends the UE (Network Function) Policy Container in the same PDN connection/PDU session in which the UE (Network Function) Policy Container was received.
During EPS to 5GS mobility with N26 (Service-based Interface), the UE (Network Function) Policy Association is terminated by PCF (Network Function) for PDU Session when it receives the indication of RAT type change from the SMF (Network Function)+PGW-C.
During 5GS to EPS mobility with N26 (Service-based Interface), the PCF (Network Function) for the PDU Session determines whether the UE (Network Function) supports URSP delivery in EPS by checking UE (Network Function) context policy control subscription information in UDR (Network Function). The PCF (Network Function) for the PDU Session discovers the address of PCF (Network Function) for the UE (Network Function) serving the UE (Network Function) by querying BSF (Network Function). The PCF (Network Function) for the UE (Network Function) recovers the information about the PSI list in the UE (Network Function) and the subscribed PCRTs in 5GS from former UE (Network Function) Policy Association for the UE (Network Function) after receiving the UE (Network Function) Policy Association Establishment request including a UE (Network Function) Policy Container only including an indication about the trigger for the UE (Network Function) Policy Association Establishment ("5GS to EPS mobility").
NOTE 2:	At 5GS to EPS mobility with N26 (Service-based Interface), the guard timer in the AMF (Network Function) (as specified in clauses 4.11.1.2.1 and 4.11.1.3.2 of TS 23.502 [3]) ensures that the UE (Network Function) Policy Association remains until the PCF (Network Function) for the UE (Network Function) detects that a UE (Network Function) Policy Association establishment is received from a PCF (Network Function) for the PDU Session indicating 5GS to EPS mobility.
NOTE 3:	In the case that the UE (Network Function) is still registered and reachable over non-3GPP access, the PCF (Network Function) for UE (Network Function) can have two UE (Network Function) policy associations for one UE (Network Function), and based on local configuration the PCF (Network Function) can decide to use one of the UE (Network Function) policy associations to update URSP rule to the UE (Network Function). The UE (Network Function) can receive URSP Rules over any of these two accesses.
A network sharing architecture shall allow multiple participating operators to share resources of a single shared network according to agreed allocation schemes. The shared network includes a radio access network. The shared resources include radio resources.
The shared network operator allocates shared resources to the participating operators based on their planned and current needs and according to service level agreements.
In this Release of the specification, only the 5G Multi-Operator Core Network (5G MOCN) network sharing architecture, in which only the RAN (Network Function) is shared in 5G System, is supported. 5G MOCN for 5G System, including UE (Network Function), RAN (Network Function) and AMF (Network Function), shall support operators' ability to use more than one PLMN ID (i.e. with same or different country code (MCC) some of which is specified in TS 23.122 [17] and different network codes (MNC)) or combinations of PLMN ID and NID. 5G MOCN supports NG-RAN (Network Function) Sharing with or without multiple Cell Identity broadcast as described in TS 38.300 [27].
5G MOCN also supports the following sharing scenarios involving non-public networks, i.e.NG-RAN (Network Function) can be shared by any combination of PLMNs, PNI-NPNs (with CAG), and SNPNs (each identified by PLMN ID and NID).
NOTE 1:	PNI-NPNs (without CAG) are not explicitly listed above as it does not require additional NG-RAN (Network Function) sharing functionality compared to sharing by one or multiple PLMNs.
In all non-public network sharing scenarios, each Cell Identity as specified in TS 38.331 [28] is associated with one of the following configuration options:
-	one or multiple SNPNs;
-	one or multiple PNI-NPNs (with CAG); or
-	one or multiple PLMNs only.
NOTE 2:	This allows the assignment of multiple cell identities to a cell and also allows the cell identities to be independently assigned, i.e. without need for coordination, by the network sharing partners, between PLMNs and/or non-public networks.
NOTE 3:	Different PLMN IDs (or combinations of PLMN ID and NID) can also point to the same 5GC. When same 5GC supports multiple SNPNs (identified by PLMN ID and NID), it is up to the operator's policy whether they are used as equivalent SNPNs for a UE (Network Function).
NOTE 4:	There is no standardized mechanism to avoid paging collisions if the same 5G-S-TMSI is allocated to different UEs by different PLMNs or SNPNs of the shared network, as the risk of paging collision is assumed to be very low. If such risk is to be eliminated then PLMNs and SNPNs of the shared network needs to coordinate the value space of the 5G-S-TMSI to differentiate the PLMNs and SNPNs of the shared network.

Figure 5.18.1-1: A 5G Multi-Operator Core Network (5G MOCN) in which multiple CNs are 
connected to the same NG-RAN (Network Function)
If a shared NG-RAN (Network Function) is configured to indicate available networks (PLMNs and/or SNPNs) for selection by UEs, each cell in the shared radio access network shall in the broadcast system information include available core network operators in the shared network.
The Broadcast System Information broadcasts a set of PLMN IDs and/or PLMN IDs and NIDs and one or more additional set of parameters per PLMN e.g. cell-ID, Tracking Areas, CAG Identifiers. All 5G System capable UEs that connect to NG-RAN (Network Function) support reception of multiple PLMN IDs and per PLMN specific parameters. All SNPN-enabled UEs support reception of multiple combinations of PLMN ID and NID and SNPN-specific parameters.
The available core network operators (PLMNs and/or SNPNs) shall be the same for all cells of a Tracking Area in a shared NG-RAN (Network Function) network.
UEs not set to operate in SNPN access mode decode the broadcast system information and take the information concerning available PLMN IDs into account in PLMN and cell (re-)selection procedures. UEs set to operate in SNPN access mode decode the broadcast system information and take the information concerning available PLMN IDs and NIDs into account in network and cell (re-)selection procedures. Broadcast system information is specified in TS 38.331 [28] for NR, TS 36.331 [51] for E-UTRA and related UE (Network Function) access stratum idle mode procedures in TS 38.304 [50] for NR and TS 36.304 [52] for E-UTRA.
5.18.2a	PLMN list and SNPN list handling for network sharing
The AMF (Network Function) prepares lists of PLMN IDs or SNPN IDs suitable as target PLMNs or target SNPNs for use at idle mode cell (re)selection and for use at handover and RRC (Protocol) Connection Release with redirection. The AMF (Network Function):
-	provides the UE (Network Function) with the list of PLMNs or list of SNPNs that the UE (Network Function) shall consider as Equivalent to the serving PLMN or the serving SNPN (see TS 23.122 [17]); and
-	provides the NG-RAN (Network Function) with a prioritised list of permitted PLMNs or a prioritized list of permitted SNPNs. When prioritising these PLMNs or SNPNs, the AMF (Network Function) may consider the following information: HPLMN of the UE (Network Function) or the subscribed SNPN of the UE (Network Function), the serving PLMN or the serving SNPN, a preferred target PLMN (e.g. based on last used EPS PLMN) or a preferred target SNPN, or the policies of the operator(s).
For a UE (Network Function) registered in an SNPN, the AMF (Network Function) shall not provide a list of equivalent PLMNs to the UE (Network Function) and shall not provide a list of permitted PLMNs to NG-RAN (Network Function).
For a UE (Network Function) registered in a PLMN, the AMF (Network Function) shall not provide a list of equivalent SNPNs to the UE (Network Function) and shall not provide a list of permitted SNPNs to NG-RAN (Network Function).
NOTE:	This clause applies to UEs not operating in SNPN access mode. Network selection for UEs set to operate in SNPN access mode is described in clause 5.30.2.4.
A UE (Network Function) that has a subscription to one of the sharing core network operators shall be able to select this core network operator while within the coverage area of the shared network and to receive subscribed services from that core network operator.
Each cell in shared NG-RAN (Network Function) shall in the broadcast system information include the PLMN-IDs concerning available core network operators in the shared network.
When a UE (Network Function) performs an Initial Registration to a network, one of available PLMNs shall be selected to serve the UE (Network Function). UE (Network Function) uses all the received broadcast PLMN-IDs in its PLMN (re)selection processes which is specified in TS 23.122 [17]. UE (Network Function) shall inform the NG-RAN (Network Function) of the selected PLMN so that the NG-RAN (Network Function) can route correctly. The NG-RAN (Network Function) shall inform the core network of the selected PLMN.
As per any network, after Initial Registration to the shared network and while remaining served by the shared network, the network selection procedures specified in TS 23.122 [17] may cause the UE (Network Function) to perform a reselection of another available PLMN.
UE (Network Function) uses all of the received broadcast PLMN-IDs in its cell and PLMN (re)selection processes.
The NG-RAN (Network Function) uses the selected PLMN/SNPN (provided by the UE (Network Function) at RRC (Protocol) establishment, or, provided by the AMF (Network Function)/source NG-RAN (Network Function) at N2 (Non-service-based Interface) (Service-based Interface)/Xn handover) to select target cells for future handovers (and radio resources in general) appropriately. The network should not move the UE (Network Function) to another available PLMN/SNPN, e.g. by handover, as long as the selected PLMN/SNPN is available to serve the UE (Network Function)'s location.
In the case of handover or network controlled release to a PLMN in a shared network:
-	When multiple PLMN IDs are broadcasted in a cell selected by NG-RAN (Network Function), NG-RAN (Network Function) shall select a target PLMN, taking into account the prioritized list of PLMN IDs provided via Mobility Restriction List from AMF (Network Function).
-	For Xn based HO procedure, Source NG-RAN (Network Function) indicates the selected PLMN ID to the target NG-RAN (Network Function), see TS 38.300 [27].
-	For N2 (Non-service-based Interface) (Service-based Interface) based HO procedure, the NG-RAN (Network Function) indicates a selected PLMN ID to the AMF (Network Function) as part of the TAI sent in the HO required message. Source AMF (Network Function) uses the TAI information supplied by the source NG-RAN (Network Function) to select the target AMF (Network Function)/MME. The source AMF (Network Function) should forward the selected PLMN ID to the target AMF (Network Function)/MME. The target AMF (Network Function)/MME indicates the selected PLMN ID to the target NG-RAN (Network Function)/eNB so that the target NG-RAN (Network Function)/eNB can select target cells for future handover appropriately.
-	For RRC (Protocol) connection release with redirection to E-UTRAN procedure, NG-RAN (Network Function) decides the target network by using PLMN information as defined in the first bullet.
A change in serving PLMN is indicated to the UE (Network Function) as part of the UE (Network Function) registration with the selected network via 5G-GUTI in 5GS.
In the case of handover or network controlled release to an SNPN in a shared network, the following applies:
-	When multiple SNPN IDs are broadcasted in a cell selected by NG-RAN (Network Function), NG-RAN (Network Function) shall select a target SNPN, taking into account the prioritized list of SNPN IDs provided via Mobility Restriction List from AMF (Network Function).
-	For Xn based HO procedure, Source NG-RAN (Network Function) indicates the selected SNPN ID to the target NG-RAN (Network Function), see TS 38.300 [27].
-	For N2 (Non-service-based Interface) (Service-based Interface) based HO procedure, the NG-RAN (Network Function) indicates a selected SNPN ID to the AMF (Network Function) together with the TAI sent in the HO required message. Source AMF (Network Function) uses the selected SNPN ID together with the TAI information supplied by the source NG-RAN (Network Function) to select the target AMF (Network Function). The source AMF (Network Function) should forward the selected SNPN ID to the target AMF (Network Function). The target AMF (Network Function) indicates the selected SNPN ID to the target NG-RAN (Network Function) so that the target NG-RAN (Network Function) can select target cells for future handover appropriately.
A change in serving SNPN is indicated to the UE (Network Function) as part of the UE (Network Function) registration with the selected network.
As defined in clause 5.15.1, a Network Slice is defined within a PLMN or SNPN. Network sharing is performed among different PLMNs and/or SNPNs. In the case of network sharing, each PLMN or SNPN sharing the NG-RAN (Network Function) defines and supports its PLMN- or SNPN- specific set of slices that are supported by the common NG-RAN (Network Function).
In order to ensure that the network functions within 5G System are operating under nominal capacity for providing connectivity and necessary services to the UE (Network Function). Thus, it supports various measures to guard itself under various operating conditions (e.g. peak operating hour, extreme situations). It includes support for load (re-)balancing, overload control and NAS (Protocol) level congestion control. A 5GC NF (Network Function) is considered to be in overload when it is operating over its nominal capacity resulting in diminished performance (including impacts to handling of incoming and outgoing traffic).
AMF (Network Function) can support load balancing and re-balancing of TNL associations between 5G-AN and AMF (Network Function) by using mechanisms specified in clause 5.21.1.
The AMF (Network Function) Load Balancing functionality permits UEs that are entering into an AMF (Network Function) Region/AMF (Network Function) Set to be directed to an appropriate AMF (Network Function) in a manner that achieves load balancing between AMFs. This is achieved by setting a Weight Factor for each AMF (Network Function), such that the probability of the 5G-AN selecting an AMF (Network Function) is proportional to Weight Factor of the AMF (Network Function). The Weight Factor is typically set according to the capacity of an AMF (Network Function) node relative to other AMF (Network Function) nodes. The Weight Factor is sent from the AMF (Network Function) to the 5G-AN via NGAP messages (see TS 38.413 [34]).
NOTE 1:	An operator may decide to change the Weight Factor after the establishment of NGAP connectivity as a result of changes in the AMF (Network Function) capacities. e.g. a newly installed AMF (Network Function) may be given a very much higher Weight Factor for an initial period of time making it faster to increase its load.
NOTE 2:	It is intended that the Weight Factor is NOT changed frequently. e.g. in a mature network, changes on a monthly basis could be anticipated, e.g. due to the addition of 5G-AN or 5GC nodes.
NOTE 3:	Weight Factors for AMF (Network Function) Load Balancing are associated with AMF (Network Function) Names.
Load balancing by 5G-AN node is only performed between AMFs that belong to the same AMF (Network Function) set, i.e. AMFs with the same PLMN, AMF (Network Function) Region ID and AMF (Network Function) Set ID value.
The 5G-AN node may have their Load Balancing parameters adjusted (e.g. the Weight Factor is set to zero if all subscribers are to be removed from the AMF (Network Function), which will route new entrants to other AMFs within an AMF (Network Function) Set).
The AMF (Network Function) load re-balancing functionality permits cross-section of its subscribers that are registered on an AMF (Network Function) (within an AMF (Network Function) Set) to be moved to another AMF (Network Function) within the same AMF (Network Function) set with minimal impacts on the network and end users. AMF (Network Function) may request some or all of the 5G-AN node(s) to redirect a cross-section of UE (Network Function)(s) returning from CM-IDLE state to be redirected to another AMF (Network Function) within the same AMF (Network Function) set, if the 5G-AN is configured to support this. The AMF (Network Function) may request some or all of the 5G-AN node(s) to redirect the UEs served by one of its GUAMI(s) to a specific target AMF (Network Function) within the same AMF (Network Function) set or to any different AMF (Network Function) within the same AMF (Network Function) set.
When indicating a specific target AMF (Network Function), the AMF (Network Function) should ensure that the load re-balancing will not cause overload in the target AMF (Network Function).
NOTE:	This requirement can be fulfilled by the AMF (Network Function) itself or by the OAM.
For UE (Network Function)(s) in CM-IDLE state, when UE (Network Function) subsequently returns from CM-IDLE state and the 5G-AN receives an initial NAS (Protocol) message with a 5G S-TMSI or GUAMI pointing to an AMF (Network Function) that requested for redirection, the 5G-AN should select the specific target AMF (Network Function) (provided by the original AMF (Network Function)) or a different AMF (Network Function) from the same AMF (Network Function) set and forward the initial NAS (Protocol) message.
For UE (Network Function)(s) in CONNECTED mode, similar mechanisms for AMF (Network Function) Management can be used to move the UE (Network Function) to another AMF (Network Function) in the same AMF (Network Function) set as described in clause 5.21.2, except that the old AMF (Network Function) deregisters itself from NRF (Network Function).
The newly selected/target AMF (Network Function) (which is now the serving AMF (Network Function)) will re-assign the GUTI (using its own GUAMI(s)) to the UE (Network Function)(s). It is not expected that the 5G-AN node rejects any request or enables access control restriction when it receives a request for redirection for load control from the connected AMF (Network Function)(s).
When the AMF (Network Function) wants to stop redirection, the AMF (Network Function) can indicate that it can serve all UE (Network Function)(s) in CM-IDLE state to stop the redirection.
NOTE 1:	An example use for the AMF (Network Function) load re-balancing functionality is for the AMF (Network Function) to pro-actively re-balance its load prior to reaching overload i.e. to prevent overload situation.
NOTE 2:	Typically, AMF (Network Function) Load Re-Balancing is not needed when the AMF (Network Function) becomes overloaded because the Load Balancing function should have ensured that the other AMFs within the AMF (Network Function) Set are similarly overloaded.
The AMF (Network Function) shall contain mechanisms for avoiding and handling overload situations. This includes the following measures:
-	N2 (Non-service-based Interface) (Service-based Interface) overload control that could result in RRC (Protocol) reject, RRC (Protocol) Connection Release and unified access barring.
-	NAS congestion control.
Under unusual circumstances, if AMF (Network Function) has reached overload situation, the AMF (Network Function) activates NAS (Protocol) level congestion control as specified in Clause 5.19.7 and AMF (Network Function) restricts the load that the 5G-AN node(s) are generating, if the 5G-AN is configured to support overload control. N2 (Non-service-based Interface) (Service-based Interface) overload control can be achieved by the AMF (Network Function) invoking the N2 (Non-service-based Interface) (Service-based Interface) overload procedure (see TS 38.300 [27] and TS 38.413 [34]) to all or to a proportion of the 5G-AN nodes with which the AMF (Network Function) has N2 (Non-service-based Interface) (Service-based Interface) connections. The AMF (Network Function) may include the S-NSSAI(s) in NGAP OVERLOAD START message sent to 5G-AN node(s) to indicate the Network Slice(s) with which NAS (Protocol) signalling is to be restricted. To reflect the amount of load that the AMF (Network Function) wishes to reduce, the AMF (Network Function) can adjust the proportion of 5G-AN nodes which are sent NGAP OVERLOAD START message, and the content of the overload start procedure.
When NGAP OVERLOAD START is sent by multiple AMFs or from the same AMF (Network Function) set in the same PLMN towards the 5G-AN, it should be ensured that the signalling load is evenly distributed within the PLMN and within each AMF (Network Function) set.
A 5G-AN node supports restricting of 5G-AN signalling connection when a signalling connection establishment are attempted by certain UEs (which are registered or attempting to register with the 5GC), as specified in TS 38.331 [28] and TS 36.331 [51]. Additionally, a 5G-AN node provides support for the barring of UEs as described in TS 22.261 [2]. These mechanisms are further specified in TS 38.331 [28] and TS 36.331 [51]. For 3GPP Access Type, the signalling connection establishment attempt includes a RRC (Protocol) Connection Resume procedure from RRC_INACTIVE.
By sending the NGAP OVERLOAD START message, the AMF (Network Function) can request the 5G-AN node to apply the following behaviour for UEs that the AMF (Network Function) is serving:
a)	Restrict 5G-AN signalling connection requests that are not for emergency, not for exception reporting and not for high priority mobile originated services; or
b)	Restrict 5G-AN signalling connection requests for uplink NAS (Protocol) signalling transmission to that AMF (Network Function);
c)	Restrict 5G-AN signalling connection requests where the Requested NSSAI at AS layer only includes the indicated S-NSSAI(s) in the NGAP OVERLOAD START message. This applies also to RRC_INACTIVE Connection Resume procedure where the Allowed NSSAI in the stored UE (Network Function) context in the RAN (Network Function) only includes S-NSSAIs included in the NGAP OVERLOAD START.
d)	only permit 5G-AN signalling connection requests for emergency sessions and mobile terminated services for that AMF (Network Function); or
e)	only permit 5G-AN signalling connection requests for high priority sessions, exception reporting and mobile terminated services for that AMF (Network Function);
The above applies for RRC (Protocol) Connection Establishment procedure and RRC (Protocol) Connection Resume procedures over 3GPP access, as well as for the UE (Network Function)-N3IWF (Network Function) connection establishment over untrusted Non-3GPP access and for the UE (Network Function)-TNGF (Network Function) connection establishment over trusted Non-3GPP access.
The AMF (Network Function) can provide a value that indicates the percentage of connection requests to be restricted in the NGAP OVERLOAD START, and the 5G-AN node may consider this value for congestion control.
When restricting a 5G-AN signalling connection, the 5G-AN indicates to the UE (Network Function) an appropriate wait timer that limits further 5G-AN signalling connection requests until the wait timer expires.
During an overload situation, the AMF (Network Function) should attempt to maintain support for emergency services and for MPS.
When the AMF (Network Function) is recovering, the AMF (Network Function) can either:
-	send a NGAP OVERLOAD START message with a new percentage value that permits more connection requests to be successful, or
-	send a NGAP OVERLOAD STOP message.
to the same 5G-AN node(s) the NGAP OVERLOAD START was previously sent.
The SMF (Network Function) shall contain mechanisms for avoiding and handling overload situations. This can include the following measures:
-	SMF (Network Function) overload control that could result in rejections of NAS (Protocol) requests.
The SMF (Network Function) overload control may be activated by SMF (Network Function) due to congestion situation at SMF (Network Function) e.g. configuration, by a restart or recovery condition of a UPF (Network Function), or by a partial failure or recovery of a UPF (Network Function) for a particular UPF (Network Function)(s).
Under unusual circumstances, if the SMF (Network Function) has reached overload situation, the SMF (Network Function) activates NAS (Protocol) level congestion control as specified in clause 5.19.7. The SMF (Network Function) may restrict the load that the AMF (Network Function)(s) are generating, if the AMF (Network Function) is configured to enable the overload restriction.
NAS level congestion control may be applied in general (i.e. for all NAS (Protocol) messages), per DNN, per S-NSSAI, per DNN and S-NSSAI, or for a specific group of UEs.
NAS level congestion control is achieved by providing the UE (Network Function) a back-off time. To avoid that large amounts of UEs initiate deferred requests (almost) simultaneously, the 5GC should select each back-off time value so that the deferred requests are not synchronized. When the UE (Network Function) receives a back-off time, the UE (Network Function) shall not initiate any NAS (Protocol) signalling with regards to the applied congestion control until the back-off timer expires or the UE (Network Function) receives a mobile terminated request from the network, or the UE (Network Function) initiates signalling for emergency services or high priority access.
AMFs and SMFs may apply NAS (Protocol) level congestion control, but should not apply NAS (Protocol) level congestion control for procedures not subject to congestion control.
This clause only applies to NAS (Protocol) Mobility Management congestion control.
Under general overload conditions the AMF (Network Function) may reject NAS (Protocol) messages from UEs using any 5G-AN. When a NAS (Protocol) request is rejected, a Mobility Management back-off time may be sent by the AMF (Network Function) to the UE (Network Function). While the Mobility Management back-off timer is running, the UE (Network Function) shall not initiate any NAS (Protocol) request except for Deregistration procedure and procedures not subject to congestion control (e.g. high priority access, emergency services) and mobile terminated services. After any such Deregistration procedure, the back-off timer continues to run. While the Mobility Management back-off timer is running, the UE (Network Function) is allowed to perform Mobility Registration Update if the UE (Network Function) is already in CM-CONNECTED state. If the UE (Network Function) receives a paging request or a NAS (Protocol) notification message from the AMF (Network Function) while the Mobility Management back off timer is running, the UE (Network Function) shall stop the Mobility Management back-off timer and initiate the Service Request procedure or the Mobility Registration Update procedure over 3GPP access and/or non-3GPP access as applicable. Over non-3GPP access, if the UE (Network Function) is in CM-IDLE state when the back-off timer is stopped, it shall initiate the UE (Network Function)-triggered Service Request procedure as soon as it switches back to CM-CONNECTED state.
In order to allow the UE (Network Function) to report the PS Data Off status change in PDU Session Modification Request message, the UE (Network Function) behaves as follows while keeping the NAS (Protocol) MM back-off timer running in the UE (Network Function):
-	When the UE (Network Function) is in CM-IDLE state and has not moved out of the Registration Area, the UE (Network Function) is allowed to send a Service Request message with an indication that the message is exempted from NAS (Protocol) congestion control. When the UE (Network Function) is in CM-IDLE mode and has moved out of the Registration Area, the UE (Network Function) is allowed to send a Mobility Registration Update request message, with a Follow-on request, and with an indication that the message is exempted from NAS (Protocol) congestion control.
-	When the UE (Network Function) is in CM-CONNECTED state, the UE (Network Function) sends a PDU Session Modification Request with PS Data Off status change carried in UL NAS (Protocol) Transport message with an indication that the message is exempted from NAS (Protocol) congestion control.
When the NAS (Protocol) MM congestion control is activated at AMF (Network Function), if the UE (Network Function) indicates that the NAS (Protocol) MM message is exempted from NAS (Protocol) congestion control, the AMF (Network Function) shall not reject the NAS (Protocol) MM message and shall forward the NAS (Protocol) SM message to the corresponding SMF (Network Function) with an indication that the NAS (Protocol) SM message was indicated to be exempted from NAS (Protocol) congestion control. The SMF (Network Function) ensures that the NAS (Protocol) SM message is not subject to congestion control otherwise the SMF (Network Function) rejects the message, e.g. the SMF (Network Function) shall reject PDU Session Modification received if it is not for Data Off status reporting.
The Mobility Management back-off timer shall not impact Cell/RAT/Access Type and PLMN change. Cell/RAT/TA/Access Type change does not stop the Mobility Management back-off timer. The Mobility Management back-off timer shall not be a trigger for PLMN reselection or SNPN reselection. The back-off timer is stopped as defined in TS 24.501 [47] when a new PLMN or SNPN, that is not an equivalent PLMN or is not an equivalent SNPN, is accessed.
To avoid that large amounts of UEs initiate deferred requests (almost) simultaneously, the AMF (Network Function) should select the Mobility Management back-off timer value so that the deferred requests are not synchronized.
If the UE (Network Function) required to report 5GSM Core Network Capability change, or the Always-on PDU Session Requested indication while the NAS (Protocol) MM congestion control timer was running and was unable to initiate MM signalling, the UE (Network Function) defers the related MM signalling until the MM congestion control timer expires and initiates after the expiry of the timer.
In the case of a UE (Network Function) with scheduled communication pattern, the AMF (Network Function) may consider the UE (Network Function)'s communication pattern while selecting a value for the Mobility Management back-off timer so that the UE (Network Function) does not miss its only scheduled communication window.
The AMF (Network Function) should not reject Registration Request message for Mobility Registration Update that are performed when the UE (Network Function) is already in CM-CONNECTED state.
The AMF (Network Function) may reject the Service Request message and a UL NAS (Protocol) Transfer with a Mobility Management back-off time when the UE (Network Function) is already in CM-CONNECTED state. If UE (Network Function) receives a DL NAS (Protocol) Transfer message from the AMF (Network Function) while the Mobility Management back off timer is running, the UE (Network Function) shall stop the Mobility Management back-off timer.
For CM-IDLE state mobility, the AMF (Network Function) may reject Registration Request messages for Mobility Registration Update by including a Mobility Management back off time value in the Registration Reject message.
If UE (Network Function) registered in the same PLMN for 3GPP access and non-3GPP access and receives a Mobility Management back-off time from the AMF (Network Function), the back-off time (and corresponding start and stop) is applied equally to both 3GPP access and non-3GPP access. If UE (Network Function) registered in different PLMNs for 3GPP access and non-3GPP access respectively and receives a Mobility Management back-off time, the back-off time is only applied to the PLMN that provides the time to the UE (Network Function).
If the AMF (Network Function) rejects Registration Request messages or Service Request with a Mobility Management back-off time which is larger than the sum of the UE (Network Function)'s Periodic Registration Update timer and the Implicit Deregistration timer, the AMF (Network Function) should adjust the mobile reachable timer and/or Implicit Deregistration timer such that the AMF (Network Function) does not implicitly deregister the UE (Network Function) while the Mobility Management back-off timer is running.
NOTE:	This is to minimize signalling after the Mobility Management back-off timer expires.
If the AMF (Network Function) deregisters the UE (Network Function) with an indication of re-registration required, the UE (Network Function) behaviour for handling the back-off timer(s) is as specified in TS 24.501 [47].
DNN based congestion control is designed for the purpose of avoiding and handling of NAS (Protocol) SM signalling congestion for the UEs with a back-off timer associated with or without a DNN regardless of the presence of an S-NSSAI. Both UE (Network Function) and 5GC shall support the functionality to enable DNN based congestion control.
SMFs may apply DNN based congestion control towards the UE (Network Function) by rejecting PDU Session Establishment Request message, or PDU Session Modification Request message except for those sent for the purpose of reporting 3GPP PS Data Off status change for a specific DNN with a running back-off timer. The SMF (Network Function) may release PDU Sessions belonging to a congested DNN by sending a PDU Session Release Command message towards the UE (Network Function) with a DNN back-off timer. If a DNN back-off time is set in the PDU Session Release Command message, the cause value of "reactivation requested" shall not be set.
If NWDAF (Network Function) is deployed, the SMF (Network Function) may make use of Session Management Congestion Control Experience analytics provided by NWDAF (Network Function), as defined in clause 6.12 of TS 23.288 [86], to determine back-off timer provided to UEs.
NOTE:	For example, the SMF (Network Function) can apply a short back-off timer to the UEs in the list of high-experienced UEs while the SMF (Network Function) can apply a long back-off timer to the UEs in the list of low-experienced UEs.
When DNN based congestion control is activated at AMF (Network Function) e.g. configured by OAM, the AMF (Network Function) provides a NAS (Protocol) Transport Error message for the NAS (Protocol) Transport message carrying an SM message, and in the NAS (Protocol) Transport Error message it includes a DNN back-off timer.
The UE (Network Function) associates the received back-off time with the DNN (i.e. no DNN, DNN only) which the UE (Network Function) included in the uplink NAS (Protocol) MM message carrying the corresponding NAS (Protocol) SM request message.
The UE (Network Function) associates the received back-off time with the DNN (i.e. no DNN, DNN only) in any PLMN unless the DNN associated with the back-off timer is an LADN DNN in which case the UE (Network Function) only associates it to the PLMN in which the back-off time was received.
The UE (Network Function) behaves as follows when the DNN back-off timer is running:
-	If a DNN is associated with the back-off timer, the UE (Network Function) shall not initiate any Session Management procedures for the congested DNN. The UE (Network Function) may initiate Session Management procedures for other DNNs. The UE (Network Function) shall not initiate any Session Management procedure for the corresponding APN when UE (Network Function) moves to EPS. The UE (Network Function) may initiate Session Management procedures for other APNs when the UE (Network Function) moves to EPS;
-	If no DNN is associated with the back-off timer, the UE (Network Function) may only initiate Session Management requests of any PDU Session Type for a specific DNN;
-	Upon Cell/TA/PLMN/RAT change, change of untrusted non-3GPP access network or change of Access Type, the UE (Network Function) shall not stop the back-off timer;
-	The UE (Network Function) is allowed to initiate the Session Management procedures for high priority access and emergency services;
-	The UE (Network Function) is allowed to initiate the Session Management procedure for reporting Data Off status change to the network;
-	If the UE (Network Function) receives a network initiated Session Management message other than PDU Session Release Command for the congested DNN associated to a running back-off timer, the UE (Network Function) shall stop the back-off timer and respond to the 5GC;
-	If the UE (Network Function) receives a PDU Session Release Command message for the congested DNN, it shall stop the back-off timer unless it receives a new back-off time from SMF (Network Function);
-	The UE (Network Function) is allowed to initiate PDU Session Release procedure (i.e. sending PDU Session Release Request message). The UE (Network Function) shall not stop the back-off timer when the related PDU Session is released;
-	The list above is not an exhaustive list, i.e. more details of the above actions and further conditions, if any, are specified in TS 24.501 [47].
If UE (Network Function) initiates one of the Session Management procedures that are exempted from NAS (Protocol) congestion control, the UE (Network Function) indicates that the carried NAS (Protocol) SM message is exempted from NAS (Protocol) congestion control in the UL NAS (Protocol) Transport message as described in TS 24.501 [47]. When the DNN based congestion control is activated at AMF (Network Function), if the UE (Network Function) indicates that the NAS (Protocol) SM message in the UL NAS (Protocol) Transport message is exempted from NAS (Protocol) congestion control, the AMF (Network Function) shall not apply DNN based congestion control on the UL NAS (Protocol) Transport message and shall forward the NAS (Protocol) SM message to the corresponding SMF (Network Function) with an indication that the message was received with exemption indication. The SMF (Network Function) evaluates whether the NAS (Protocol) SM message is allowed to be exempted from DNN based congestion control. If it is not, the SMF (Network Function) rejects the message, e.g. the SMF (Network Function) shall reject PDU Session Modification received if it is not for Data Off status reporting).
The UE (Network Function) shall maintain a separate back-off timer for each DNN that the UE (Network Function) may use.
To avoid that large amounts of UEs initiate deferred requests (almost) simultaneously, the 5GC should select the back-off timer value so that deferred requests are not synchronized.
If the UE (Network Function) required to report 5GSM Core Network Capability change, or the Always-on PDU Session Requested indication while DNN based congestion control was running and was unable to initiate SM signalling, the UE (Network Function) defers the related SM signalling until the DNN based congestion control timer expires and initiates the necessary SM signalling after the expiry of the timer.
The DNN based Session Management congestion control is applicable to the NAS (Protocol) SM signalling initiated from the UE (Network Function) in the Control Plane. The Session Management congestion control does not prevent the UE (Network Function) from sending and receiving data or initiating Service Request procedures for activating User Plane connection towards the DNN(s) that are under Session Management congestion control.
S-NSSAI based congestion control is designed for the purpose of avoiding and handling of NAS (Protocol) signalling congestion for the UEs with back-off timer associated with or without an S-NSSAI regardless of the presence of a DNN.
The UE (Network Function) associates the received back-off time with the S-NSSAI and DNN (i.e. no S-NSSAI and no DNN, no S-NSSAI, S-NSSAI only, an S-NSSAI and a DNN) which was included in the uplink NAS (Protocol) MM message carrying the corresponding NAS (Protocol) SM request message for the PLMN which is under congestion.
S-NSSAI based congestion control is applied as follows:
-	If an S-NSSAI is determined as congested, then the SMF (Network Function) may apply S-NSSAI based congestion control towards the UE (Network Function) for SM requests except for those sent for the purpose of reporting 3GPP PS Data Off status change for a specific S-NSSAI and provides a back-off time and an indication of HPLMN congestion;
-	If the UE (Network Function) receives an S-NSSAI based back-off time without an indication of HPLMN congestion, the UE (Network Function) shall apply the S-NSSAI back-off timer only in the PLMN in which the back-off time was received. If the UE (Network Function) receives S-NSSAI based back-off time with an indication of HPLMN congestion, the UE (Network Function) shall apply the S-NSSAI based back-off timer in the PLMN in which the back-off time was received and in any other PLMN;
-	The SMF (Network Function) may release PDU Sessions belonging to a congested S-NSSAI by sending a PDU Session Release Request message towards the UE (Network Function) with a back-off time associated either to the S-NSSAI only (i.e. with no specific DNN) or a combination of the S-NSSAI and a specific DNN. If NWDAF (Network Function) is deployed, the SMF (Network Function) may make use of Session Management Congestion Control Experience analytics provided by NWDAF (Network Function), as defined in clause 6.12 of TS 23.288 [86], to determine back-off timer provided to UEs;
NOTE:	For example, the SMF (Network Function) can apply a short back-off timer to the UEs in the list of high-experienced UEs while the SMF (Network Function) can apply a long back-off timer to the UEs in the list of low-experienced UEs.
-	If S-NSSAI based congestion control is activated at AMF (Network Function) e.g. configured by OAM and an S-NSSAI is determined as congested, then the AMF (Network Function) applies S-NSSAI based congestion control towards the UE (Network Function) for UE (Network Function)-initiated Session Management requests. In this case, the AMF (Network Function) provides a NAS (Protocol) Transport Error message for the NAS (Protocol) Transport message carrying the SM message, and in the NAS (Protocol) Transport Error message it includes a back-off timer; If NWDAF (Network Function) is deployed, the AMF (Network Function) may determine that S-NSSAI is congested based on the network slice load level analytics defined in TS 23.288 [86].
-	The UE (Network Function) behaves as follows in the PLMN where the S-NSSAI based congestion control applies when the back-off timer is running:
-	If the back-off timer was associated with an S-NSSAI only (i.e. not associated with an S-NSSAI and a DNN), the UE (Network Function) shall not initiate any Session Management procedures for the congested S-NSSAI;
-	If the back-off timer was associated with an S-NSSAI and a DNN, then the UE (Network Function) shall not initiate any Session Management procedures for that combination of S-NSSAI and DNN;
-	If the UE (Network Function) receives a network-initiated Session Management message other than PDU Session Release Command for the congested S-NSSAI, the UE (Network Function) shall stop this back-off timer and respond to the 5GC;
-	If the UE (Network Function) receives a PDU Session Release Command message for the congested S-NSSAI, it shall stop the back-off timer unless it receives a new back-off time from SMF (Network Function);
-	Upon Cell/TA/PLMN/RAT change, change of untrusted non-3GPP access network or change of Access Type, the UE (Network Function) shall not stop the back-off timer for any S-NSSAI or any combination of S-NSSAI and DNN;
-	The UE (Network Function) is allowed to initiate the Session Management procedures for high priority access and emergency services for the S-NSSAI;
-	The UE (Network Function) is allowed to initiate the Session Management procedure for reporting Data Off status change for the S-NSSAI or the combination of S-NSSAI and DNN.
-	If the back-off timer is not associated to any S-NSSAI, the UE (Network Function) may only initiate Session Management procedures for specific S-NSSAI;
-	If the back-off timer is not associated to any S-NSSAI and DNN, the UE (Network Function) may only initiate Session Management procedures for specific S-NSSAI and DNN;
-	The UE (Network Function) is allowed to initiate PDU Session Release procedure (e.g. sending PDU Session Release Request message). The UE (Network Function) shall not stop the back-off timer when the related PDU Session is released;
-	The list above is not an exhaustive list, i.e. more details of the above actions and further conditions, if any, are specified in TS 24.501 [47].
The UE (Network Function) shall maintain a separate back-off timer for each S-NSSAI and for each combination of S-NSSAI and DNN that the UE (Network Function) may use.
If UE (Network Function) initiates one of the Session Management procedure that are exempt from NAS (Protocol) congestion control, the UE (Network Function) indicates that the carried NAS (Protocol) SM message is exempted from NAS (Protocol) congestion control in the UL NAS (Protocol) Transport message as described in TS 24.501 [47]. When the S-NSSAI based congestion control is activated at AMF (Network Function), if the UE (Network Function) indicates that the NAS (Protocol) SM message in the UL NAS (Protocol) Transport message is exempted from NAS (Protocol) congestion control, the AMF (Network Function) shall not apply S-NSSAI based congestion control on the UL NAS (Protocol) Transport message and shall forward the NAS (Protocol) SM message to the corresponding SMF (Network Function) with an indication that the message was received with exemption indication. The SMF (Network Function) evaluates whether that the NAS (Protocol) SM message is allowed to be exempted from S-NSSAI based congestion control. If it is not, the SMF (Network Function) rejects the message, e.g. the SMF (Network Function) shall reject PDU Session Modification received if it is not for Data Off status reporting.
The back-off timer associated with an S-NSSAI or a combination of an S-NSSAI and a DNN shall only apply to congestion control for Session Management procedures when UE (Network Function) is in 5GS.
To avoid that large amounts of UEs initiate deferred requests (almost) simultaneously, the 5GC should select the value of the back-off timer for the S-NSSAI based congestion control so that deferred requests are not synchronized.
If the UE (Network Function) required to report 5GSM Core Network Capability change, or the Always-on PDU Session Requested indication while S-NSSAI based congestion control timer was running and was unable to initiate SM signalling, the UE (Network Function) defers the related SM signalling until the S-NSSAI based congestion control timer expires and initiates the necessary SM signalling after the expiry of the timer.
The S-NSSAI based congestion control does not prevent the UE (Network Function) from sending and receiving data or initiating Service Request procedure for activating User Plane connection for a PDU Session associated to the S-NSSAI that is under the congestion control.
The group specific NAS (Protocol) level congestion control applies to a specific group of UEs. Group specific NAS (Protocol) level congestion control is performed at the 5GC only, and it is transparent to UE (Network Function). The AMF (Network Function) or SMF (Network Function) or both may apply NAS (Protocol) level congestion control for a UE (Network Function) associated to an Internal-Group Identifier (see clause 5.9.7).
NOTE:	5GC logic for Group specific NAS (Protocol) level congestion control is not described in this Release of the specification.
Under overload conditions the AMF (Network Function) may restrict requests from UEs for data transmission via Control Plane CIoT 5GS Optimisation. A Control Plane data back-off timer may be returned by the AMF (Network Function) (e.g. in Registration Accept messages, Service Reject message or Service Accept message). While the Control Plane data back-off timer is running, the UE (Network Function) shall not initiate any data transfer via Control Plane CIoT 5GS Optimisation, i.e. the UE (Network Function) shall not send any Control Plane Service Request with uplink data as defined in TS 24.501 [47]. The AMF (Network Function) shall store the Control Plane data back-off timer per UE (Network Function) and shall not process any further requests (other than exception reporting and a response to paging) for Data Transport via a Control Plane Service Request from that UE (Network Function) while the Control Plane data back-off timer is still running.
NOTE 1:	The Control Plane data back-off timer does not affect any other mobility management or session management procedure.
NOTE 2:	The Control Plane data back-off timer does not apply to user plane data communication.
If the UE (Network Function) is allowed to send exception reporting, the UE (Network Function) may send an initial NAS (Protocol) Message for exception reporting even if Control Plane data back-off timer is running.
The UE (Network Function) may respond to paging with an initial NAS (Protocol) Message without uplink data even if the Control Plane data back-off timer is running.
If the AMF (Network Function) receives an initial NAS (Protocol) Message in reponse to a paging, and the AMF (Network Function) has a Control Plane data back-off timer running for the UE (Network Function), and the AMF (Network Function) is not overloaded, and AMF (Network Function) decides to accept the Control Plane Service Request, then the AMF (Network Function) shall respond with Service Accept without the Control Plane data back-off timer and stop the Control Plane data back-off timer. If the UE (Network Function) receives a Service Accept without the Control Plane data back-off timer from the AMF (Network Function) while the Control Plane data back-off timer is running, the UE (Network Function) shall stop the Control Plane data back-off timer. The Control Plane data back-off timer in the UE (Network Function) and the AMF (Network Function) is stopped at PLMN change.
If the AMF (Network Function) receives a Control Plane Service Request with uplink data, and decides to send the UE (Network Function) a Control Plane data back-off timer, the AMF (Network Function) may decide to process the Control Plane Service Request with uplink data, i.e. decrypt and forward the data payload, or not based on the following:
-	If the UE (Network Function) has indicated Release Assistance Information that no further Uplink and Downlink Data transmissions are expected, then the AMF (Network Function) may process (integrity check/decipher/forward) the received Control Plane data packet, and send a Service Accept to the UE (Network Function) with Control Plane data back-off timer. The UE (Network Function) interprets this as successful transmission of the Control Plane data packet starts the Control Plane data back-off timer.
-	For all other cases, the AMF (Network Function) may decide to not process the received Control Plane data packet and send a Service Reject to the UE (Network Function) with Control Plane data back-off timer. The UE (Network Function) interprets this indication as unsuccessful delivery of the control plane data packet and starts the Control Plane data back-off timer. The AMF (Network Function) may take into consideration whether the PDU Session is set to Control Plane only to make the decision whether to reject the packet and send Service Reject or move the PDU Session to user plane and process the data packet as described in next bullet.
-	Alternatively, if UE (Network Function) has not provided Release Assistance Information, and the PDU Session not set to Control Plane only, and UE (Network Function) supports N3 (Non-service-based Interface) (Service-based Interface) data transfer, then the AMF (Network Function) may initiate establishment of N3 (Non-service-based Interface) (Service-based Interface) bearer according to the procedure defined in clause 4.2.3 of TS 23.502 [3]. In this case the AMF (Network Function) may also return a Control Plane data back-off timer within the Service Accept.
The AMF (Network Function) only includes the Control Plane data back-off timer if the UE (Network Function) has indicated support for Control Plane CIoT 5GS optimizations in the Registration Request.
The Network Exposure Function (NEF (Network Function)) supports external exposure of capabilities of network functions. External exposure can be categorized as Monitoring capability, Provisioning capability, Policy/Charging capability, Analytics reporting capability and Member UE (Network Function) selection capability. The Monitoring capability is for monitoring of specific event for UE (Network Function) in 5G System and making such monitoring events information available for external exposure via the NEF (Network Function). The Provisioning capability is for allowing external party to provision of information which can be used for the UE (Network Function) in 5G System. The Policy/Charging capability is for handling access and mobility management, QoS and charging policies for the UE (Network Function) based on the request from external party. The Analytics reporting capability is for allowing an external party to fetch or subscribe/unsubscribe to analytics information generated by 5G System (this is further defined in TS 23.288 [86]). The Member UE (Network Function) selection capability is for allowing an external party to acquire one or more list(s) of candidate UE (Network Function)(s) (among the list of target member UE (Network Function)(s) provided by the AF (Network Function)) and additional information that is based on the assistance information generated by 5G System based on some defined filtering criteria, the details are explained in clause 4.15.13 in TS 23.502 [3].
Monitoring capability is comprised of means that allow the identification of the 5G network function suitable for configuring the specific monitoring events, detect the monitoring event, and report the monitoring event to the authorised external party. Monitoring capability can be used for exposing UE (Network Function)'s mobility management context such as UE (Network Function) location, reachability, roaming status, and loss of connectivity. Monitoring capability can also be used for exposing QoS monitoring result. AMF (Network Function) stores URRP-AMF (Network Function) information in the MM context to determine the NFs that are authorised to receive direct notifications from the AMF (Network Function). UDM (Network Function) stores URRP-AMF (Network Function) information locally to determine authorised monitoring requests when forwarding indirect notifications. The Monitoring capability also allows AF (Network Function) to subscribe to the group status changes for a group, either a 5G VN group as described in clause 5.29.2, as well as a group configured by OA&M. In this case the AF (Network Function) is notified if the group member list is updated or a group member is no longer subscribed to the group.
Provisioning capability allows an external party to provision the Expected UE (Network Function) Behaviour or the 5G-VN group information or DNN and S-NSSAI specific Group Parameters or ECS Address Configuration Information or service specific information to 5G NF (Network Function) via the NEF (Network Function). The provisioning comprises of the authorisation of the provisioning external third party, receiving the provisioned external information via the NEF (Network Function), storing the information, and distributing that information among those NFs that use it. The externally provisioned data can be consumed by different NFs, depending on the data. In the case of provisioning the Expected UE (Network Function) Behaviour, the externally provisioned information which is defined as the Expected UE (Network Function) Behaviour parameters in clause 4.15.6.3 of TS 23.502 [3] or Network Control parameter in clause 4.15.6.3a of TS 23.502 [3] consists of information on expected UE (Network Function) movement, Expected UE (Network Function) Behaviour parameters or expected Network Configuration parameter. The provisioned Expected UE (Network Function) Behaviour parameters may be used for the setting of mobility management or session management parameters of the UE (Network Function). In the case of provisioning the 5G-VN group information the externally provisioned information is defined as the 5G-VN group parameters in clause 4.15.6.7 of TS 23.502 [3] and it consists of some information on the 5G-VN group. In the case of the provisioning the DNN and S-NSSAI specific Group Parameters, the externally provisioned information is defined in clause 4.15.6.14 of TS 23.502 [3] and clause 5.20b. In the case of provisioning ECS address, the externally provisioned information is defined as the ECS Address Configuration Information in clause 4.15.6.3d of TS 23.502 [3]. The affected NFs are informed via the subscriber data update as specified in clause 4.15.6.2 of TS 23.502 [3]. The externally provisioned information which is defined as the Service Parameters in clause 4.15.6.7 of TS 23.502 [3] consists of service specific information used for supporting the specific service in 5G system. The provisioned Service Parameters may be delivered to the UEs. The affected NFs are informed of the data update.
Policy/Charging capability is comprised of means that allow the request for session and charging policy, enforce QoS policy, apply accounting functionality and requests to influence access and mobility management policies. It can be used for specific QoS/priority handling for the session of the UE (Network Function), and for setting applicable charging party or charging rate.
Analytics reporting capability is comprised of means that allow discovery of type of analytics that can be consumed by external party, the request for consumption of analytics information generated by NWDAF (Network Function).
Member UE (Network Function) selection capability is comprised of means that allows filtering and providing one or more list(s) of candidate UE (Network Function)(s) (among the list of target member UE (Network Function)(s) provided by the AF (Network Function)) and additional information that can be consumed by external party, the request for consumption of UE (Network Function) list generated by external party.
An NEF (Network Function) may support CAPIF (Network Function) functions for external exposure as specified in clause 6.2.5.1.
An NEF (Network Function) may support exposure of NWDAF (Network Function) analytics as specified in TS 23.288 [86].
The NEF (Network Function) may support exposure of 5GS and/or UE (Network Function) availability and capabilities for time synchronization service as specified in clause 5.27.1.8.
An NEF (Network Function) may support exposure of event based notifications and reports for NSACF (Network Function) as specified in clause 5.15.11.
An AF (Network Function) may only be able to identify the target UE (Network Function) of an AF (Network Function) request for external exposure of 5GC capabilities (e.g. Data Provisioning or for Event Exposure for a specific UE (Network Function)) by providing the UE (Network Function)'s address information. In this case the NEF (Network Function) first needs to retrieve the Permanent identifier of the UE (Network Function) before trying to fulfil the AF (Network Function) request. The NEF (Network Function) may determine the Permanent identifier of the UE (Network Function), as described in clause 4.15.3.2.13 of TS 23.502 [3], based on:
-	the address of the UE (Network Function) as provided by the AF (Network Function); this may be an IP  (Protocol)address or a MAC  (Protocol)address;
-	the corresponding DNN and/or S-NSSAI information: this may have been provided by the AF (Network Function) or determined by the NEF (Network Function) based on the requesting AF (Network Function); this is needed if the UE (Network Function) address is an IP  (Protocol)address.
The NEF (Network Function) may provide an AF (Network Function) specific UE (Network Function) Identifier to the AF (Network Function):
-	that has explicitly requested a translation from the address of the UE (Network Function) to a unique UE (Network Function) identifier (via Nnef_UEId service); or
-	that has implicitly requested a translation from the address of the UE (Network Function) to a AF (Network Function) specific UE (Network Function) Identifier by requesting external exposure about an individual UE (Network Function) identified by its address.
The AF (Network Function) may have its own means to maintain the AF (Network Function) specific UE (Network Function) Identifier through, e.g. an AF (Network Function) session. After the retrieval of an AF (Network Function) specific UE (Network Function) Identifier the AF (Network Function) shall not keep maintaining a mapping between this identifier and the UE (Network Function) IP  (Protocol)address as this mapping may change.
The AF (Network Function) specific UE (Network Function) Identifier shall not correspond to a MSISDN; it is represented as a GPSI in the form of an External Identifier. When used as an AF (Network Function) specific UE (Network Function) identifier, the External Identifier provided by the 5GCN shall be different for different AF (Network Function).
NOTE 1:	This is to protect user privacy.
NOTE 2:	The AF (Network Function) specific UE (Network Function) identifier is ensured to be unique across different AFs as defined in TS 23.003 [19] by configuration. Such configuration is assumed to be coordinated between the different involved entities (e.g. NEF (Network Function)(s) and UDM (Network Function)/UDR (Network Function)).
NOTE 3:	Based on policies, the NEF (Network Function) can be configured to enforce restriction on the usage of AF (Network Function) specific UE (Network Function) identifier (e.g. rejection of a service request from AF (Network Function) not authorized to use the UE (Network Function) identifier).
5.20a	Data Collection from an AF (Network Function)
An NF (Network Function) that needs to collect data from an AF (Network Function) may subscribe/unsubscribe to notifications regarding data collected from an AF (Network Function), either directly from the AF (Network Function) or via NEF (Network Function).
The data collected from an AF (Network Function) is used as input for analytics by the NWDAF (Network Function).
The details for the data collected from an AF (Network Function) as well as interactions between NEF (Network Function), AF (Network Function) and NWDAF (Network Function) are described in TS 23.288 [86].
5.20b	Support exposure of DNN and S-NSSAI specific Group Parameters
5.20b.1	Group attribute provisioning
A group may be a 5G VN group managed as defined in clause 5.29.2, as well as a group configured by OA&M.
An AF (Network Function) may provision attributes for a group:
-	LADN Service area, the LADN service area is consisted of Tracking Area identities or geographical information, it is applicable to each UE (Network Function) member within the group and for a specific DNN and S-NSSAI.
-	QoS, the QoS refers to 5QI, ARP and 5QI Priority Level as defined in clause 5.7.2.7 and it is applicable to each UE (Network Function) member within the group and for a specific DNN and S-NSSAI.
5.20b.2	Support LADN service area for a group
The procedure as defined in clause 4.15.6.2 of TS 23.502 [3] is applicable for provisioning of LADN service area for a group with the following clarifications and enhancements:
-	The AF (Network Function) request additionally contains the LADN service area as part of DNN and S-NSSAI specific Group Parameters, and the LADN service area is stored in UDR (Network Function) as subscription data and delivered to AMF (Network Function). If the AMF (Network Function) receives the LADN service area for a group, the AMF (Network Function) configures the DNN of the group as LADN DNN.
-	If the AF (Network Function) provides the LADN service area in the form of geographical information, the NEF (Network Function) maps the geographical information to a list of TAs before sending the service area to the UDM (Network Function).
LADN per DNN and S-NSSAI as defined in clause 5.6.5a is applicable for enforcement of LADN service area.
5.20b.3	Support QoS for a group
The procedure as defined in clause 4.15.6.2 of TS 23.502 [3] is applicable for provisioning of QoS for a group with the following clarifications and enhancements:
-	The AF (Network Function) request additionally contains the QoS for the group, and the UDM (Network Function) stores such QoS in the UDR (Network Function) and uses such QoS to set 5GS Subscribed QoS profile in Session Management Subscription data for each UE (Network Function) within the group.
-	When a UE (Network Function) belongs to multiple groups simultaneously, the strictest QoS profile among groups the group member belongs to is selected.
NOTE:	In the case that the strictest QoS profile can not be fulfilled, the next strictest QoS profile is selected.
Mechanisms as defined in clause 5.7.2.7 are used to enforce the 5GS Subscribed QoS profile for each UE (Network Function) within a group thus to support enforcement of QoS for a group.
5.20b.4	Void

5.20b.5	Support Change of PDU Session Type for a group of UEs
The Service specific parameters provisioning procedure as defined in clauses 4.15.6.7 and 4.15.6.7a of TS 23.502 [3] is applicable for updating of PDU session type of the URSP for a group of UEs.
When the UE (Network Function) receives the URSP rules, the UE (Network Function) re-evaluates the URSP rules, and may release the PDU session and re-establishes the PDU session with the high precedence PDU session type in the URSP rules.
5.20c	Provisioning of traffic characteristics and monitoring of performance characteristics for a group
NEF (Network Function) provisioning capability as defined in clause 5.20 allows an AF (Network Function) to perform provisioning of traffic characteristics and monitoring of performance characteristics for a group of UEs as specified in clause 4.15.6.14 of TS 23.502 [3] and clause 6.1.3.28 of TS 23.503 [45].
NOTE :	The AF (Network Function) may use application layer functionalities to handle requests for UE (Network Function)-to-UE (Network Function) traffic as defined by SA WG6.
The NEF (Network Function) determines whether or not to invoke the TSCTSF (Network Function) in the same way as for AF (Network Function) session with required QoS procedure, as described in step 2 of clause 4.15.6.6 in TS 23.502 [3]. In the case that the TSCTSF (Network Function) is used, the TSCTSF (Network Function) receives the AF (Network Function) requested QoS information from the NEF (Network Function). In the case that TSCTSF (Network Function) is not used, the AF (Network Function) request is handled as described in clause 4.15.6.14 of TS 23.502 [3] and clause 6.1.3.28 of TS 23.503 [45].
When the TSCTSF (Network Function) receives the AF (Network Function) requested QoS information from NEF (Network Function) or the PCF (Network Function)(s) receive the AF (Network Function) requested QoS information from UDR (Network Function), the TSCTSF (Network Function) or PCF (Network Function) (s) manage the AF (Network Function) requested QoS information for each UE (Network Function) group member within the group as follows:
-	Translate the External Group ID into a list of SUPIs by invoking Nudm_SDM_Get service.
-	Determine which of these UE (Network Function) group members have active PDU Sessions matching the DNN and S-NSSAI and determine the relevant UE (Network Function) address.
-	Manage the request status (activated, de-activated, failed) for each UE (Network Function) group member within the group:
-	Apply the AF (Network Function) requested QoS information if the UE (Network Function) group member is registered or has active PDU Session matching the DNN and S-NSSAI. Set the status to activated if the QoS resources are assigned for the UE (Network Function) group member, otherwise, failed.
-	Set the status to de-activated if the UE (Network Function) group member is not registered or has no active PDU Session matching the DNN and S-NSSAI.
-	Delete the request status for the UE (Network Function) group member if the UE (Network Function) group member is removed from the group, and further revokes AF (Network Function) request QoS information if the request status is activated.
-	Check whether to apply the AF (Network Function) requested QoS information and update the request status for the UE (Network Function) group member if the UE (Network Function) group member is newly added to the group.
-	When the AF (Network Function) requested QoS information contains temporal invalidity condition:
-	Revoke AF (Network Function) requested QoS information for each UE (Network Function) group member which is marked as active, so to e.g. to remove or modify PCC rules as defined in clause 4.16.5.2 of TS 23.502 [3] if the start-time is reached.
-	Apply AF (Network Function) requested QoS information for each UE (Network Function) group member that has active PDU Sessions matching the DNN and S-NSSAI, e.g. to add or modify PCC rules as defined in clause 4.16.5.2 of TS 23.502 [3].
5.20d	User Plane Direct 5GS Information Exposure
5.20d.1	General
In order to expose network information, the user plane direct 5GS information exposure function may be applied. The user plane direct 5GS information exposure function allows the UPF (Network Function) to report the network information directly to consumer based on the instructions provided by SMF (Network Function).
NOTE:	In the scenario of Edge Computing as described in TS 23.548 [130], the consumer can be the L (Service-based Interface)-NEF (Network Function) or local AF (Network Function) when the local AF (Network Function) is trusted.
When the exposed network information is provided by the UPF (Network Function), the PSA (Network Function) UPF (Network Function) may be instructed to report network information via Nupf_EventExposure service (e.g. directly to an AF (Network Function), i.e. bypassing the SMF (Network Function) and the PCF (Network Function)); or the UPF (Network Function) may be instructed to report the information to the consumer via SMF (Network Function)/PCF (Network Function)/NEF (Network Function), as described in clause 5.8.2.18.
When the exposed network information is provided by the NG-RAN (Network Function), the NG-RAN (Network Function) may be instructed by the SMF (Network Function) to report the information via the GTP-U (Protocol) tunnel(s) between the NG RAN (Network Function) and PSA (Network Function) UPF (Network Function), as defined in clause 5.45.
The User Plane Direct 5GS Information Exposure may be used for exposing the following information:
-	QoS Monitoring information (see clause 5.45).
-	TSC Management Information (see clause 5.28.3).
5GC supports different virtualized deployment scenarios, including but not limited to the options below:
-	A Network Function instance can be deployed as distributed, redundant, stateless, and scalable NF (Network Function) instance that provides the services from several locations and several execution instances in each location.
-	This type of deployments would typically not require support for addition or removal of NF (Network Function) instances for redundancy and scalability. In the case of an AMF (Network Function) this deployment option may use enablers like, addition of TNLA, removal of TNLA, TNLA release and rebinding of NGAP UE (Network Function) association to a new TNLA to the same AMF (Network Function).
-	A Network Function instance can also be deployed such that several network function instances are present within a NF (Network Function) set provide distributed, redundant, stateless and scalability together as a set of NF (Network Function) instances.
-	This type of deployments may support for addition or removal of NF (Network Function) instances for redundancy and scalability. In the case of an AMF (Network Function) this deployment option may use enablers like, addition of AMFs and TNLAs, removal of AMFs and TNLAs, TNLA release and rebinding of NGAP UE (Network Function) associations to a new TNLA to different AMFs in the same AMF (Network Function) set.
-	The SEPP (Network Function), although not a Network Function instance, can also be deployed distributed, redundant, stateless, and scalable.
-	The SCP (Network Function), although not a Network Function instance, can also be deployed distributed, redundant, and scalable.
Also, deployments taking advantage of only some or any combination of concepts from each of the above options is possible.
5G-AN node shall have the capability to support multiple TNL associations per AMF (Network Function), i.e. AMF (Network Function) name.
An AMF (Network Function) shall provide the 5G-AN node with the weight factors for each TNL association of the AMF (Network Function).
The AMF (Network Function) shall be able to request the 5G-AN node to add or remove TNL associations to the AMF (Network Function).
The AMF (Network Function) shall be able to indicate to the 5G-AN node the set of TNL associations used for UE (Network Function)-associated signalling and the set of TNL associations used for non-UE (Network Function) associated signalling.
NOTE: The TNL association(s) indicated for UE (Network Function)-associated and non-UE (Network Function) associated signalling can either be overlap or be different.
While a UE (Network Function) is in CM-Connected state the 5G-AN node shall maintain the same NGAP UE (Network Function)-TNLA-binding (i.e. use the same TNL association and same NGAP association for the UE (Network Function)) unless explicitly changed or released by the AMF (Network Function).
An AMF (Network Function) shall be able to update the NGAP UE (Network Function)-TNLA-binding (i.e. change the TNL association for the UE (Network Function)) in CM-CONNECTED state at any time. The NGAP UE (Network Function)-TNLA-binding can also be updated when a UE (Network Function)-specific NGAP message initiated by AMF (Network Function) is received via a new TNL association.
An AMF (Network Function) shall be able to update the NGAP UE (Network Function)-TNLA-binding (i.e. change the TNL association for the UE (Network Function)) in response to an N2 (Non-service-based Interface) (Service-based Interface) message received from the 5G-AN by triangular redirection (e.g. by responding to the 5G-AN node using a different TNL association).
An AMF (Network Function) shall be able to command the 5G-AN node to release the NGAP UE (Network Function)-TNLA-binding for a UE (Network Function) in CM-CONNECTED state while maintaining N3 (Non-service-based Interface) (Service-based Interface) (user-plane connectivity) for the UE (Network Function) at any time.
The 5G-AN node shall consider the following factors for selecting a TNL association for the AMF (Network Function) for the initial N2 (Non-service-based Interface) (Service-based Interface) message e.g. N2 (Non-service-based Interface) (Service-based Interface) INITIAL UE (Network Function) MESSAGE:
-	Availability of candidate TNL associations.
-	Weight factors of candidate TNL associations.
The AMF (Network Function) may use any TNL association intended for non-UE (Network Function) associated signalling for initiation of the N2 (Non-service-based Interface) (Service-based Interface) Paging procedure.
The 5G System should support establishment of association between AMF (Network Function) and 5G-AN node.
A new AMF (Network Function) can be added to an AMF (Network Function) set and association between AMF (Network Function) and GUAMI can be created and/or updated as follows:
-	AMF (Network Function) shall be able to dynamically update the NRF (Network Function) with the new or updated GUAMI(s) to provide mapping between GUAMI(s) and AMF (Network Function) information. Association between GUAMI(s) and AMF (Network Function) is published to NRF (Network Function). In addition, to deal with planned maintenance and failure, an AMF (Network Function) may optionally provide backup AMF (Network Function) information, i.e. it act as a backup AMF (Network Function) if the indicated GUAMI associated AMF (Network Function) is unavailable. It is assumed that the backup AMF (Network Function) and the original AMF (Network Function) are in the same AMF (Network Function) set as they have access to the same UE (Network Function) context. Based on that information one GUAMI is associated with an AMF (Network Function), optionally with a backup AMF (Network Function) used for planned removal and/or another (same or different) backup AMF (Network Function) used for failure.
-	Upon successful update, the NRF (Network Function) considers the new and/or updated GUAMI(s) for providing AMF (Network Function) discovery results to the requester. Requester can be other CP network functions.
-	The new AMF (Network Function) provides its GUAMI to 5G-AN and 5G-AN store this association. If the association between the same GUAMI and another AMF (Network Function) exists in the 5G-AN (e.g. due to AMF (Network Function) planned removal), the previously stored AMF (Network Function) is replaced by the new AMF (Network Function) for the corresponding GUAMI association.
Information about new AMF (Network Function) should be published and available in the DNS system. It should allow 5G-AN to discover AMF (Network Function) and setup associations with the AMF (Network Function) required. N2 (Non-service-based Interface) (Service-based Interface) setup procedure should allow the possibility of AMFs within the AMF (Network Function) Set to advertise the same AMF (Network Function) Pointer and/or distinct AMF (Network Function) Pointer value(s) to the 5G-AN node.
To support the legacy EPC core network entity (i.e. MME) to discover and communicate with the AMF (Network Function), the information about the AMF (Network Function) should be published and available in the DNS system. Furthermore, GUMMEI and GUAMI encoding space should be partitioned to avoid overlapping values in order to enable MME discover an AMF (Network Function) without ambiguity.
An AMF (Network Function) can be taken graciously out of service as follows:
-	If an UDSF (Network Function) is deployed in the network, then the AMF (Network Function) stores the context for registered UE (Network Function)(s) in the UDSF (Network Function). The UE (Network Function) context includes the AMF (Network Function) UE (Network Function) NGAP ID that is unique per AMF (Network Function) set. In order for the AMF (Network Function) planned removal procedure to work graciously, 5G-S-TMSI shall be unique per AMF (Network Function) Set. If there are ongoing transactions (e.g. N1 (Non-service-based Interface) (Service-based Interface) procedure) for certain UE (Network Function)(s), AMF (Network Function) stores the UE (Network Function) context(s) in the UDSF (Network Function) upon completion of an ongoing transaction.
-	The AMF (Network Function) deregister itself from NRF (Network Function) indicating due to AMF (Network Function) planned removal.
NOTE 1:	It is assumed that the UE (Network Function) contexts from the old AMF (Network Function) include all event subscriptions with peer CP NFs.
NOTE 2: Before removal of AMF (Network Function) the overload control mechanism can be used to reduce the amount of ongoing transaction.
An AMF (Network Function) identified by GUAMI(s) shall be able to notify the 5G-AN that it will be unavailable for processing transactions by including GUAMI(s) configured on this AMF (Network Function). Upon receipt of the indication that an AMF (Network Function)(identified by GUAMI(s)) is unavailable, 5G-AN shall take the following action:
-	5G-AN should mark this AMF (Network Function) as unavailable and not consider the AMF (Network Function) for selection for subsequent N2 (Non-service-based Interface) (Service-based Interface) transactions until 5G-AN learns that it is available (e.g. as part of discovery results or by configuration).
-	During NGAP Setup procedure, the AMF (Network Function) may include an additional indicator that the AMF (Network Function) will rebind or release the NGAP UE (Network Function)-TNLA-binding on a per UE (Network Function)-basis for UE (Network Function)(s) in CM-CONNECTED state. If that indicator is included and the 5G-AN supports timer mechanism, the 5G-AN starts a timer to control the release of NGAP UE (Network Function)-TNLA-binding. For the duration of the timer or until the AMF (Network Function) releases or re-binds the NGAP UE (Network Function)-TNLA-binding the AN does not select a new AMF (Network Function) for subsequent UE (Network Function) transactions. Upon timer expiry, the 5G-AN releases the NGAP UE (Network Function) UE (Network Function)-TNLA-binding(s) with the corresponding AMF (Network Function) for the respective UE (Network Function)(s), for subsequent N2 (Non-service-based Interface) (Service-based Interface) message, the 5G-AN should select a different AMF (Network Function) from the same AMF (Network Function) set when the subsequent N2 (Non-service-based Interface) (Service-based Interface) message needs to be sent.
NOTE 3:	For UE (Network Function)(s) in CM-CONNECTED state, after indicating that the AMF (Network Function) is unavailable for processing UE (Network Function) transactions and including an indicator that the AMF (Network Function) releases the NGAP UE (Network Function)-TNLA-binding(s) on a per UE (Network Function)-basis, the AMF (Network Function) can either trigger a re-binding of the NGAP UE (Network Function) associations to an available TNLA on a different AMF (Network Function) in the same AMF (Network Function) set or use the NGAP UE (Network Function)-TNLA-binding per UE (Network Function) release procedure defined in TS 23.502 [3] to release the NGAP UE (Network Function)-TNLA-binding on a per UE (Network Function)-basis while requesting the AN to maintain N3 (Non-service-based Interface) (Service-based Interface) (user plane connectivity) and UE (Network Function) context information.
NOTE 4:	The support and the use of timer mechanism in 5G-AN is up to implementation.
-	If the instruction does not include the indicator, for UE (Network Function)(s) in CM-CONNECTED state, 5G-AN considers this as a request to release the NGAP UE (Network Function)-TNLA-binding with the corresponding AMF (Network Function) for the respective UE (Network Function)(s) while maintaining N3 (Non-service-based Interface) (Service-based Interface) (user plane connectivity) and UE (Network Function) context information. For subsequent N2 (Non-service-based Interface) (Service-based Interface) message, the 5G-AN should select a different AMF (Network Function) from the same AMF (Network Function) set when the subsequent N2 (Non-service-based Interface) (Service-based Interface) message needs to be sent.
-	For UE (Network Function)(s) in CM-IDLE state, when it subsequently returns from CM-IDLE state and the 5G-AN receives an initial NAS (Protocol) message with a 5G S-TMSI or GUAMI pointing to an AMF (Network Function) that is marked unavailable, the 5G-AN should select a different AMF (Network Function) from the same AMF (Network Function) set and forward the initial NAS (Protocol) message. If the 5G-AN can't select an AMF (Network Function) from the same AMF (Network Function) set, the 5G-AN selects another new AMF (Network Function) as described in clause 6.3.5.
An AMF (Network Function) identified by GUAMI(s) shall be able to instruct other peer CP NFs, subscribed to receive such a notification, that it will be unavailable for processing transactions by including GUAMI(s) configured on this AMF (Network Function). If the CP NFs register with NRF (Network Function) for AMF (Network Function) unavailable notification, then the NRF (Network Function) shall be able to notify the subscribed NFs to receive such a notification that AMF (Network Function) identified by GUAMI(s) will be unavailable for processing transactions. Upon receipt of the notification that an AMF (Network Function) (GUAMI(s)) is unavailable, the other CP NFs shall take the following actions:
-	CP NF (Network Function) should mark this AMF (Network Function) (identified by GUAMI(s)) as unavailable and not consider the AMF (Network Function) for selection for subsequent MT transactions until the CP NF (Network Function) learns that it is available (e.g. as part of NF (Network Function) discovery results or via NF (Network Function) status notification from NRF (Network Function)).
-	Mark this AMF (Network Function) as unavailable while not changing the status of UE (Network Function)(s) associated to this AMF (Network Function) (UE (Network Function)(s) previously served by the corresponding AMF (Network Function) still remain registered in the network), and AMF (Network Function) Set information.
-	For the UE (Network Function)(s) that were associated to the corresponding AMF (Network Function), when the peer CP NF (Network Function) needs to initiate a transaction towards the AMF (Network Function) that is marked unavailable, CP NF (Network Function) should select another AMF (Network Function) from the same AMF (Network Function) set (as in clause 6.3.5) and forward the transaction together with the old GUAMI. The new AMF (Network Function) retrieves UE (Network Function) context from the UDSF (Network Function). If CP NF (Network Function) needs to send a notification to new AMF (Network Function) which is associated with a subscription from the old AMF (Network Function), the CP NF (Network Function) shall exchange the old AMF (Network Function) information embedded in the Notification Address with the new AMF (Network Function) information, and use that Notification Address for subsequent communication.
NOTE 5:	If the CP NF (Network Function) does not subscribe to receive AMF (Network Function) unavailable notification (either directly from the AMF (Network Function) or via NRF (Network Function)), the CP NF (Network Function) may attempt forwarding the transaction towards the old AMF (Network Function) and detect that the AMF (Network Function) is unavailable after certain number of attempts. When it detects unavailable, it marks the AMF (Network Function) and its associated GUAMI(s) as unavailable. CP NF (Network Function) should select another AMF (Network Function) from the same AMF (Network Function) set (as in clause 6.3.5) and forward the transaction together with the old GUAMI. The new AMF (Network Function) retrieves UE (Network Function) context from the UDSF (Network Function) and process the transaction.
Following actions should be performed by the newly selected AMF (Network Function):
-	When there is a transaction with the UE (Network Function) the newly selected AMF (Network Function) retrieves the UE (Network Function) context from the UDSF (Network Function) based on SUPI, 5G-GUTI or AMF (Network Function) UE (Network Function) NGAP ID and processes the UE (Network Function) message accordingly and updates the 5G-GUTI towards the UE (Network Function), if necessary. For UE (Network Function)(s) in CM-CONNECTED state, it may also update the NGAP UE (Network Function) association with a new AMF (Network Function) UE (Network Function) NGAP ID towards the 5G-AN and replace the GUAMI in the UE (Network Function) context stored at the 5G-AN with the new GUAMI associated with the newly selected AMF (Network Function) if the 5G-GUTI has been updated. The AMF (Network Function) also informs the NG-RAN (Network Function) of the new UE (Network Function) Identity Index Value (derived from the new 5G-GUTI).
-	When there is a transaction with the UE (Network Function), the new selected AMF (Network Function) updates the peer NFs (that subscribed to receive AMF (Network Function) unavailability notification from old AMF (Network Function)), with the new selected AMF (Network Function) information.
-	If the new AMF (Network Function) is aware of a different AMF (Network Function) serving the UE (Network Function) (by implementation specific means) it forwards the uplink N2 (Non-service-based Interface) (Service-based Interface) signalling of the UE (Network Function) to that AMF (Network Function) directly if necessary, the 5G-AN shall be able to receive the message from a different AMF (Network Function), or it rejects the transaction from the peer CP NFs with a cause to indicate that new AMF (Network Function) has been selected, the peer CP NFs resend the transaction to the new AMF (Network Function).
NOTE 6:	This bullet above addresses situations where 5G-AN node selects an AMF (Network Function) and CP NFs select another AMF (Network Function) for the UE (Network Function) concurrently. It also addresses the situation where CP NFs select an AMF (Network Function) for the UE (Network Function) concurrently
-	If the UE (Network Function) is in CM-IDLE state and the new AMF (Network Function) does not have access to the UE (Network Function) context, the new AMF (Network Function) selects one available AMF (Network Function) from the old AMF (Network Function) set as described in clause 6.3.5. The selected AMF (Network Function) retrieves the UE (Network Function) context from the UDSF (Network Function) and provides the UE (Network Function) context to the new AMF (Network Function). If the new AMF (Network Function) doesn't receive the UE (Network Function) context then the AMF (Network Function) may force the UE (Network Function) to perform Initial Registration.
An AMF (Network Function) can be taken graciously out of service as follows:
-	The AMF (Network Function) can forward registered UE (Network Function) contexts, UE (Network Function) contexts grouped by the same GUAMI value, to target AMF (Network Function)(s) within the same AMF (Network Function) set, including the source AMF (Network Function) name used for redirecting UE (Network Function)'s MT transaction. The UE (Network Function) context includes the per AMF (Network Function) Set unique AMF (Network Function) UE (Network Function) NGAP ID. In order for the AMF (Network Function) planned removal procedure to work graciously, 5G-S-TMSI shall be unique per AMF (Network Function) set. If there are ongoing transactions (e.g. N1 (Non-service-based Interface) (Service-based Interface) procedure) for certain UE (Network Function)(s), AMF (Network Function) forwards the UE (Network Function) context(s) to the target AMF (Network Function) upon completion of an ongoing transaction.
-	The AMF (Network Function) deregister itself from NRF (Network Function) indicating due to AMF (Network Function) planned removal.
NOTE 1:	It is assumed that the UE (Network Function) contexts from the old AMF (Network Function) include all event subscriptions with peer CP NFs.
NOTE 2: Before removal of AMF (Network Function) the overload control mechanism can be used to reduce the amount of ongoing transaction.
An AMF (Network Function) shall be able to instruct the 5G-AN that it will be unavailable for processing transactions by including GUAMI(s) configured on this AMF (Network Function) and its corresponding target AMF (Network Function)(s). The target AMF (Network Function) shall be able to update the 5G-AN that the UE (Network Function)(s) served by the old GUAMI(s) are now served by target AMF (Network Function). The target AMF (Network Function) provides the old GUAMI value that the 5G-AN can use to locate UE (Network Function) contexts served by the old AMF (Network Function). Upon receipt of the indication that an old AMF (Network Function) is unavailable, 5G-AN shall take the following action:
-	5G-AN should mark this AMF (Network Function) as unavailable and not consider the AMF (Network Function) for selection for subsequent N2 (Non-service-based Interface) (Service-based Interface) transactions until 5G-AN learns that it is available (e.g. as part of discovery results or by configuration). The associated GUAMIs are marked as unavailable.
-	During NGAP Setup, the AMF (Network Function) may include an additional indicator that the AMF (Network Function) will rebind or release the NGAP UE (Network Function)-TNLA-binding on per UE (Network Function)-basis. If that indicator is included and the 5G-AN supports timer mechanism, the 5G-AN starts a timer to control the release of NGAP UE (Network Function)-TNLA-binding(s). For the duration of the timer or until the AMF (Network Function) releases or re-binds the NGAP UE (Network Function)-TNLA-binding, the AN does not select a new AMF (Network Function) for subsequent transactions. Upon timer expiry, the 5G-AN releases the NGAP UE (Network Function)-TNLA-binding(s) with the corresponding AMF (Network Function) for the respective UE (Network Function)(s), for subsequent N2 (Non-service-based Interface) (Service-based Interface) message, the 5G-AN uses GUAMI which points to the target AMF (Network Function) that replaced the old unavailable AMF (Network Function), to forward the N2 (Non-service-based Interface) (Service-based Interface) message to the corresponding target AMF (Network Function)(s).
NOTE 3:	For UE (Network Function)(s) in CM-CONNECTED state, after indicating that the AMF (Network Function) is unavailable for processing UE (Network Function) transactions and including an indicator that the AMF (Network Function) releases the NGAP UE (Network Function)-TNLA-binding on a per UE (Network Function)-basis, the AMF (Network Function) can either trigger a re-binding of the NGAP UE (Network Function) associations to an available TNLA on a different AMF (Network Function) within the same AMF (Network Function) set or use the NGAP UE (Network Function)-TNLA-binding per UE (Network Function) release procedure defined in TS 23.502 [3] to release the NGAP UE (Network Function)-TNLA-binding on a per UE (Network Function)-basis while requesting the AN to maintain N3 (Non-service-based Interface) (Service-based Interface) (user plane connectivity) and UE (Network Function) context information.
NOTE 4:	The support and the use of timer mechanism in 5G-AN is up to implementation.
	If the instruction does not include the indicator, for UE (Network Function)(s) in CM-CONNECTED state, 5G-AN considers this as a request to release the NGAP UE (Network Function) UE (Network Function)-TNLA-binding(s) with the corresponding AMF (Network Function) for the respective UE (Network Function)(s) while maintaining N3 (Non-service-based Interface) (Service-based Interface) (user plane connectivity) and UE (Network Function) context information. For subsequent N2 (Non-service-based Interface) (Service-based Interface) message, the 5G-AN uses GUAMI based resolution which points to the target AMF (Network Function) that replaced the old unavailable AMF (Network Function), to forward the N2 (Non-service-based Interface) (Service-based Interface) message to the corresponding target AMF (Network Function)(s).
-	For UE (Network Function)(s) in CM-IDLE state, when it subsequently returns from CM-IDLE state and the 5G-AN receives an initial NAS (Protocol) message with a 5G S-TMSI or GUAMI, based resolution the 5G-AN uses 5G S-TMSI or GUAMI which points to the target AMF (Network Function) that has replaced the old unavailable AMF (Network Function) and, the 5G-AN forwards N2 (Non-service-based Interface) (Service-based Interface) message.
An AMF (Network Function) shall be able to instruct other peer CP NFs, subscribed to receive such a notification, that it will be unavailable for processing transactions by including GUAMI(s) configured on this AMF (Network Function) and its corresponding target AMF (Network Function)(s). The target AMF (Network Function) shall update the CP NF (Network Function) that the old GUAMI(s) is now served by target AMF (Network Function). The old AMF (Network Function) provides the old GUAMI value to target AMF (Network Function) and the target AMF (Network Function) can use to locate UE (Network Function) contexts served by the old AMF (Network Function). If the CP NFs register with NRF (Network Function) for AMF (Network Function) unavailable notification, then the NRF (Network Function) shall be able to notify the subscribed NFs to receive such a notification (along with the corresponding target AMF (Network Function)(s)) that AMF (Network Function) identified by GUAMI(s) will be unavailable for processing transactions. Upon receipt of the notification that an AMF (Network Function) is unavailable, the other CP NFs shall take the following action:
-	Mark this AMF (Network Function) and its associated GUAMI(s) as unavailable while not changing the status of UE (Network Function)(s) associated to this AMF (Network Function) (UE (Network Function)(s) previously served by the corresponding AMF (Network Function) still remain registered in the network), and AMF (Network Function) Set information.
-	For the UE (Network Function)(s) that were associated to the corresponding AMF (Network Function), when the peer CP NF (Network Function) needs to initiate a transaction towards the AMF (Network Function) that is marked unavailable and the old unavailable AMF (Network Function) was replaced by the target AMF (Network Function), CP NF (Network Function) should forward the transaction together with the old GUAMI to the target AMF (Network Function)(s). If CP NF (Network Function) needs to send a notification to new AMF (Network Function) which is associated with a subscription from the old AMF (Network Function), the CP NF (Network Function) shall exchange the old AMF (Network Function) information embedded in the Notification Address with the new AMF (Network Function) information, and use that Notification Address for subsequent communication.
NOTE 5:	If the CP NF (Network Function) does not subscribe to receive AMF (Network Function) unavailable notification (either directly with the AMF (Network Function) or via NRF (Network Function)), the CP NF (Network Function) may attempt forwarding the transaction towards the old AMF (Network Function) and detect that the AMF (Network Function) is unavailable after certain number of attempts. When it detects unavailable, it marks the AMF (Network Function) and its associated GUAMI(s) as unavailable.
The following actions should be performed by the target AMF (Network Function):
-	To allow AMF (Network Function) process ongoing transactions for some UE (Network Function)(s) even after it notifies unavailable status to the target AMF (Network Function), the target AMF (Network Function) keeps the association of the old GUAMI(s) and the old AMF (Network Function) for a configured time. During that configured period, if target AMF (Network Function) receives the transaction from the peer CP NFs and cannot locate UE (Network Function) context, it rejects the transaction with old AMF (Network Function) name based on that association, and the indicated AMF (Network Function) is only used for the ongoing transaction. The peer CP NFs resend the transaction to the indicated AMF (Network Function) only for the ongoing transaction. For subsequent transactions, peer CP NFs should use the target AMF (Network Function). When the timer is expired, the target AMF (Network Function) deletes that association information.
-	When there is a transaction with the UE (Network Function) the target AMF (Network Function) uses SUPI, 5G-GUTI or AMF (Network Function) UE (Network Function) NGAP ID to locate UE (Network Function) contexts and processes the UE (Network Function) transactions accordingly and updates the 5G-GUTI towards the UE (Network Function), if necessary. For UE (Network Function)(s) in CM-CONNECTED state, it may also update the NGAP UE (Network Function) association with a new AMF (Network Function) UE (Network Function) NGAP ID towards the 5G-AN and replace the GUAMI in the UE (Network Function) context stored at the 5G-AN with the new GUAMI associated with the newly selected AMF (Network Function) if the 5G-GUTI has been updated. The AMF (Network Function) also informs the NG-RAN (Network Function) of the new UE (Network Function) Identity Index Value (derived from the new 5G-GUTI).
-	Target AMF (Network Function) shall not use old GUAMI to allocate 5G-GUTI for UE (Network Function)(s) that are being served by Target AMF (Network Function).
In order to try and handle AMF (Network Function) failure in a graceful manner (i.e. without impacting the UE (Network Function)), AMF (Network Function) can either back up the UE (Network Function) contexts in UDSF (Network Function), or per GUAMI granularity in other AMFs (serving as backup AMF (Network Function) for the indicated GUAMI).
NOTE 1:	Frequency of backup is left to implementation.
For deployments without UDSF (Network Function), for each GUAMI the backup AMF (Network Function) information (in association to the GUAMI) is configured in the AMF (Network Function). The AMF (Network Function) sends this information to 5G-AN and other CP NFs during the N2 (Non-service-based Interface) (Service-based Interface) setup procedure or the first (per NF (Network Function)) interaction with other CP NFs.
In the case that an AMF (Network Function) fails and the 5G-AN/peer CP NFs detect that the AMF (Network Function) has failed, or the 5G-AN/peer CP NFs receives notification from another AMF (Network Function) in the same AMF (Network Function) set that this AMF (Network Function) has failed, following actions are taken:
-	The OAM deregister the AMF (Network Function) from NRF (Network Function) indicating due to AMF (Network Function) failure.
-	5G-AN marks this AMF (Network Function) as failed and not consider the AMF (Network Function) for selection until explicitly notified.
-	For UE (Network Function)(s) in CM-CONNECTED state, 5G-AN considers failure detection or failure notification as a trigger to release the NGAP UE (Network Function)-TNLA-binding(s) with the corresponding AMF (Network Function) for the respective UE (Network Function)(s) while maintaining N3 (Non-service-based Interface) (Service-based Interface) (user plane connectivity) and other UE (Network Function) context information. For subsequent N2 (Non-service-based Interface) (Service-based Interface) message, if the backup AMF (Network Function) information of the corresponding failed AMF (Network Function) is not available the 5G-AN should select a different AMF (Network Function) (as in clause 6.3.5) from the same AMF (Network Function) set when the subsequent N2 (Non-service-based Interface) (Service-based Interface) message needs to be sent for the UE (Network Function)(s). If no other AMF (Network Function) from the AMF (Network Function) set is available, then it can select an AMF (Network Function) (implementation dependent) from the same AMF (Network Function) Region as in clause 6.3.5. If backup AMF (Network Function) information of the corresponding failed AMF (Network Function) is available, the 5G-AN forwards the N2 (Non-service-based Interface) (Service-based Interface) message to the backup AMF (Network Function).
NOTE 2:	One AMF (Network Function) in the AMF (Network Function) set may be configured to send this failure notification message.
-	For UE (Network Function)(s) in CM-IDLE state, when it subsequently returns from CM-IDLE state and the 5G-AN receives an initial NAS (Protocol) message with a S-TMSI or GUAMI pointing to an AMF (Network Function) that is marked failed, if the backup AMF (Network Function) information of the corresponding failed AMF (Network Function) is not available the 5G-AN should select a different AMF (Network Function) from the same AMF (Network Function) set and forward the initial NAS (Protocol) message. If no other AMF (Network Function) from the AMF (Network Function) set is available, then it can select an AMF (Network Function) (implementation dependent) from the same AMF (Network Function) Region as in clause 6.3.5. If backup AMF (Network Function) information of the corresponding failed AMF (Network Function) is available, the 5G-AN forwards the N2 (Non-service-based Interface) (Service-based Interface) message to the backup AMF (Network Function).
-	Peer CP NFs consider this AMF (Network Function) as unavailable while retaining the UE (Network Function) context.
-	For the UE (Network Function)(s) that were associated to the corresponding AMF (Network Function), when the peer CP NF (Network Function) needs to initiate a transaction towards the AMF (Network Function), if backup AMF (Network Function) information of the corresponding failed AMF (Network Function) is not available, CP NF (Network Function) should select another AMF (Network Function) from the same AMF (Network Function) set and forward the transaction together with the old GUAMI. If neither the backup AMF (Network Function) nor any other AMF (Network Function) from the AMF (Network Function) set is available, then CP NF (Network Function) can select an AMF (Network Function) from the same AMF (Network Function) Region as in clause 6.3.5. If backup AMF (Network Function) information of the corresponding failed AMF (Network Function) is available, the CP NF (Network Function) forwards transaction to the backup AMF (Network Function). If CP NF (Network Function) needs to send a notification to new AMF (Network Function) which is associated with a subscription from the old AMF (Network Function), the CP NF (Network Function) shall exchange the old AMF (Network Function) information embedded in the Notification Address with the new AMF (Network Function) information, and use that Notification Address for subsequent communication.
-	When the 5G-AN or CP NFs need to select a different AMF (Network Function) from the same AMF (Network Function) set,
-	For deployments with UDSF (Network Function), any AMF (Network Function) from the same AMF (Network Function) set can be selected.
-	For deployments without UDSF (Network Function), the backup AMF (Network Function) is determined based on the GUAMI of the failed AMF (Network Function).
Following actions should be taken by the newly selected AMF (Network Function):
-	For deployments with UDSF (Network Function), when there is a transaction with the UE (Network Function) the newly selected AMF (Network Function) retrieves the UE (Network Function) context from the UDSF (Network Function) using SUPI, 5G-GUTI or AMF (Network Function) UE (Network Function) NGAP ID and it processes the UE (Network Function) message accordingly and updates the 5G-GUTI towards the UE (Network Function), if necessary.
-	For deployments without UDSF (Network Function), backup AMF (Network Function) (the newly selected AMF (Network Function)), based on the failure detection of the old AMF (Network Function), instructs peer CP NFs and 5G-AN that the UE (Network Function) contexts corresponding to the GUAMI of the failed AMF (Network Function) is now served by this newly selected AMF (Network Function). The backup AMF (Network Function) shall not use old GUAMI to allocate 5G-GUTI for UE (Network Function)(s) that are being served by Target AMF (Network Function). The backup AMF (Network Function) uses the GUAMI to locate the respective UE (Network Function) Context(s).
-	When there is a transaction with the UE (Network Function), the new AMF (Network Function) updates the peer NFs (that subscribed to receive AMF (Network Function) unavailability notification from old AMF (Network Function)) with the new AMF (Network Function) information.
-	If the new AMF (Network Function) is aware of a different AMF (Network Function) serving the UE (Network Function) (by implementation specific means) it redirects the uplink N2 (Non-service-based Interface) (Service-based Interface) signalling to that AMF (Network Function), or reject the transaction from the peer CP NFs with a cause to indicate that new AMF (Network Function) has been selected. The peer CP NFs may wait for the update from the new AMF (Network Function) and resend the transaction to the new AMF (Network Function).
NOTE 3:	This bullet above addresses situations where 5G-AN node selects an AMF (Network Function) and other CP NFs select an AMF (Network Function) for the UE (Network Function) concurrently. It also addresses the situation where CP NFs select an AMF (Network Function) for the UE (Network Function) concurrently.
NOTE 4:	It is assumed that the UE (Network Function) contexts from the old AMF (Network Function) include all event subscriptions with peer CP NFs.
-	If the UE (Network Function) is in CM-IDLE state and the new AMF (Network Function) does not have access to the UE (Network Function) context, the new AMF (Network Function) selects one available AMF (Network Function) from the old AMF (Network Function) set as described in clause 6.3.5. The selected AMF (Network Function) retrieves the UE (Network Function) context from the UDSF (Network Function) and provides the UE (Network Function) context to the new AMF (Network Function). If the new AMF (Network Function) doesn't receive the UE (Network Function) context then the AMF (Network Function) may force the UE (Network Function) to perform Initial Registration.
-	If the UE (Network Function) is in CM-CONNECTED state, the new AMF (Network Function) may also update the NGAP UE (Network Function) association with a new AMF (Network Function) UE (Network Function) NGAP ID towards the 5G-AN and replace the GUAMI in the UE (Network Function) context stored at the 5G-AN with the new GUAMI associated with the newly selected AMF (Network Function) if the 5G-GUTI has been updated.
NOTE 5:	The above N2 (Non-service-based Interface) (Service-based Interface) TNL association selection and AMF (Network Function) management is applied to the selected PLMN.
A Network Function instance can be deployed such that several network function instances are present within an NF (Network Function) Set to provide distribution, redundancy and scalability together as a Set of NF (Network Function) instances. The same is also supported for NF (Network Function) Services. This can be achieved when the equivalent NFs and NF (Network Function) Services share the same context data or by Network Function/NF (Network Function) Service Context Transfer procedures as specified in clause 4.26 of TS 23.502 [3].
NOTE:	A NF (Network Function) can be replaced by an alternative NF (Network Function) within the same NF (Network Function) Set in the case of scenarios such as failure, load balancing, load re-balancing.
Such a network reliability design shall work in both communication modes, i.e. Direct Communication and Indirect Communication. In the Direct Communication mode, the NF (Network Function) Service consumer is involved in the reliability related procedures. In Indirect Communication mode, the SCP (Network Function) is involved in the reliability related procedures.
Equivalent Control Plane NFs may be grouped into NF (Network Function) Sets, e.g. several SMF (Network Function) instances are grouped into an SMF (Network Function) Set. NFs within a NF (Network Function) Set are interchangeable because they share the same context data, and may be deployed in different locations, e.g. different data centres.
In the case of SMF (Network Function), multiple instances of SMFs within an SMF (Network Function) Set need to be connected to the same UPF (Network Function):
-	If the N4 (Service-based Interface) association is established between a SMF (Network Function) instance and an UPF (Network Function), each N4 (Service-based Interface) association is only managed by the related SMF (Network Function) instance.
-	If only one N4 (Service-based Interface) association is established between a SMF (Network Function) Set and an UPF (Network Function), any SMF (Network Function) in the SMF (Network Function) Set should be able to manage the N4 (Service-based Interface) association with the UPF (Network Function).
Furthermore, for a given UE (Network Function) and PDU Session any SMF (Network Function) in the SMF (Network Function) Set should be able to control the N4 (Service-based Interface) session with the UPF (Network Function) (however, at any given time, only one SMF (Network Function) in the SMF (Network Function) Set will control the UPF (Network Function) for a given UE (Network Function)'s PDU Session).
A Control Plane NF (Network Function) is composed of one or multiple NF (Network Function) Services. Within a NF (Network Function) a NF (Network Function) service may have multiple instances. These multiple NF (Network Function) Service instances can be grouped into NF (Network Function) Service Set if they are interchangeable with each other because they share the same context data.
NOTE:	The actual mapping of instances to a given Set is up to deployment.
The NF (Network Function) producer instance is the NF (Network Function) instance which host the NF (Network Function) Service Producer. When the NF (Network Function) producer instance is not available, another NF (Network Function) producer instance within the same NF (Network Function) Set is selected.
For Direct Communication mode, the NF (Network Function) Service consumer may subscribe to status change notifications of NF (Network Function) instance from the NRF (Network Function). If the NF (Network Function) Service consumer is notified by the NRF (Network Function) or detects by itself (e.g. request is not responded) that the NF (Network Function) producer instance is not available anymore, another available NF (Network Function) producer instance within the same NF (Network Function) Set is selected by the NF (Network Function) Service consumer.
For Indirect Communication mode, the SCP (Network Function) or NF (Network Function) Service consumer may subscribe to status change notifications of NF (Network Function) instance from the NRF (Network Function) and selects another NF (Network Function) producer instance within the same NF (Network Function) Set if the original NF (Network Function) producer instance serving the UE (Network Function) is not available anymore.
NOTE:	It is up to the implementation on how the SCP (Network Function) knows a NF (Network Function) producer instance is not available anymore.
When multiple NF (Network Function) Service instances within a NF (Network Function) Service Set are exposed to the NF (Network Function) Service consumer or SCP (Network Function) and the failure of NF (Network Function) Service instance is detected or notified by the NRF (Network Function), i.e. it is not available anymore, the NF (Network Function) Service consumer or SCP (Network Function) selects another NF (Network Function) Service instance of the same NF (Network Function) Service Set within the NF (Network Function) instance, if available. Otherwise the NF (Network Function) Service consumer or SCP (Network Function) selects a different NF (Network Function) instance within the same NF (Network Function) Set.
NOTE:	The NF (Network Function) Producer instance can change the NF (Network Function) Service instance in the response to the service request.
When multiple NF (Network Function) Service instances within a NF (Network Function) Service Set are exposed to the NF (Network Function) Service consumer or SCP (Network Function) as a single NF (Network Function) Service, the reliability, i.e. the selection of an alternative NF (Network Function) Service instance is handled within the NF (Network Function) instance.
Network Function/NF (Network Function) Service Context Transfer Procedures allow transfer of Service Context of a NF (Network Function)/NF (Network Function) Service from a Source NF (Network Function)/NF (Network Function) Service Instance to the Target NF (Network Function)/NF (Network Function) Service Instance e.g. before the Source NF (Network Function)/NF (Network Function) Service can gracefully close its NF (Network Function)/NF (Network Function) Service. Service Context Transfer procedures are supported as specified in clause 4.26 of TS 23.502 [3].
Source NF (Network Function) / OA&M system determines when Source NF (Network Function) needs to transfer UE (Network Function) contexts to an NF (Network Function) in another NF (Network Function) set. Source NF (Network Function) should initiate this only for UE (Network Function)(s) that are not active in order to limit and avoid impacting services offered to corresponding UE (Network Function)(s).
The 5GS and the 5G QoS model allow classification and differentiation of specific services such as listed in clause 5.16, based on subscription-related and invocation-related priority mechanisms. These mechanisms provide abilities such as invoking, modifying, maintaining, and releasing QoS Flows with priority, and delivering QoS Flow packets according to the QoS characteristics under network congestion conditions.
Subscription-related Priority Mechanisms include the ability to prioritize flows based on subscription information, including the prioritization of RRC (Protocol) Connection Establishment based on Unified Access Control mechanisms and the establishment of prioritized QoS Flows.
Invocation-related Priority Mechanisms include the ability for the service layer to request/invoke the activation of prioritized QoS Flows through an interaction over Rx/N5 (Service-based Interface) and packet detection in the UPF (Network Function).
QoS Mechanisms applied to established QoS Flows include the ability to fulfil the QoS characteristics of QoS Flows through preservation of differentiated treatment for prioritized QoS Flow and resource distribution prioritization.
Messages associated with priority services that are exchanged over service-based interfaces may include a Message Priority header to indicate priority information, as specified in TS 23.502 [3] and TS 29.500 [49].
In addition, the separation of concerns between the service classification provided by the core network through the association of Service Data Flows to QoS, and the enforcing of QoS differentiation in (R)AN through the association of QoS Flows to Data Radio bearers, supports the prioritization of QoS Flows when a limitation of the available data radio bearers occurs.
In addition, it also includes the ability for the service layer to provide instructions on how to perform pre-emption of media flows with the same priority assigned through an interaction over Rx as defined in TS 23.503 [45].
Subscription-related mechanisms which are always applied:
-	(R)AN: During initial Access Network Connection Establishment, the Establishment Cause is set to indicate that special treatment is to be applied by the (R)AN in the radio resource allocation as specified in clause 5.2 for 3GPP access.
-	UDM (Network Function): As defined in clause 5.2.3 of TS 23.502 [3], the UE (Network Function) subscription data in the UDM (Network Function) contains an MPS subscription indication (i.e. MPS priority) and an MCX subscription indication (i.e. MCX priority) for the UE (Network Function) that has subscription to MPS and MCX, respectively. The MPS priority and the MCX priority, if available, are provided to the AMF (Network Function) via the Registration or the UE (Network Function) Configuration Update procedure as defined in clause 4.2 of TS 23.502 [3].
-	AMF (Network Function): Following Access Network Connection Establishment, the receipt of the designated Establishment Cause (i.e. high priority access) by the AMF (Network Function) will result in priority handling of the "Initial UE (Network Function) Message" received as part of the Registration procedures of clause 4.2.2 of TS 23.502 [3]. If the AMF (Network Function) did not receive a designated Establishment Cause (i.e. high priority access), but when the AMF (Network Function) determines that there is a MPS priority (or MCX priority) in the UDM (Network Function) for that UE (Network Function), the AMF (Network Function) shall provide priority handling for that UE (Network Function) at that time and shall provide the MPS priority (or MCX priority) to the UE (Network Function) via the Registration or the UE (Network Function) Configuration Update procedure, as defined in clause 4.2 of TS 23.502 [3]. In addition, certain exemptions to Control Plane Congestion and Overload Control are provided as specified in clause 5.19.
Subscription-related mechanisms which are conditionally applied:
-	UE (Network Function): When barring control parameters are broadcast by the RAN (Network Function), access barring based on Access Identity(es) configured in the USIM and/or an Access Category is applied prior to an initial upstream transmission for the UE (Network Function) which provides a mechanism to limit transmissions from UEs categorized as non-prioritized, while allowing transmissions from UEs categorized as prioritized (such as MPS subscribed UEs), during the RRC (Protocol) Connection Establishment procedure as specified in clause 5.2.
-	UDM (Network Function): One or more ARP priority levels are assigned for prioritized or critical services. The ARP of the prioritized QoS Flows for each DN (Network Function) is set to an appropriate ARP priority level. The 5QI is from the standard value range as specified in clause 5.7.2.7. In addition, Priority Level may be configured for the standardized 5QIs, and if configured, it overwrites the default value specified in the QoS characteristics Table 5.7.4-1.
-	PCF (Network Function): The "IMS Signalling Priority" information is set for the subscriber in the UDM (Network Function), and the PCF (Network Function) modifies the ARP of the QoS Flow used for IMS signalling, for each DN (Network Function) which supports prioritized services leveraging on IMS signalling, to an appropriate ARP priority level assigned for that service.
The generic mechanisms used based on invocation-related Priority Mechanisms for prioritised services are based an interaction with an Application (Protocol) Function and between the Application (Protocol) Function and the PCF (Network Function) over Rx/N5 (Service-based Interface) interface.
These mechanisms apply to mobile originated as well as mobile terminated SIP call/sessions (clause 5.21 of TS 23.228 [15]) and Priority PDU connectivity services including MPS for Data Transport Service.
NOTE 1:	Clause 5.21 of TS 23.228 [15] is applicable to 5GS, with the understanding that the term PCRF corresponds to PCF (Network Function) in the 5GS.
Invocation-related mechanisms for Mobile Originations e.g. via SIP/IMS:
-	PCF (Network Function): When an indication for a session arrives over the Rx/N5 (Service-based Interface) Interface and the UE (Network Function) does not have priority for the signalling QoS Flow, the PCF (Network Function) derives the ARP and 5QI parameters, plus associated QoS characteristics as appropriate, of the QoS Flow for Signalling as per Service Provider policy as specified in clause 6.1.3.11 of TS 23.503 [45].
-	PCF (Network Function): For sessions such as MPS, when establishing or modifying a QoS Flow for media as part of the session origination procedure, the PCF (Network Function) selects the ARP and 5QI parameters, plus associated QoS characteristics as appropriate, to provide priority treatment to the QoS Flow(s).
-	PCF (Network Function): When all active sessions to a particular DN (Network Function) are released, and the UE (Network Function) is not configured for priority treatment to that particular PDU Session for a DN (Network Function), the PCF (Network Function) will downgrade the IMS Signalling QoS Flows from appropriate settings of the ARP and 5QI parameters, plus associated QoS characteristics as appropriate, to those entitled by the UE (Network Function) based on subscription.
Invocation-related mechanisms for Mobile Terminations e.g. via SIP/IMS:
-	PCF (Network Function): When an indication for a session arrives over the Rx/N5 (Service-based Interface) Interface, mechanisms as described above for Mobile Originations are applied.
-	UPF (Network Function): If an IP  (Protocol)packet arrives at the UPF (Network Function) for a UE (Network Function) that is CM-IDLE, the UPF (Network Function) sends a "Data Notification" including the information to identify the QoS Flow for the DL data packet to the SMF (Network Function), as specified in clause 4.2.3.3 of TS 23.502 [3].
-	SMF (Network Function): If a " Data Notification" message arrives at the SMF (Network Function) for a QoS Flow associated with an ARP priority level value that is entitled for priority use, delivery of priority indication during the Paging procedure is provided by inclusion of the ARP in the N11 (Service-based Interface) interface "N1N2MessageTransfer" message, as specified in clause 4.2.3.3 of TS 23.502 [3].
-	AMF (Network Function): If an "N1N2MessageTransfer" message arrives at the AMF (Network Function) containing an ARP priority level value that is entitled for priority use, the AMF (Network Function) handles the request with priority and includes the "Paging Priority" IE in the N2 (Non-service-based Interface) (Service-based Interface) "Paging" message set to a value assigned to indicate that there is an IP  (Protocol)packet at the UPF (Network Function) entitled to priority treatment, as specified in clause 4.2.3.3 of TS 23.502 [3].
-	SMF (Network Function): For a UE (Network Function) that is not configured for priority treatment, upon receiving the "N7 (Service-based Interface) Session Management Policy Modification" message from the PCF (Network Function) with an ARP priority level that is entitled for priority use, the SMF (Network Function) sends an "N1N2MessageTransfer" to update the ARP for the Signalling QoS Flows, as specified in clause 4.3.3.2 of TS 23.502 [3].
-	AMF (Network Function): Upon receiving the "N1N2MessageTransfer" message from the SMF (Network Function) with an ARP priority level that is entitled for priority use, the AMF (Network Function) updates the ARP for the Signalling QoS Flows, as specified in clause 4.3.3.2 of TS 23.502 [3].
-	(R)AN: Inclusion of the "Paging Priority" in the N2 (Non-service-based Interface) (Service-based Interface) "Paging" message triggers priority handling of paging in times of congestion at the (R)AN as specified in clause 4.2.3.3 of TS 23.502 [3].
Invocation-related mechanisms for the Priority PDU connectivity services:
-	PCF (Network Function): If the state of the Priority PDU connectivity services is modified from disabled to enabled, the QoS Flow(s) controlled by the Priority PDU connectivity services are established/modified to have the service appropriate settings of the ARP and 5QI parameters, plus associated QoS characteristics as appropriate, using the PDU Session Modification procedure as specified in clause 4.3.3 of TS 23.502 [3].
-	PCF (Network Function): If the state of Priority PDU connectivity services is modified from enabled to disabled, the QoS Flow(s) controlled by the Priority PDU connectivity services are modified from Priority PDU connectivity service appropriate settings of the ARP and 5QI parameters, plus associated QoS characteristics as appropriate, to those entitled by the UE (Network Function) as per subscription, using the PDU Session Modification procedure as specified in clause 4.3.3 of TS 23.502 [3].
Invocation-related mechanisms for MPS for Data Transport Service:
-	MPS for Data Transport Service follows the same steps as those for Priority PDU connectivity services. The QoS Flows that will be subject to MPS for Data Transport Service are based on operator policy and regulations by means of local PCF (Network Function) configuration.
NOTE 2:	If no configuration is provided, MPS for Data Transport Service applies to the QoS Flow associated with the default QoS rule.
Mechanisms applied to established QoS Flows:
-	(R)AN: QoS Flows requested in the Xn "Handover Request" or N2 (Non-service-based Interface) (Service-based Interface) "Handover Request" which are marked as entitled to priority by virtue of inclusion of an ARP value from the set allocated by the Service Provider for prioritised services are given priority over requests for QoS Flows which do not include an ARP from the set as specified in clause 4.9 of TS 23.502 [3].
-	SMF (Network Function): Congestion management procedures in the SMF (Network Function) will provide priority to QoS Flows established for sessions during periods of extreme overload. Prioritised services are exempt from any session management congestion controls. See clause 5.19.
-	AMF (Network Function): Congestion management procedures in the AMF (Network Function) will provide priority to any Mobility Management procedures required for the prioritised services during periods of extreme overload. Prioritised services are exempt from any Mobility Management congestion controls. See clause 5.19.5.
-	QoS Flows whose ARP parameter is from the set allocated by the Service Provider for prioritised services' use shall be exempt from release during QoS Flow load rebalancing.
-	(R)AN, UPF (Network Function): IMS Signalling Packets associated with prioritised services' use are handled with priority. Specifically, during times of severe congestion when it is necessary to drop packets on the IMS Signalling QoS Flow, or QoS Flow supporting MPS for Data Transport Service signalling, to ensure network stability, these FEs shall drop packets not associated with priority signalling such as MPS or Mission Critical services before packets associated with priority signalling. See clauses 5.16.5 and 5.16.6.
-	(R)AN, UPF (Network Function): During times of severe congestion when it is necessary to drop packets on a media QoS Flow to ensure network stability, these FEs shall drop packets not associated with priority sessions such as MPS or Mission Critical services before packets associated with priority sessions. See clauses 5.16.5 and 5.16.6.
Asynchronous type communication (ATC) enables 5GC to delay synchronizing UE (Network Function) context with the UE (Network Function), so as to achieve an efficient signalling overhead and increase system capacity. The support of ATC is optional for the AMF (Network Function).
5GC supports asynchronous type communication with the following functionality:
-	Capability to store the UE (Network Function) context based on the received message, and synchronize the UE (Network Function) context with the involved network functions or UE (Network Function) later;
For network function (e.g. PCF (Network Function), UDM (Network Function), etc.) triggered signalling procedure (e.g. network triggered Service Request procedure, network triggered PDU Session Modification procedure, etc.), if the UE (Network Function) CM state in the AMF (Network Function) is CM-IDLE state and the requesting network function indicates to the AMF (Network Function) the ATC is allowed for the signalling, if the AMF (Network Function) supports the ATC feature, the AMF (Network Function) may update and store the UE (Network Function) context based on the received message without paging UE (Network Function) immediately. When the UE (Network Function) CM state in the AMF (Network Function) enters CM-CONNECTED state, the AMF (Network Function) forwards N1 (Non-service-based Interface) (Service-based Interface) and N2 (Non-service-based Interface) (Service-based Interface) message to synchronize the UE (Network Function) context with the (R)AN and/or the UE (Network Function).
If the originating NF (Network Function) does not require immediate delivery, it may indicate that the AMF (Network Function) is allowed to use ATC.
NOTE:	Pre-Rel-17 AMF (Network Function) implementation cannot decode the indication that ATC is allowed.
This feature, when activated by the user, prevents traffic via 3GPP access of all IP  (Protocol)packets, Unstructured and Ethernet data except for those related to 3GPP PS Data Off Exempt Services. The 3GPP PS Data Off Exempt Services are a set of operator services, defined in TS 22.011 [25] and TS 23.221 [23], that are the only allowed services when the 3GPP PS Data Off feature has been activated by the user. The 5GC shall support 3GPP PS Data Off operation in both non-roaming and roaming scenarios.
UEs may be configured with up to two lists of 3GPP PS Data Off Exempt Services and the list(s) are provided to the UEs by HPLMN via Device Management or UICC provisioning. When the UE (Network Function) is configured with two lists, one list is valid for the UEs camping in the home PLMN and the other list is valid for any VPLMN the UE (Network Function) is roaming in. When the UE (Network Function) is configured with a single list, without an indication to which PLMNs the list is applicable, then this list is valid for the home PLMN and any PLMN the UE (Network Function) is roaming in.
NOTE 1:	The operator needs to ensure coordinated list(s) of 3GPP Data Off Exempt Services provisioned in the UE (Network Function) and configured in the network.
The UE (Network Function) reports its 3GPP PS Data Off status in PCO (Protocol Configuration Option) to (H-)SMF (Network Function) during UE (Network Function) requested PDU Session Establishment procedure for establishment of a PDU Session associated with 3GPP access and/or non-3GPP access. The UE (Network Function) does not need to report PS Data Off status during the PDU Session Establishment procedure for handover of the PDU Session between 3GPP access and non 3GPP access if 3GPP PS Data Off status is not changed since the last report. The PS Data Off status for a PDU Session does not affect data transfer over non-3GPP access.
If 3GPP PS Data Off is activated, the UE (Network Function) prevents the sending of uplink IP  (Protocol)packets, Unstructured and Ethernet data except for those related to 3GPP PS Data Off Exempt Services, based on the pre-configured list(s) of Data Off Exempt Services.
If 3GPP PS Data Off is activated for a UE (Network Function) with MA PDU Sessions established through the ATSSS feature (see clause 5.32), the data transferred over the non-3GPP access of the MA PDU sessions are unaffected, which is ensured by the policy for ATSSS Control as specified in clause 5.32.3.
The UE (Network Function) shall immediately report a change of its 3GPP PS Data Off status in PCO by using UE (Network Function) requested PDU Session Modification procedure. This also applies to the scenario of inter-RAT mobility to NG-RAN (Network Function) and to scenarios where the 3GPP PS Data Off status is changed when the session management back-off timer is running as specified in clause 5.19.7.3 and clause 5.19.7.4. For UEs in Non-Allowed Area (or not in Allowed Area) as specified in clause 5.3.4.1, the UE (Network Function) shall also immediately report a change of its 3GPP PS Data Off status for the PDU Session. For UEs moving out of LADN area and the PDU Session is still maintained as specified in clause 5.6.5, the UE (Network Function) shall also immediately report a change of its 3GPP PS Data Off status for the PDU Session.
The additional behaviour of the SMF (Network Function) for 3GPP PS Data Off is controlled by local configuration or policy from the PCF (Network Function) as defined in TS 23.503 [45].
NOTE 2:	For the PDU Session used for IMS services, the 3GPP Data Off Exempt Services are enforced in the IMS domain as specified TS 23.228 [15]. Policies configured in the (H-)SMF (Network Function)/PCF (Network Function) need to ensure those services are always allowed when the 3GPP Data Off status of the UE (Network Function) is set to "activated".
5GS supports tracing as described in TS 32.421 [66]. 5GS support may include subscriber tracing (tracing targeting a SUPI) or equipment tracing (tracing targeting a PEI) but also other forms of tracing further described in TS 32.421 [66].
NOTE 1:	TS 23.501 / TS 23.502 [3] / TS 23.503 [45] only describe how 5GS signalling supports delivery of Trace Requirements about a UE (Network Function) (Signalling Based Activation/Deactivation of Tracing). OAM delivery of tracing requirements as well as the transfer of tracing results to one or more Operations Systems are out of scope of these documents.
The content of Trace Requirements about a UE (Network Function) (e.g. trace reference, address of the Trace Collection Entity, etc.) is defined in TS 32.421 [66].
Trace Requirements about a UE (Network Function) may be configured in subscription data of the UE (Network Function) and delivered together with other subscription data by the UDM (Network Function) towards the AMF (Network Function), the SMF (Network Function) and/or the SMSF (Network Function).
The AMF (Network Function) propagates Trace Requirements about a UE (Network Function) received from the UDM (Network Function) to network entities not retrieving subscription information from UDM (Network Function), i.e. to the 5G-AN, to the AUSF (Network Function) and to the PCF (Network Function). The AMF (Network Function) also propagates Trace Requirements to the SMF (Network Function) and to the SMSF (Network Function). If the I-SMF (Network Function) or V-SMF (Network Function) is needed for the PDU session, the AMF (Network Function) propagates Trace Requirements to the I-SMF (Network Function) or V-SMF (Network Function). The I-SMF (Network Function) or V-SMF (Network Function) also propagates Trace Requirements received from the AMF (Network Function) to the I-UPF (Network Function) or V-UPF (Network Function) (over N4 (Service-based Interface)).
Trace Requirements about a UE (Network Function) may be sent by the AMF (Network Function) to the 5G-AN as part of:
-	the N2 (Non-service-based Interface) (Service-based Interface) procedures used to move the UE (Network Function) from CM-IDLE to CM-CONNECTED or,
-	the N2 (Non-service-based Interface) (Service-based Interface) procedures to request a Hand-over from a target NG-RAN (Network Function) or,
-	a stand-alone dedicated N2 (Non-service-based Interface) (Service-based Interface) procedure when tracing is activated while the UE (Network Function) is CM-CONNECTED.
Trace Requirements about a UE (Network Function) sent to a 5G-AN shall not contain information on the SUPI or on the PEI of the UE (Network Function). Trace Requirements are directly sent from Source to Target NG-RAN (Network Function) in the case of Xn Hand-Over.
The SMF (Network Function) propagates Trace Requirements about a UE (Network Function) received from the UDM (Network Function) to the UPF (Network Function) (over N4 (Service-based Interface)) and to the PCF (Network Function). The SMF (Network Function) provides Trace Requirements to the PCF (Network Function) when it has selected a different PCF (Network Function) than the one received from the AMF (Network Function).
Once the SMF (Network Function) or the SMSF (Network Function) has received subscription data, Trace Requirements received from UDM (Network Function) supersede Trace requirements received from the AMF (Network Function). Trace Requirements are exchanged on N26 (Service-based Interface) between the AMF (Network Function) and the MME.
5GS supports 5G LAN-type service as defined in clause 5.29. 5G LAN-type service includes the 5G VN group management that can be configured by a network administrator.
The parameters for 5G VN group is defined in clause 5.29.
The 5G VN group parameters about a UE (Network Function) may be configured in subscription data of the UE (Network Function) and delivered together with other subscription data by the UDM (Network Function) towards the AMF (Network Function) and SMF (Network Function).
The purpose of the Configuration Transfer is to enable the transfer of information between two RAN (Network Function) nodes at any time via NG interface and the Core Network. An example of application is to exchange the RAN (Network Function) node's IP  (Protocol)addresses in order to be able to use Xn interface between the NG-RAN (Network Function) node for Self-Optimised Networks (SON), as specified in TS 38.413 [34].
Configuration Transfer between two RAN (Network Function) node provides a generic mechanism for the exchange of information between applications belonging to the RAN (Network Function) nodes.
In order to make the information transparent for the Core Network, the information is included in a transparent container that includes source and target RAN (Network Function) node addresses, which allows the Core Network nodes to route the messages. The mechanism is depicted in figure 5.26 1.

Figure 5.26-1: inter NG-RAN (Network Function) Configuration Transfer basic network architecture
The NG-RAN (Network Function) transparent containers are transferred from the source NG-RAN (Network Function) node to the destination NG-RAN (Network Function) node by use of Configuration Transfer messages.
A Configuration Transfer message is used from the NG-RAN (Network Function) node to the AMF (Network Function) over N2 (Non-service-based Interface) (Service-based Interface) interface, a AMF (Network Function) Configuration Transfer message is used from the AMF (Network Function) to the NG-RAN (Network Function) over N2 (Non-service-based Interface) (Service-based Interface) interface, and a Configuration Transfer Tunnel message is used to tunnel the transparent container from a source AMF (Network Function) to a target AMF (Network Function) over the N14 (Service-based Interface) interface.
Each Configuration Transfer message carrying the transparent container is routed and relayed independently by the core network node(s).
All the Configuration Transfer messages contain the addresses of the source and destination RAN (Network Function) nodes. An NG-RAN (Network Function) node is addressed by the Target NG-RAN (Network Function) node identifier.
The following description applies to all the Configuration Transfer messages used for the exchange of the transparent container.
The source RAN (Network Function) node sends a message to its core network node including the source and destination addresses. The AMF (Network Function) uses the destination address to route the message to the correct AMF (Network Function) via the N14 (Service-based Interface) interface.
The AMF (Network Function) connected to the destination RAN (Network Function) node decides which RAN (Network Function) node to send the message to, based on the destination address.
The AMF (Network Function) performs relaying between N2 (Non-service-based Interface) (Service-based Interface) and N14 (Service-based Interface) messages as described in TS 38.413 [34], TS 29.518 [71].
This clause describes 5G System features that can be used independently or in combination to enable time-sensitive communication, time synchronization and deterministic networking:
-	Delay-critical GBR;
-	A hold and forward mechanism to schedule traffic as defined in IEEE Std 802.1Q [98] for Ethernet PDU Sessions in DS-TT and NW-TT (see clause 5.27.4) to de-jitter flows that have traversed the 5G System if the 5G System is to participate transparently as a bridge in a TSN network;
-	TSC Assistance Information: describes TSC flow traffic characteristics as described in clause 5.27.2 that may be provided optionally for use by the gNB, to allow more efficiently schedule radio resources for periodic traffic and applies to PDU Session type Ethernet and IP.
-	Time Synchronization: describes how 5GS can operate as a PTP Relay (IEEE Std 802.1AS [104]), as a Boundary Clock or as Transparent Clock (IEEE Std 1588 [126]) for PDU Session type Ethernet and IP  (Protocol)and how 5GS can detect and report the status of the time synchronization.
-	RAN (Network Function) feedback for BAT offset and adjusted periodicity describes a mechanism supported by NG-RAN (Network Function) and 5G CN that enables AF (Network Function) to adapt to received BAT offset and adjusted periodicity from NG-RAN (Network Function) for a given traffic flow.
The 5G System integration as a bridge in an IEEE 802.1 TSN network as described in clause 5.28 can make use of all features listed above.
To support any of the above features to enable time-sensitive communication, time synchronization and deterministic networking, during the PDU Session establishment, the UE (Network Function) shall request to establish a PDU Session as an always-on PDU Session, and the PDU Sessions are established as Always-on PDU session as described in clause 5.6.13. In this release of the specification, to use any of the above features to enable time-sensitive communication, time synchronization and deterministic networking:
-	Home Routed PDU Sessions are not supported;
-	PDU Sessions are supported only for SSC mode 1;
-	Service continuity is not supported when the UE (Network Function) moves from 5GS to EPS .i.e. interworking with EPS is not supported for a PDU Session for time synchronization or TSC or deterministic networking.
For supporting time synchronization service, the 5GS is configured to operate in one or multiple PTP instances and to operate in one of the following modes (if supported) for each PTP instance:
1)	as time-aware system as described in IEEE Std 802.1AS [104],
2)	as Boundary Clock as described in IEEE Std 1588 [126], provisioned by the profiles supported by this 3GPP specification including SMPTE Profile for Use of IEEE Std 1588 [126] Precision Time Protocol in Professional Broadcast Applications ST 2059-2:2015 [127];
NOTE 1:	Via proper configuration of the IEEE Std 1588 [126] data set members, the 5G internal system clock can become the time source for the PTP grandmaster function for the connected networks in the case of mode 1 and mode 2.
NOTE 2:	In some cases where the 5G internal system clock is the time source for the PTP grandmaster function for the connected networks, it might not be required for the UE (Network Function) to receive gPTP or PTP messages over user plane. The UE (Network Function) and DS-TT uses the 5G timing information and generates the necessary gPTP or PTP message for the end station, if needed (this is implementation specific).
3)	as peer-to-peer Transparent Clock as described in IEEE Std 1588 [126], provisioned by the profiles supported by this 3GPP specification including SMPTE Profile for Use of IEEE Std 1588 Precision Time Protocol in Professional Broadcast Applications ST 2059-2:2015 [127]; or
4)	as end-to-end Transparent Clock as described in IEEE Std 1588 [126], provisioned by the profiles supported by this 3GPP specification including SMPTE Profile for Use of IEEE Std 1588 Precision Time Protocol in Professional Broadcast Applications ST 2059-2:2015 [127].
NOTE 3:	When the GM is external, the operation of 5GS as Boundary Clock assumes that profiles that are supported by the 5GS allows the exemption specified in clauses 9.5.9 and 9.5.10 of IEEE Std 1588 [126] where the originTimestamp (or preciseOriginTimestamp in case of two-step operation) is not required to be updated with the syncEventEgressTimestamp (and a Local PTP Clock locked to the external GM). As described in clause 5.27.1.2.2, only correctionField is updated with the 5GS residence time and link delay, in a similar operation as specified by IEEE Std 802.1AS [104].
The configuration of the time synchronization service in 5GS for option 1 by TSN AF (Network Function) and CNC is described in clause 5.28.3, and for options 1-4 by AF (Network Function)/NEF (Network Function) and TSCTSF (Network Function) in clause 5.27.1.8 and clause 5.28.3.
The 5GS shall be modelled as an IEEE Std 802.1AS [104] or IEEE Std 1588 [126] compliant entity based on the above configuration.
NOTE 4:	This release of the specification does not support the PTP management mechanism or PTP management messages as described in clause 15 in IEEE Std 1588 [126].
The DS-TT and NW-TT at the edge of the 5G system may support the IEEE Std 802.1AS [104] or other IEEE Std 1588 [126] profiles' operations respective to the configured mode of operation. The UE (Network Function), gNB, UPF (Network Function), NW-TT and DS- TTs are synchronized with the 5G GM (i.e. the 5G internal system clock) which shall serve to keep these network elements synchronized. The TTs located at the edge of 5G system fulfil some functions related to IEEE Std 802.1AS [104] and may fulfil some functions related to IEEE Std 1588 [126], e.g. (g)PTP support and timestamping. Figure 5.27.1-1 illustrates the 5G and PTP grandmaster (GM) clock distribution model via 5GS.

Figure 5.27.1-1: 5G system is modelled as PTP instance for supporting time synchronization
Figure 5.27.1-1 depicts the two synchronizations systems considered: the 5G Clock synchronization and the (g)PTP domain synchronization.
-	5G Access Stratum-based Time Distribution: Used for NG RAN (Network Function) synchronization and also distributed to the UE (Network Function). The 5G Access Stratum-based Time Distribution over the radio interface towards the UE (Network Function) is specified in TS 38.331 [28]. This method may be used to either further distribute the 5G timing to devices connected to a UE (Network Function) (using implementation-specific means) or to support the operation of the (g)PTP-based time distribution method.
-	(g)PTP-based Time Distribution: Provides timing among entities in a (g)PTP domain. This process follows the applicable profiles of IEEE Std 802.1AS [104] or IEEE Std 1588 [126]. This method relies on the 5G access stratum-based time distribution method to synchronize the UE (Network Function)/DS-TT and on the 5GS time synchronization to synchronize the gNB (which, in turn, may synchronize the DS-TT) and the NW-TT.
The gNB needs to be synchronized to the 5G GM clock.
The 5GS supports two methods for determining the grandmaster PTP Instance and the time-synchronization spanning tree.
-	Method a), BMCA procedure.
-	Method b), local configuration.
This is further described in clause 5.27.1.6.
The 5G internal system clock shall be made available to all user plane nodes in the 5G system. The UPF (Network Function) and NW-TT may get the 5G internal system clock via the underlying PTP compatible transport network with mechanisms outside the scope of 3GPP. The 5G internal system clock shall be made available to UE (Network Function) with signalling of time information related to absolute timing of radio frames as described in TS 38.331 [28]. The 5G internal system clock shall be made available to DS-TT by the UE (Network Function).
The mechanisms for distribution of TSN GM clock and time-stamping described in this clause are according to IEEE Std 802.1AS [104].
NOTE 1:	It means Externally-observable behaviour of the 5GS bridge needs to comply with IEEE Std 802.1AS [104].
For downlink Time Synchronization, upon reception of a downlink gPTP message from NW-TT port in Follower state, the NW-TT makes an ingress timestamping (TSi) for each gPTP event (Sync) message and uses the cumulative rateRatio received inside the gPTP message payload (carried within Sync message for one-step operation or Follow_up message for two-step operation) to calculate the link delay from the upstream TSN node (gPTP entity connected to NW-TT) expressed in TSN GM time as specified in IEEE Std 802.1AS [104]. NW-TT then calculates the new cumulative rateRatio (i.e. the cumulative rateRatio of the 5GS) as specified in IEEE Std 802.1AS [104] and modifies the gPTP message payload (carried within Sync message for one-step operation or Follow_up message for two-step operation) as follows:
-	Adds the link delay from the upstream TSN node in TSN GM time to the correction field.
-	Replaces the cumulative rateRatio received from the upstream TSN node with the new cumulative rateRatio.
-	Adds TSi in the Suffix field of the gPTP packet as described in clause H.2.
The UPF (Network Function)/NW-TT uses the ingress port number of the NW-TT, and domainNumber and sdoId in the received gPTP message to assign the gPTP message to a PTP instance in the NW-TT. If the NW-TT does not have a matching PTP instance, the UPF (Network Function)/NW-TT discards the message. The UPF (Network Function)/NW-TT then forwards the gPTP message from TSN network to the PTP ports in DS-TT(s) in Leader state within this PTP instance via PDU sessions terminating in this UPF (Network Function) that the UEs have established to the TSN network. The UPF (Network Function)/NW-TT also forwards the gPTP message to the PTP ports in NW-TT in Leader state within this PTP instance. All gPTP messages are transmitted on a QoS Flow that complies with the residence time upper bound requirement specified in IEEE Std 802.1AS [104].
NOTE 2:	Leader and Follower terms in this specification maps to Master and Slave terms respectively for (g)PTP time synchronization as specified in IEEE Std 802.1AS [104] and IEEE Std 1588 [126]. This terminology can require update depending on the IEEE 1588 WG response to SA WG2.
NOTE 3:	The sum of the UE (Network Function)-DS-TT residence time and the PDB of the QoS Flow needs to be lower than the residence time upper bound requirement for a time-aware system specified in IEEE Std 802.1AS [104] in the following cases:
a)	If the PTP port in DS-TT is in Follower state and a PTP port in the NW-TT is in Leader state; or 
b)	a PTP port in DS-TT is in Leader state and a PTP port in NW-TT is in Follower state.
NOTE 4:	If the PTP port in DS-TT is in a Follower state, and a PTP port in another DS-TT is in Leader state, then the sum of the residence time for these two DS-TT ports and the PDB of the QoS flow of the two PDU Sessions needs to be lower than the residence time upper bound requirement for a time-aware system specified in IEEE Std 802.1AS [104].
A UE (Network Function) receives the gPTP messages and forwards them to the DS-TT. The DS-TT then creates egress timestamping (TSe) for the gPTP event (Sync) messages for external TSN working domains. The difference between TSi and TSe is considered as the calculated residence time spent within the 5G system for this gPTP message expressed in 5GS time. The DS-TT then uses the rateRatio contained inside the gPTP message payload (carried within Sync message for one-step operation or Follow_up message for two-step operation) to convert the residence time spent within the 5GS in TSN GM time and modifies the payload of the gPTP message that it sends towards the downstream TSN node (gPTP entity connected to DS-TT) as follows:
-	Adds the calculated residence time expressed in TSN GM time to the correction field.
-	Removes Suffix field that contains TSi.
If the ingress DS-TT has indicated support of the IEEE Std 802.1AS [104] PTP profile as described in clause K.2.1 and the network has configured a PTP instance with the IEEE Std 802.1AS [104] PTP profile for the ingress DS-TT, the ingress DS-TT performs the following operations for received UL gPTP messages for the PTP instance:
-	Adds the link delay from the upstream TSN node (gPTP entity connected to DS-TT) in TSN GM time